*&---------------------------------------------------------------------*
*& Report  ZCHANGE_CONTROL1
*& developed by Jyotsna for QA as per QA guidlines.
***auth delegation added on 3.12.24 Jyotsna
*&---------------------------------------------------------------------*
**&---------------------------------------------------------------------*
*&tables used - ZDMS1,ZDMS2,ZDMS3,ZDMS4,ZDMS5,ZDMS6,PA0001,T001P,ZPASSW,ZDMS_GOS.
*ZDMS1- CONTAIN DATA AT THE TIME OF CREATION & DEPT. HEAD APPROVAL DATA, REVIEWER ACCEPTANCE & APPROVER ACCEPTANCE ALSO CC SUBJECT DATA ENTERED BY QA
*ZDMS2 CONTAIN ALL IMPACTED ACTIVITIES ENTERED BY RELEVENT USERS
*ZDMS3- THIS CONTAIN IMPACTED ACTIVITIES ENTERED BY QA ALONG WITH ITS TARGET DATE & COMPLETION DATE
*ZDMS4 - THIS CONTAIN CHANGE CONTROL NUMBER, QA DATA LIKE RPN, QA APPROVAL & TECHNICAL DIRECTOR APPROVAL.
*ZDMS4- IT ALSO CONTAIN CLOSURE DATA LIKE CLUSURE-I & CLOSURE-II, WHEN IT IS CLOSED & CLOSURE IS DONE BY WHOME.
*ZDMS5 - THIS IS CHANGE CONTROL EXTENSION TABLE, MEANS TARGET CLOSURE DATA IS ARRIVED BUT USER STILL NEED SOME TIME FOR CLOSURE ACTIVITIES, THEN USER HAS
*TO FILL EXTENSION DATA.
*ZDMS6 - Change Control DATA for Extension - Responcible Departments
*ZDMS6 - THIS CONTAINS USER DATA FOR THOSE WHICH ARE RESPONCIBLE FOR EXTENSION.
*& TCODE 'ZQMS' - EVERY PERSON HAS TO LOGIN USING THEIR EMPLOYEE CODE & PASSWORD - EMP CODE, PASSORD & EMAIL IS IS STORED IN TABLE ZPASSW.
*1. INITIATOR HAS TO FILL DATA IN CHNAGE CONTROL & SAVE-ALL DATA WIL GATE SAVED IN TABLE ZDSM1.
*2. DEPT. HEAD HAS TO APPROVE & WRITE COMMENT IF ANY - DATA WILL BE SAVED IN TABLE ZDMS1.
*.3 IF ANY REVIEWER & APPROVER IS APPLICABLE THEN THIS DATA WILL BE SAVED IN TABLE ZDMS1.
*4. ONCE APPROVE, QA HAS TO ACCEPT , THE SYSTEM WILL INITIATE CHANGE CONTROL NUMBER - THIS DATA WILL BE SAVED TIN TABLE ZDMS4
*5.IF QA REJECETD.. IT WILL STAND AS REJECTED & NO FURTHER DATA...
*6.once QA APPROVED, QA WILL SELECT ALL REQUIRED DEPARTMENTS TO IMPACTED ACTIVITIES- THIS DATA WILL BE SAVED IN TABLE ZDMS2
*7 USER WILL ENTER THEIR IMPACTED ACTIVITIES & TARGET DATA, REMARK IF ANY- THIS DATA WILL BE STORED IN TABLE ZDMS2
*8. ONCE ALL USERS HAVE ENTERED ITS ACTIVITES, THEN QA HAS TO MAINTAIN THEIR RPM, THIS DATA WILL BE STORED IN TABLE ZDMS4
*9 QA HAS TO MAINTAIN ALL RELEVENT ACTIVITIES FOR ALL RELEVENT DEPARTMENT THIS DATA WILL BE STORED IN TABLE ZDMS.
*10 QA HS TO MAINTAIN TARGET CLOSUTE DATA- THIS DATA WILL BE SAVED IN TABLE ZDMS4.
*11. QA HEAD HAS TO APPROVE- & THEN TECH. DIRECTOR HAD TO APPROVE- THIS DATA WILL BE STORED IN TABLE ZDMS4.
*12. IF USER IS NOT ABLE TO COMPLETE THEIR ACTIVITY AS PER MENTIONED TARGET DATE, THEN USER HAS TO FILL EXTENSION REQUEST FORM -THIS DATA WILL SAVE IN TABLE ZDMS5.
*13 USER HAS TO SELECT ALL RESPONCIBLE DEPARTMENT FOR THEIR EXTENSION -THIS DATA WILL BE SAVED IN TABLE ZDMS6.
*14 RESPONCIBLE DEPARTMENT USER FOR CC EXTENSION HAS TO FILL DATA - THIS WILL BE STORED IN TABLE ZDMS6.
*15 ONCE USER, FILLED EXTENSION FORM, QA WILL AUTHORIZE THEIT GIVEN PERIOD - THIS DATA WILL STORE IN TABLE ZDMS5.
*16 FINALLY CLOSURE WILL BE DONE BY QA - THIS DATA WILL BE SAVED IN TABLE ZDMS4.
*&
*&---------------------------------------------------------------------*
REPORT ZCHANGE_CONTROL1_2 NO STANDARD PAGE HEADING LINE-SIZE 200.

TABLES : QALS,
         ZDMS1,
         ZDMS2,
         ZDMS3,
         ZDMS4,
         ZDMS5,  "8.8.21 for extension
         ZDMS6, "TABLE FOR DEPT FOR EXTENSION
         PA0001,
         T001P,
         T001W,
         ZPASSW,
         HRP1000,
         HRP1001,
         ZDMS_GOS,
         T500P,
*         ZQMS_DEPTHEAD,  "new table for department head
         ZQMS_DEPTHEAD1,  "new table for department head date wise impact on 12.5.24
         ZQMS_DEPTHEAD2,  "3.12.24
         PA0002,
         ZQMS_PRINT,
         pa0105,
         ZPA0001.
*         PA0105.

TYPE-POOLS:  SLIS.
DATA : V_FM TYPE RS38L_FNAM.
DATA : CONTROL  TYPE SSFCTRLOP.
DATA : W_SSFCOMPOP TYPE SSFCOMPOP.
DATA: MBLNR TYPE ZDMS1-MBLNR.
DATA: REV(1) TYPE C.
DATA: REV1(1) TYPE C.
DATA: RPN11(4) TYPE C.
DATA: RPN12(4) TYPE C.
DATA: RPN13(4) TYPE C.
DATA: RPNVAL1(4) TYPE C.

DATA: SQAREMARK1 TYPE ZDMS4-RTEXT1,
      SQAREMARK2 TYPE ZDMS4-RTEXT2,
      SQAREMARK3 TYPE ZDMS4-RTEXT3.

*-----------> Added by Karthik on 19.09.2019

DATA: LO_GOS_MANAGER TYPE REF TO CL_GOS_MANAGER,
      LS_BORIDENT    TYPE BORIDENT,
      LV_MBLNR       TYPE MBLNR.

*----------> End of Addition

DATA: G_REPID     LIKE SY-REPID,
      FIELDCAT    TYPE SLIS_T_FIELDCAT_ALV,
      WA_FIELDCAT LIKE LINE OF FIELDCAT,
      SORT        TYPE SLIS_T_SORTINFO_ALV,
      WA_SORT     LIKE LINE OF SORT,
      LAYOUT      TYPE SLIS_LAYOUT_ALV,
      L_GLAY      TYPE LVC_S_GLAY.

DATA : FCODE    TYPE TABLE OF SY-UCOMM,
       OK       LIKE SY-UCOMM,
       MESG(40) TYPE C.
DATA: QAAPPROVE(1) TYPE C.
DATA : CCNO         TYPE MKPF-MBLNR,
*       SYEAR(4)     TYPE C,
       YEAR1(4)     TYPE C,
       VBELN(10)    TYPE N,
       FINV(10)     TYPE N,
       VBELN1(5)    TYPE N,
       FINV1(5)     TYPE N,
       PLT(2)       TYPE C,
       FINVNUMB(20) TYPE C,
       FFMBLNR      TYPE ZDMS1-MBLNR,
       SDATE        TYPE SY-DATUM.
DATA: YEAR2(4) TYPE C.
DATA: CCPRT(1) TYPE C.
DATA: PDATUM TYPE ZQMS_PRINT-PDATUM,
      PUZEIT TYPE ZQMS_PRINT-PUZEIT.
DATA: REVCLDT TYPE SY-DATUM.
DATA: REVCLDATE TYPE SY-DATUM.  "REVISE CLOSE OUT DATE

DATA: CCN TYPE ZDMS4-CCNUMB1.
DATA: CCNUM1 TYPE ZDMS4-CCNUMB1.  "25.11.20
DATA : ENAME        TYPE PA0001-ENAME,
       DEPT         TYPE T001P-BTEXT,
       KUNNR        TYPE T001W-KUNNR,
       ANAME        TYPE PA0001-ENAME,
       INAME        TYPE PA0001-ENAME,
       DNAME        TYPE PA0001-ENAME,
       REVNAME      TYPE PA0001-ENAME,
       REV2NAME     TYPE PA0001-ENAME,
       REVPOS       TYPE HRP1000-STEXT,
       REV2POS      TYPE HRP1000-STEXT,
       REV1STAT(12) TYPE C,
       REV2STAT(12) TYPE C,
       IDEPT        TYPE T001P-BTEXT,
       STATUS(10)   TYPE C,
       CCNUMB1      TYPE ZDMS4-CCNUMB1,
       CCSTAT(32)   TYPE C,
       DEPTSTAT(12) TYPE C,
*       DEPT1      TYPE PA0001-BTRTL,
       S            TYPE I,
       REVER        TYPE I.
DATA: EXTACCEPT TYPE C.  "ACCEPT FOR EXTENSION
*DATA :  DEPTXT1  TYPE T001P-BTEXT,
*        DEPTXT2  TYPE T001P-BTEXT,
*        DEPTXT3  TYPE T001P-BTEXT,
*        DEPTXT4  TYPE T001P-BTEXT,
*        DEPTXT5  TYPE T001P-BTEXT,
*        DEPTXT6  TYPE T001P-BTEXT,
*        DEPTXT7  TYPE T001P-BTEXT,
*        DEPTXT8  TYPE T001P-BTEXT,
*        DEPTXT9  TYPE T001P-BTEXT,
*        DEPTXT10 TYPE T001P-BTEXT,
*        DEPTXT11 TYPE T001P-BTEXT,
*        DEPTXT12 TYPE T001P-BTEXT,
*        DEPTXT13 TYPE T001P-BTEXT,
*        DEPTXT14 TYPE T001P-BTEXT,
*        DEPTXT15 TYPE T001P-BTEXT,
*        DEPTXT16 TYPE T001P-BTEXT,
*        DEPTXT17 TYPE T001P-BTEXT,
*        DEPTXT18 TYPE T001P-BTEXT,
*        DEPTXT19 TYPE T001P-BTEXT,
*        DEPTXT20 TYPE T001P-BTEXT.

DATA : DEPTNAME  TYPE PA0001-ENAME,
       DEPTDT    TYPE SY-DATUM,
       DEPTTM    TYPE SY-UZEIT,
       PDEPT(10) TYPE C.  "30.1.22

DATA : IMPDEPTXT   TYPE T001P-BTEXT,
       IMPSTAT(20) TYPE C,
       IMPNAME     TYPE PA0001-ENAME,
       IMPDATE     TYPE SY-DATUM,
       IMPTM       TYPE SY-UZEIT,
       IMPTXT(4)   TYPE C.
DATA: DEPTTXT1(300) TYPE C,
      DEPTTXT2(300) TYPE C,
      DEPTTXT3(300) TYPE C,
      DEPTTXT4(300) TYPE C,
      DEPTTXT5(300) TYPE C.
DATA: COUNTD TYPE I.

DATA : IDEPT1  TYPE T001P-BTEXT,
       IDEPT2  TYPE T001P-BTEXT,
       IDEPT3  TYPE T001P-BTEXT,
       IDEPT4  TYPE T001P-BTEXT,
       IDEPT5  TYPE T001P-BTEXT,
       IDEPT6  TYPE T001P-BTEXT,
       IDEPT7  TYPE T001P-BTEXT,
       IDEPT8  TYPE T001P-BTEXT,
       IDEPT9  TYPE T001P-BTEXT,
       IDEPT10 TYPE T001P-BTEXT,
       IDEPT11 TYPE T001P-BTEXT,
       IDEPT12 TYPE T001P-BTEXT,
       IDEPT13 TYPE T001P-BTEXT,
       IDEPT14 TYPE T001P-BTEXT,
       IDEPT15 TYPE T001P-BTEXT,
       IDEPT16 TYPE T001P-BTEXT,
       IDEPT17 TYPE T001P-BTEXT,
       IDEPT18 TYPE T001P-BTEXT,
       IDEPT19 TYPE T001P-BTEXT,
       IDEPT20 TYPE T001P-BTEXT.

DATA : TSDEPT1  TYPE T001P-BTEXT,
       TSDEPT2  TYPE T001P-BTEXT,
       TSDEPT3  TYPE T001P-BTEXT,
       TSDEPT4  TYPE T001P-BTEXT,
       TSDEPT5  TYPE T001P-BTEXT,
       TSDEPT6  TYPE T001P-BTEXT,
       TSDEPT7  TYPE T001P-BTEXT,
       TSDEPT8  TYPE T001P-BTEXT,
       TSDEPT9  TYPE T001P-BTEXT,
       TSDEPT10 TYPE T001P-BTEXT,

       TSDEPT11 TYPE T001P-BTEXT,
       TSDEPT12 TYPE T001P-BTEXT,
       TSDEPT13 TYPE T001P-BTEXT,
       TSDEPT14 TYPE T001P-BTEXT,
       TSDEPT15 TYPE T001P-BTEXT,
       TSDEPT16 TYPE T001P-BTEXT,
       TSDEPT17 TYPE T001P-BTEXT,
       TSDEPT18 TYPE T001P-BTEXT,
       TSDEPT19 TYPE T001P-BTEXT,
       TSDEPT20 TYPE T001P-BTEXT.

DATA : IMPDEPT     TYPE PA0001-BTRTL,
       IMPDEPT1(2) TYPE C,
       IMDATE1     TYPE SY-DATUM.

DATA : INAME1  TYPE PA0001-ENAME,
       INAME2  TYPE PA0001-ENAME,
       INAME3  TYPE PA0001-ENAME,
       INAME4  TYPE PA0001-ENAME,
       INAME5  TYPE PA0001-ENAME,
       INAME6  TYPE PA0001-ENAME,
       INAME7  TYPE PA0001-ENAME,
       INAME8  TYPE PA0001-ENAME,
       INAME9  TYPE PA0001-ENAME,
       INAME10 TYPE PA0001-ENAME.

DATA : APPROVE1 TYPE ZDMS2-APPROVE,
       REJECT1  TYPE ZDMS2-REJECT,
       NA       TYPE ZDMS2-NA,
       NATEXT   TYPE ZDMS2-NATEXT,
       EBUDAT   TYPE SY-DATUM,
       EPERNR   TYPE PA0001-PERNR,
       UBUDAT   TYPE SY-DATUM,
*       ATEXT1   TYPE ZDMS2-ATEXT1,
       ATEXT1   TYPE STRING,
       ADATE1   TYPE ZDMS2-TDATE1,
       ATEXT2   TYPE STRING,
       ADATE2   TYPE ZDMS2-TDATE2,
       ATEXT3   TYPE STRING,
       ADATE3   TYPE ZDMS2-TDATE3,
       ATEXT4   TYPE STRING,
       ADATE4   TYPE ZDMS2-TDATE4,
       ATEXT5   TYPE STRING,
       ADATE5   TYPE ZDMS2-TDATE5,
       ADATE6   TYPE ZDMS2-CTDATE1,
       ADATE7   TYPE ZDMS2-CTDATE1,
       ADATE8   TYPE ZDMS2-CTDATE1,
       ADATE9   TYPE ZDMS2-CTDATE1,
       ADATE10  TYPE ZDMS2-CTDATE1.
*       AFOLW1   TYPE ZDMS2-FOLW1,
*       AFOLW2   TYPE ZDMS2-FOLW2,
*       AFOLW3   TYPE ZDMS2-FOLW3,
*       AFOLW4   TYPE ZDMS2-FOLW4,
*       AFOLW5   TYPE ZDMS2-FOLW5.

DATA : ACDATE1 TYPE ZDMS2-CTDATE1,
       ACDATE2 TYPE ZDMS2-CTDATE2,
       ACDATE3 TYPE ZDMS2-CTDATE3,
       ACDATE4 TYPE ZDMS2-CTDATE4,
       ACDATE5 TYPE ZDMS2-CTDATE5.

DATA : AREM1 TYPE ZDMS2-REM1,
       AREM2 TYPE ZDMS2-REM2,
       AREM3 TYPE ZDMS2-REM3,
       AREM4 TYPE ZDMS2-REM4,
       AREM5 TYPE ZDMS2-REM5.

DATA : BREM1 TYPE ZDMS2-REM1,
       BREM2 TYPE ZDMS2-REM2,
       BREM3 TYPE ZDMS2-REM3,
       BREM4 TYPE ZDMS2-REM4,
       BREM5 TYPE ZDMS2-REM5.

DATA : CREM1 TYPE ZDMS2-REM1,
       CREM2 TYPE ZDMS2-REM2,
       CREM3 TYPE ZDMS2-REM3,
       CREM4 TYPE ZDMS2-REM4,
       CREM5 TYPE ZDMS2-REM5.

DATA : DREM1 TYPE ZDMS2-REM1,
       DREM2 TYPE ZDMS2-REM2,
       DREM3 TYPE ZDMS2-REM3,
       DREM4 TYPE ZDMS2-REM4,
       DREM5 TYPE ZDMS2-REM5.

DATA : EREM1 TYPE ZDMS2-REM1,
       EREM2 TYPE ZDMS2-REM2,
       EREM3 TYPE ZDMS2-REM3,
       EREM4 TYPE ZDMS2-REM4,
       EREM5 TYPE ZDMS2-REM5.

DATA : FREM1 TYPE ZDMS2-REM1,
       FREM2 TYPE ZDMS2-REM2,
       FREM3 TYPE ZDMS2-REM3,
       FREM4 TYPE ZDMS2-REM4,
       FREM5 TYPE ZDMS2-REM5.

DATA : GREM1 TYPE ZDMS2-REM1,
       GREM2 TYPE ZDMS2-REM2,
       GREM3 TYPE ZDMS2-REM3,
       GREM4 TYPE ZDMS2-REM4,
       GREM5 TYPE ZDMS2-REM5.

DATA : HREM1 TYPE ZDMS2-REM1,
       HREM2 TYPE ZDMS2-REM2,
       HREM3 TYPE ZDMS2-REM3,
       HREM4 TYPE ZDMS2-REM4,
       HREM5 TYPE ZDMS2-REM5.

DATA : IREM1 TYPE ZDMS2-REM1,
       IREM2 TYPE ZDMS2-REM2,
       IREM3 TYPE ZDMS2-REM3,
       IREM4 TYPE ZDMS2-REM4,
       IREM5 TYPE ZDMS2-REM5.

DATA : JREM1 TYPE ZDMS2-REM1,
       JREM2 TYPE ZDMS2-REM2,
       JREM3 TYPE ZDMS2-REM3,
       JREM4 TYPE ZDMS2-REM4,
       JREM5 TYPE ZDMS2-REM5.

DATA : APPROVE2 TYPE ZDMS2-APPROVE,
       REJECT2  TYPE ZDMS2-REJECT,
       BTEXT1   TYPE STRING,
       BDATE1   TYPE ZDMS2-TDATE1,
       BTEXT2   TYPE STRING,
       BDATE2   TYPE ZDMS2-TDATE2,
       BTEXT3   TYPE STRING,
       BDATE3   TYPE ZDMS2-TDATE3,
       BTEXT4   TYPE STRING,
       BDATE4   TYPE ZDMS2-TDATE4,
       BTEXT5   TYPE STRING,
       BDATE5   TYPE ZDMS2-TDATE5,
       BDATE6   TYPE ZDMS2-CTDATE1,
       BDATE7   TYPE ZDMS2-CTDATE2,
       BDATE8   TYPE ZDMS2-CTDATE3,
       BDATE9   TYPE ZDMS2-CTDATE4,
       BDATE10  TYPE ZDMS2-CTDATE5.
*         BFOLW1   TYPE ZDMS2-FOLW1,
*         BFOLW2   TYPE ZDMS2-FOLW2,
*         BFOLW3   TYPE ZDMS2-FOLW3,
*         BFOLW4   TYPE ZDMS2-FOLW4,
*         BFOLW5   TYPE ZDMS2-FOLW5.

DATA : APPROVE3 TYPE ZDMS2-APPROVE,
       REJECT3  TYPE ZDMS2-REJECT,
       CTEXT1   TYPE STRING,
       CDATE1   TYPE ZDMS2-TDATE1,
       CTEXT2   TYPE STRING,
       CDATE2   TYPE ZDMS2-TDATE2,
       CTEXT3   TYPE STRING,
       CDATE3   TYPE ZDMS2-TDATE3,
       CTEXT4   TYPE STRING,
       CDATE4   TYPE ZDMS2-TDATE4,
       CTEXT5   TYPE STRING,
       CDATE5   TYPE ZDMS2-TDATE5,
       CDATE6   TYPE ZDMS2-CTDATE1,
       CDATE7   TYPE ZDMS2-CTDATE2,
       CDATE8   TYPE ZDMS2-CTDATE3,
       CDATE9   TYPE ZDMS2-CTDATE4,
       CDATE10  TYPE ZDMS2-CTDATE5.
*       CFOLW1   TYPE ZDMS2-FOLW1,
*       CFOLW2   TYPE ZDMS2-FOLW2,
*       CFOLW3   TYPE ZDMS2-FOLW3,
*       CFOLW4   TYPE ZDMS2-FOLW4,
*       CFOLW5   TYPE ZDMS2-FOLW5.

DATA : APPROVE4 TYPE ZDMS2-APPROVE,
       REJECT4  TYPE ZDMS2-REJECT,
       DTEXT1   TYPE STRING,
       DDATE1   TYPE ZDMS2-TDATE1,
       DTEXT2   TYPE STRING,
       DDATE2   TYPE ZDMS2-TDATE2,
       DTEXT3   TYPE STRING,
       DDATE3   TYPE ZDMS2-TDATE3,
       DTEXT4   TYPE STRING,
       DDATE4   TYPE ZDMS2-TDATE4,
       DTEXT5   TYPE STRING,
       DDATE5   TYPE ZDMS2-TDATE5,
       DDATE6   TYPE ZDMS2-CTDATE1,
       DDATE7   TYPE ZDMS2-CTDATE2,
       DDATE8   TYPE ZDMS2-CTDATE3,
       DDATE9   TYPE ZDMS2-CTDATE4,
       DDATE10  TYPE ZDMS2-CTDATE5.
*       DFOLW1   TYPE ZDMS2-FOLW1,
*       DFOLW2   TYPE ZDMS2-FOLW2,
*       DFOLW3   TYPE ZDMS2-FOLW3,
*       DFOLW4   TYPE ZDMS2-FOLW4,
*       DFOLW5   TYPE ZDMS2-FOLW5.

DATA : APPROVE5 TYPE ZDMS2-APPROVE,
       REJECT5  TYPE ZDMS2-REJECT,
       ETEXT1   TYPE STRING,
       EDATE1   TYPE ZDMS2-TDATE1,
       ETEXT2   TYPE STRING,
       EDATE2   TYPE ZDMS2-TDATE2,
       ETEXT3   TYPE STRING,
       EDATE3   TYPE ZDMS2-TDATE3,
       ETEXT4   TYPE STRING,
       EDATE4   TYPE ZDMS2-TDATE4,
       ETEXT5   TYPE STRING,
       EDATE5   TYPE ZDMS2-TDATE5,
       EDATE6   TYPE ZDMS2-CTDATE1,
       EDATE7   TYPE ZDMS2-CTDATE2,
       EDATE8   TYPE ZDMS2-CTDATE3,
       EDATE9   TYPE ZDMS2-CTDATE4,
       EDATE10  TYPE ZDMS2-CTDATE5.
*       EFOLW1   TYPE ZDMS2-FOLW1,
*       EFOLW2   TYPE ZDMS2-FOLW2,
*       EFOLW3   TYPE ZDMS2-FOLW3,
*       EFOLW4   TYPE ZDMS2-FOLW4,
*       EFOLW5   TYPE ZDMS2-FOLW5.

DATA : APPROVE6 TYPE ZDMS2-APPROVE,
       REJECT6  TYPE ZDMS2-REJECT,
       FTEXT1   TYPE STRING,
       FDATE1   TYPE ZDMS2-TDATE1,
       FTEXT2   TYPE STRING,
       FDATE2   TYPE ZDMS2-TDATE2,
       FTEXT3   TYPE STRING,
       FDATE3   TYPE ZDMS2-TDATE3,
       FTEXT4   TYPE STRING,
       FDATE4   TYPE ZDMS2-TDATE4,
       FTEXT5   TYPE STRING,
       FDATE5   TYPE ZDMS2-TDATE5,
       FDATE6   TYPE ZDMS2-CTDATE1,
       FDATE7   TYPE ZDMS2-CTDATE2,
       FDATE8   TYPE ZDMS2-CTDATE3,
       FDATE9   TYPE ZDMS2-CTDATE4,
       FDATE10  TYPE ZDMS2-CTDATE5.
*       FFOLW1   TYPE ZDMS2-FOLW1,
*       FFOLW2   TYPE ZDMS2-FOLW2,
*       FFOLW3   TYPE ZDMS2-FOLW3,
*       FFOLW4   TYPE ZDMS2-FOLW4,
*       FFOLW5   TYPE ZDMS2-FOLW5.

*DATA : SUBJECT TYPE STRING.

DATA : APPROVE7 TYPE ZDMS2-APPROVE,
       REJECT7  TYPE ZDMS2-REJECT,
       GTEXT1   TYPE STRING,
       GDATE1   TYPE ZDMS2-TDATE1,
       GTEXT2   TYPE STRING,
       GDATE2   TYPE ZDMS2-TDATE2,
       GTEXT3   TYPE STRING,
       GDATE3   TYPE ZDMS2-TDATE3,
       GTEXT4   TYPE STRING,
       GDATE4   TYPE ZDMS2-TDATE4,
       GTEXT5   TYPE STRING,
       GDATE5   TYPE ZDMS2-TDATE5,
       GDATE6   TYPE ZDMS2-CTDATE1,
       GDATE7   TYPE ZDMS2-CTDATE2,
       GDATE8   TYPE ZDMS2-CTDATE3,
       GDATE9   TYPE ZDMS2-CTDATE4,
       GDATE10  TYPE ZDMS2-CTDATE5.
*       GFOLW1   TYPE ZDMS2-FOLW1,
*       GFOLW2   TYPE ZDMS2-FOLW2,
*       GFOLW3   TYPE ZDMS2-FOLW3,
*       GFOLW4   TYPE ZDMS2-FOLW4,
*       GFOLW5   TYPE ZDMS2-FOLW5.

DATA : APPROVE8 TYPE ZDMS2-APPROVE,
       REJECT8  TYPE ZDMS2-REJECT,
       HTEXT1   TYPE STRING,
       HDATE1   TYPE ZDMS2-TDATE1,
       HTEXT2   TYPE STRING,
       HDATE2   TYPE ZDMS2-TDATE2,
       HTEXT3   TYPE STRING,
       HDATE3   TYPE ZDMS2-TDATE3,
       HTEXT4   TYPE STRING,
       HDATE4   TYPE ZDMS2-TDATE4,
       HTEXT5   TYPE STRING,
       HDATE5   TYPE ZDMS2-TDATE5,
       HDATE6   TYPE ZDMS2-CTDATE1,
       HDATE7   TYPE ZDMS2-CTDATE2,
       HDATE8   TYPE ZDMS2-CTDATE3,
       HDATE9   TYPE ZDMS2-CTDATE4,
       HDATE10  TYPE ZDMS2-CTDATE5.
*       HFOLW1   TYPE ZDMS2-FOLW1,
*       HFOLW2   TYPE ZDMS2-FOLW2,
*       HFOLW3   TYPE ZDMS2-FOLW3,
*       HFOLW4   TYPE ZDMS2-FOLW4,
*       HFOLW5   TYPE ZDMS2-FOLW5.

DATA : APPROVE9 TYPE ZDMS2-APPROVE,
       REJECT9  TYPE ZDMS2-REJECT,
       ITEXT1   TYPE STRING,
       IDATE1   TYPE ZDMS2-TDATE1,
       ITEXT2   TYPE STRING,
       IDATE2   TYPE ZDMS2-TDATE2,
       ITEXT3   TYPE STRING,
       IDATE3   TYPE ZDMS2-TDATE3,
       ITEXT4   TYPE STRING,
       IDATE4   TYPE ZDMS2-TDATE4,
       ITEXT5   TYPE STRING,
       IDATE5   TYPE ZDMS2-TDATE5,
       IDATE6   TYPE ZDMS2-CTDATE1,
       IDATE7   TYPE ZDMS2-CTDATE2,
       IDATE8   TYPE ZDMS2-CTDATE3,
       IDATE9   TYPE ZDMS2-CTDATE4,
       IDATE10  TYPE ZDMS2-CTDATE5.
*       IFOLW1   TYPE ZDMS2-FOLW1,
*       IFOLW2   TYPE ZDMS2-FOLW2,
*       IFOLW3   TYPE ZDMS2-FOLW3,
*       IFOLW4   TYPE ZDMS2-FOLW4,
*       IFOLW5   TYPE ZDMS2-FOLW5.


DATA : APPROVE10 TYPE ZDMS2-APPROVE,
       REJECT10  TYPE ZDMS2-REJECT,
       JTEXT1    TYPE STRING,
       JDATE1    TYPE ZDMS2-TDATE1,
       JTEXT2    TYPE STRING,
       JDATE2    TYPE ZDMS2-TDATE2,
       JTEXT3    TYPE STRING,
       JDATE3    TYPE ZDMS2-TDATE3,
       JTEXT4    TYPE STRING,
       JDATE4    TYPE ZDMS2-TDATE4,
       JTEXT5    TYPE STRING,
       JDATE5    TYPE ZDMS2-TDATE5,
       JDATE6    TYPE ZDMS2-CTDATE1,
       JDATE7    TYPE ZDMS2-CTDATE2,
       JDATE8    TYPE ZDMS2-CTDATE3,
       JDATE9    TYPE ZDMS2-CTDATE4,
       JDATE10   TYPE ZDMS2-CTDATE5.
*       JFOLW1    TYPE ZDMS2-FOLW1,
*       JFOLW2    TYPE ZDMS2-FOLW2,
*       JFOLW3    TYPE ZDMS2-FOLW3,
*       JFOLW4    TYPE ZDMS2-FOLW4,
*       JFOLW5    TYPE ZDMS2-FOLW5.

DATA : KTEXT1   TYPE STRING,
       KTEXT2   TYPE STRING,
       KTEXT3   TYPE STRING,
       KTEXT4   TYPE STRING,
       KTEXT5   TYPE STRING,
       KTEXT6   TYPE STRING,
       KTEXT7   TYPE STRING,
       KTEXT8   TYPE STRING,
       KDATE1   TYPE ZDMS3-TDATE1,
       KDATE2   TYPE ZDMS3-TDATE1,
       KDATE3   TYPE ZDMS3-TDATE1,
       KDATE4   TYPE ZDMS3-TDATE1,
       KDATE5   TYPE ZDMS3-TDATE1,
       KDATE6   TYPE ZDMS3-TDATE1,
       KDATE7   TYPE ZDMS3-TDATE1,
       KDATE8   TYPE ZDMS3-TDATE1,
       KCDATE1  TYPE ZDMS3-CTDATE1,
       KCDATE2  TYPE ZDMS3-CTDATE1,
       KCDATE3  TYPE ZDMS3-CTDATE1,
       KCDATE4  TYPE ZDMS3-CTDATE1,
       KCDATE5  TYPE ZDMS3-CTDATE1,
       KCDATE6  TYPE ZDMS3-CTDATE1,
       KCDATE7  TYPE ZDMS3-CTDATE1,
       KCDATE8  TYPE ZDMS3-CTDATE1,
       KREM1    TYPE ZDMS3-REM1,
       KREM2    TYPE ZDMS3-REM1,
       KREM3    TYPE ZDMS3-REM1,
       KREM4    TYPE ZDMS3-REM1,
       KREM5    TYPE ZDMS3-REM1,
       KREM6    TYPE ZDMS3-REM1,
       KREM7    TYPE ZDMS3-REM1,
       KREM8    TYPE ZDMS3-REM1,
       KFOLW1   TYPE ZDMS3-FOLW1,
       KFOLW2   TYPE ZDMS3-FOLW1,
       KFOLW3   TYPE ZDMS3-FOLW1,
       KFOLW4   TYPE ZDMS3-FOLW1,
       KFOLW5   TYPE ZDMS3-FOLW1,
       KFOLW6   TYPE ZDMS3-FOLW1,
       KFOLW7   TYPE ZDMS3-FOLW1,
       KFOLW8   TYPE ZDMS3-FOLW1,

       NKTEXT1  TYPE STRING,
       NKTEXT2  TYPE STRING,
       NKTEXT3  TYPE STRING,
       NKTEXT4  TYPE STRING,
       NKTEXT5  TYPE STRING,
       NKTEXT6  TYPE STRING,
       NKTEXT7  TYPE STRING,
       NKTEXT8  TYPE STRING,
       NKDATE1  TYPE ZDMS3-TDATE1,
       NKDATE2  TYPE ZDMS3-TDATE1,
       NKDATE3  TYPE ZDMS3-TDATE1,
       NKDATE4  TYPE ZDMS3-TDATE1,
       NKDATE5  TYPE ZDMS3-TDATE1,
       NKDATE6  TYPE ZDMS3-TDATE1,
       NKDATE7  TYPE ZDMS3-TDATE1,
       NKDATE8  TYPE ZDMS3-TDATE1,
       NKCDATE1 TYPE ZDMS3-CTDATE1,
       NKCDATE2 TYPE ZDMS3-CTDATE1,
       NKCDATE3 TYPE ZDMS3-CTDATE1,
       NKCDATE4 TYPE ZDMS3-CTDATE1,
       NKCDATE5 TYPE ZDMS3-CTDATE1,
       NKCDATE6 TYPE ZDMS3-CTDATE1,
       NKCDATE7 TYPE ZDMS3-CTDATE1,
       NKCDATE8 TYPE ZDMS3-CTDATE1,
       NKREM1   TYPE ZDMS3-REM1,
       NKREM2   TYPE ZDMS3-REM1,
       NKREM3   TYPE ZDMS3-REM1,
       NKREM4   TYPE ZDMS3-REM1,
       NKREM5   TYPE ZDMS3-REM1,
       NKREM6   TYPE ZDMS3-REM1,
       NKREM7   TYPE ZDMS3-REM1,
       NKREM8   TYPE ZDMS3-REM1,
       NKFOLW1  TYPE ZDMS3-FOLW1,
       NKFOLW2  TYPE ZDMS3-FOLW1,
       NKFOLW3  TYPE ZDMS3-FOLW1,
       NKFOLW4  TYPE ZDMS3-FOLW1,
       NKFOLW5  TYPE ZDMS3-FOLW1,
       NKFOLW6  TYPE ZDMS3-FOLW1,
       NKFOLW7  TYPE ZDMS3-FOLW1,
       NKFOLW8  TYPE ZDMS3-FOLW1.

DATA :LTEXT1   TYPE STRING,
      LTEXT2   TYPE STRING,
      LTEXT3   TYPE STRING,
      LTEXT4   TYPE STRING,
      LTEXT5   TYPE STRING,
      LTEXT6   TYPE STRING,
      LTEXT7   TYPE STRING,
      LTEXT8   TYPE STRING,
      LDATE1   TYPE ZDMS3-TDATE1,
      LDATE2   TYPE ZDMS3-TDATE1,
      LDATE3   TYPE ZDMS3-TDATE1,
      LDATE4   TYPE ZDMS3-TDATE1,
      LDATE5   TYPE ZDMS3-TDATE1,
      LDATE6   TYPE ZDMS3-TDATE1,
      LDATE7   TYPE ZDMS3-TDATE1,
      LDATE8   TYPE ZDMS3-TDATE1,
      LCDATE1  TYPE ZDMS3-CTDATE1,
      LCDATE2  TYPE ZDMS3-CTDATE1,
      LCDATE3  TYPE ZDMS3-CTDATE1,
      LCDATE4  TYPE ZDMS3-CTDATE1,
      LCDATE5  TYPE ZDMS3-CTDATE1,
      LCDATE6  TYPE ZDMS3-CTDATE1,
      LCDATE7  TYPE ZDMS3-CTDATE1,
      LCDATE8  TYPE ZDMS3-CTDATE1,
      LREM1    TYPE ZDMS3-REM1,
      LREM2    TYPE ZDMS3-REM1,
      LREM3    TYPE ZDMS3-REM1,
      LREM4    TYPE ZDMS3-REM1,
      LREM5    TYPE ZDMS3-REM1,
      LREM6    TYPE ZDMS3-REM1,
      LREM7    TYPE ZDMS3-REM1,
      LREM8    TYPE ZDMS3-REM1,
      LFOLW1   TYPE ZDMS3-FOLW1,
      LFOLW2   TYPE ZDMS3-FOLW1,
      LFOLW3   TYPE ZDMS3-FOLW1,
      LFOLW4   TYPE ZDMS3-FOLW1,
      LFOLW5   TYPE ZDMS3-FOLW1,
      LFOLW6   TYPE ZDMS3-FOLW1,
      LFOLW7   TYPE ZDMS3-FOLW1,
      LFOLW8   TYPE ZDMS3-FOLW1,

      NLTEXT1  TYPE STRING,
      NLTEXT2  TYPE STRING,
      NLTEXT3  TYPE STRING,
      NLTEXT4  TYPE STRING,
      NLTEXT5  TYPE STRING,
      NLTEXT6  TYPE STRING,
      NLTEXT7  TYPE STRING,
      NLTEXT8  TYPE STRING,
      NLDATE1  TYPE ZDMS3-TDATE1,
      NLDATE2  TYPE ZDMS3-TDATE1,
      NLDATE3  TYPE ZDMS3-TDATE1,
      NLDATE4  TYPE ZDMS3-TDATE1,
      NLDATE5  TYPE ZDMS3-TDATE1,
      NLDATE6  TYPE ZDMS3-TDATE1,
      NLDATE7  TYPE ZDMS3-TDATE1,
      NLDATE8  TYPE ZDMS3-TDATE1,
      NLCDATE1 TYPE ZDMS3-CTDATE1,
      NLCDATE2 TYPE ZDMS3-CTDATE1,
      NLCDATE3 TYPE ZDMS3-CTDATE1,
      NLCDATE4 TYPE ZDMS3-CTDATE1,
      NLCDATE5 TYPE ZDMS3-CTDATE1,
      NLCDATE6 TYPE ZDMS3-CTDATE1,
      NLCDATE7 TYPE ZDMS3-CTDATE1,
      NLCDATE8 TYPE ZDMS3-CTDATE1,
      NLREM1   TYPE ZDMS3-REM1,
      NLREM2   TYPE ZDMS3-REM1,
      NLREM3   TYPE ZDMS3-REM1,
      NLREM4   TYPE ZDMS3-REM1,
      NLREM5   TYPE ZDMS3-REM1,
      NLREM6   TYPE ZDMS3-REM1,
      NLREM7   TYPE ZDMS3-REM1,
      NLREM8   TYPE ZDMS3-REM1,
      NLFOLW1  TYPE ZDMS3-FOLW1,
      NLFOLW2  TYPE ZDMS3-FOLW1,
      NLFOLW3  TYPE ZDMS3-FOLW1,
      NLFOLW4  TYPE ZDMS3-FOLW1,
      NLFOLW5  TYPE ZDMS3-FOLW1,
      NLFOLW6  TYPE ZDMS3-FOLW1,
      NLFOLW7  TYPE ZDMS3-FOLW1,
      NLFOLW8  TYPE ZDMS3-FOLW1.

DATA :MTEXT1   TYPE STRING,
      MTEXT2   TYPE STRING,
      MTEXT3   TYPE STRING,
      MTEXT4   TYPE STRING,
      MTEXT5   TYPE STRING,
      MTEXT6   TYPE STRING,
      MTEXT7   TYPE STRING,
      MTEXT8   TYPE STRING,
      MDATE1   TYPE ZDMS3-TDATE1,
      MDATE2   TYPE ZDMS3-TDATE1,
      MDATE3   TYPE ZDMS3-TDATE1,
      MDATE4   TYPE ZDMS3-TDATE1,
      MDATE5   TYPE ZDMS3-TDATE1,
      MDATE6   TYPE ZDMS3-TDATE1,
      MDATE7   TYPE ZDMS3-TDATE1,
      MDATE8   TYPE ZDMS3-TDATE1,
      MCDATE1  TYPE ZDMS3-CTDATE1,
      MCDATE2  TYPE ZDMS3-CTDATE1,
      MCDATE3  TYPE ZDMS3-CTDATE1,
      MCDATE4  TYPE ZDMS3-CTDATE1,
      MCDATE5  TYPE ZDMS3-CTDATE1,
      MCDATE6  TYPE ZDMS3-CTDATE1,
      MCDATE7  TYPE ZDMS3-CTDATE1,
      MCDATE8  TYPE ZDMS3-CTDATE1,
      MREM1    TYPE ZDMS3-REM1,
      MREM2    TYPE ZDMS3-REM1,
      MREM3    TYPE ZDMS3-REM1,
      MREM4    TYPE ZDMS3-REM1,
      MREM5    TYPE ZDMS3-REM1,
      MREM6    TYPE ZDMS3-REM1,
      MREM7    TYPE ZDMS3-REM1,
      MREM8    TYPE ZDMS3-REM1,
      MFOLW1   TYPE ZDMS3-FOLW1,
      MFOLW2   TYPE ZDMS3-FOLW1,
      MFOLW3   TYPE ZDMS3-FOLW1,
      MFOLW4   TYPE ZDMS3-FOLW1,
      MFOLW5   TYPE ZDMS3-FOLW1,
      MFOLW6   TYPE ZDMS3-FOLW1,
      MFOLW7   TYPE ZDMS3-FOLW1,
      MFOLW8   TYPE ZDMS3-FOLW1,

      NMTEXT1  TYPE STRING,
      NMTEXT2  TYPE STRING,
      NMTEXT3  TYPE STRING,
      NMTEXT4  TYPE STRING,
      NMTEXT5  TYPE STRING,
      NMTEXT6  TYPE STRING,
      NMTEXT7  TYPE STRING,
      NMTEXT8  TYPE STRING,
      NMDATE1  TYPE ZDMS3-TDATE1,
      NMDATE2  TYPE ZDMS3-TDATE1,
      NMDATE3  TYPE ZDMS3-TDATE1,
      NMDATE4  TYPE ZDMS3-TDATE1,
      NMDATE5  TYPE ZDMS3-TDATE1,
      NMDATE6  TYPE ZDMS3-TDATE1,
      NMDATE7  TYPE ZDMS3-TDATE1,
      NMDATE8  TYPE ZDMS3-TDATE1,
      NMCDATE1 TYPE ZDMS3-CTDATE1,
      NMCDATE2 TYPE ZDMS3-CTDATE1,
      NMCDATE3 TYPE ZDMS3-CTDATE1,
      NMCDATE4 TYPE ZDMS3-CTDATE1,
      NMCDATE5 TYPE ZDMS3-CTDATE1,
      NMCDATE6 TYPE ZDMS3-CTDATE1,
      NMCDATE7 TYPE ZDMS3-CTDATE1,
      NMCDATE8 TYPE ZDMS3-CTDATE1,
      NMREM1   TYPE ZDMS3-REM1,
      NMREM2   TYPE ZDMS3-REM1,
      NMREM3   TYPE ZDMS3-REM1,
      NMREM4   TYPE ZDMS3-REM1,
      NMREM5   TYPE ZDMS3-REM1,
      NMREM6   TYPE ZDMS3-REM1,
      NMREM7   TYPE ZDMS3-REM1,
      NMREM8   TYPE ZDMS3-REM1,
      NMFOLW1  TYPE ZDMS3-FOLW1,
      NMFOLW2  TYPE ZDMS3-FOLW1,
      NMFOLW3  TYPE ZDMS3-FOLW1,
      NMFOLW4  TYPE ZDMS3-FOLW1,
      NMFOLW5  TYPE ZDMS3-FOLW1,
      NMFOLW6  TYPE ZDMS3-FOLW1,
      NMFOLW7  TYPE ZDMS3-FOLW1,
      NMFOLW8  TYPE ZDMS3-FOLW1.

DATA :NTEXT1   TYPE STRING,
      NTEXT2   TYPE STRING,
      NTEXT3   TYPE STRING,
      NTEXT4   TYPE STRING,
      NTEXT5   TYPE STRING,
      NTEXT6   TYPE STRING,
      NTEXT7   TYPE STRING,
      NTEXT8   TYPE STRING,
      NDATE1   TYPE ZDMS3-TDATE1,
      NDATE2   TYPE ZDMS3-TDATE1,
      NDATE3   TYPE ZDMS3-TDATE1,
      NDATE4   TYPE ZDMS3-TDATE1,
      NDATE5   TYPE ZDMS3-TDATE1,
      NDATE6   TYPE ZDMS3-TDATE1,
      NDATE7   TYPE ZDMS3-TDATE1,
      NDATE8   TYPE ZDMS3-TDATE1,
      NCDATE1  TYPE ZDMS3-CTDATE1,
      NCDATE2  TYPE ZDMS3-CTDATE1,
      NCDATE3  TYPE ZDMS3-CTDATE1,
      NCDATE4  TYPE ZDMS3-CTDATE1,
      NCDATE5  TYPE ZDMS3-CTDATE1,
      NCDATE6  TYPE ZDMS3-CTDATE1,
      NCDATE7  TYPE ZDMS3-CTDATE1,
      NCDATE8  TYPE ZDMS3-CTDATE1,
      NREM1    TYPE ZDMS3-REM1,
      NREM2    TYPE ZDMS3-REM1,
      NREM3    TYPE ZDMS3-REM1,
      NREM4    TYPE ZDMS3-REM1,
      NREM5    TYPE ZDMS3-REM1,
      NREM6    TYPE ZDMS3-REM1,
      NREM7    TYPE ZDMS3-REM1,
      NREM8    TYPE ZDMS3-REM1,
      NFOLW1   TYPE ZDMS3-FOLW1,
      NFOLW2   TYPE ZDMS3-FOLW1,
      NFOLW3   TYPE ZDMS3-FOLW1,
      NFOLW4   TYPE ZDMS3-FOLW1,
      NFOLW5   TYPE ZDMS3-FOLW1,
      NFOLW6   TYPE ZDMS3-FOLW1,
      NFOLW7   TYPE ZDMS3-FOLW1,
      NFOLW8   TYPE ZDMS3-FOLW1,

      NNTEXT1  TYPE STRING,
      NNTEXT2  TYPE STRING,
      NNTEXT3  TYPE STRING,
      NNTEXT4  TYPE STRING,
      NNTEXT5  TYPE STRING,
      NNTEXT6  TYPE STRING,
      NNTEXT7  TYPE STRING,
      NNTEXT8  TYPE STRING,
      NNDATE1  TYPE ZDMS3-TDATE1,
      NNDATE2  TYPE ZDMS3-TDATE1,
      NNDATE3  TYPE ZDMS3-TDATE1,
      NNDATE4  TYPE ZDMS3-TDATE1,
      NNDATE5  TYPE ZDMS3-TDATE1,
      NNDATE6  TYPE ZDMS3-TDATE1,
      NNDATE7  TYPE ZDMS3-TDATE1,
      NNDATE8  TYPE ZDMS3-TDATE1,
      NNCDATE1 TYPE ZDMS3-CTDATE1,
      NNCDATE2 TYPE ZDMS3-CTDATE1,
      NNCDATE3 TYPE ZDMS3-CTDATE1,
      NNCDATE4 TYPE ZDMS3-CTDATE1,
      NNCDATE5 TYPE ZDMS3-CTDATE1,
      NNCDATE6 TYPE ZDMS3-CTDATE1,
      NNCDATE7 TYPE ZDMS3-CTDATE1,
      NNCDATE8 TYPE ZDMS3-CTDATE1,
      NNREM1   TYPE ZDMS3-REM1,
      NNREM2   TYPE ZDMS3-REM1,
      NNREM3   TYPE ZDMS3-REM1,
      NNREM4   TYPE ZDMS3-REM1,
      NNREM5   TYPE ZDMS3-REM1,
      NNREM6   TYPE ZDMS3-REM1,
      NNREM7   TYPE ZDMS3-REM1,
      NNREM8   TYPE ZDMS3-REM1,
      NNFOLW1  TYPE ZDMS3-FOLW1,
      NNFOLW2  TYPE ZDMS3-FOLW1,
      NNFOLW3  TYPE ZDMS3-FOLW1,
      NNFOLW4  TYPE ZDMS3-FOLW1,
      NNFOLW5  TYPE ZDMS3-FOLW1,
      NNFOLW6  TYPE ZDMS3-FOLW1,
      NNFOLW7  TYPE ZDMS3-FOLW1,
      NNFOLW8  TYPE ZDMS3-FOLW1.

DATA :OTEXT1   TYPE STRING,
      OTEXT2   TYPE STRING,
      OTEXT3   TYPE STRING,
      OTEXT4   TYPE STRING,
      OTEXT5   TYPE STRING,
      OTEXT6   TYPE STRING,
      OTEXT7   TYPE STRING,
      OTEXT8   TYPE STRING,
      ODATE1   TYPE ZDMS3-TDATE1,
      ODATE2   TYPE ZDMS3-TDATE1,
      ODATE3   TYPE ZDMS3-TDATE1,
      ODATE4   TYPE ZDMS3-TDATE1,
      ODATE5   TYPE ZDMS3-TDATE1,
      ODATE6   TYPE ZDMS3-TDATE1,
      ODATE7   TYPE ZDMS3-TDATE1,
      ODATE8   TYPE ZDMS3-TDATE1,
      OCDATE1  TYPE ZDMS3-CTDATE1,
      OCDATE2  TYPE ZDMS3-CTDATE1,
      OCDATE3  TYPE ZDMS3-CTDATE1,
      OCDATE4  TYPE ZDMS3-CTDATE1,
      OCDATE5  TYPE ZDMS3-CTDATE1,
      OCDATE6  TYPE ZDMS3-CTDATE1,
      OCDATE7  TYPE ZDMS3-CTDATE1,
      OCDATE8  TYPE ZDMS3-CTDATE1,
      OREM1    TYPE ZDMS3-REM1,
      OREM2    TYPE ZDMS3-REM1,
      OREM3    TYPE ZDMS3-REM1,
      OREM4    TYPE ZDMS3-REM1,
      OREM5    TYPE ZDMS3-REM1,
      OREM6    TYPE ZDMS3-REM1,
      OREM7    TYPE ZDMS3-REM1,
      OREM8    TYPE ZDMS3-REM1,
      OFOLW1   TYPE ZDMS3-FOLW1,
      OFOLW2   TYPE ZDMS3-FOLW1,
      OFOLW3   TYPE ZDMS3-FOLW1,
      OFOLW4   TYPE ZDMS3-FOLW1,
      OFOLW5   TYPE ZDMS3-FOLW1,
      OFOLW6   TYPE ZDMS3-FOLW1,
      OFOLW7   TYPE ZDMS3-FOLW1,
      OFOLW8   TYPE ZDMS3-FOLW1,

      NOTEXT1  TYPE STRING,
      NOTEXT2  TYPE STRING,
      NOTEXT3  TYPE STRING,
      NOTEXT4  TYPE STRING,
      NOTEXT5  TYPE STRING,
      NOTEXT6  TYPE STRING,
      NOTEXT7  TYPE STRING,
      NOTEXT8  TYPE STRING,
      NODATE1  TYPE ZDMS3-TDATE1,
      NODATE2  TYPE ZDMS3-TDATE1,
      NODATE3  TYPE ZDMS3-TDATE1,
      NODATE4  TYPE ZDMS3-TDATE1,
      NODATE5  TYPE ZDMS3-TDATE1,
      NODATE6  TYPE ZDMS3-TDATE1,
      NODATE7  TYPE ZDMS3-TDATE1,
      NODATE8  TYPE ZDMS3-TDATE1,
      NOCDATE1 TYPE ZDMS3-CTDATE1,
      NOCDATE2 TYPE ZDMS3-CTDATE1,
      NOCDATE3 TYPE ZDMS3-CTDATE1,
      NOCDATE4 TYPE ZDMS3-CTDATE1,
      NOCDATE5 TYPE ZDMS3-CTDATE1,
      NOCDATE6 TYPE ZDMS3-CTDATE1,
      NOCDATE7 TYPE ZDMS3-CTDATE1,
      NOCDATE8 TYPE ZDMS3-CTDATE1,
      NOREM1   TYPE ZDMS3-REM1,
      NOREM2   TYPE ZDMS3-REM1,
      NOREM3   TYPE ZDMS3-REM1,
      NOREM4   TYPE ZDMS3-REM1,
      NOREM5   TYPE ZDMS3-REM1,
      NOREM6   TYPE ZDMS3-REM1,
      NOREM7   TYPE ZDMS3-REM1,
      NOREM8   TYPE ZDMS3-REM1,
      NOFOLW1  TYPE ZDMS3-FOLW1,
      NOFOLW2  TYPE ZDMS3-FOLW1,
      NOFOLW3  TYPE ZDMS3-FOLW1,
      NOFOLW4  TYPE ZDMS3-FOLW1,
      NOFOLW5  TYPE ZDMS3-FOLW1,
      NOFOLW6  TYPE ZDMS3-FOLW1,
      NOFOLW7  TYPE ZDMS3-FOLW1,
      NOFOLW8  TYPE ZDMS3-FOLW1.

DATA :PTEXT1   TYPE STRING,
      PTEXT2   TYPE STRING,
      PTEXT3   TYPE STRING,
      PTEXT4   TYPE STRING,
      PTEXT5   TYPE STRING,
      PTEXT6   TYPE STRING,
      PTEXT7   TYPE STRING,
      PTEXT8   TYPE STRING,
      PDATE1   TYPE ZDMS3-TDATE1,
      PDATE2   TYPE ZDMS3-TDATE1,
      PDATE3   TYPE ZDMS3-TDATE1,
      PDATE4   TYPE ZDMS3-TDATE1,
      PDATE5   TYPE ZDMS3-TDATE1,
      PDATE6   TYPE ZDMS3-TDATE1,
      PDATE7   TYPE ZDMS3-TDATE1,
      PDATE8   TYPE ZDMS3-TDATE1,
      PCDATE1  TYPE ZDMS3-CTDATE1,
      PCDATE2  TYPE ZDMS3-CTDATE1,
      PCDATE3  TYPE ZDMS3-CTDATE1,
      PCDATE4  TYPE ZDMS3-CTDATE1,
      PCDATE5  TYPE ZDMS3-CTDATE1,
      PCDATE6  TYPE ZDMS3-CTDATE1,
      PCDATE7  TYPE ZDMS3-CTDATE1,
      PCDATE8  TYPE ZDMS3-CTDATE1,
      PREM1    TYPE ZDMS3-REM1,
      PREM2    TYPE ZDMS3-REM1,
      PREM3    TYPE ZDMS3-REM1,
      PREM4    TYPE ZDMS3-REM1,
      PREM5    TYPE ZDMS3-REM1,
      PREM6    TYPE ZDMS3-REM1,
      PREM7    TYPE ZDMS3-REM1,
      PREM8    TYPE ZDMS3-REM1,
      PFOLW1   TYPE ZDMS3-FOLW1,
      PFOLW2   TYPE ZDMS3-FOLW1,
      PFOLW3   TYPE ZDMS3-FOLW1,
      PFOLW4   TYPE ZDMS3-FOLW1,
      PFOLW5   TYPE ZDMS3-FOLW1,
      PFOLW6   TYPE ZDMS3-FOLW1,
      PFOLW7   TYPE ZDMS3-FOLW1,
      PFOLW8   TYPE ZDMS3-FOLW1,

      NPTEXT1  TYPE ZDMS3-ATEXT1,
      NPTEXT2  TYPE ZDMS3-ATEXT1,
      NPTEXT3  TYPE ZDMS3-ATEXT1,
      NPTEXT4  TYPE ZDMS3-ATEXT1,
      NPTEXT5  TYPE ZDMS3-ATEXT1,
      NPTEXT6  TYPE ZDMS3-ATEXT1,
      NPTEXT7  TYPE ZDMS3-ATEXT1,
      NPTEXT8  TYPE ZDMS3-ATEXT1,
      NPDATE1  TYPE ZDMS3-TDATE1,
      NPDATE2  TYPE ZDMS3-TDATE1,
      NPDATE3  TYPE ZDMS3-TDATE1,
      NPDATE4  TYPE ZDMS3-TDATE1,
      NPDATE5  TYPE ZDMS3-TDATE1,
      NPDATE6  TYPE ZDMS3-TDATE1,
      NPDATE7  TYPE ZDMS3-TDATE1,
      NPDATE8  TYPE ZDMS3-TDATE1,
      NPCDATE1 TYPE ZDMS3-CTDATE1,
      NPCDATE2 TYPE ZDMS3-CTDATE1,
      NPCDATE3 TYPE ZDMS3-CTDATE1,
      NPCDATE4 TYPE ZDMS3-CTDATE1,
      NPCDATE5 TYPE ZDMS3-CTDATE1,
      NPCDATE6 TYPE ZDMS3-CTDATE1,
      NPCDATE7 TYPE ZDMS3-CTDATE1,
      NPCDATE8 TYPE ZDMS3-CTDATE1,
      NPREM1   TYPE ZDMS3-REM1,
      NPREM2   TYPE ZDMS3-REM1,
      NPREM3   TYPE ZDMS3-REM1,
      NPREM4   TYPE ZDMS3-REM1,
      NPREM5   TYPE ZDMS3-REM1,
      NPREM6   TYPE ZDMS3-REM1,
      NPREM7   TYPE ZDMS3-REM1,
      NPREM8   TYPE ZDMS3-REM1,
      NPFOLW1  TYPE ZDMS3-FOLW1,
      NPFOLW2  TYPE ZDMS3-FOLW1,
      NPFOLW3  TYPE ZDMS3-FOLW1,
      NPFOLW4  TYPE ZDMS3-FOLW1,
      NPFOLW5  TYPE ZDMS3-FOLW1,
      NPFOLW6  TYPE ZDMS3-FOLW1,
      NPFOLW7  TYPE ZDMS3-FOLW1,
      NPFOLW8  TYPE ZDMS3-FOLW1.

DATA :QTEXT1   TYPE STRING,
      QTEXT2   TYPE STRING,
      QTEXT3   TYPE STRING,
      QTEXT4   TYPE STRING,
      QTEXT5   TYPE STRING,
      QTEXT6   TYPE STRING,
      QTEXT7   TYPE STRING,
      QTEXT8   TYPE STRING,
      QDATE1   TYPE ZDMS3-TDATE1,
      QDATE2   TYPE ZDMS3-TDATE1,
      QDATE3   TYPE ZDMS3-TDATE1,
      QDATE4   TYPE ZDMS3-TDATE1,
      QDATE5   TYPE ZDMS3-TDATE1,
      QDATE6   TYPE ZDMS3-TDATE1,
      QDATE7   TYPE ZDMS3-TDATE1,
      QDATE8   TYPE ZDMS3-TDATE1,
      QCDATE1  TYPE ZDMS3-CTDATE1,
      QCDATE2  TYPE ZDMS3-CTDATE1,
      QCDATE3  TYPE ZDMS3-CTDATE1,
      QCDATE4  TYPE ZDMS3-CTDATE1,
      QCDATE5  TYPE ZDMS3-CTDATE1,
      QCDATE6  TYPE ZDMS3-CTDATE1,
      QCDATE7  TYPE ZDMS3-CTDATE1,
      QCDATE8  TYPE ZDMS3-CTDATE1,
      QREM1    TYPE ZDMS3-REM1,
      QREM2    TYPE ZDMS3-REM1,
      QREM3    TYPE ZDMS3-REM1,
      QREM4    TYPE ZDMS3-REM1,
      QREM5    TYPE ZDMS3-REM1,
      QREM6    TYPE ZDMS3-REM1,
      QREM7    TYPE ZDMS3-REM1,
      QREM8    TYPE ZDMS3-REM1,
      QFOLW1   TYPE ZDMS3-FOLW1,
      QFOLW2   TYPE ZDMS3-FOLW1,
      QFOLW3   TYPE ZDMS3-FOLW1,
      QFOLW4   TYPE ZDMS3-FOLW1,
      QFOLW5   TYPE ZDMS3-FOLW1,
      QFOLW6   TYPE ZDMS3-FOLW1,
      QFOLW7   TYPE ZDMS3-FOLW1,
      QFOLW8   TYPE ZDMS3-FOLW1,

      NQTEXT1  TYPE STRING,
      NQTEXT2  TYPE STRING,
      NQTEXT3  TYPE STRING,
      NQTEXT4  TYPE STRING,
      NQTEXT5  TYPE STRING,
      NQTEXT6  TYPE STRING,
      NQTEXT7  TYPE STRING,
      NQTEXT8  TYPE STRING,
      NQDATE1  TYPE ZDMS3-TDATE1,
      NQDATE2  TYPE ZDMS3-TDATE1,
      NQDATE3  TYPE ZDMS3-TDATE1,
      NQDATE4  TYPE ZDMS3-TDATE1,
      NQDATE5  TYPE ZDMS3-TDATE1,
      NQDATE6  TYPE ZDMS3-TDATE1,
      NQDATE7  TYPE ZDMS3-TDATE1,
      NQDATE8  TYPE ZDMS3-TDATE1,
      NQCDATE1 TYPE ZDMS3-CTDATE1,
      NQCDATE2 TYPE ZDMS3-CTDATE1,
      NQCDATE3 TYPE ZDMS3-CTDATE1,
      NQCDATE4 TYPE ZDMS3-CTDATE1,
      NQCDATE5 TYPE ZDMS3-CTDATE1,
      NQCDATE6 TYPE ZDMS3-CTDATE1,
      NQCDATE7 TYPE ZDMS3-CTDATE1,
      NQCDATE8 TYPE ZDMS3-CTDATE1,
      NQREM1   TYPE ZDMS3-REM1,
      NQREM2   TYPE ZDMS3-REM1,
      NQREM3   TYPE ZDMS3-REM1,
      NQREM4   TYPE ZDMS3-REM1,
      NQREM5   TYPE ZDMS3-REM1,
      NQREM6   TYPE ZDMS3-REM1,
      NQREM7   TYPE ZDMS3-REM1,
      NQREM8   TYPE ZDMS3-REM1,
      NQFOLW1  TYPE ZDMS3-FOLW1,
      NQFOLW2  TYPE ZDMS3-FOLW1,
      NQFOLW3  TYPE ZDMS3-FOLW1,
      NQFOLW4  TYPE ZDMS3-FOLW1,
      NQFOLW5  TYPE ZDMS3-FOLW1,
      NQFOLW6  TYPE ZDMS3-FOLW1,
      NQFOLW7  TYPE ZDMS3-FOLW1,
      NQFOLW8  TYPE ZDMS3-FOLW1.

DATA :RTEXT1    TYPE STRING,
      RTEXT2    TYPE STRING,
      RTEXT3    TYPE STRING,
      RTEXT4    TYPE STRING,
      RTEXT5    TYPE STRING,
      RTEXT6    TYPE STRING,
      RTEXT7    TYPE STRING,
      RTEXT8    TYPE STRING,
      RDATE1    TYPE ZDMS3-TDATE1,
      RDATE2    TYPE ZDMS3-TDATE1,
      RDATE3    TYPE ZDMS3-TDATE1,
      RDATE4    TYPE ZDMS3-TDATE1,
      RDATE5    TYPE ZDMS3-TDATE1,
      RDATE6    TYPE ZDMS3-TDATE1,
      RDATE7    TYPE ZDMS3-TDATE1,
      RDATE8    TYPE ZDMS3-TDATE1,
      RCDATE1   TYPE ZDMS3-CTDATE1,
      RCDATE2   TYPE ZDMS3-CTDATE1,
      RCDATE3   TYPE ZDMS3-CTDATE1,
      RCDATE4   TYPE ZDMS3-CTDATE1,
      RCDATE5   TYPE ZDMS3-CTDATE1,
      RCDATE6   TYPE ZDMS3-CTDATE1,
      RCDATE7   TYPE ZDMS3-CTDATE1,
      RCDATE8   TYPE ZDMS3-CTDATE1,
      RREM1     TYPE STRING,
      RREM2     TYPE STRING,
      RREM3     TYPE STRING,
      RREM4     TYPE ZDMS3-REM1,
      RREM5     TYPE ZDMS3-REM1,
      RREM6     TYPE ZDMS3-REM1,
      RREM7     TYPE ZDMS3-REM1,
      RREM8     TYPE ZDMS3-REM1,
      RFOLW1    TYPE ZDMS3-FOLW1,
      RFOLW2    TYPE ZDMS3-FOLW1,
      RFOLW3    TYPE ZDMS3-FOLW1,
      RFOLW4    TYPE ZDMS3-FOLW1,
      RFOLW5    TYPE ZDMS3-FOLW1,
      RFOLW6    TYPE ZDMS3-FOLW1,
      RFOLW7    TYPE ZDMS3-FOLW1,
      RFOLW8    TYPE ZDMS3-FOLW1,

      RREM21    TYPE STRING,
      RREM22    TYPE STRING,
      RREM23    TYPE STRING,

      QAREMARK  TYPE STRING,
      QAREMARK2 TYPE STRING,
      QAREMARK3 TYPE STRING,

      NRTEXT1   TYPE STRING,
      NRTEXT2   TYPE STRING,
      NRTEXT3   TYPE STRING,
      NRTEXT4   TYPE STRING,
      NRTEXT5   TYPE STRING,
      NRTEXT6   TYPE STRING,
      NRTEXT7   TYPE STRING,
      NRTEXT8   TYPE STRING,
      NRDATE1   TYPE ZDMS3-TDATE1,
      NRDATE2   TYPE ZDMS3-TDATE1,
      NRDATE3   TYPE ZDMS3-TDATE1,
      NRDATE4   TYPE ZDMS3-TDATE1,
      NRDATE5   TYPE ZDMS3-TDATE1,
      NRDATE6   TYPE ZDMS3-TDATE1,
      NRDATE7   TYPE ZDMS3-TDATE1,
      NRDATE8   TYPE ZDMS3-TDATE1,
      NRCDATE1  TYPE ZDMS3-CTDATE1,
      NRCDATE2  TYPE ZDMS3-CTDATE1,
      NRCDATE3  TYPE ZDMS3-CTDATE1,
      NRCDATE4  TYPE ZDMS3-CTDATE1,
      NRCDATE5  TYPE ZDMS3-CTDATE1,
      NRCDATE6  TYPE ZDMS3-CTDATE1,
      NRCDATE7  TYPE ZDMS3-CTDATE1,
      NRCDATE8  TYPE ZDMS3-CTDATE1,
      NRREM1    TYPE ZDMS3-REM1,
      NRREM2    TYPE ZDMS3-REM1,
      NRREM3    TYPE ZDMS3-REM1,
      NRREM4    TYPE ZDMS3-REM1,
      NRREM5    TYPE ZDMS3-REM1,
      NRREM6    TYPE ZDMS3-REM1,
      NRREM7    TYPE ZDMS3-REM1,
      NRREM8    TYPE ZDMS3-REM1,
      NRFOLW1   TYPE ZDMS3-FOLW1,
      NRFOLW2   TYPE ZDMS3-FOLW1,
      NRFOLW3   TYPE ZDMS3-FOLW1,
      NRFOLW4   TYPE ZDMS3-FOLW1,
      NRFOLW5   TYPE ZDMS3-FOLW1,
      NRFOLW6   TYPE ZDMS3-FOLW1,
      NRFOLW7   TYPE ZDMS3-FOLW1,
      NRFOLW8   TYPE ZDMS3-FOLW1.

DATA :STEXT1   TYPE STRING,
      STEXT2   TYPE STRING,
      STEXT3   TYPE STRING,
      STEXT4   TYPE STRING,
      STEXT5   TYPE STRING,
      STEXT6   TYPE STRING,
      STEXT7   TYPE STRING,
      STEXT8   TYPE STRING,
      SDATE1   TYPE ZDMS3-TDATE1,
      SDATE2   TYPE ZDMS3-TDATE1,
      SDATE3   TYPE ZDMS3-TDATE1,
      SDATE4   TYPE ZDMS3-TDATE1,
      SDATE5   TYPE ZDMS3-TDATE1,
      SDATE6   TYPE ZDMS3-TDATE1,
      SDATE7   TYPE ZDMS3-TDATE1,
      SDATE8   TYPE ZDMS3-TDATE1,
      SCDATE1  TYPE ZDMS3-CTDATE1,
      SCDATE2  TYPE ZDMS3-CTDATE1,
      SCDATE3  TYPE ZDMS3-CTDATE1,
      SCDATE4  TYPE ZDMS3-CTDATE1,
      SCDATE5  TYPE ZDMS3-CTDATE1,
      SCDATE6  TYPE ZDMS3-CTDATE1,
      SCDATE7  TYPE ZDMS3-CTDATE1,
      SCDATE8  TYPE ZDMS3-CTDATE1,
      SREM1    TYPE ZDMS3-REM1,
      SREM2    TYPE ZDMS3-REM1,
      SREM3    TYPE ZDMS3-REM1,
      SREM4    TYPE ZDMS3-REM1,
      SREM5    TYPE ZDMS3-REM1,
      SREM6    TYPE ZDMS3-REM1,
      SREM7    TYPE ZDMS3-REM1,
      SREM8    TYPE ZDMS3-REM1,
      SFOLW1   TYPE ZDMS3-FOLW1,
      SFOLW2   TYPE ZDMS3-FOLW1,
      SFOLW3   TYPE ZDMS3-FOLW1,
      SFOLW4   TYPE ZDMS3-FOLW1,
      SFOLW5   TYPE ZDMS3-FOLW1,
      SFOLW6   TYPE ZDMS3-FOLW1,
      SFOLW7   TYPE ZDMS3-FOLW1,
      SFOLW8   TYPE ZDMS3-FOLW1,

      NSTEXT1  TYPE STRING,
      NSTEXT2  TYPE STRING,
      NSTEXT3  TYPE STRING,
      NSTEXT4  TYPE STRING,
      NSTEXT5  TYPE STRING,
      NSTEXT6  TYPE STRING,
      NSTEXT7  TYPE STRING,
      NSTEXT8  TYPE STRING,
      NSDATE1  TYPE ZDMS3-TDATE1,
      NSDATE2  TYPE ZDMS3-TDATE1,
      NSDATE3  TYPE ZDMS3-TDATE1,
      NSDATE4  TYPE ZDMS3-TDATE1,
      NSDATE5  TYPE ZDMS3-TDATE1,
      NSDATE6  TYPE ZDMS3-TDATE1,
      NSDATE7  TYPE ZDMS3-TDATE1,
      NSDATE8  TYPE ZDMS3-TDATE1,
      NSCDATE1 TYPE ZDMS3-CTDATE1,
      NSCDATE2 TYPE ZDMS3-CTDATE1,
      NSCDATE3 TYPE ZDMS3-CTDATE1,
      NSCDATE4 TYPE ZDMS3-CTDATE1,
      NSCDATE5 TYPE ZDMS3-CTDATE1,
      NSCDATE6 TYPE ZDMS3-CTDATE1,
      NSCDATE7 TYPE ZDMS3-CTDATE1,
      NSCDATE8 TYPE ZDMS3-CTDATE1,
      NSREM1   TYPE ZDMS3-REM1,
      NSREM2   TYPE ZDMS3-REM1,
      NSREM3   TYPE ZDMS3-REM1,
      NSREM4   TYPE ZDMS3-REM1,
      NSREM5   TYPE ZDMS3-REM1,
      NSREM6   TYPE ZDMS3-REM1,
      NSREM7   TYPE ZDMS3-REM1,
      NSREM8   TYPE ZDMS3-REM1,
      NSFOLW1  TYPE ZDMS3-FOLW1,
      NSFOLW2  TYPE ZDMS3-FOLW1,
      NSFOLW3  TYPE ZDMS3-FOLW1,
      NSFOLW4  TYPE ZDMS3-FOLW1,
      NSFOLW5  TYPE ZDMS3-FOLW1,
      NSFOLW6  TYPE ZDMS3-FOLW1,
      NSFOLW7  TYPE ZDMS3-FOLW1,
      NSFOLW8  TYPE ZDMS3-FOLW1.

DATA :TTEXT1   TYPE STRING,
      TTEXT2   TYPE STRING,
      TTEXT3   TYPE STRING,
      TTEXT4   TYPE STRING,
      TTEXT5   TYPE STRING,
      TTEXT6   TYPE STRING,
      TTEXT7   TYPE STRING,
      TTEXT8   TYPE STRING,
      TDATE1   TYPE ZDMS3-TDATE1,
      TDATE2   TYPE ZDMS3-TDATE1,
      TDATE3   TYPE ZDMS3-TDATE1,
      TDATE4   TYPE ZDMS3-TDATE1,
      TDATE5   TYPE ZDMS3-TDATE1,
      TDATE6   TYPE ZDMS3-TDATE1,
      TDATE7   TYPE ZDMS3-TDATE1,
      TDATE8   TYPE ZDMS3-TDATE1,
      TCDATE1  TYPE ZDMS3-CTDATE1,
      TCDATE2  TYPE ZDMS3-CTDATE1,
      TCDATE3  TYPE ZDMS3-CTDATE1,
      TCDATE4  TYPE ZDMS3-CTDATE1,
      TCDATE5  TYPE ZDMS3-CTDATE1,
      TCDATE6  TYPE ZDMS3-CTDATE1,
      TCDATE7  TYPE ZDMS3-CTDATE1,
      TCDATE8  TYPE ZDMS3-CTDATE1,
      TREM1    TYPE ZDMS3-REM1,
      TREM2    TYPE ZDMS3-REM1,
      TREM3    TYPE ZDMS3-REM1,
      TREM4    TYPE ZDMS3-REM1,
      TREM5    TYPE ZDMS3-REM1,
      TREM6    TYPE ZDMS3-REM1,
      TREM7    TYPE ZDMS3-REM1,
      TREM8    TYPE ZDMS3-REM1,
      TFOLW1   TYPE ZDMS3-FOLW1,
      TFOLW2   TYPE ZDMS3-FOLW1,
      TFOLW3   TYPE ZDMS3-FOLW1,
      TFOLW4   TYPE ZDMS3-FOLW1,
      TFOLW5   TYPE ZDMS3-FOLW1,
      TFOLW6   TYPE ZDMS3-FOLW1,
      TFOLW7   TYPE ZDMS3-FOLW1,
      TFOLW8   TYPE ZDMS3-FOLW1,

      NTTEXT1  TYPE STRING,
      NTTEXT2  TYPE STRING,
      NTTEXT3  TYPE STRING,
      NTTEXT4  TYPE STRING,
      NTTEXT5  TYPE STRING,
      NTTEXT6  TYPE STRING,
      NTTEXT7  TYPE STRING,
      NTTEXT8  TYPE STRING,
      NTDATE1  TYPE ZDMS3-TDATE1,
      NTDATE2  TYPE ZDMS3-TDATE1,
      NTDATE3  TYPE ZDMS3-TDATE1,
      NTDATE4  TYPE ZDMS3-TDATE1,
      NTDATE5  TYPE ZDMS3-TDATE1,
      NTDATE6  TYPE ZDMS3-TDATE1,
      NTDATE7  TYPE ZDMS3-TDATE1,
      NTDATE8  TYPE ZDMS3-TDATE1,
      NTCDATE1 TYPE ZDMS3-CTDATE1,
      NTCDATE2 TYPE ZDMS3-CTDATE1,
      NTCDATE3 TYPE ZDMS3-CTDATE1,
      NTCDATE4 TYPE ZDMS3-CTDATE1,
      NTCDATE5 TYPE ZDMS3-CTDATE1,
      NTCDATE6 TYPE ZDMS3-CTDATE1,
      NTCDATE7 TYPE ZDMS3-CTDATE1,
      NTCDATE8 TYPE ZDMS3-CTDATE1,
      NTREM1   TYPE ZDMS3-REM1,
      NTREM2   TYPE ZDMS3-REM1,
      NTREM3   TYPE ZDMS3-REM1,
      NTREM4   TYPE ZDMS3-REM1,
      NTREM5   TYPE ZDMS3-REM1,
      NTREM6   TYPE ZDMS3-REM1,
      NTREM7   TYPE ZDMS3-REM1,
      NTREM8   TYPE ZDMS3-REM1,
      NTFOLW1  TYPE ZDMS3-FOLW1,
      NTFOLW2  TYPE ZDMS3-FOLW1,
      NTFOLW3  TYPE ZDMS3-FOLW1,
      NTFOLW4  TYPE ZDMS3-FOLW1,
      NTFOLW5  TYPE ZDMS3-FOLW1,
      NTFOLW6  TYPE ZDMS3-FOLW1,
      NTFOLW7  TYPE ZDMS3-FOLW1,
      NTFOLW8  TYPE ZDMS3-FOLW1.

DATA : D1        TYPE ZDMS1-D1,
       D2        TYPE ZDMS1-D2,
       D3        TYPE ZDMS1-D3,
       D4        TYPE ZDMS1-D4,
       D5        TYPE ZDMS1-D5,
       D6        TYPE ZDMS1-D6,
       D7        TYPE ZDMS1-D7,
       D8        TYPE ZDMS1-D8,
       D9        TYPE ZDMS1-D9,
       D10       TYPE ZDMS1-D10,
       D11       TYPE ZDMS1-D11,
       D12       TYPE ZDMS1-D12,
       DTEXT     TYPE ZDMS1-DTEXT,
       APPROVE   TYPE ZDMS1-APPROVE,
       REJECT    TYPE ZDMS1-REJECT,
       RAPPROVE1 TYPE ZDMS1-APPROVE,
       RREJECT1  TYPE ZDMS1-REJECT,
       RAPPROVE2 TYPE ZDMS1-APPROVE,
       RREJECT2  TYPE ZDMS1-REJECT,
       QAPPROVE1 TYPE ZDMS1-APPROVE,
       QREJECT1  TYPE ZDMS1-REJECT.

*       LTEXT1   TYPE ZDMS3-ATEXT1,
*       LTEXT2   TYPE ZDMS3-ATEXT1,
*       LTEXT3   TYPE ZDMS3-ATEXT1,
*       LTEXT4   TYPE ZDMS3-ATEXT1,
*       LTEXT5   TYPE ZDMS3-ATEXT1,
*       LDATE1   TYPE ZDMS3-TDATE1,
*       LDATE2   TYPE ZDMS3-TDATE1,
*       LDATE3   TYPE ZDMS3-TDATE1,
*       LDATE4   TYPE ZDMS3-TDATE1,
*       LDATE5   TYPE ZDMS3-TDATE1,
*       LCDATE1  TYPE ZDMS3-CTDATE1,
*       LCDATE2  TYPE ZDMS3-CTDATE1,
*       LCDATE3  TYPE ZDMS3-CTDATE1,
*       LCDATE4  TYPE ZDMS3-CTDATE1,
*       LCDATE5  TYPE ZDMS3-CTDATE1,
*
*       LREM1    TYPE ZDMS3-REM1,
*       LREM2    TYPE ZDMS3-REM1,
*       LREM3    TYPE ZDMS3-REM1,
*       LREM4    TYPE ZDMS3-REM1,
*       LREM5    TYPE ZDMS3-REM1,
*       LFOLW1   TYPE ZDMS3-FOLW1,
*       LFOLW2   TYPE ZDMS3-FOLW1,
*       LFOLW3   TYPE ZDMS3-FOLW1,
*       LFOLW4   TYPE ZDMS3-FOLW1,
*       LFOLW5   TYPE ZDMS3-FOLW1,
*
*       MTEXT1   TYPE ZDMS3-ATEXT1,
*       MTEXT2   TYPE ZDMS3-ATEXT1,
*       MTEXT3   TYPE ZDMS3-ATEXT1,
*       MTEXT4   TYPE ZDMS3-ATEXT1,
*       MTEXT5   TYPE ZDMS3-ATEXT1,
*       MDATE1   TYPE ZDMS3-TDATE1,
*       MDATE2   TYPE ZDMS3-TDATE1,
*       MDATE3   TYPE ZDMS3-TDATE1,
*       MDATE4   TYPE ZDMS3-TDATE1,
*       MDATE5   TYPE ZDMS3-TDATE1,
*       MCDATE1  TYPE ZDMS3-CTDATE1,
*       MCDATE2  TYPE ZDMS3-CTDATE1,
*       MCDATE3  TYPE ZDMS3-CTDATE1,
*       MCDATE4  TYPE ZDMS3-CTDATE1,
*       MCDATE5  TYPE ZDMS3-CTDATE1,
*
*       MREM1    TYPE ZDMS3-REM1,
*       MREM2    TYPE ZDMS3-REM1,
*       MREM3    TYPE ZDMS3-REM1,
*       MREM4    TYPE ZDMS3-REM1,
*       MREM5    TYPE ZDMS3-REM1,
*       MFOLW1   TYPE ZDMS3-FOLW1,
*       MFOLW2   TYPE ZDMS3-FOLW1,
*       MFOLW3   TYPE ZDMS3-FOLW1,
*       MFOLW4   TYPE ZDMS3-FOLW1,
*       MFOLW5   TYPE ZDMS3-FOLW1,
*
*       NTEXT1   TYPE ZDMS3-ATEXT1,
*       NTEXT2   TYPE ZDMS3-ATEXT1,
*       NTEXT3   TYPE ZDMS3-ATEXT1,
*       NTEXT4   TYPE ZDMS3-ATEXT1,
*       NTEXT5   TYPE ZDMS3-ATEXT1,
*       NDATE1   TYPE ZDMS3-TDATE1,
*       NDATE2   TYPE ZDMS3-TDATE1,
*       NDATE3   TYPE ZDMS3-TDATE1,
*       NDATE4   TYPE ZDMS3-TDATE1,
*       NDATE5   TYPE ZDMS3-TDATE1,
*       NCDATE1  TYPE ZDMS3-CTDATE1,
*       NCDATE2  TYPE ZDMS3-CTDATE1,
*       NCDATE3  TYPE ZDMS3-CTDATE1,
*       NCDATE4  TYPE ZDMS3-CTDATE1,
*       NCDATE5  TYPE ZDMS3-CTDATE1,
*
*       NREM1    TYPE ZDMS3-REM1,
*       NREM2    TYPE ZDMS3-REM1,
*       NREM3    TYPE ZDMS3-REM1,
*       NREM4    TYPE ZDMS3-REM1,
*       NREM5    TYPE ZDMS3-REM1,
*       NFOLW1   TYPE ZDMS3-FOLW1,
*       NFOLW2   TYPE ZDMS3-FOLW1,
*       NFOLW3   TYPE ZDMS3-FOLW1,
*       NFOLW4   TYPE ZDMS3-FOLW1,
*       NFOLW5   TYPE ZDMS3-FOLW1,
*
*       OTEXT1   TYPE ZDMS3-ATEXT1,
*       OTEXT2   TYPE ZDMS3-ATEXT1,
*       OTEXT3   TYPE ZDMS3-ATEXT1,
*       OTEXT4   TYPE ZDMS3-ATEXT1,
*       OTEXT5   TYPE ZDMS3-ATEXT1,
*       ODATE1   TYPE ZDMS3-TDATE1,
*       ODATE2   TYPE ZDMS3-TDATE1,
*       ODATE3   TYPE ZDMS3-TDATE1,
*       ODATE4   TYPE ZDMS3-TDATE1,
*       ODATE5   TYPE ZDMS3-TDATE1,
*       OCDATE1  TYPE ZDMS3-CTDATE1,
*       OCDATE2  TYPE ZDMS3-CTDATE1,
*       OCDATE3  TYPE ZDMS3-CTDATE1,
*       OCDATE4  TYPE ZDMS3-CTDATE1,
*       OCDATE5  TYPE ZDMS3-CTDATE1,
*
*       OREM1    TYPE ZDMS3-REM1,
*       OREM2    TYPE ZDMS3-REM1,
*       OREM3    TYPE ZDMS3-REM1,
*       OREM4    TYPE ZDMS3-REM1,
*       OREM5    TYPE ZDMS3-REM1,
*       OFOLW1   TYPE ZDMS3-FOLW1,
*       OFOLW2   TYPE ZDMS3-FOLW1,
*       OFOLW3   TYPE ZDMS3-FOLW1,
*       OFOLW4   TYPE ZDMS3-FOLW1,
*       OFOLW5   TYPE ZDMS3-FOLW1,
*
*       PTEXT1   TYPE ZDMS3-ATEXT1,
*       PTEXT2   TYPE ZDMS3-ATEXT1,
*       PTEXT3   TYPE ZDMS3-ATEXT1,
*       PTEXT4   TYPE ZDMS3-ATEXT1,
*       PTEXT5   TYPE ZDMS3-ATEXT1,
*       PDATE1   TYPE ZDMS3-TDATE1,
*       PDATE2   TYPE ZDMS3-TDATE1,
*       PDATE3   TYPE ZDMS3-TDATE1,
*       PDATE4   TYPE ZDMS3-TDATE1,
*       PDATE5   TYPE ZDMS3-TDATE1,
*       PCDATE1  TYPE ZDMS3-CTDATE1,
*       PCDATE2  TYPE ZDMS3-CTDATE1,
*       PCDATE3  TYPE ZDMS3-CTDATE1,
*       PCDATE4  TYPE ZDMS3-CTDATE1,
*       PCDATE5  TYPE ZDMS3-CTDATE1,
*
*       PREM1    TYPE ZDMS3-REM1,
*       PREM2    TYPE ZDMS3-REM1,
*       PREM3    TYPE ZDMS3-REM1,
*       PREM4    TYPE ZDMS3-REM1,
*       PREM5    TYPE ZDMS3-REM1,
*       PFOLW1   TYPE ZDMS3-FOLW1,
*       PFOLW2   TYPE ZDMS3-FOLW1,
*       PFOLW3   TYPE ZDMS3-FOLW1,
*       PFOLW4   TYPE ZDMS3-FOLW1,
*       PFOLW5   TYPE ZDMS3-FOLW1,
*
*       QTEXT1   TYPE ZDMS3-ATEXT1,
*       QTEXT2   TYPE ZDMS3-ATEXT1,
*       QTEXT3   TYPE ZDMS3-ATEXT1,
*       QTEXT4   TYPE ZDMS3-ATEXT1,
*       QTEXT5   TYPE ZDMS3-ATEXT1,
*       QDATE1   TYPE ZDMS3-TDATE1,
*       QDATE2   TYPE ZDMS3-TDATE1,
*       QDATE3   TYPE ZDMS3-TDATE1,
*       QDATE4   TYPE ZDMS3-TDATE1,
*       QDATE5   TYPE ZDMS3-TDATE1,
*       QCDATE1  TYPE ZDMS3-CTDATE1,
*       QCDATE2  TYPE ZDMS3-CTDATE1,
*       QCDATE3  TYPE ZDMS3-CTDATE1,
*       QCDATE4  TYPE ZDMS3-CTDATE1,
*       QCDATE5  TYPE ZDMS3-CTDATE1,
*
*       QREM1    TYPE ZDMS3-REM1,
*       QREM2    TYPE ZDMS3-REM1,
*       QREM3    TYPE ZDMS3-REM1,
*       QREM4    TYPE ZDMS3-REM1,
*       QREM5    TYPE ZDMS3-REM1,
*       QFOLW1   TYPE ZDMS3-FOLW1,
*       QFOLW2   TYPE ZDMS3-FOLW1,
*       QFOLW3   TYPE ZDMS3-FOLW1,
*       QFOLW4   TYPE ZDMS3-FOLW1,
*       QFOLW5   TYPE ZDMS3-FOLW1,
*
*       RRTEXT1  TYPE ZDMS3-ATEXT1,
*       RRTEXT2  TYPE ZDMS3-ATEXT1,
*       RRTEXT3  TYPE ZDMS3-ATEXT1,
*       RRTEXT4  TYPE ZDMS3-ATEXT1,
*       RRTEXT5  TYPE ZDMS3-ATEXT1,
*       RRDATE1  TYPE ZDMS3-TDATE1,
*       RRDATE2  TYPE ZDMS3-TDATE1,
*       RRDATE3  TYPE ZDMS3-TDATE1,
*       RRDATE4  TYPE ZDMS3-TDATE1,
*       RRDATE5  TYPE ZDMS3-TDATE1,
*       RRCDATE1 TYPE ZDMS3-CTDATE1,
*       RRCDATE2 TYPE ZDMS3-CTDATE1,
*       RRCDATE3 TYPE ZDMS3-CTDATE1,
*       RRCDATE4 TYPE ZDMS3-CTDATE1,
*       RRCDATE5 TYPE ZDMS3-CTDATE1,
*
*       RREM1    TYPE ZDMS3-REM1,
*       RREM2    TYPE ZDMS3-REM1,
*       RREM3    TYPE ZDMS3-REM1,
*       RREM4    TYPE ZDMS3-REM1,
*       RREM5    TYPE ZDMS3-REM1,
*       RFOLW1   TYPE ZDMS3-FOLW1,
*       RFOLW2   TYPE ZDMS3-FOLW1,
*       RFOLW3   TYPE ZDMS3-FOLW1,
*       RFOLW4   TYPE ZDMS3-FOLW1,
*       RFOLW5   TYPE ZDMS3-FOLW1,
*
*       STEXT1   TYPE ZDMS3-ATEXT1,
*       STEXT2   TYPE ZDMS3-ATEXT1,
*       STEXT3   TYPE ZDMS3-ATEXT1,
*       STEXT4   TYPE ZDMS3-ATEXT1,
*       STEXT5   TYPE ZDMS3-ATEXT1,
*       SDATE1   TYPE ZDMS3-TDATE1,
*       SDATE2   TYPE ZDMS3-TDATE1,
*       SDATE3   TYPE ZDMS3-TDATE1,
*       SDATE4   TYPE ZDMS3-TDATE1,
*       SDATE5   TYPE ZDMS3-TDATE1,
*       SCDATE1  TYPE ZDMS3-CTDATE1,
*       SCDATE2  TYPE ZDMS3-CTDATE1,
*       SCDATE3  TYPE ZDMS3-CTDATE1,
*       SCDATE4  TYPE ZDMS3-CTDATE1,
*       SCDATE5  TYPE ZDMS3-CTDATE1,
*
*       SREM1    TYPE ZDMS3-REM1,
*       SREM2    TYPE ZDMS3-REM1,
*       SREM3    TYPE ZDMS3-REM1,
*       SREM4    TYPE ZDMS3-REM1,
*       SREM5    TYPE ZDMS3-REM1,
*       SFOLW1   TYPE ZDMS3-FOLW1,
*       SFOLW2   TYPE ZDMS3-FOLW1,
*       SFOLW3   TYPE ZDMS3-FOLW1,
*       SFOLW4   TYPE ZDMS3-FOLW1,
*       SFOLW5   TYPE ZDMS3-FOLW1,
*
*       TTEXT1   TYPE ZDMS3-ATEXT1,
*       TTEXT2   TYPE ZDMS3-ATEXT1,
*       TTEXT3   TYPE ZDMS3-ATEXT1,
*       TTEXT4   TYPE ZDMS3-ATEXT1,
*       TTEXT5   TYPE ZDMS3-ATEXT1,
*       TDATE1   TYPE ZDMS3-TDATE1,
*       TDATE2   TYPE ZDMS3-TDATE1,
*       TDATE3   TYPE ZDMS3-TDATE1,
*       TDATE4   TYPE ZDMS3-TDATE1,
*       TDATE5   TYPE ZDMS3-TDATE1,
*       TCDATE1  TYPE ZDMS3-CTDATE1,
*       TCDATE2  TYPE ZDMS3-CTDATE1,
*       TCDATE3  TYPE ZDMS3-CTDATE1,
*       TCDATE4  TYPE ZDMS3-CTDATE1,
*       TCDATE5  TYPE ZDMS3-CTDATE1,
*
*       TREM1    TYPE ZDMS3-REM1,
*       TREM2    TYPE ZDMS3-REM1,
*       TREM3    TYPE ZDMS3-REM1,
*       TREM4    TYPE ZDMS3-REM1,
*       TREM5    TYPE ZDMS3-REM1,
*       TFOLW1   TYPE ZDMS3-FOLW1,
*       TFOLW2   TYPE ZDMS3-FOLW1,
*       TFOLW3   TYPE ZDMS3-FOLW1,
*       TFOLW4   TYPE ZDMS3-FOLW1,
*       TFOLW5   TYPE ZDMS3-FOLW1.


DATA : A           TYPE I,
       QHREM       TYPE ZDMS4-QHREM,
       QHAPPROVE   TYPE ZDMS4-QHAPPROVE,
       QHREJECT    TYPE ZDMS4-QHREJECT,
       QHPERNR     TYPE ZDMS4-QHPERNR,
       TDREM       TYPE ZDMS4-TDREM,
       TDREM1      TYPE ZDMS4-TDREM,
       TDREM2      TYPE ZDMS4-TDREM,
       TDAPPROVE   TYPE ZDMS4-TDAPPROVE,
       TDREJECT    TYPE ZDMS4-TDREJECT,
       CCNUMB      TYPE ZDMS4-CCNUMB,
       TDPERNR     TYPE ZDMS4-QHPERNR,
       RPN_S       TYPE ZDMS4-RPN_S,
       RPN_P       TYPE ZDMS4-RPN_P,
       RPN_D       TYPE ZDMS4-RPN_D,
       RRTEXT1     TYPE ZDMS4-RTEXT1,
       RRTEXT2     TYPE ZDMS4-RTEXT2,
       RRTEXT3     TYPE ZDMS4-RTEXT3,
       RPN(3)      TYPE C,
       RPNSTAT(10) TYPE C,
       CL1         TYPE ZDMS4-CL1,
       CL1TXT1     TYPE ZDMS4-CL1TXT1,
       CL1TXT2     TYPE ZDMS4-CL1TXT2,
       CL1TXT3     TYPE ZDMS4-CL1TXT3,
       CL2         TYPE ZDMS4-CL2,
       CL2TXT1     TYPE ZDMS4-CL2TXT1,
       CL2TXT2     TYPE ZDMS4-CL2TXT2,
       CL2TXT3     TYPE ZDMS4-CL2TXT3,
       QHCL2       TYPE ZDMS4-CL2,
       CL1BY       TYPE PA0001-ENAME,
       QHCL1BY     TYPE PA0001-ENAME,
       CL1DT       TYPE SY-DATUM,
       QHCL1DT     TYPE SY-DATUM,
       RPNPERNR    TYPE PA0001-PERNR,
       RPNDATE     TYPE SY-DATUM,
       CHGTYPN     TYPE ZDMS4-CHGTYPN,
       CHGTYPM     TYPE ZDMS4-CHGTYPM,
       CL2BY       TYPE PA0001-ENAME,
       CL2DT       TYPE SY-DATUM,
       QHCL2BY     TYPE PA0001-ENAME,
       QHCL2DT     TYPE SY-DATUM,
       QHCL1       TYPE ZDMS4-QHCL1.

DATA : RPN1         TYPE N,
       RPN2         TYPE N,
       RPN3         TYPE N,
       TCLOSEDT     TYPE SY-DATUM,
       TCLOSEDTNAME TYPE PA0001-ENAME,  "TENTATIVE CLOSURE DATE
       TCLOSEDTON   TYPE SY-DATUM,
       TCLOSETMON   TYPE SY-UZEIT.

DATA : CCOUNT      TYPE I VALUE 1,
       C           TYPE I,
       CHGSTAT(10) TYPE C,
       CHGAPR      TYPE PA0001-ENAME,
       CHGAUT(10)  TYPE C,
       CHGAUR      TYPE PA0001-ENAME,
*       cl1stat(14) TYPE c,
       CL1STAT(40) TYPE C,
       CL1NAME     TYPE PA0001-ENAME,
       CL1ANAME    TYPE PA0001-ENAME,
       FCOUNT      TYPE I VALUE 1,
       FCOUNT1(2)  TYPE C,
       CL2STAT(40) TYPE C,
       CL2NAME     TYPE PA0001-ENAME,
       CL2ANAME    TYPE PA0001-ENAME,
       S1(2)       TYPE C.
DATA: SFTDDATE   TYPE SY-DATUM,
      SFTCLOSEDT TYPE SY-DATUM.

DATA : IMPRNAME TYPE PA0001-ENAME,
       IMPRDT   TYPE SY-DATUM,
       IMPRTM   TYPE SY-UZEIT.

DATA : LIMPRNAME TYPE PA0001-ENAME,
       LIMPRDT   TYPE SY-DATUM,
       LIMPRTM   TYPE SY-UZEIT.


DATA : ZDMS1D1(15)  TYPE C,
       ZDMS1D2(15)  TYPE C,
       ZDMS1D3(15)  TYPE C,
       ZDMS1D4(15)  TYPE C,
       ZDMS1D5(15)  TYPE C,
       ZDMS1D6(15)  TYPE C,
       ZDMS1D7(15)  TYPE C,
       ZDMS1D8(15)  TYPE C,
       ZDMS1D9(15)  TYPE C,
       ZDMS1D10(15) TYPE C,
       ZDMS1D11(15) TYPE C,
       ZDMS1D12(15) TYPE C,
       ZDMS1D13(15) TYPE C.

DATA: REJ1NAME      TYPE PA0001-ENAME,
      REJ1DT        TYPE SY-DATUM,
      REJ1REM1(100) TYPE C,
      REJ1REM2(100) TYPE C,
      REJ1REM3(100) TYPE C.

DATA : ZDMS1ATEXT(375) TYPE C,
       ZDMS1ATEXT1(80) TYPE C.
DATA: SPEC1 TYPE TABLE OF STRING WITH HEADER LINE.

DATA : RPNNAME   TYPE PA0001-ENAME,
       RPNDT     TYPE SY-DATUM,
       QHRPNNAME TYPE PA0001-ENAME,
       QHRPNDT   TYPE SY-DATUM,
       TDRPNNAME TYPE PA0001-ENAME,
       TDRPNDT   TYPE SY-DATUM,
       FOLWNAME  TYPE PA0001-ENAME,
       FOLWDT    TYPE SY-DATUM,
       FOLWTM    TYPE SY-UZEIT.

DATA : DHREM1 TYPE ZDMS1-DREM1,
       DHREM2 TYPE ZDMS1-DREM1,
       DHREM3 TYPE ZDMS1-DREM1.


DATA : DEPT1   TYPE T001P-BTRTL,
       DEPT2   TYPE T001P-BTRTL,
       DEPT3   TYPE T001P-BTRTL,
       DEPT4   TYPE T001P-BTRTL,
       DEPT5   TYPE T001P-BTRTL,
       DEPT6   TYPE T001P-BTRTL,
       DEPT7   TYPE T001P-BTRTL,
       DEPT8   TYPE T001P-BTRTL,
       DEPT9   TYPE T001P-BTRTL,
       DEPT10  TYPE T001P-BTRTL,
       DEPT111 TYPE T001P-BTRTL,
       DEPT12  TYPE T001P-BTRTL,
       DEPT13  TYPE T001P-BTRTL,
       DEPT14  TYPE T001P-BTRTL,
       DEPT15  TYPE T001P-BTRTL,
       DEPT16  TYPE T001P-BTRTL,
       DEPT17  TYPE T001P-BTRTL,
       DEPT18  TYPE T001P-BTRTL,
       DEPT19  TYPE T001P-BTRTL,
       DEPT20  TYPE T001P-BTRTL.

DATA : DEPT11 TYPE PA0001-BTRTL.
DATA : RNAME  TYPE PA0001-ENAME,
       RDATE  TYPE SY-DATUM,
       RANAME TYPE PA0001-ENAME,
       RNAME2 TYPE PA0001-ENAME,
       QNAME  TYPE PA0001-ENAME.

DATA: QSUB1(100) TYPE C,
      QSUB2(100) TYPE C,
      QSUB3(100) TYPE C.

TYPES : BEGIN OF FOLW1,
          MJAHR   TYPE ZDMS2-MJAHR,
          MBLNR   TYPE ZDMS2-MBLNR,
          DEPT    TYPE ZDMS2-DEPT,
*          ZEILE(2) TYPE C,
          EBUDAT  TYPE ZDMS2-EBUDAT,
          EPERNR  TYPE ZDMS2-EPERNR,
          UBUDAT  TYPE ZDMS2-UBUDAT,
          UPERNR  TYPE ZDMS2-UPERNR,
          ATEXT1  TYPE STRING,
          TDATE1  TYPE ZDMS2-TDATE1,
          CTDATE1 TYPE ZDMS2-TDATE1,
          REM1    TYPE STRING,
        END OF FOLW1.

TYPES : BEGIN OF FOLW2,
          MJAHR   TYPE ZDMS3-MJAHR,
          MBLNR   TYPE ZDMS3-MBLNR,
          DEPT    TYPE ZDMS3-DEPT,
          BTEXT   TYPE T001P-BTEXT,
          ZEILE   TYPE ZDMS3-ZEILE,
          EBUDAT  TYPE ZDMS2-EBUDAT,
          EPERNR  TYPE ZDMS2-EPERNR,
          UBUDAT  TYPE ZDMS2-UBUDAT,
          UPERNR  TYPE ZDMS2-UPERNR,
          ATEXT1  TYPE STRING,
          TDATE1  TYPE ZDMS2-TDATE1,
          CTDATE1 TYPE ZDMS2-TDATE1,
          REM1    TYPE STRING,
          FCHK    TYPE  CHAR5,
*          CHK     TYPE  CHAR5,
        END OF FOLW2.

TYPES : BEGIN OF SDEPT1,
          MJAHR    TYPE ZDMS3-MJAHR,
          MBLNR    TYPE ZDMS3-MBLNR,
          ZEILE(2) TYPE C,
          DEPT     TYPE ZDMS3-DEPT,
          BTEXT    TYPE T001P-BTEXT,
          WERKS    TYPE ZDMS1-WERKS,
          CHK      TYPE  CHAR5,
          NAME1    TYPE T500P-NAME1,
*          ZEILE   TYPE ZDMS3-ZEILE,
*          BUDAT   TYPE ZDMS2-BUDAT,
*          PERNR   TYPE ZDMS2-PERNR,
*          ATEXT1  TYPE STRING,
*          TDATE1  TYPE ZDMS2-TDATE1,
*          CTDATE1 TYPE ZDMS2-TDATE1,
*          REM1    TYPE STRING,
*          FCHK    TYPE  CHAR5,
        END OF SDEPT1.

TYPES : BEGIN OF TCLOSURE1,
          MJAHR    TYPE ZDMS3-MJAHR,
          MBLNR    TYPE ZDMS3-MBLNR,
          TCLOSEDT TYPE SY-DATUM,
        END OF TCLOSURE1.

DATA : IT_ZDMS1     TYPE TABLE OF ZDMS1,
       WA_ZDMS1     TYPE ZDMS1,
       IT_ZDMS4_1   TYPE TABLE OF ZDMS4,
       WA_ZDMS4_1   TYPE ZDMS4,
       IT_ZDMS2     TYPE TABLE OF ZDMS2,
       WA_ZDMS2     TYPE ZDMS2,
       IT_ZDMS2_1   TYPE TABLE OF ZDMS2,
       WA_ZDMS2_1   TYPE ZDMS2,
       IT_ZDMS3     TYPE TABLE OF ZDMS3,
       WA_ZDMS3     TYPE ZDMS3,
       IT_ZDMS4     TYPE TABLE OF ZDMS4,
       WA_ZDMS4     TYPE ZDMS4,
       IT_FOLW1     TYPE TABLE OF FOLW1,
       WA_FOLW1     TYPE FOLW1,
       IT_FOLW2     TYPE TABLE OF FOLW2,
       WA_FOLW2     TYPE FOLW2,
       IT_SDEPT1    TYPE TABLE OF SDEPT1,
       WA_SDEPT1    TYPE SDEPT1,
       IT_T001P     TYPE TABLE OF T001P,
       WA_T001P     TYPE T001P,
       IMP_ZDMS2    TYPE TABLE OF ZDMS2,
       WMP_ZDMS2    TYPE ZDMS2,
       IMP1_ZDMS2   TYPE TABLE OF ZDMS2,
       WMP1_ZDMS2   TYPE ZDMS2,
       IT_TCLOSURE1 TYPE TABLE OF TCLOSURE1,
       WA_TCLOSURE1 TYPE TCLOSURE1,
       IT_ZDMS6     TYPE TABLE OF ZDMS6,
       WA_ZDMS6     TYPE ZDMS6,
       IT_ZDMS6_1   TYPE TABLE OF ZDMS6,
       WA_ZDMS6_1   TYPE ZDMS6,
       IT_ZDMS5     TYPE TABLE OF ZDMS5,
       WA_ZDMS5     TYPE ZDMS5,
       IT_ZDMS61    TYPE TABLE OF ZDMS6,
       WA_ZDMS61    TYPE ZDMS6.
TYPES: BEGIN OF CHECK,
         MBLNR   TYPE ZDMS1-MBLNR,
         MJAHR   TYPE ZDMS1-MJAHR,
         FORM(1) TYPE C,
       END OF CHECK.
DATA: IT_CHECK TYPE TABLE OF CHECK,
      WA_CHECK TYPE CHECK.

TYPES: BEGIN OF DEPT1,
         BTRTL TYPE PA0001-BTRTL,
       END OF DEPT1.
TYPES: BEGIN OF DEPT2,
         TXT(1)     TYPE C,
         BTRTL      TYPE PA0001-BTRTL,
         LOC(3)     TYPE C,
         DEPTNAME   TYPE T001P-BTEXT,
         STATUS(20) TYPE C,
         NAME       TYPE PA0001-ENAME,
         IMPDATE    TYPE CPUDT,
         IMPTM      TYPE CPUTM,
       END OF DEPT2.

TYPES: BEGIN OF DEPT3,
         BTRTL      TYPE PA0001-BTRTL,
         COUNT(3)   TYPE C,
         ATEXT      TYPE ZDMS2-ATEXT1,
         REMARK(75) TYPE C,
         TDATE      TYPE ZDMS2-TDATE1,
         CDATE      TYPE ZDMS2-CTDATE1,
       END OF DEPT3.

TYPES: BEGIN OF IDEPT2,
         BTRTL      TYPE PA0001-BTRTL,
         COUNT(3)   TYPE C,
         ATEXT(100) TYPE C,
         REMARK(50) TYPE C,
         DEPTNAME   TYPE T001P-BTEXT,
         TDATE      TYPE CPUDT,
         CTDATE     TYPE CPUDT,
       END OF IDEPT2.

TYPES: BEGIN OF EXT1,
         DEPTNAME TYPE T001P-BTEXT,
         NAME     TYPE PA0001-ENAME,
         IMPDATE  TYPE CPUDT,
       END OF EXT1.

DATA: IT_DEPT1   TYPE TABLE OF DEPT1,
      WA_DEPT1   TYPE DEPT1,
      IT_DEPT2   TYPE TABLE OF DEPT2,
      WA_DEPT2   TYPE DEPT2,
      IT_DEPT3   TYPE TABLE OF DEPT3,
      WA_DEPT3   TYPE DEPT3,
      IT_IDEPT1  TYPE TABLE OF DEPT1,
      WA_IDEPT1  TYPE DEPT1,
      IT_IDEPT2  TYPE TABLE OF IDEPT2,
      WA_IDEPT2  TYPE IDEPT2,

      IT_LIDEPT1 TYPE TABLE OF DEPT1,
      WA_LIDEPT1 TYPE DEPT1,

      IT_LIDEPT2 TYPE TABLE OF IDEPT2,
      WA_LIDEPT2 TYPE IDEPT2,

      IT_EXT1    TYPE TABLE OF EXT1,
      WA_EXT1    TYPE EXT1.

DATA : COUNT TYPE I VALUE 1,
       INTC  TYPE I.

DATA : ZDMS1_WA TYPE ZDMS1.
DATA : ZDMS1_WA1 TYPE ZDMS1.
DATA : ZDMS2_WA TYPE ZDMS2,
       ZDMS3_WA TYPE ZDMS3,
       ZDMS4_WA TYPE ZDMS4.
DATA: APRDT TYPE SY-DATUM.
DATA : A1 TYPE I.
DATA : BTRTL     TYPE PA0001-BTRTL,
       ZEILE(3)  TYPE C,
       ZEILE1(3) TYPE C,
       CNT(3)    TYPE P DECIMALS 0,
       CNT1(2)   TYPE C VALUE 1,
       ERR       TYPE I,
       WERKS     TYPE ZDMS1-WERKS,
       NWERKS    TYPE ZDMS1-WERKS,
       TWERKS    TYPE T001P-WERKS.
DATA: UPDCD TYPE I.

DATA: CTDATEN1 TYPE SY-DATUM,
      CTN      TYPE I.

DATA: IT_ZDMS2_N TYPE TABLE OF ZDMS2,
      WA_ZDMS2_N TYPE ZDMS2,
      IT_ZDMS3_N TYPE TABLE OF ZDMS3,
      WA_ZDMS3_N TYPE ZDMS3.
DATA: ZDMS3_N_WA TYPE ZDMS3.

DATA: ODEPT  TYPE T001P-BTEXT,
      ODEPT1 TYPE T001P-BTEXT.



DATA : APPRNAME         TYPE PA0001-ENAME,
       APPRDT           TYPE SY-DATUM,
       APPRTM           TYPE SY-UZEIT,
       ATTACHFILE(1250) TYPE C,
       ATTACH(255)      TYPE C,
       DOC_KEY          TYPE ZDMS_GOS-DOC_KEY,
       DOCKEY(10)       TYPE C.

DATA : IT_ZDMS_GOS TYPE TABLE OF ZDMS_GOS,
       WA_ZDMS_GOS TYPE ZDMS_GOS.

TYPES : BEGIN OF ITAB1,
          MJAHR   TYPE ZDMS3-MJAHR,
          MBLNR   TYPE ZDMS3-MBLNR,
          DEPT    TYPE ZDMS3-DEPT,
          ZEILE   TYPE ZDMS3-ZEILE,
          BUDAT   TYPE ZDMS3-BUDAT,
          PERNR   TYPE ZDMS3-PERNR,
          ATEXT1  TYPE ZDMS3-ATEXT1,
          TDATE1  TYPE ZDMS3-TDATE1,
          REM1    TYPE STRING,
          CTDATE1 TYPE ZDMS3-CTDATE1,
          FOLW1   TYPE ZDMS3-FOLW1,
          BTEXT   TYPE T001P-BTEXT,
        END OF ITAB1.

TYPES : BEGIN OF ITAS1,
          MJAHR   TYPE ZDMS3-MJAHR,
          MBLNR   TYPE ZDMS3-MBLNR,
          PERNR   TYPE ZDMS3-PERNR,
          ENAME   TYPE PA0001-ENAME,
          DEPTAPR TYPE ZDMS1-APPROVE,
          DEPTREJ TYPE ZDMS1-REJECT,
          CCNUMB1 TYPE ZDMS4-CCNUMB1,
        END OF ITAS1.

TYPES : BEGIN OF EMAIL,
          PERNR      TYPE PA0001-PERNR,
          USRID_LONG TYPE PA0105-USRID_LONG,
        END OF EMAIL.

TYPES : BEGIN OF EMAIL1,
          MJAHR      TYPE ZDMS1-MJAHR,
          MBLNR      TYPE ZDMS1-MBLNR,
          ZEILE(2)   TYPE C,
          USRID_LONG TYPE STRING,
        END OF EMAIL1.

TYPES : BEGIN OF IMP1,
          MJAHR  TYPE ZDMS2-MJAHR,
          MBLNR  TYPE ZDMS2-MBLNR,
          CNT(1) TYPE C,
          DEPT   TYPE PA0001-BTRTL,
          IMP    TYPE STRING,
          TARDT  TYPE SY-DATUM,
          REMARK TYPE STRING,

        END OF IMP1.

TYPES : BEGIN OF EXTDEPT1,
          TICK       TYPE CHAR1,
          MJAHR      TYPE ZDMS2-MJAHR,
          MBLNR      TYPE ZDMS2-MBLNR,
          DEPT       TYPE PA0001-BTRTL,
          ENAME      TYPE PA0001-ENAME,
          DEPTNAME   TYPE  T001P-BTEXT,
          APPROVE(1) TYPE C,

          ACCEPTNAME TYPE PA0001-ENAME,
          ACCEPTDT   TYPE SY-DATUM,

        END OF EXTDEPT1.

DATA : IT_TAB1 TYPE TABLE OF ITAB1,
       WA_TAB1 TYPE ITAB1,
       IT_IMP1 TYPE TABLE OF IMP1,
       WA_IMP1 TYPE IMP1.
DATA : IT_TAS1 TYPE TABLE OF ITAS1,
       WA_TAS1 TYPE ITAS1.
DATA : IT_EMAIL  TYPE TABLE OF EMAIL,
       WA_EMAIL  TYPE EMAIL,
       IT_EMAIL1 TYPE TABLE OF EMAIL1,
       WA_EMAIL1 TYPE EMAIL1.

DATA: IT_EXTDEPT1 TYPE TABLE OF EXTDEPT1,
      WA_EXTDEPT1 TYPE EXTDEPT1.

DATA: O_ENCRYPTOR        TYPE REF TO CL_HARD_WIRED_ENCRYPTOR,
      O_CX_ENCRYPT_ERROR TYPE REF TO CX_ENCRYPT_ERROR.
DATA:
*      v_ac_xstring type xstring,
  V_EN_STRING TYPE STRING,
*      v_en_xstring type xstring,
  V_DE_STRING TYPE STRING,
*      v_de_xstring type string,
  V_ERROR_MSG TYPE STRING.

DATA: STDREM(300) TYPE C,
      SQHREM(75)  TYPE C.

DATA : DEPTHEAD     TYPE PA0001-PERNR,
       NDEPTHEAD    TYPE PA0001-PERNR, "second level hod  1.12.24
       DEPTHEAD1    TYPE PA0001-PERNR,
       DEPTHEAD2    TYPE PA0001-PERNR,
       DEPTHNAME    TYPE PA0001-ENAME,
       DEPTAPPRNAME TYPE PA0001-ENAME,
       DEPTHAPR(1)  TYPE C,
       DEPTAPPR     TYPE I,
       DEPTEMAIL1   TYPE I,
       DEPTIND1     TYPE I.


DATA : REVPERNR TYPE PA0001-PERNR.
DATA: R(1) TYPE C.

DATA : ADDDEPT TYPE I.
CONTROLS TABLE_CONTROL TYPE TABLEVIEW USING SCREEN 9001.

DATA : CHGTYP(12) TYPE C,
       RPNVAL     TYPE P.
DATA: EXTP TYPE I.
DATA: QATEXT1(100) TYPE C,
      QATEXT2(100) TYPE C,
      QATEXT3(100) TYPE C,
      QATEXT4(100) TYPE C,
      QATEXT5(100) TYPE C.
DATA: QAPPRDT TYPE ZDMS5-QAPPRDT.
DATA: QAREVDT TYPE ZDMS5-QAREVDT,
      QAPPRTM TYPE SY-UZEIT.
DATA: QADAYS(3) TYPE C.
DATA: EXT(1) TYPE C.
DATA: EIDAYS(3) TYPE C.
DATA: EIDATE  TYPE ZDMS5-EIDATE,
      EIUZEIT TYPE ZDMS5-EIUZEIT.
DATA: FORM1(1) TYPE C.
DATA: NEW(1) TYPE C.
*DATA: new1(1) TYPE c.
DATA: TITLE1(100) TYPE C.
DATA: QACQD(3) TYPE C.
DATA : ZDMSSEARCH1_WA TYPE ZDMSSEARCH1.

DATA: CCNUM        TYPE ZDMS1-MBLNR,
      YEAR         TYPE ZDMS1-MJAHR,
      YEAR11(4)    TYPE C,
      PLANT        TYPE T001W-WERKS,
      SOP(100)     TYPE C,
      RSOP(100)    TYPE C,
      LOC(6)       TYPE C,
      SUBJECT(310) TYPE C.
DATA: FORMNAME1(100) TYPE C.
*DATA: deptappr TYPE i.

DATA: QAHEADNAME TYPE PA0001-ENAME.
DATA: SRTEXT1  TYPE ZDMS5-RTEXT1,
      SRTEXT2  TYPE ZDMS5-RTEXT1,
      SRTEXT3  TYPE ZDMS5-RTEXT1,
      SRTEXT4  TYPE ZDMS5-RTEXT1,
      SRTEXT5  TYPE ZDMS5-RTEXT1,
      SRTEXT6  TYPE ZDMS5-RTEXT1,
      SRTEXT7  TYPE ZDMS5-RTEXT1,
      SRTEXT8  TYPE ZDMS5-RTEXT1,
      SRTEXT9  TYPE ZDMS5-RTEXT1,
      SRTEXT10 TYPE ZDMS5-RTEXT1.

DATA : CHGNUM TYPE ZDMS4-CCNUMB1.

DATA: EXTPNAME     TYPE PA0001-ENAME,
      EXTPDT       TYPE SY-DATUM,  "initiator dt for extension
      EXTPTM       TYPE SY-UZEIT,
      EXTPDNAME    TYPE PA0001-ENAME,
      EXTINITDEPT  TYPE PA0001-BTRTL,  "extension initiator
      EXTPDDT      TYPE SY-DATUM,
      EXTPDTM      TYPE SY-UZEIT,
      EXTPONAME    TYPE PA0001-ENAME,  "other dept head responcible for extension
      EXTPODT      TYPE SY-DATUM,
*      revextdt     TYPE sy-datum, "revised extension date.
      EXTDEPTNAME  TYPE T001P-BTEXT,  "ORI DEPT NAME
      EXTODEPTNAME TYPE T001P-BTEXT.  "OTHER DEPT NAME
*DATA : STAT TYPE I.
DATA: CHK1(1) TYPE C,
      CHK2(1) TYPE C,
      CHK3(1) TYPE C.
DATA: ERR1 TYPE I.
DATA: OTHREXTDEPT TYPE PA0001-BTRTL.

DATA : R1   TYPE C,
       R1C  TYPE C,
       R2   TYPE C,
       R21  TYPE C,
       R21A TYPE C,

*             R5 RADIOBUTTON GROUP R2,
       R4   TYPE C,
       R4A  TYPE C,
       R3   TYPE C,
       R3A  TYPE C,
       R31  TYPE C,
       R32  TYPE C,
       R33  TYPE C,
*             R34 RADIOBUTTON GROUP R2,
       R7   TYPE C,
       R7A  TYPE C,  "ENTER TENTATIVE CLOSURE DATE
       RE1  TYPE C,  "extension
       RE2  TYPE C,  "extension
       RE3  TYPE C,  "extension
       R8   TYPE C,
       R81  TYPE C,
       R82  TYPE C,
       R9   TYPE C,
       R91  TYPE C,
       R10  TYPE C,
       R11  TYPE C,
       R12  TYPE C.

*       r13  type c.
DATA: IBTRTL TYPE PA0001-BTRTL.
DATA: REVIEWERC TYPE PA0001-PERNR.
DATA: TCL1 TYPE I.  "TENTATIVE CLOSURE
DATA : EMAILID(70) TYPE C.
DATA: EXT1      TYPE I,
      INITDEPT1 TYPE PA0001-BTRTL,
      INITDEPT2 TYPE PA0001-BTRTL.

DATA : INITDEPT       TYPE PA0001-BTRTL,
       INITDEPTSEL(1) TYPE C,
       QASEL(1)       TYPE C.
****************************************
DATA : OPTIONS        TYPE ITCPO,
       L_OTF_DATA     LIKE ITCOO OCCURS 10,
       L_ASC_DATA     LIKE TLINE OCCURS 10,
       L_DOCS         LIKE DOCS  OCCURS 10,
       L_PDF_DATA     LIKE SOLISTI1 OCCURS 10,
       L_PDF_DATA1    LIKE SOLISTI1 OCCURS 10,
       L_BIN_FILESIZE TYPE I.
DATA :  RESULT      LIKE  ITCPP.
DATA: DOCDATA LIKE SOLISTI1  OCCURS  10,
      OBJHEAD LIKE SOLISTI1  OCCURS  1,
      OBJBIN1 LIKE SOLISTI1  OCCURS 10,
      OBJBIN  LIKE SOLISTI1  OCCURS 10.
DATA: LISTOBJECT LIKE ABAPLIST  OCCURS  1 .
DATA: DOC_CHNG LIKE SODOCCHGI1.
DATA RECLIST    LIKE SOMLRECI1  OCCURS  1 WITH HEADER LINE.
DATA MCOUNT TYPE I.
DATA : V_WERKS TYPE WERKS_D.
DATA : V_TEXT(70) TYPE C.
DATA: LTX LIKE T247-LTX.

DATA : USRID_LONG LIKE PA0105-USRID_LONG.
DATA : W_USRID_LONG TYPE PA0105-USRID_LONG.
DATA RIGHE_ATTACHMENT TYPE I.
DATA RIGHE_TESTO TYPE I.
DATA TAB_LINES TYPE I.
DATA  BEGIN OF OBJPACK OCCURS 0 .
INCLUDE STRUCTURE  SOPCKLSTI1.
DATA END OF OBJPACK.

DATA BEGIN OF OBJTXT OCCURS 0.
INCLUDE STRUCTURE SOLISTI1.
DATA END OF OBJTXT.
DATA : W_OBJTXT(310) TYPE C.
DATA : W_OBJTXT1(110) TYPE C.
DATA: V_MSG(125) TYPE C.
DATA : WA_D1(10) TYPE C.
DATA: REVIEWER TYPE PA0001-ENAME.
DATA : AUTHPLANT TYPE ZDMS1-WERKS,
       CQD(1)    TYPE C.
DATA : JANDT TYPE SY-DATUM.
DATA : RNDDEPT TYPE PA0001-BTRTL.

DATA: RSTAT(10) TYPE C.
DATA: ZDMS5_WA TYPE ZDMS5,
      ZDMS6_WA TYPE ZDMS6.
DATA : WA_CLDT1(10) TYPE C.
DATA:  APRPERNR TYPE ZQMS_DEPTHEAD-APPROVER.
DATA:  UNAME(40) TYPE C.
DATA: DHEAD1 TYPE I. " allow second line for dept head.
*******************************************

DATA: PERNR TYPE PA0001-PERNR.

SELECTION-SCREEN BEGIN OF BLOCK MERKMALE1 WITH FRAME TITLE TEXT-002.
  PARAMETERS : CC1  RADIOBUTTON GROUP R1,
               RCC1 RADIOBUTTON GROUP R1,
               RCC2 RADIOBUTTON GROUP R1,
               RCC3 RADIOBUTTON GROUP R1.
SELECTION-SCREEN END OF BLOCK MERKMALE1.

SELECTION-SCREEN BEGIN OF BLOCK MERKMALE3 WITH FRAME TITLE TEXT-001.
  PARAMETERS : "pernr    like pa0001-pernr matchcode object prem,
               PASS(10) TYPE C NO-DISPLAY.
SELECTION-SCREEN END OF BLOCK MERKMALE3.


SELECTION-SCREEN BEGIN OF BLOCK MERKMALE2 WITH FRAME TITLE TEXT-002.

*PARAMETERS : R1  RADIOBUTTON GROUP R2,
*             R2  RADIOBUTTON GROUP R2,
*
**             R5 RADIOBUTTON GROUP R2,
*             R4  RADIOBUTTON GROUP R2,
*             R3  RADIOBUTTON GROUP R2,
*             R31 RADIOBUTTON GROUP R2,
*             R32 RADIOBUTTON GROUP R2,
*             R33 RADIOBUTTON GROUP R2,
**             R34 RADIOBUTTON GROUP R2,
*             R7  RADIOBUTTON GROUP R2,
*             R8  RADIOBUTTON GROUP R2,
*             R81 RADIOBUTTON GROUP R2,
*             R82 RADIOBUTTON GROUP R2,
*             R9  RADIOBUTTON GROUP R2,
*             R91 RADIOBUTTON GROUP R2,
*             R10 RADIOBUTTON GROUP R2.

SELECTION-SCREEN END OF BLOCK MERKMALE2 .

AT SELECTION-SCREEN OUTPUT.

  LOOP AT SCREEN.
    CHECK SCREEN-NAME EQ 'PASS'.
    SCREEN-INVISIBLE = 1.
    MODIFY SCREEN.
  ENDLOOP.

*  PERFORM SEARCHHELP.

INITIALIZATION.
  G_REPID = SY-REPID.

START-OF-SELECTION.

  SELECT SINGLE * FROM PA0105 WHERE USRID EQ SY-UNAME.
  IF SY-SUBRC EQ 0.
    PERNR = PA0105-PERNR.
  ENDIF.

**  CLEAR : SUBJECT.
*  IF CC1 EQ 'X'.
*    PERFORM PASSW.
*  ENDIF.

  CLEAR : TSDEPT1,TSDEPT2,TSDEPT3,TSDEPT4,TSDEPT5,TSDEPT6,TSDEPT7,TSDEPT8,TSDEPT9,TSDEPT10.
  CLEAR : STATUS, ENAME, ANAME, DEPT, KUNNR, IDEPT,BTRTL,QNAME.
  IF CC1 EQ 'X'.
    SELECT SINGLE * FROM PA0001 WHERE PERNR EQ PERNR." AND ENDDA GE SY-DATUM AND PLANS NE '99999999'.
    IF SY-SUBRC NE 0.
      MESSAGE 'INVALID USER' TYPE 'E'.
      EXIT.
    ENDIF.
  ENDIF.

  IF PERNR EQ '00014022'.
*    r33 = 'X'.
    PERFORM SEARCHHELP1.
  ELSE.
    PERFORM SEARCHHELP.
  ENDIF.

  CLEAR : AUTHPLANT,CQD.
  SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ PERNR .
  IF SY-SUBRC EQ 0.
    AUTHPLANT = ZPASSW-WERKS.
*    SELECT SINGLE * FROM PA0001 WHERE PERNR EQ PERNR AND ENDDA GE SY-DATUM.
    SELECT SINGLE * FROM ZPA0001 WHERE PERNR EQ PERNR AND ENDDA GE SY-DATUM.
    IF SY-SUBRC EQ 0.
*      IF PA0001-BTRTL EQ '1232'.
      IF ZPA0001-BTRTL EQ '1232'.
        CQD = 'X'.
      ENDIF.
    ENDIF.
  ENDIF.

  IF RCC1 EQ 'X'.
    CALL TRANSACTION 'ZQMSR'.
*    PERFORM CCREPORT.
    EXIT.
  ELSEIF RCC2 EQ 'X'.
    CALL TRANSACTION 'ZQMSRA'.
*    PERFORM CCREPORT.
    EXIT.
  ELSEIF RCC3 EQ 'X'.  "ADDED ON 13.12.22 BY JYOTSNA
    CALL TRANSACTION 'ZDEV'.
*    PERFORM CCREPORT.
    EXIT.
  ELSE.
    IF PERNR EQ '00014022'.
      R33 = 'X'.
    ELSE.
      R10 = 'X'.
    ENDIF.
    CALL SCREEN 9009.
  ENDIF.






*  CLEAR : TSDEPT1,TSDEPT2,TSDEPT3,TSDEPT4,TSDEPT5,TSDEPT6,TSDEPT7,TSDEPT8,TSDEPT9,TSDEPT10.
*  CLEAR : STATUS, ENAME, ANAME, DEPT, KUNNR, IDEPT,BTRTL.

*  IF R1 EQ 'X'.
*    YEAR = SY-DATUM+0(4).
*  ELSE.
*    YEAR = YEAR.
*  ENDIF.

*  SELECT SINGLE * FROM PA0001 WHERE PERNR EQ PERNR AND ENDDA GE SY-DATUM.
*  IF SY-SUBRC EQ 0.
*    IMPDEPT = PA0001-BTRTL.
*  ENDIF.

*  IF CC1  EQ 'X' AND R1 EQ 'X'.
*
*    IF PERNR IS  INITIAL.
*      MESSAGE 'ENTER EMPLOYEE CODE NUMBER' TYPE 'E'.
*    ENDIF.
*    IF CCNUM IS NOT INITIAL.
*      MESSAGE 'REMOVE NOTIFICATION NUMBER' TYPE 'E'.
*    ENDIF.
*    SELECT * FROM ZDMS1 INTO TABLE IT_ZDMS1 WHERE MJAHR EQ YEAR.
*    SORT IT_ZDMS1 DESCENDING BY MBLNR.
*    READ TABLE IT_ZDMS1 INTO WA_ZDMS1 WITH KEY MJAHR = YEAR.
*    IF SY-SUBRC EQ 0.
*      VBELN = WA_ZDMS1-MBLNR.
*    ENDIF.
*    FINV = VBELN + 1.
*    SELECT SINGLE * FROM PA0001 WHERE PERNR EQ PERNR AND ENDDA GE SY-DATUM.
*    IF SY-SUBRC EQ 0.
*      ENAME = PA0001-ENAME.
*      SELECT SINGLE * FROM T001P WHERE BTRTL EQ PA0001-BTRTL.
*      IF SY-SUBRC EQ 0.
*        DEPT = T001P-BTEXT.
*      ENDIF.
*    ENDIF.
*    CALL SCREEN 9001.
*  ELSEIF CC1  EQ 'X' AND R2 EQ 'X'.
*    SELECT SINGLE * FROM ZDMS1 WHERE MBLNR EQ CCNUM AND MJAHR EQ YEAR.
*    IF SY-SUBRC NE 0.
*      MESSAGE 'INVALID NUMBER' TYPE 'I'.
*      EXIT.
*    ENDIF.
*    IF PERNR IS  INITIAL.
*      MESSAGE 'ENTER EMPLOYEE CODE NUMBER' TYPE 'E'.
*    ENDIF.
*    IF CCNUM IS  INITIAL.
*      MESSAGE 'ENTER CHANGE CONTROL NUMBER' TYPE 'E'.
*    ENDIF.
*    IF YEAR IS  INITIAL.
*      MESSAGE 'ENTER CHANGE CONTROL YEAR' TYPE 'E'.
*    ENDIF.
**    PERFORM PASSW.
*    SELECT * FROM ZDMS1 INTO TABLE IT_ZDMS1 WHERE MBLNR EQ CCNUM AND MJAHR EQ YEAR.
*    CALL SCREEN 9001.
*
*  ELSEIF CC1  EQ 'X' AND R4 EQ 'X'.
*    SELECT SINGLE * FROM ZDMS1 WHERE MBLNR EQ CCNUM AND MJAHR EQ YEAR.
*    IF SY-SUBRC NE 0.
*      MESSAGE 'INVALID NUMBER' TYPE 'I'.
*      EXIT.
*    ENDIF.
*    IF CCNUM IS  INITIAL.
*      MESSAGE 'ENTER CHANGE CONTROL NUMBER' TYPE 'E'.
*    ENDIF.
*    IF YEAR IS  INITIAL.
*      MESSAGE 'ENTER CHANGE CONTROL YEAR' TYPE 'E'.
*    ENDIF.
*    SELECT * FROM ZDMS1 INTO TABLE IT_ZDMS1 WHERE MBLNR EQ CCNUM AND MJAHR EQ YEAR.
*    SELECT * FROM ZDMS2 INTO TABLE IT_ZDMS2 WHERE MBLNR EQ CCNUM AND MJAHR EQ YEAR .
**    PERFORM REJECTION.
*    CALL SCREEN 9001.
*
*  ELSEIF CC1  EQ 'X' AND R3 EQ 'X' .
*    SELECT SINGLE * FROM ZDMS1 WHERE MBLNR EQ CCNUM AND MJAHR EQ YEAR.
*    IF SY-SUBRC NE 0.
*      MESSAGE 'INVALID NUMBER' TYPE 'I'.
*      EXIT.
*    ENDIF.
*    SELECT SINGLE * FROM ZDMS1 WHERE MBLNR EQ CCNUM AND MJAHR EQ YEAR .
*    IF SY-SUBRC EQ 0.
*      IF ZDMS1-APPROVE NE 'X'.
*        MESSAGE 'CHANGE NOT YET APPROVED BY DEPT. HEAD' TYPE 'I'.
*        EXIT.
*      ENDIF.
*    ENDIF.
*    IF CCNUM IS  INITIAL.
*      MESSAGE 'ENTER CHANGE CONTROL NUMBER' TYPE 'E'.
*    ENDIF.
*    IF YEAR IS  INITIAL.
*      MESSAGE 'ENTER CHANGE CONTROL YEAR' TYPE 'E'.
*    ENDIF.
*    SELECT * FROM ZDMS1 INTO TABLE IT_ZDMS1 WHERE MBLNR EQ CCNUM AND MJAHR EQ YEAR.
*    PERFORM DEPTCHK.
*    SELECT * FROM ZDMS2 INTO TABLE IT_ZDMS2 WHERE MBLNR EQ CCNUM AND MJAHR EQ YEAR.
**        PERFORM REJECTION.
*    CALL SCREEN 9004.
*
*  ELSEIF CC1  EQ 'X' AND ( R31 EQ 'X' OR R32 EQ 'X' OR R33 EQ 'X' ).
*    SELECT SINGLE * FROM ZDMS1 WHERE MBLNR EQ CCNUM AND MJAHR EQ YEAR.
*    IF SY-SUBRC NE 0.
*      MESSAGE 'INVALID NUMBER' TYPE 'I'.
*      EXIT.
*    ENDIF.
*    SELECT SINGLE * FROM ZDMS1 WHERE MBLNR EQ CCNUM AND MJAHR EQ YEAR .
*    IF SY-SUBRC EQ 0.
*      IF ZDMS1-APPROVE NE 'X'.
*        MESSAGE 'CHANGE NOT YET APPROVED BY DEPT. HEAD' TYPE 'I'.
*        EXIT.
*      ENDIF.
*    ENDIF.
*    IF CCNUM IS  INITIAL.
*      MESSAGE 'ENTER CHANGE CONTROL NUMBER' TYPE 'E'.
*    ENDIF.
*    IF YEAR IS  INITIAL.
*      MESSAGE 'ENTER CHANGE CONTROL YEAR' TYPE 'E'.
*    ENDIF.
*    SELECT * FROM ZDMS1 INTO TABLE IT_ZDMS1 WHERE MBLNR EQ CCNUM AND MJAHR EQ YEAR.
*    PERFORM DEPTCHK.
*    SELECT * FROM ZDMS2 INTO TABLE IT_ZDMS2 WHERE MBLNR EQ CCNUM AND MJAHR EQ YEAR.
**        PERFORM REJECTION.
*    CALL SCREEN 9005.
*
**  ELSEIF CC1  EQ 'X' AND R5 EQ 'X'.
***    PERFORM PASSW.
**    SELECT SINGLE * FROM ZDMS4 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM.
**    IF SY-SUBRC EQ 0.
**      MOVE-CORRESPONDING ZDMS4 TO ZDMS4_WA.
**      ZDMS4_WA-QHAPPROVE = ' '.
**      ZDMS4_WA-QHREJECT = ' '.
**      ZDMS4_WA-QHPERNR = PERNR.
***            ZDMS1_WA1-TDAPPROVE = TDAPPROVE.
***            ZDMS1_WA1-TDREJECT = TDREJECT.
***            ZDMS1_WA1-CCNUMB = FINV1.
***            ZDMS1_WA1-CCNUMB1 = FINVNUMB.
**      UPDATE ZDMS4 FROM ZDMS4_WA.
**      CLEAR ZDMS4_WA.
**      MESSAGE 'QA HEAD APPROVAL IS RESET' TYPE 'I'.
**      EXIT.
**    ENDIF.
*
**  ELSEIF CC1  EQ 'X' AND R6 EQ 'X'.
***    PERFORM PASSW.
**    SELECT SINGLE * FROM ZDMS1 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM.
**    IF SY-SUBRC EQ 0.
**      MOVE-CORRESPONDING ZDMS4 TO ZDMS4_WA.
**      ZDMS4_WA-TDAPPROVE = ' '.
**      ZDMS4_WA-TDREJECT = ' '.
**      ZDMS4_WA-TDPERNR = PERNR.
***            ZDMS4_WA1-TDAPPROVE = TDAPPROVE.
***            ZDMS4_WA1-TDREJECT = TDREJECT.
***            ZDMS4_WA1-CCNUMB = FINV1.
***            ZDMS4_WA1-CCNUMB1 = FINVNUMB.
**      UPDATE ZDMS4 FROM ZDMS4_WA.
**      CLEAR ZDMS4_WA.
**      MESSAGE 'TECHNICAL DIRECTOR APPROVAL IS RESET' TYPE 'I'.
**      EXIT.
**    ENDIF.
*
*  ELSEIF CC1  EQ 'X' AND  R7 EQ 'X' .
*    SELECT SINGLE * FROM ZDMS1 WHERE MBLNR EQ CCNUM AND MJAHR EQ YEAR.
*    IF SY-SUBRC NE 0.
*      MESSAGE 'INVALID NUMBER' TYPE 'I'.
*      EXIT.
*    ENDIF.
*    IF CCNUM IS  INITIAL.
*      MESSAGE 'ENTER CHANGE CONTROL NUMBER' TYPE 'E'.
*    ENDIF.
*    IF YEAR IS  INITIAL.
*      MESSAGE 'ENTER CHANGE CONTROL YEAR' TYPE 'E'.
*    ENDIF.
**    PERFORM PASSW.
*    SELECT * FROM ZDMS1 INTO TABLE IT_ZDMS1 WHERE MBLNR EQ CCNUM AND MJAHR EQ YEAR.
*    SELECT * FROM ZDMS2 INTO TABLE IT_ZDMS2 WHERE MBLNR EQ CCNUM AND MJAHR EQ YEAR.
*    SELECT * FROM ZDMS3 INTO TABLE IT_ZDMS3 WHERE MBLNR EQ CCNUM AND MJAHR EQ YEAR.
**        PERFORM REJECTION.
*    CALL SCREEN 9003.
*
*  ELSEIF CC1  EQ 'X' AND ( R8 EQ 'X' OR R81 EQ 'X' OR R9 EQ 'X' OR R91 EQ 'X').
*    SELECT SINGLE * FROM ZDMS1 WHERE MBLNR EQ CCNUM AND MJAHR EQ YEAR.
*    IF SY-SUBRC NE 0.
*      MESSAGE 'INVALID NUMBER' TYPE 'I'.
*      EXIT.
*    ENDIF.
*    IF CCNUM IS  INITIAL.
*      MESSAGE 'ENTER CHANGE CONTROL NUMBER' TYPE 'E'.
*    ENDIF.
*    IF YEAR IS  INITIAL.
*      MESSAGE 'ENTER CHANGE CONTROL YEAR' TYPE 'E'.
*    ENDIF.
**    PERFORM PASSW.
*    SELECT * FROM ZDMS1 INTO TABLE IT_ZDMS1 WHERE MBLNR EQ CCNUM AND MJAHR EQ YEAR.
*    SELECT * FROM ZDMS2 INTO TABLE IT_ZDMS2 WHERE MBLNR EQ CCNUM AND MJAHR EQ YEAR.
*    SELECT * FROM ZDMS3 INTO TABLE IT_ZDMS3 WHERE MBLNR EQ CCNUM AND MJAHR EQ YEAR.
**        PERFORM REJECTION.
*    CALL SCREEN 9006.
*  ELSEIF CC1  EQ 'X' AND R82 EQ 'X' .
*    SELECT SINGLE * FROM ZDMS1 WHERE MBLNR EQ CCNUM AND MJAHR EQ YEAR.
*    IF SY-SUBRC NE 0.
*      MESSAGE 'INVALID NUMBER' TYPE 'I'.
*      EXIT.
*    ENDIF.
*    IF CCNUM IS  INITIAL.
*      MESSAGE 'ENTER CHANGE CONTROL NUMBER' TYPE 'E'.
*    ENDIF.
*    IF YEAR IS  INITIAL.
*      MESSAGE 'ENTER CHANGE CONTROL YEAR' TYPE 'E'.
*    ENDIF.
**    PERFORM PASSW.
*
**        PERFORM REJECTION.
*    PERFORM FOLWACT.
*
*  ELSEIF CC1  EQ 'X' AND R10 EQ 'X'.
*    SELECT SINGLE * FROM ZDMS1 WHERE MBLNR EQ CCNUM AND MJAHR EQ YEAR.
*    IF SY-SUBRC NE 0.
*      MESSAGE 'INVALID NUMBER' TYPE 'I'.
*      EXIT.
*    ENDIF.
*    IF CCNUM IS  INITIAL.
*      MESSAGE 'ENTER CHANGE CONTROL NUMBER' TYPE 'E'.
*    ENDIF.
*    IF YEAR IS  INITIAL.
*      MESSAGE 'ENTER CHANGE CONTROL YEAR' TYPE 'E'.
*    ENDIF.
**    PERFORM PASSW.
*
*    PERFORM PRINT.
**    PERFORM PRINT_FORM.
*
**  ELSEIF CC1  EQ 'X' AND R11 EQ 'X'.
**    PERFORM SEARCHHELP.
*
*  ENDIF.


*&---------------------------------------------------------------------*
*&      Module  STATUS_9001  OUTPUT
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
MODULE STATUS_9001 OUTPUT.
  CLEAR TSDEPT5.

*  TSDEPT5 = 'xxx'.
  CLEAR: WERKS.
  WERKS = PLANT.
  IF CC1  EQ 'X' AND R1 EQ 'X'.
    SET PF-STATUS 'STATUS'.
    SET TITLEBAR 'CREATE'.
    ZDMS1-MBLNR = FINV.
    ZDMS1-WERKS = PLANT.
    WERKS = PLANT.
    SELECT SINGLE * FROM T001W WHERE WERKS EQ ZDMS1-WERKS.
    IF SY-SUBRC EQ 0.
      KUNNR = T001W-KUNNR.
    ENDIF.
    LOOP AT SCREEN.
      IF SCREEN-GROUP1 EQ '001'.
        SCREEN-INPUT = 0.
        MODIFY SCREEN.
      ELSEIF SCREEN-GROUP1 EQ '002'.
        SCREEN-INPUT = 0.
        MODIFY SCREEN.
      ELSEIF SCREEN-GROUP1 EQ '004'.
        SCREEN-INPUT = 0.
        MODIFY SCREEN.
      ELSEIF SCREEN-GROUP2 EQ '002'.
        SCREEN-INPUT = 0.
        MODIFY SCREEN.
      ENDIF.
    ENDLOOP.

  ELSEIF CC1  EQ 'X' AND ( R2 EQ 'X' OR R1C EQ 'X' OR R4 EQ 'X' OR R21A EQ 'X' OR R21 EQ 'X' OR R4A EQ 'X') .

    SET PF-STATUS 'STATUS'.
    SET TITLEBAR 'CHANGE'.
    CLEAR : IBTRTL,WERKS.
    SELECT SINGLE * FROM ZDMS1 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM.
    IF SY-SUBRC EQ 0.
      WERKS = ZDMS1-WERKS.
*      SELECT SINGLE * FROM PA0001 WHERE PERNR EQ ZDMS1-PERNR AND ENDDA GE SY-DATUM.
      SELECT SINGLE * FROM PA0001 WHERE PERNR EQ ZDMS1-PERNR AND ENDDA GE SY-DATUM.
      IF SY-SUBRC EQ 0.
*        IBTRTL = PA0001-BTRTL.  "initiating department code
        IBTRTL = ZPA0001-BTRTL.  "initiating department code
      ENDIF.
    ENDIF.


*    BREAK-POINT.
    IF R21A EQ 'X' OR R21 EQ 'X'.  "31.5.22
      CLEAR : CHK1.
      IF R21A EQ 'X'.
        SELECT SINGLE * FROM ZQMS_DEPTHEAD1 WHERE BTRTL EQ IBTRTL AND REVIEWER EQ SPACE AND TO_DT GE SY-DATUM.
        IF SY-SUBRC EQ 0.
          CHK1 = 1.
        ENDIF.
        IF CHK1 EQ 1.
          MESSAGE 'REVIEWER ENTRY IS NOT ALLOWED' TYPE 'E'.
        ENDIF.
      ELSEIF R21 EQ 'X'.
*        BREAK-POINT.
        SELECT SINGLE * FROM ZQMS_DEPTHEAD1 WHERE BTRTL EQ IBTRTL AND REVIEWER NE SPACE AND TO_DT GE SY-DATUM.
        IF SY-SUBRC EQ 0.
          SELECT SINGLE * FROM ZDMS1 WHERE MBLNR EQ CCNUM AND MJAHR EQ YEAR AND RAPPROVE2 NE 'X'.
          IF SY-SUBRC EQ 0.
            MESSAGE 'CHANGE CONTROL IS NOT YET REVIEWED BY REVIEWER' TYPE 'E'.
          ENDIF.
        ENDIF.

        SELECT SINGLE * FROM ZQMS_DEPTHEAD1 WHERE BTRTL EQ IBTRTL AND APPROVER NE SPACE AND TO_DT GE SY-DATUM.
        IF SY-SUBRC EQ 0.
          IF PERNR NE ZQMS_DEPTHEAD1-APPROVER.
            MESSAGE 'INVALID APPROVER' TYPE 'E'.
          ENDIF.
        ENDIF.


        SELECT SINGLE * FROM ZQMS_DEPTHEAD1 WHERE BTRTL EQ IBTRTL AND APPROVER EQ SPACE AND TO_DT GE SY-DATUM.
        IF SY-SUBRC EQ 0.
          CHK1 = 1.
        ENDIF.
        IF CHK1 EQ 1.
          MESSAGE 'APPROVER ENTRY IS NOT ALLOWED' TYPE 'E'.
        ENDIF.
      ENDIF.



*      CLEAR : chk1.
*      SELECT SINGLE * FROM zdms1 WHERE mjahr EQ year AND mblnr EQ ccnum.
*      IF sy-subrc EQ 0.
*        SELECT SINGLE * FROM pa0001 WHERE pernr EQ zdms1-pernr AND endda GE sy-datum.
*        IF sy-subrc EQ 0.
*          IF zdms1-werks EQ '1000'.
*            IF pa0001-btrtl EQ '1232' OR pa0001-btrtl EQ '1223' OR pa0001-btrtl EQ '1224' OR pa0001-btrtl EQ '1230'
*              OR pa0001-btrtl EQ '1228' OR pa0001-btrtl EQ '1229' OR pa0001-btrtl EQ '1231'.
*              chk1 = 1.
*            ENDIF.
*          ELSEIF zdms1-werks EQ '1001'.
*            IF pa0001-btrtl EQ '1323' OR pa0001-btrtl EQ '1328'.
*              chk1 = 1.
*            ENDIF.
*          ENDIF.
*        ENDIF.
*      ENDIF.
*      IF chk1 EQ 1.
*        MESSAGE 'REVIEWER / APPROVER ENTRY IS NOT ALLOWED' TYPE 'E'.
*      ENDIF.
    ENDIF.

    IF R2 EQ 'X'.
      SELECT SINGLE * FROM ZDMS1 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM.
      IF SY-SUBRC EQ 0.
        IF ZDMS1-APPROVE EQ 'X' OR ZDMS1-REJECT EQ 'X'.
          MESSAGE 'APPROVAL / REJECTION IS ALREADY DONE' TYPE 'I'.
          LEAVE TO SCREEN 0.
          LOOP AT SCREEN.
            SCREEN-INPUT = 0.
            MODIFY SCREEN.
          ENDLOOP.
        ENDIF.
      ENDIF.

*      SELECT SINGLE * FROM ZQMS_DEPTHEAD1 WHERE BTRTL EQ IBTRTL AND PERNR EQ PERNR AND TO_DT GE SY-DATUM...  "added on 19.5.23
*      IF SY-SUBRC EQ 4.
*        MESSAGE 'NOT DEPARTMENT HEAD' TYPE 'E'.
*      ENDIF.
******below code added on 1.12.24.
      CLEAR : DHEAD1.
      SELECT SINGLE * FROM ZQMS_DEPTHEAD1 WHERE BTRTL EQ IBTRTL AND PERNR EQ PERNR AND TO_DT GE SY-DATUM...  "added on 19.5.23
      IF SY-SUBRC EQ 0.
        DHEAD1 = 1.
      ENDIF.
      SELECT SINGLE * FROM ZQMS_DEPTHEAD2 WHERE BTRTL EQ IBTRTL AND PERNR EQ PERNR AND FROM_DT LE SY-DATUM AND TO_DT GE SY-DATUM.  "added on 19.5.23
      IF SY-SUBRC EQ 0.
        DHEAD1 = 1.
      ENDIF.
      IF DHEAD1 NE 1.
        MESSAGE 'NOT DEPARTMENT HEAD' TYPE 'E'.
      ENDIF.
****************************

    ENDIF.

    IF R21 EQ 'X'.
      SELECT SINGLE * FROM ZDMS1 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM.
      IF SY-SUBRC EQ 0.
        IF ZDMS1-RAPPROVE1 EQ 'X' OR ZDMS1-RREJECT1 EQ 'X'.
          MESSAGE 'APPROVAL / REJECTION IS ALREADY DONE' TYPE 'I'.
          LEAVE TO SCREEN 0.
          LOOP AT SCREEN.
            SCREEN-INPUT = 0.
            MODIFY SCREEN.
          ENDLOOP.
        ENDIF.
      ENDIF.
    ENDIF.
    IF R21A EQ 'X'.
      SELECT SINGLE * FROM ZDMS1 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM.
      IF SY-SUBRC EQ 0.
        IF ZDMS1-RAPPROVE2 EQ 'X' OR ZDMS1-RREJECT2 EQ 'X'.
          MESSAGE 'APPROVAL / REJECTION IS ALREADY DONE' TYPE 'I'.
          LEAVE TO SCREEN 0.
          LOOP AT SCREEN.
            SCREEN-INPUT = 0.
            MODIFY SCREEN.
          ENDLOOP.
        ENDIF.
      ENDIF.
    ENDIF.


    SELECT SINGLE * FROM ZDMS4 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM.
    IF SY-SUBRC EQ 0.
      IF ZDMS4-CL1 EQ 'X'.
        LOOP AT SCREEN.
          SCREEN-INPUT = 0.
          MODIFY SCREEN.
        ENDLOOP.
      ENDIF.
      IF ZDMS4-TDAPPROVE EQ 'X' OR ZDMS4-TDREJECT EQ 'X'.
        LOOP AT SCREEN.
          SCREEN-INPUT = 0.
          MODIFY SCREEN.
        ENDLOOP.
      ENDIF.
    ENDIF.
    IF R1C EQ 'X'.
      SELECT SINGLE * FROM ZDMS1 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM.
      IF SY-SUBRC EQ 0.
        IF ZDMS1-PERNR NE PERNR.
          IF SY-UNAME EQ 'ITBOM01' AND PERNR EQ '00007413'.
          ELSEIF WERKS EQ '1000' AND SY-UNAME EQ 'QANSK01' AND PERNR EQ '00005693'.
          ELSEIF WERKS EQ '3000' AND SY-UNAME EQ 'QANSK02' AND PERNR EQ '00013959'.
          ELSEIF WERKS EQ '4000' AND SY-UNAME EQ 'QANSK02' AND PERNR EQ '00013959'.
          ELSEIF WERKS EQ '1001' AND SY-UNAME EQ 'QAGOA02' AND PERNR EQ '00011924'.
*            break-point  .
          ELSE.
            MESSAGE 'ONLY INITIATOR CAN MAKE THE CHANGES' TYPE 'E'.
            EXIT.
          ENDIF.
        ENDIF.

**********************
        IF SY-UNAME EQ 'ITBOM01' AND PERNR EQ '00007413'.
        ELSEIF WERKS EQ '1000' AND SY-UNAME EQ 'QANSK01' AND PERNR EQ '00005693'.  "allowed on 1.3.23
        ELSEIF WERKS EQ '3000' AND SY-UNAME EQ 'QANSK02' AND PERNR EQ '00013959'.  "allowed on 1.3.23
        ELSEIF WERKS EQ '4000' AND SY-UNAME EQ 'QANSK02' AND PERNR EQ '00013959'.  "allowed on 1.3.23
        ELSEIF WERKS EQ '1001' AND SY-UNAME EQ 'QAGOA02' AND PERNR EQ '00011924'. "allowed on 1.3.23
        ELSE..
          IF ZDMS1-APPROVE EQ 'X' OR ZDMS1-REJECT EQ 'X'.
            MESSAGE 'RESET DEPT HEAD''S APPROVAL FOR EDIT MODE' TYPE 'I'.
            LOOP AT SCREEN.
              SCREEN-INPUT = 0.
              MODIFY SCREEN.
            ENDLOOP.
          ELSE.
            LOOP AT SCREEN.
              IF SCREEN-GROUP1 EQ '001'.
                SCREEN-INPUT = 0.
                MODIFY SCREEN.
              ELSEIF SCREEN-GROUP1 EQ '002'.
                SCREEN-INPUT = 0.
                MODIFY SCREEN.
              ELSEIF SCREEN-GROUP2 EQ '002'.
                SCREEN-INPUT = 0.
                MODIFY SCREEN.
              ELSEIF SCREEN-GROUP1 EQ '004'.
                SCREEN-INPUT = 0.
                MODIFY SCREEN.
              ELSE.
*              SCREEN-INPUT = 1.
*              MODIFY SCREEN.
              ENDIF.
            ENDLOOP.
          ENDIF.

        ENDIF.
******************************************
      ENDIF.
    ELSEIF R2 EQ 'X'.
      PERFORM DEPTHEAD.
      LOOP AT SCREEN.
        IF SCREEN-GROUP1 EQ '001'.
        ELSE.
          SCREEN-INPUT = 0.
          MODIFY SCREEN.
        ENDIF.
      ENDLOOP.
      LOOP AT SCREEN.
        IF SCREEN-GROUP1 EQ '002'.
          SCREEN-INPUT = 0.
          MODIFY SCREEN.
        ENDIF.
      ENDLOOP.
    ELSEIF R21 EQ 'X'. "Approver
      CLEAR : APRPERNR.
*      BREAK-POINT .
      SELECT SINGLE * FROM ZQMS_DEPTHEAD1 WHERE BTRTL EQ IBTRTL AND TO_DT GE SY-DATUM.
      IF SY-SUBRC EQ 0.
        SELECT SINGLE * FROM PA0001 WHERE PERNR EQ ZQMS_DEPTHEAD1-APPROVER AND PLANS NE '99999999' AND ENDDA GE SY-DATUM.
        IF SY-SUBRC EQ 0.
          APRPERNR = ZQMS_DEPTHEAD1-APPROVER.
        ENDIF.
      ENDIF.
      LOOP AT SCREEN.
        IF SCREEN-GROUP1 EQ '002'.
        ELSE.
          SCREEN-INPUT = 0.
          MODIFY SCREEN.
        ENDIF.
      ENDLOOP.

*      IF zdms1-werks EQ '1000'.
*        SELECT SINGLE * FROM zqms_depthead WHERE btrtl EQ '1227'.
*        IF sy-subrc EQ 0.
*          aprpernr = zqms_depthead-approver.
*        ENDIF.
**        IF pernr NE '00007354'.
*        IF pernr NE aprpernr.
*          MESSAGE 'NOT VALID USER' TYPE 'E'.
*          EXIT.
*        ENDIF.
*        LOOP AT SCREEN.
*          IF screen-group1 EQ '002'.
*          ELSE.
*            screen-input = 0.
*            MODIFY SCREEN.
*          ENDIF.
*        ENDLOOP.
*      ELSEIF zdms1-werks EQ '1001'.
*        IF pernr NE '00003139'.
**        IF pernr NE '00016314'. "added on 16.1.23
*          MESSAGE 'NOT VALID USER' TYPE 'E'.
*          EXIT.
*        ENDIF.
*        LOOP AT SCREEN.
*          IF screen-group1 EQ '002'.
*          ELSE.
*            screen-input = 0.
*            MODIFY SCREEN.
*          ENDIF.
*        ENDLOOP.
**********************new*********6.5.22*****
*      ELSE.
*        IF pernr NE '00003861'.
*          MESSAGE 'NOT VALID USER' TYPE 'E'.
*          EXIT.
*        ENDIF.
*        LOOP AT SCREEN.
*          IF screen-group1 EQ '002'.
*          ELSE.
*            screen-input = 0.
*            MODIFY SCREEN.
*          ENDIF.
*        ENDLOOP.
*      ENDIF.

*****************************************************
    ELSEIF R21A EQ 'X'. "Reviewer
*      BREAK-POINT .
      CLEAR : REVIEWERC.
      SELECT SINGLE * FROM ZQMS_DEPTHEAD1 WHERE BTRTL EQ IBTRTL AND TO_DT GE SY-DATUM..
      IF SY-SUBRC EQ 0.
        SELECT SINGLE * FROM PA0001 WHERE PERNR EQ ZQMS_DEPTHEAD1-REVIEWER AND PLANS NE '99999999' AND ENDDA GE SY-DATUM.
        IF SY-SUBRC EQ 0.
          REVIEWERC = ZQMS_DEPTHEAD1-REVIEWER.
        ENDIF.
      ENDIF.
      IF REVIEWERC NE PERNR.
        MESSAGE 'NOT VALID USER' TYPE 'E'.
      ENDIF.

      LOOP AT SCREEN.
        IF SCREEN-GROUP2 EQ '002'.
        ELSE.
          SCREEN-INPUT = 0.
          MODIFY SCREEN.
        ENDIF.
      ENDLOOP.

*      IF zdms1-werks EQ '1001'.
**        IF pernr NE '00009352'.
**        IF pernr NE '00015536'.  "23.5.22
*        IF pernr EQ '00015536' .
**          OR pernr EQ '00009352' .  "22.6.22
*        ELSE.
*          MESSAGE 'NOT VALID USER' TYPE 'E'.
*          EXIT.
*        ENDIF.
*        LOOP AT SCREEN.
*          IF screen-group2 EQ '002'.
*          ELSE.
*            screen-input = 0.
*            MODIFY SCREEN.
*          ENDIF.
*        ENDLOOP.
*      ELSEIF zdms1-werks EQ '1000'.
*        IF zdms1-pernr EQ '00002055'.
**          IF pernr NE '00002155'.
*          IF pernr NE '00011666'. "changed on 16.1.23
*            MESSAGE 'NOT VALID USER' TYPE 'E'.
*            EXIT.
*          ENDIF.
*        ELSE.
**          IF PERNR NE '00013901'.
*          IF pernr NE '00015167'.  " 8.6.20
*            MESSAGE 'NOT VALID USER' TYPE 'E'.
*            EXIT.
*          ENDIF.
*        ENDIF.
*        LOOP AT SCREEN.
*          IF screen-group2 EQ '002'.
*          ELSE.
*            screen-input = 0.
*            MODIFY SCREEN.
*          ENDIF.
*        ENDLOOP.
*      ENDIF.
    ELSEIF R4A EQ 'X'.
*BREAK-POINT.
      SELECT SINGLE * FROM ZDMS1 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM AND APPROVE NE 'X'.
      IF SY-SUBRC EQ 0.
        MESSAGE 'NOTIFICATION IS NOT YET APPROVED BY DEPARTMENT HEAD' TYPE 'E'.
        EXIT.
      ENDIF.
      LOOP AT SCREEN.
        IF SCREEN-GROUP1 EQ '004'.
        ELSE.
          SCREEN-INPUT = 0.
          MODIFY SCREEN.
        ENDIF.
      ENDLOOP.

*************************

      SELECT SINGLE * FROM ZDMS1 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM.
      IF SY-SUBRC EQ 0.
        IF ZDMS1-QAPPROVE1 EQ 'X' OR ZDMS1-QREJECT1 EQ 'X'.
          MESSAGE 'ACCEPTANCE / REJECTION IS ALREADY DONE' TYPE 'I'.
          LEAVE TO SCREEN 0.
          LOOP AT SCREEN.
            SCREEN-INPUT = 0.
            MODIFY SCREEN.
          ENDLOOP.
        ENDIF.
      ENDIF.

**************************

    ELSEIF R4 EQ 'X'.
      PERFORM DEPTQA.
      SELECT SINGLE * FROM ZDMS4 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM.
      IF SY-SUBRC EQ 0.
        IF ZDMS4-QHAPPROVE EQ 'X' OR ZDMS4-QHREJECT EQ 'X'.
          MESSAGE 'APPROVAL / REJECTION IS ALREADY DONE' TYPE 'I'.
          LEAVE TO SCREEN 0.
          LOOP AT SCREEN.
            SCREEN-INPUT = 0.
            MODIFY SCREEN.
          ENDLOOP.
        ENDIF.
      ENDIF.
      LOOP AT SCREEN.
        IF SCREEN-GROUP1 EQ '002'.
        ELSEIF SCREEN-GROUP1 EQ '003'.
        ELSE.
          SCREEN-INPUT = 0.
          MODIFY SCREEN.
        ENDIF.
      ENDLOOP.
    ENDIF.
*    PERFORM DEPTTEXT.
    LOOP AT IT_ZDMS1 INTO WA_ZDMS1.
*      BREAK-POINT.
      IF WA_ZDMS1-APPROVE EQ 'X' OR WA_ZDMS1-REJECT EQ 'X'.
        IF R2 EQ 'X'.
          LOOP AT SCREEN.
            IF SCREEN-GROUP1 EQ '001'.
            ELSE.
              SCREEN-INPUT = 0.
              MODIFY SCREEN.
            ENDIF.
          ENDLOOP.
        ENDIF.
      ENDIF.
*      IF WA_ZDMS1-QHAPPROVE EQ 'X' OR WA_ZDMS1-QHREJECT EQ 'X' OR WA_ZDMS1-TDAPPROVE EQ 'X' OR WA_ZDMS1-TDREJECT EQ 'X'.
*        LOOP AT SCREEN.
*          SCREEN-INPUT = 0.
*          MODIFY SCREEN.
*        ENDLOOP.
*      ENDIF.

      SELECT SINGLE * FROM PA0001 WHERE PERNR EQ WA_ZDMS1-PERNR AND ENDDA GE SY-DATUM AND PLANS NE '99999999'..
         IF SY-SUBRC EQ 0.
        ENAME = PA0001-ENAME.
        ENDIF.
      SELECT SINGLE * FROM ZPA0001 WHERE PERNR EQ WA_ZDMS1-PERNR AND ENDDA GE SY-DATUM. " AND PLANS NE '99999999'..
      IF SY-SUBRC EQ 0.
*        ENAME = PA0001-ENAME.
*        SELECT SINGLE * FROM T001P WHERE BTRTL EQ PA0001-BTRTL.
        SELECT SINGLE * FROM T001P WHERE BTRTL EQ ZPA0001-BTRTL.
        IF SY-SUBRC EQ 0.
          DEPT = T001P-BTEXT.
        ENDIF.
      ENDIF.

      SELECT SINGLE * FROM PA0001 WHERE PERNR EQ WA_ZDMS1-APERNR AND ENDDA GE SY-DATUM AND PLANS NE '99999999'.
      IF SY-SUBRC EQ 0.
        ANAME = PA0001-ENAME.
      ENDIF.
      SELECT SINGLE * FROM T001W WHERE WERKS EQ WA_ZDMS1-WERKS.
      IF SY-SUBRC EQ 0.
        KUNNR = T001W-KUNNR.
      ENDIF.
      CLEAR : RNAME,RDATE.
      SELECT SINGLE * FROM PA0001 WHERE PERNR EQ WA_ZDMS1-RPERNR AND ENDDA GE SY-DATUM AND PLANS NE '99999999'.
      IF SY-SUBRC EQ 0.
        RNAME = PA0001-ENAME.
        RDATE = WA_ZDMS1-RDATE.
      ENDIF.
      CLEAR : RNAME2,RDATE2.
      SELECT SINGLE * FROM PA0001 WHERE PERNR EQ WA_ZDMS1-RPERNR2 AND ENDDA GE SY-DATUM AND PLANS NE '99999999'.
      IF SY-SUBRC EQ 0.
        RNAME2 = PA0001-ENAME.
        RDATE2 = WA_ZDMS1-RDATE.
      ENDIF.

      ZDMS1-MJAHR = WA_ZDMS1-MJAHR.
      ZDMS1-MBLNR = WA_ZDMS1-MBLNR.
      ZDMS1-ZTYP = WA_ZDMS1-ZTYP.
      ZDMS1-BUDAT = WA_ZDMS1-BUDAT.
      ZDMS1-PERNR = WA_ZDMS1-PERNR.
      WERKS = WA_ZDMS1-WERKS.
      D1 = WA_ZDMS1-D1.
      D2 = WA_ZDMS1-D2.
      D3 = WA_ZDMS1-D3.
      D4 = WA_ZDMS1-D4.
      D5 = WA_ZDMS1-D5.
      D6 = WA_ZDMS1-D6.
      D7 = WA_ZDMS1-D7.
      D8 = WA_ZDMS1-D8.
      D9 = WA_ZDMS1-D9.
      D10 = WA_ZDMS1-D10.
      D11 = WA_ZDMS1-D11.
      D12 = WA_ZDMS1-D12.
      DTEXT = WA_ZDMS1-DTEXT.
      ATEXT1 = WA_ZDMS1-ATEXT1.
      ATEXT2 = WA_ZDMS1-ATEXT2.
      ATEXT3 = WA_ZDMS1-ATEXT3.
      ATEXT4 = WA_ZDMS1-ATEXT4.
      ATEXT5 = WA_ZDMS1-ATEXT5.

      BTEXT1 = WA_ZDMS1-BTEXT1.
      BTEXT2 = WA_ZDMS1-BTEXT2.
      BTEXT3 = WA_ZDMS1-BTEXT3.
      BTEXT4 = WA_ZDMS1-BTEXT4.
      BTEXT5 = WA_ZDMS1-BTEXT5.

      CTEXT1 = WA_ZDMS1-CTEXT1.
      CTEXT2 = WA_ZDMS1-CTEXT2.
      CTEXT3 = WA_ZDMS1-CTEXT3.
      CTEXT4 = WA_ZDMS1-CTEXT4.
      CTEXT5 = WA_ZDMS1-CTEXT5.

      DTEXT1 = WA_ZDMS1-DTEXT1.
      DTEXT2 = WA_ZDMS1-DTEXT2.
      DTEXT3 = WA_ZDMS1-DTEXT3.
      DTEXT4 = WA_ZDMS1-DTEXT4.
      DTEXT5 = WA_ZDMS1-DTEXT5.

      ETEXT1 = WA_ZDMS1-ETEXT1.
      ETEXT2 = WA_ZDMS1-ETEXT2.
      ETEXT3 = WA_ZDMS1-ETEXT3.
      ETEXT4 = WA_ZDMS1-ETEXT4.
      ETEXT5 = WA_ZDMS1-ETEXT5.

      FTEXT1 = WA_ZDMS1-FTEXT1.
      FTEXT2 = WA_ZDMS1-FTEXT2.
      FTEXT3 = WA_ZDMS1-FTEXT3.
      FTEXT4 = WA_ZDMS1-FTEXT4.
      FTEXT5 = WA_ZDMS1-FTEXT5.

      APPROVE = WA_ZDMS1-APPROVE.
      REJECT = WA_ZDMS1-REJECT.
      DHREM1 = WA_ZDMS1-DREM1.
      DHREM2 = WA_ZDMS1-DREM2.
      DHREM3 = WA_ZDMS1-DREM3.

      RAPPROVE1 = WA_ZDMS1-RAPPROVE1.
      RREJECT1 = WA_ZDMS1-RREJECT1.
      RREM1 = WA_ZDMS1-RREM1.
      RREM2 = WA_ZDMS1-RREM2.
      RREM3 = WA_ZDMS1-RREM3.

      RAPPROVE2 = WA_ZDMS1-RAPPROVE2.
      RREJECT2 = WA_ZDMS1-RREJECT2.
      RREM21 = WA_ZDMS1-RREM21.
      RREM22 = WA_ZDMS1-RREM22.
      RREM23 = WA_ZDMS1-RREM23.
      IF WA_ZDMS1-QPERNR1 NE '00000000'.
        SELECT SINGLE * FROM PA0001 WHERE PERNR EQ WA_ZDMS1-QPERNR1 AND ENDDA GE SY-DATUM AND PLANS NE '99999999'.
        IF SY-SUBRC EQ 0.
          QNAME = PA0001-ENAME.
*        QDATE = WA_ZDMS1-QDATE1.
        ENDIF.
      ENDIF.
      QAPPROVE1 = WA_ZDMS1-QAPPROVE1.
      QREJECT1 = WA_ZDMS1-QREJECT1.
      QDATE1 = WA_ZDMS1-QDATE1.
      QAREMARK = WA_ZDMS1-QAREMARK1.
      QAREMARK2 = WA_ZDMS1-QAREMARK2.
      QAREMARK3 = WA_ZDMS1-QAREMARK3.
*      SUBJECT = WA_ZDMS1-SUBJECT.

      PERFORM DEPTTEXT.
    ENDLOOP.
  ENDIF.

ENDMODULE.
*&---------------------------------------------------------------------*
*&      Module  USER_COMMAND_9001  INPUT
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
MODULE USER_COMMAND_9001 INPUT.

  CASE OK.

    WHEN 'SAVE'.
*      BREAK-POINT.
      IF CC1  EQ 'X' AND R1 EQ 'X'.
**************************
        SDATE+6(2) = '01'.
        SDATE+4(2) = '01'.
        SDATE+0(4) = '2020'.

*        if sy-datum ge sdate.
        CLEAR : VBELN,FINV.
        SELECT * FROM ZDMS1 INTO TABLE IT_ZDMS1 WHERE MJAHR EQ YEAR.
        SORT IT_ZDMS1 DESCENDING BY MBLNR.
        READ TABLE IT_ZDMS1 INTO WA_ZDMS1 WITH KEY MJAHR = YEAR WERKS = PLANT.
        IF SY-SUBRC EQ 0.
*          break-point.
          IF PLANT EQ '1000'.
            IF WA_ZDMS1-MBLNR LT 10000.
              VBELN = 10000.
            ELSE.
              VBELN = WA_ZDMS1-MBLNR.
            ENDIF.
          ELSEIF PLANT EQ '1001'.
            IF WA_ZDMS1-MBLNR LT 20000.
              VBELN = 20000.
            ELSE.
              VBELN = WA_ZDMS1-MBLNR.
            ENDIF.
          ELSEIF PLANT EQ '4000'.
            IF WA_ZDMS1-MBLNR LT 40000.
              VBELN = 40000.
            ELSE.
              VBELN = WA_ZDMS1-MBLNR.
            ENDIF.
          ELSE.
*            if PLANT eq '3000'.
            IF WA_ZDMS1-MBLNR LT 30000.
              VBELN = 30000.
            ELSE.
              VBELN = WA_ZDMS1-MBLNR.
            ENDIF.
          ENDIF.
        ELSE.
          IF WERKS EQ '1000'.
            VBELN = 10000.
          ELSEIF WERKS EQ '1001'.
            VBELN = 20000.
          ELSEIF WERKS EQ '3000'.
            VBELN = 30000.
          ELSEIF WERKS EQ '4000'.
            VBELN = 40000.
          ENDIF.
        ENDIF.
*        else.
*          clear : vbeln,finv.
*          select * from zdms1 into table it_zdms1 where mjahr eq year.
*          sort it_zdms1 descending by mblnr.
*          read table it_zdms1 into wa_zdms1 with key mjahr = year.
*          if sy-subrc eq 0.
*            vbeln = wa_zdms1-mblnr.
*          endif.
*        endif.
        FINV = VBELN + 1.

**        ******LOCK*********************
*
*
*        clear : vbeln,finv.
*        select * from zdms1 into table it_zdms1 where mjahr eq year.        "20.11.2019
*        sort it_zdms1 descending by mblnr.
*        read table it_zdms1 into wa_zdms1 with key mjahr = year.
*        if sy-subrc eq 0.
*          vbeln = wa_zdms1-mblnr.
*        endif.
*        finv = vbeln + 1.

        CLEAR : FFMBLNR.
        FFMBLNR = FINV.
*
        CALL FUNCTION 'ENQUEUE_EZDMS1'
          EXPORTING
            MODE_ZDMS1     = 'E'
            MANDT          = SY-MANDT
            MJAHR          = YEAR
            MBLNR          = FFMBLNR
*           X_MJAHR        = ' '
*           X_MBLNR        = ' '
*           _SCOPE         = '2'
*           _WAIT          = ' '
*           _COLLECT       = ' '
          EXCEPTIONS
            FOREIGN_LOCK   = 1
            SYSTEM_FAILURE = 2
            OTHERS         = 3.
        IF SY-SUBRC <> 0.
* Implement suitable error handling here
        ENDIF.

        CASE SY-SUBRC.
          WHEN 1.
*            message e184(bctrain) with 'OTHER USER ALREADY PROCESSING, PLZ TRY AFTER SOME TIME' .
*            MESSAGE 'OTHER USER ALREADY PROCESSING, PLZ TRY AFTER SOME TIME' TYPE 'E'.
            MESSAGE E000(0U) WITH SY-MSGV1.
          WHEN 2.
            MESSAGE E184(BCTRAIN) WITH 'system failure'.
          WHEN 0.
*            message i184(bctrain) with 'success'.
          WHEN OTHERS.
            MESSAGE E184(BCTRAIN) WITH 'others'.
        ENDCASE.
***************************************

        ZDMS1_WA-MJAHR = YEAR.
        ZDMS1_WA-MBLNR = FINV.
        ZDMS1_WA-ZTYP = 'CC'.
        ZDMS1_WA-BUDAT = SY-DATUM.
        ZDMS1_WA-UZEIT = SY-UZEIT.
        ZDMS1_WA-UNAME = SY-UNAME.
        ZDMS1_WA-PERNR = PERNR.
*        zdms1_wa-werks = werks.
        ZDMS1_WA-WERKS = PLANT.
        ZDMS1_WA-D1 = D1.
        ZDMS1_WA-D2 = D2.
        ZDMS1_WA-D3 = D3.
        ZDMS1_WA-D4 = D4.
        ZDMS1_WA-D5 = D5.
        ZDMS1_WA-D6 = D6.
        ZDMS1_WA-D7 = D7.
        ZDMS1_WA-D8 = D8.
        ZDMS1_WA-D9 = D9.
        ZDMS1_WA-D10 = D10.
        ZDMS1_WA-D11 = D11.
        ZDMS1_WA-D12 = D12.
        ZDMS1_WA-DTEXT = DTEXT.
        ZDMS1_WA-ATEXT1 = ATEXT1.
        ZDMS1_WA-ATEXT2 = ATEXT2.
        ZDMS1_WA-ATEXT3 = ATEXT3.
        ZDMS1_WA-ATEXT4 = ATEXT4.
        ZDMS1_WA-ATEXT5 = ATEXT5.
        ZDMS1_WA-BTEXT1 = BTEXT1.
        ZDMS1_WA-BTEXT2 = BTEXT2.
        ZDMS1_WA-BTEXT3 = BTEXT3.
        ZDMS1_WA-BTEXT4 = BTEXT4.
        ZDMS1_WA-BTEXT5 = BTEXT5.
        ZDMS1_WA-CTEXT1 = CTEXT1.
        ZDMS1_WA-CTEXT2 = CTEXT2.
        ZDMS1_WA-CTEXT3 = CTEXT3.
        ZDMS1_WA-CTEXT4 = CTEXT4.
        ZDMS1_WA-CTEXT5 = CTEXT5.
        ZDMS1_WA-DTEXT1 = DTEXT1.
        ZDMS1_WA-DTEXT2 = DTEXT2.
        ZDMS1_WA-DTEXT3 = DTEXT3.
        ZDMS1_WA-DTEXT4 = DTEXT4.
        ZDMS1_WA-DTEXT5 = DTEXT5.
        ZDMS1_WA-ETEXT1 = ETEXT1.
        ZDMS1_WA-ETEXT2 = ETEXT2.
        ZDMS1_WA-ETEXT3 = ETEXT3.
        ZDMS1_WA-ETEXT4 = ETEXT4.
        ZDMS1_WA-ETEXT5 = ETEXT5.
        ZDMS1_WA-FTEXT1 = FTEXT1.
        ZDMS1_WA-FTEXT2 = FTEXT2.
        ZDMS1_WA-FTEXT3 = FTEXT3.
        ZDMS1_WA-FTEXT4 = FTEXT4.
        ZDMS1_WA-FTEXT5 = FTEXT5.

        IF D1 EQ SPACE AND D2 EQ SPACE AND D3 EQ SPACE AND D4 EQ SPACE AND D5 EQ SPACE AND D6 EQ SPACE AND D7 EQ SPACE AND D8 EQ SPACE
       AND D9 EQ SPACE AND D10 EQ SPACE AND D11 EQ SPACE AND D12 EQ SPACE AND DTEXT EQ SPACE.
          MESSAGE 'SELECT - CHANGE APPLICABLE TO :' TYPE 'E'.  "22.1.21
          EXIT.
        ENDIF.


        IF ATEXT1 EQ SPACE OR BTEXT1 EQ SPACE OR CTEXT1 EQ SPACE OR DTEXT1 EQ SPACE OR ETEXT1 EQ SPACE OR FTEXT1 EQ SPACE.
          MESSAGE 'ENTER DATA IN ALL FIELDS' TYPE 'E'.
          EXIT.
        ENDIF.
        INSERT ZDMS1 FROM ZDMS1_WA.
        CLEAR : ZDMS1_WA.

********************************************
        CALL FUNCTION 'DEQUEUE_EZDMS1'
          EXPORTING
            MODE_ZDMS1 = 'E'
            MANDT      = SY-MANDT
            MJAHR      = YEAR
            MBLNR      = FFMBLNR
*           X_MJAHR    = ' '
*           X_MBLNR    = ' '
*           _SCOPE     = '3'
*           _SYNCHRON  = ' '
*           _COLLECT   = ' '
          .
*******************************************
*BREAK-POINT .
        MESSAGE I952(ZHR_MESSAGE) WITH FINV.
        MESSAGE 'ENTER IMPACTED ACTIVITY & ATTACH RELEVANT DOCUMENTS' TYPE 'I'.
        PERFORM EMAIL.

*        if r2 eq 'X'. "15.12.2019
        SELECT SINGLE * FROM ZDMS2 WHERE MJAHR EQ YEAR AND MBLNR EQ FINV.
        IF SY-SUBRC NE 0.
          ZDMS2_WA-MJAHR = YEAR.
          ZDMS2_WA-MBLNR = FINV.
*          SELECT SINGLE * FROM PA0001 WHERE PERNR EQ PERNR AND ENDDA GE SY-DATUM.
          SELECT SINGLE * FROM ZPA0001 WHERE PERNR EQ PERNR AND ENDDA GE SY-DATUM.
          IF SY-SUBRC EQ 0.
*            ZDMS2_WA-DEPT = PA0001-BTRTL.
            ZDMS2_WA-DEPT = ZPA0001-BTRTL.
          ENDIF.
          ZDMS2_WA-EBUDAT = SY-DATUM.
          ZDMS2_WA-EPERNR = PERNR.
          INSERT ZDMS2 FROM ZDMS2_WA.
          CLEAR : ZDMS2_WA.
        ENDIF.
*        endif.

        LEAVE TO TRANSACTION 'ZQMS'.
*        LEAVE TO TRANSACTION 'ZQMS'.
*        LEAVE TO SCREEN 0.
      ELSEIF CC1  EQ 'X' AND R1C EQ 'X'.
        SELECT SINGLE * FROM ZDMS1 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM.
        IF SY-SUBRC EQ 0.
          MOVE-CORRESPONDING ZDMS1 TO ZDMS1_WA.
*        ZDMS1_WA-MJAHR = YEAR.
*        ZDMS1_WA-MBLNR = FINV.
*        ZDMS1_WA-ZTYP = 'CC'.
*        ZDMS1_WA-BUDAT = SY-DATUM.
*        ZDMS1_WA-PERNR = PERNR.
          ZDMS1_WA-WERKS = WERKS.
          ZDMS1_WA-D1 = D1.
          ZDMS1_WA-D2 = D2.
          ZDMS1_WA-D3 = D3.
          ZDMS1_WA-D4 = D4.
          ZDMS1_WA-D5 = D5.
          ZDMS1_WA-D6 = D6.
          ZDMS1_WA-D7 = D7.
          ZDMS1_WA-D8 = D8.
          ZDMS1_WA-D9 = D9.
          ZDMS1_WA-D10 = D10.
          ZDMS1_WA-D11 = D11.
          ZDMS1_WA-D12 = D12.
          ZDMS1_WA-DTEXT = DTEXT.
          ZDMS1_WA-ATEXT1 = ATEXT1.
          ZDMS1_WA-ATEXT2 = ATEXT2.
          ZDMS1_WA-ATEXT3 = ATEXT3.
          ZDMS1_WA-ATEXT4 = ATEXT4.
          ZDMS1_WA-ATEXT5 = ATEXT5.
          ZDMS1_WA-BTEXT1 = BTEXT1.
          ZDMS1_WA-BTEXT2 = BTEXT2.
          ZDMS1_WA-BTEXT3 = BTEXT3.
          ZDMS1_WA-BTEXT4 = BTEXT4.
          ZDMS1_WA-BTEXT5 = BTEXT5.
          ZDMS1_WA-CTEXT1 = CTEXT1.
          ZDMS1_WA-CTEXT2 = CTEXT2.
          ZDMS1_WA-CTEXT3 = CTEXT3.
          ZDMS1_WA-CTEXT4 = CTEXT4.
          ZDMS1_WA-CTEXT5 = CTEXT5.
          ZDMS1_WA-DTEXT1 = DTEXT1.
          ZDMS1_WA-DTEXT2 = DTEXT2.
          ZDMS1_WA-DTEXT3 = DTEXT3.
          ZDMS1_WA-DTEXT4 = DTEXT4.
          ZDMS1_WA-DTEXT5 = DTEXT5.
          ZDMS1_WA-ETEXT1 = ETEXT1.
          ZDMS1_WA-ETEXT2 = ETEXT2.
          ZDMS1_WA-ETEXT3 = ETEXT3.
          ZDMS1_WA-ETEXT4 = ETEXT4.
          ZDMS1_WA-ETEXT5 = ETEXT5.
          ZDMS1_WA-FTEXT1 = FTEXT1.
          ZDMS1_WA-FTEXT2 = FTEXT2.
          ZDMS1_WA-FTEXT3 = FTEXT3.
          ZDMS1_WA-FTEXT4 = FTEXT4.
          ZDMS1_WA-FTEXT5 = FTEXT5.

          IF D1 EQ SPACE AND D2 EQ SPACE AND D3 EQ SPACE AND D4 EQ SPACE AND D5 EQ SPACE AND D6 EQ SPACE AND D7 EQ SPACE AND D8 EQ SPACE
                 AND D9 EQ SPACE AND D10 EQ SPACE AND D11 EQ SPACE AND D12 EQ SPACE AND DTEXT EQ SPACE.
            MESSAGE 'SELECT - CHANGE APPLICABLE TO :' TYPE 'E'. "22.1.21
            EXIT.
          ENDIF.

          IF ATEXT1 EQ SPACE OR BTEXT1 EQ SPACE OR CTEXT1 EQ SPACE OR DTEXT1 EQ SPACE OR ETEXT1 EQ SPACE OR FTEXT1 EQ SPACE.
            MESSAGE 'ENTER DATA IN ALL FIELDS' TYPE 'E'.
            EXIT.
          ENDIF.

          UPDATE ZDMS1 FROM ZDMS1_WA.

          CLEAR : ZDMS1_WA.
*          MESSAGE I952(ZHR_MESSAGE) WITH FINV.
          MESSAGE 'DATA SAVED' TYPE 'I'.
          PERFORM EMAIL.
        ENDIF.
        LEAVE TO SCREEN 0.
*        LEAVE TO TRANSACTION 'ZQMS'.
      ELSEIF CC1  EQ 'X' AND R2 EQ 'X'.
*        CLEAR : STAT.
*        SELECT SINGLE * FROM ZDMS1 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM.
*        IF SY-SUBRC EQ 0.
*          IF ZDMS1-APPROVE EQ 'X' OR ZDMS1-REJECT EQ 'X'.
*            STAT = 1.
*          ENDIF.
*        ENDIF.
        IF APPROVE EQ 'X' AND REJECT EQ 'X'.
          MESSAGE 'EITHER APPROVE OR REJECT' TYPE 'I'.
          EXIT.
        ENDIF.
        SELECT SINGLE * FROM ZDMS1 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM.
        IF SY-SUBRC EQ 0.
          MOVE-CORRESPONDING ZDMS1 TO ZDMS1_WA.
          ZDMS1_WA-APPROVE = APPROVE.
          ZDMS1_WA-REJECT = REJECT.
          ZDMS1_WA-APERNR = PERNR.
          ZDMS1_WA-ADATE = SY-DATUM.
          ZDMS1_WA-AUZEIT = SY-UZEIT.
          ZDMS1_WA-AUNAME = SY-UNAME.
          ZDMS1_WA-DREM1 = DHREM1.
          ZDMS1_WA-DREM2 = DHREM2.
          ZDMS1_WA-DREM3 = DHREM3.
*          IF ATEXT1 EQ SPACE OR BTEXT1 EQ SPACE OR CTEXT1 EQ SPACE OR DTEXT1 EQ SPACE OR ETEXT1 EQ SPACE OR FTEXT1 EQ SPACE.
*            MESSAGE 'ENTER DATA IN ALL FIELDS' TYPE 'E'.
*            EXIT.
*          ENDIF.
          UPDATE ZDMS1 FROM ZDMS1_WA.
          CLEAR : ZDMS1_WA.
          MESSAGE 'CHANGES ARE SAVED' TYPE 'I'.
        ENDIF.
        PERFORM DEPT.
*        BREAK-POINT.

        PERFORM EMAIL.

*        LEAVE TO TRANSACTION 'ZQMS'.
        LEAVE TO SCREEN 0.
      ELSEIF CC1  EQ 'X' AND R21A EQ 'X'. "REVIEWER
*        IF PERNR EQ '00007354'.
        IF RAPPROVE2 EQ 'X' AND RREJECT2 EQ 'X'.
          MESSAGE 'EITHER APPROVE OR REJECT' TYPE 'I'.
          EXIT.
        ENDIF.
        SELECT SINGLE * FROM ZDMS1 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM.
        IF SY-SUBRC EQ 0.
          IF ZDMS1-APPROVE NE 'X'.
            MESSAGE 'CHANGES ARE NOT APPROVED BY DEPT. HEAD' TYPE 'E'.
          ENDIF.
*          IF zdms1-werks EQ '1001'.
**            IF pernr EQ '00009352'.
**            IF pernr EQ '00015536'.  "23.5.22
*            IF pernr EQ '00015536'.
**               OR pernr EQ '00009352'.  "22.6.22
          MOVE-CORRESPONDING ZDMS1 TO ZDMS1_WA.
          ZDMS1_WA-RAPPROVE2 = RAPPROVE2.
          ZDMS1_WA-RREJECT2 = RREJECT2.
          ZDMS1_WA-RPERNR2 = PERNR.
          ZDMS1_WA-RDATE2 = SY-DATUM.
          ZDMS1_WA-RUZEIT2 = SY-UZEIT.
          ZDMS1_WA-RUNAME2 = SY-UNAME.
          ZDMS1_WA-RREM21 = RREM21.
          ZDMS1_WA-RREM22 = RREM22.
          ZDMS1_WA-RREM23 = RREM23.
          UPDATE ZDMS1 FROM ZDMS1_WA.
          CLEAR : ZDMS1_WA.
          MESSAGE 'CHANGES ARE SAVED' TYPE 'I'.
        ELSE.
          MESSAGE 'INVALID USER' TYPE 'E'.
        ENDIF.

*          ELSEIF zdms1-werks EQ '1000'.
*            IF zdms1-pernr EQ '00002055'.
**              IF pernr EQ '00002155'.
*              IF pernr EQ '00011666'.
*                MOVE-CORRESPONDING zdms1 TO zdms1_wa.
*                zdms1_wa-rapprove2 = rapprove2.
*                zdms1_wa-rreject2 = rreject2.
*                zdms1_wa-rpernr2 = pernr.
*                zdms1_wa-rdate2 = sy-datum.
*                zdms1_wa-rrem21 = rrem21.
*                zdms1_wa-rrem22 = rrem22.
*                zdms1_wa-rrem23 = rrem23.
*                UPDATE zdms1 FROM zdms1_wa.
*                CLEAR : zdms1_wa.
*                MESSAGE 'CHANGES ARE SAVED' TYPE 'I'.
*              ELSE.
*                MESSAGE 'INVALID USER' TYPE 'E'.
*              ENDIF.
*            ELSE.
**              IF PERNR EQ '00013901'.
*              IF pernr EQ '00015167'.
*                MOVE-CORRESPONDING zdms1 TO zdms1_wa.
*                zdms1_wa-rapprove2 = rapprove2.
*                zdms1_wa-rreject2 = rreject2.
*                zdms1_wa-rpernr2 = pernr.
*                zdms1_wa-rdate2 = sy-datum.
*                zdms1_wa-rrem21 = rrem21.
*                zdms1_wa-rrem22 = rrem22.
*                zdms1_wa-rrem23 = rrem23.
*                UPDATE zdms1 FROM zdms1_wa.
*                CLEAR : zdms1_wa.
*                MESSAGE 'CHANGES ARE SAVED' TYPE 'I'.
*              ELSE.
*                MESSAGE 'INVALID USER' TYPE 'E'.
*              ENDIF.
*            ENDIF.
*          ENDIF.
*
***************************************************
*        ENDIF.
*        LEAVE TO TRANSACTION 'ZQMS'.
        PERFORM EMAIL.
        LEAVE TO SCREEN 0.
      ELSEIF CC1  EQ 'X' AND R21 EQ 'X'.  "APPROVER


        IF RAPPROVE1 EQ 'X' AND RREJECT1 EQ 'X'.
          MESSAGE 'EITHER APPROVE OR REJECT' TYPE 'I'.
          EXIT.
        ENDIF.
*        IF PERNR EQ '00007354'.
        SELECT SINGLE * FROM ZDMS1 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM.
        IF SY-SUBRC EQ 0.
          IF ZDMS1-APPROVE NE 'X'.
            MESSAGE 'CHANGES ARE NOT APPROVED BY DEPT. HEAD' TYPE 'E'.
          ENDIF.
          SELECT SINGLE * FROM ZQMS_DEPTHEAD1 WHERE BTRTL EQ IBTRTL AND REVIEWER NE SPACE AND TO_DT GE SY-DATUM.
          IF SY-SUBRC EQ 0.
            SELECT SINGLE * FROM ZDMS1 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM AND RAPPROVE2 NE 'X'.
            IF SY-SUBRC EQ 0.
              MESSAGE 'CHANGES ARE NOT APPROVED BY REVIEWER' TYPE 'E'.
            ENDIF.
          ENDIF.

**          IF zdms1-apernr NE '00008896'.
**            IF zdms1-rapprove2 NE 'X'.
***              MESSAGE 'CHANGES ARE NOT APPROVED BY REVIEWER' TYPE 'E'.
**              MESSAGE 'CHANGES ARE NOT APPROVED BY REVIEWER' TYPE 'I'.
**            ENDIF.
**          ENDIF.
*          IF zdms1-werks EQ '1001'.
*            IF pernr EQ '00003139'.
**            IF pernr EQ '00016314'.
          MOVE-CORRESPONDING ZDMS1 TO ZDMS1_WA.
          ZDMS1_WA-RAPPROVE1 = RAPPROVE1.
          ZDMS1_WA-RREJECT1 = RREJECT1.
          ZDMS1_WA-RPERNR = PERNR.
          ZDMS1_WA-RDATE = SY-DATUM.
          ZDMS1_WA-RUZEIT = SY-UZEIT.
          ZDMS1_WA-RUNAME = SY-UNAME.
          ZDMS1_WA-RREM1 = RREM1.
          ZDMS1_WA-RREM2 = RREM2.
          ZDMS1_WA-RREM3 = RREM3.
          UPDATE ZDMS1 FROM ZDMS1_WA.
          CLEAR : ZDMS1_WA.
          MESSAGE 'CHANGES ARE SAVED' TYPE 'I'.
          SELECT SINGLE * FROM PA0001 WHERE PERNR EQ PERNR AND ENDDA GT SY-DATUM.
          IF SY-SUBRC EQ 0.
            DEPTAPPRNAME = PA0001-ENAME.
          ENDIF.

          PERFORM EMAIL.

        ELSE.
          MESSAGE 'INVALID USER' TYPE 'E'.
        ENDIF.
        LEAVE TO SCREEN 0.
*          ELSEIF zdms1-werks EQ '1000'.
*            SELECT SINGLE * FROM zqms_depthead WHERE btrtl EQ '1227'.
*            IF sy-subrc EQ 0.
*              aprpernr = zqms_depthead-approver.
*            ENDIF.
*
*            IF pernr EQ aprpernr.
*              MOVE-CORRESPONDING zdms1 TO zdms1_wa.
*              zdms1_wa-rapprove1 = rapprove1.
*              zdms1_wa-rreject1 = rreject1.
*              zdms1_wa-rpernr = pernr.
*              zdms1_wa-rdate = sy-datum.
*              zdms1_wa-rrem1 = rrem1.
*              zdms1_wa-rrem2 = rrem2.
*              zdms1_wa-rrem3 = rrem3.
*              UPDATE zdms1 FROM zdms1_wa.
*              CLEAR : zdms1_wa.
*              MESSAGE 'CHANGES ARE SAVED' TYPE 'I'.
*              SELECT SINGLE * FROM pa0001 WHERE pernr EQ pernr AND endda GT sy-datum.
*              IF sy-subrc EQ 0.
*                deptapprname = pa0001-ename.
*              ENDIF.
*
*              PERFORM email.
*
*            ELSE.
*              MESSAGE 'INVALID USER' TYPE 'E'.
*            ENDIF.
*
******************new***************6.5.22********
*
*          ELSEIF zdms1-werks EQ '3000' OR zdms1-werks EQ '4000'.
**            IF PERNR EQ '00003861'.
*            SELECT SINGLE * FROM pa0001 WHERE pernr EQ zdms1-pernr AND  endda GE sy-datum AND btrtl IN ('1129','1130').
*            IF sy-subrc EQ 0.
*              IF pernr EQ '00003861'.
*                MOVE-CORRESPONDING zdms1 TO zdms1_wa.
*                zdms1_wa-rapprove1 = rapprove1.
*                zdms1_wa-rreject1 = rreject1.
*                zdms1_wa-rpernr = pernr.
*                zdms1_wa-rdate = sy-datum.
*                zdms1_wa-rrem1 = rrem1.
*                zdms1_wa-rrem2 = rrem2.
*                zdms1_wa-rrem3 = rrem3.
*                UPDATE zdms1 FROM zdms1_wa.
*                CLEAR : zdms1_wa.
*                MESSAGE 'CHANGES ARE SAVED' TYPE 'I'.
*                SELECT SINGLE * FROM pa0001 WHERE pernr EQ pernr AND endda GT sy-datum.
*                IF sy-subrc EQ 0.
*                  deptapprname = pa0001-ename.
*                ENDIF.
*
*                PERFORM email.
*              ELSE.
*                MESSAGE 'INVALID USER' TYPE 'E'.
*              ENDIF.
*
*            ELSE.
*              MESSAGE 'INVALID USER' TYPE 'E'.
*            ENDIF.
*
************************************************
*          ENDIF.
*        ENDIF.
*
**        LEAVE TO TRANSACTION 'ZQMS'.
*        LEAVE TO SCREEN 0.
      ELSEIF CC1  EQ 'X' AND R4 EQ 'X'.
*        BREAK-POINT.
        SELECT SINGLE * FROM ZDMS1 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM.
        IF SY-SUBRC EQ 0.
          MOVE-CORRESPONDING ZDMS1 TO ZDMS1_WA.

          ZDMS1_WA-DTEXT1 = DTEXT1.
          ZDMS1_WA-DTEXT2 = DTEXT2.
          ZDMS1_WA-DTEXT3 = DTEXT3.
          ZDMS1_WA-DTEXT4 = DTEXT4.
          ZDMS1_WA-DTEXT5 = DTEXT5.
          ZDMS1_WA-ETEXT1 = ETEXT1.
          ZDMS1_WA-ETEXT2 = ETEXT2.
          ZDMS1_WA-ETEXT3 = ETEXT3.
          ZDMS1_WA-ETEXT4 = ETEXT4.
          ZDMS1_WA-ETEXT5 = ETEXT5.
          ZDMS1_WA-FTEXT1 = FTEXT1.
          ZDMS1_WA-FTEXT2 = FTEXT2.
          ZDMS1_WA-FTEXT3 = FTEXT3.
          ZDMS1_WA-FTEXT4 = FTEXT4.
          ZDMS1_WA-FTEXT5 = FTEXT5.

*          ZDMS1_WA-DEPT1 = DEPT1.
*          ZDMS1_WA-DEPT2 = DEPT2.
*          ZDMS1_WA-DEPT3 = DEPT3.
*          ZDMS1_WA-DEPT4 = DEPT4.
*          ZDMS1_WA-DEPT5 = DEPT5.
*          ZDMS1_WA-DEPT6 = DEPT6.
*          ZDMS1_WA-DEPT7 = DEPT7.
*          ZDMS1_WA-DEPT8 = DEPT8.
*          ZDMS1_WA-DEPT9 = DEPT9.
*          ZDMS1_WA-DEPT10 = DEPT10.
*          ZDMS1_WA-DEPT11 = DEPT111.
*          ZDMS1_WA-DEPT12 = DEPT12.
*          ZDMS1_WA-DEPT13 = DEPT13.
*          ZDMS1_WA-DEPT14 = DEPT14.
*          ZDMS1_WA-DEPT15 = DEPT15.
*          ZDMS1_WA-DEPT16 = DEPT16.
*          ZDMS1_WA-DEPT17 = DEPT17.
*          ZDMS1_WA-DEPT18 = DEPT18.
*          ZDMS1_WA-DEPT19 = DEPT19.
*          ZDMS1_WA-DEPT20 = DEPT20.
*          ZDMS1_WA-DPERNR = PERNR.
*          ZDMS1_WA-DDATE = SY-DATUM.
          IF DTEXT1 EQ SPACE OR ETEXT1 EQ SPACE OR FTEXT1 EQ SPACE.
            MESSAGE 'ENTER DATA IN ALL FIELDS' TYPE 'E'.
            EXIT.
          ENDIF.
          UPDATE ZDMS1 FROM ZDMS1_WA.
          CLEAR : ZDMS1_WA.
          MESSAGE 'CHANGES ARE SAVED' TYPE 'I'.
          PERFORM EMAIL.
          PERFORM DEPT.
        ENDIF.
*        LEAVE TO TRANSACTION 'ZQMS'.
        LEAVE TO SCREEN 0.

      ELSEIF CC1  EQ 'X' AND R4A EQ 'X'.
*        BREAK-POINT.
        SELECT SINGLE * FROM ZDMS1 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM.
        IF SY-SUBRC EQ 0.
          MOVE-CORRESPONDING ZDMS1 TO ZDMS1_WA.

          ZDMS1_WA-QAPPROVE1 = QAPPROVE1.
          ZDMS1_WA-QREJECT1 = QREJECT1.
          ZDMS1_WA-QPERNR1 = PERNR.
          ZDMS1_WA-QDATE1 = SY-DATUM.
          ZDMS1_WA-QUZEIT1 = SY-UZEIT.
          ZDMS1_WA-QUNAME1 = SY-UNAME.
          ZDMS1_WA-QAREMARK1 = QAREMARK.
          ZDMS1_WA-QAREMARK2 = QAREMARK2.
          ZDMS1_WA-QAREMARK3 = QAREMARK3.
          IF QAPPROVE1 EQ SPACE AND QREJECT1 EQ SPACE.
            MESSAGE 'EITHER APPROVE OR REJECT' TYPE 'E'.
            EXIT.
          ENDIF.
          UPDATE ZDMS1 FROM ZDMS1_WA.
          CLEAR : ZDMS1_WA.
          MESSAGE 'CHANGES ARE SAVED' TYPE 'I'.
*          PERFORM CCNUM.
          SELECT SINGLE * FROM ZDMS4 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM.
          IF SY-SUBRC EQ 0.
            MESSAGE 'THIS NOTIFICATION IS ALREADY SAVED' TYPE 'E'.
          ELSE.
            IF QAPPROVE1 EQ 'X'.  "INSERTED ON 10.7.20
              PERFORM CCNUM1.

*          BREAK-POINT.
              ZDMS4_WA-MJAHR = YEAR.
              ZDMS4_WA-MBLNR = CCNUM.
              ZDMS4_WA-WERKS = ZDMS1-WERKS.
              ZDMS4_WA-CCNUMB = FINV1.
              ZDMS4_WA-CCNUMB1 = FINVNUMB.
              ZDMS4_WA-QAMJAHR = SY-DATUM+0(4).  "7.2.22

              MODIFY ZDMS4 FROM ZDMS4_WA.
              CLEAR ZDMS4_WA.
              MESSAGE 'CHANGE CONTROL NUMBER IS GENERATED' TYPE 'I'.
            ENDIF.
          ENDIF.
*          PERFORM EMAIL.
*          PERFORM DEPT.
        ENDIF.
*        LEAVE TO TRANSACTION 'ZQMS'.
        LEAVE TO SCREEN 0.
      ENDIF.
*      PERFORM UPDATE.
*      PERFORM UPDATE_DATA.
*        MESSAGE 'SAVED' TYPE 'I'.
*    WHEN 'ENTER'.
*      PERFORM UPDATE.
*    WHEN 'NEXT'.
*      LOOP AT SCREEN.
*        SCREEN-INPUT = 0.
*        MODIFY SCREEN.
*      ENDLOOP.
*
*      CALL SCREEN 9002.

    WHEN 'BACK' OR 'EXIT'.
      SET SCREEN 0.
      LEAVE SCREEN.

  ENDCASE.

ENDMODULE.
*&---------------------------------------------------------------------*
*&      Module  STATUS_9002  OUTPUT
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*MODULE STATUS_9002 OUTPUT.
*  IF CC1  EQ 'X' AND ( R3 EQ 'X' ) .
*
*
*    SET PF-STATUS 'CREATE'.
*    SET TITLEBAR 'CREATE'.
**    IF CC1  EQ 'X' AND  R7 EQ 'X'.
*    LOOP AT SCREEN.
*      SCREEN-INPUT = 0.
*      MODIFY SCREEN.
*    ENDLOOP.
**    ENDIF.
*
*    SELECT SINGLE * FROM ZDMS1 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM.
*    IF SY-SUBRC EQ 0.
*      IF ZDMS1-CL2 EQ 'X'.
*        LOOP AT SCREEN.
*          SCREEN-INPUT = 0.
*          MODIFY SCREEN.
*        ENDLOOP.
*      ENDIF.
*
*      IF ZDMS1-CL1 EQ 'X'.
*        LOOP AT SCREEN.
*          IF SCREEN-GROUP2 EQ '002'.
*          ELSEIF SCREEN-GROUP2 EQ '003'.
*          ELSE.
*            SCREEN-INPUT = 0.
*            MODIFY SCREEN.
*          ENDIF.
*        ENDLOOP.
*      ENDIF.
**      IF ZDMS1-QHAPPROVE NE 'X'.
**        LOOP AT SCREEN.
**          IF SCREEN-GROUP2 EQ '001'.
**            SCREEN-INPUT = 0.
**            MODIFY SCREEN.
**          ELSEIF SCREEN-GROUP2 EQ '002'.
**            SCREEN-INPUT = 0.
**            MODIFY SCREEN.
**          ELSEIF SCREEN-GROUP2 EQ '003'.
**            SCREEN-INPUT = 0.
**            MODIFY SCREEN.
**          ELSE.
**          ENDIF.
**        ENDLOOP.
**      ENDIF.
*
*
**      IF ( ZDMS1-QHAPPROVE EQ 'X' OR ZDMS1-QHREJECT EQ 'X' ) AND ( ZDMS1-TDAPPROVE EQ 'X' OR ZDMS1-TDREJECT EQ 'X' ).
**        LOOP AT SCREEN.
**          IF SCREEN-GROUP2 EQ '001'.
**          ELSEIF SCREEN-GROUP2 EQ '002'.
**          ELSEIF SCREEN-GROUP2 EQ '003'.
**          ELSE.
**            SCREEN-INPUT = 0.
**            MODIFY SCREEN.
**          ENDIF.
**        ENDLOOP.
**      ELSEIF ZDMS1-QHAPPROVE EQ 'X' OR ZDMS1-QHREJECT EQ 'X' .
**        LOOP AT SCREEN.
**          IF SCREEN-GROUP2 EQ '001'.
**          ELSEIF SCREEN-GROUP2 EQ '002'.
**          ELSEIF SCREEN-GROUP1 EQ '002'.
**          ELSEIF SCREEN-GROUP2 EQ '003'.
**          ELSE.
**            SCREEN-INPUT = 0.
**            MODIFY SCREEN.
**          ENDIF.
**        ENDLOOP.
**      ELSEIF ZDMS1-TDAPPROVE EQ 'X' OR ZDMS1-TDREJECT EQ 'X' .
***          OR ZDMS1-TDAPPROVE EQ 'X' OR ZDMS1-TDREJECT EQ 'X'.
**        LOOP AT SCREEN.
**          IF SCREEN-GROUP2 EQ '001'.
**          ELSEIF SCREEN-GROUP2 EQ '002'.
**          ELSEIF SCREEN-GROUP1 EQ '001'.
**          ELSEIF SCREEN-GROUP2 EQ '003'.
**          ELSE.
**            SCREEN-INPUT = 0.
**            MODIFY SCREEN.
**          ENDIF.
**        ENDLOOP.
**      ENDIF.
**    ENDIF.
*
*
*
*      SELECT SINGLE * FROM ZDMS1 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM.
*      IF SY-SUBRC NE 0.
*        MESSAGE 'CHANGE CONTROL NUMBER IS NOT AVAILABLE' TYPE 'E'.
*        EXIT.
*      ENDIF.
*      PERFORM DEPTNAME.
*      SELECT SINGLE * FROM PA0001 WHERE PERNR EQ PERNR AND ENDDA GE SY-DATUM.
*      IF SY-SUBRC EQ 0.
*        INAME = PA0001-ENAME.
*      ENDIF.
*
**    READ TABLE IT_ZDMS1 INTO WA_ZDMS1 WITH KEY MBLNR = CCNUM MJAHR = YEAR.
**    IF SY-SUBRC EQ 0.
**      SELECT SINGLE * FROM PA0001 WHERE PERNR EQ WA_ZDMS1-PERNR AND ENDDA GE SY-DATUM.
**      IF SY-SUBRC EQ 0.
**        ENAME = PA0001-ENAME.
**        CL1 = WA_ZDMS1-CL1.
**        SELECT SINGLE * FROM T001P WHERE BTRTL EQ PA0001-BTRTL.
**        IF SY-SUBRC EQ 0.
**          DEPT = T001P-BTEXT.
**        ENDIF.
**      ENDIF.
**      SELECT SINGLE * FROM T001W WHERE WERKS EQ WA_ZDMS1-WERKS.
**      IF SY-SUBRC EQ 0.
**        KUNNR = T001W-KUNNR.
**      ENDIF.
**
**      RPN = WA_ZDMS1-RPN_S * WA_ZDMS1-RPN_P * WA_ZDMS1-RPN_D.
**      IF RPN LE 50.
**        RPNSTAT = 'MINOR'.
**      ELSEIF RPN GE 51 AND RPN LE 75.
**        RPNSTAT = 'MIJOR'.
**      ELSEIF RPN GT 75.
**        RPNSTAT = 'CRITICAL'.
**      ENDIF.
*    ENDIF.
**  BREAK-POINT.
*    PERFORM DATAUPDATE.
*
**      LOOP AT IT_ZDMS2 INTO WA_ZDMS2 WHERE DEPT EQ IMPDEPT.
**        ZDMS2-MBLNR = WA_ZDMS2-MBLNR.
**        ZDMS2-DEPT = WA_ZDMS2-DEPT.
**        ZDMS2-BUDAT = WA_ZDMS2-BUDAT.
**        ZDMS2-PERNR = WA_ZDMS2-PERNR.
**        ZDMS2-APPROVE = WA_ZDMS2-APPROVE.
**        ZDMS2-REJECT = WA_ZDMS2-REJECT.
**        ZDMS2-ATEXT1 = WA_ZDMS2-ATEXT1.
**        ZDMS2-TDATE1 = WA_ZDMS2-TDATE1.
**        ZDMS2-ATEXT2 = WA_ZDMS2-ATEXT2.
**        ZDMS2-TDATE2 = WA_ZDMS2-TDATE2.
**        ZDMS2-ATEXT3 = WA_ZDMS2-ATEXT3.
**        ZDMS2-TDATE3 = WA_ZDMS2-TDATE3.
**        ZDMS2-ATEXT4 = WA_ZDMS2-ATEXT4.
**        ZDMS2-TDATE4 = WA_ZDMS2-TDATE4.
**        ZDMS2-ATEXT5 = WA_ZDMS2-ATEXT5.
**        ZDMS2-TDATE5 = WA_ZDMS2-TDATE5.
**      ENDLOOP.
*
*  ENDIF.


*ENDMODULE.
*&---------------------------------------------------------------------*
*&      Module  USER_COMMAND_9002  INPUT
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*MODULE USER_COMMAND_9002 INPUT.
*  CASE OK.
**   BREAK-POINT.
*    WHEN 'SAVE'.
*
*      IF CC1  EQ 'X' AND R3 EQ 'X'.
*        IF ZDMS1-APPROVE EQ 'X' AND ZDMS1-REJECT EQ 'X'.
*          MESSAGE 'EITHER APPROVE OR REJECT' TYPE 'E'.
*        ENDIF.
*        ZDMS1_WA-MJAHR = ZDMS1-MJAHR.
*        ZDMS1_WA-MBLNR = ZDMS1-MBLNR.
*        ZDMS1_WA-ZTYP = ZDMS1-ZTYP.
*        ZDMS1_WA-BUDAT = ZDMS1-BUDAT.
*        ZDMS1_WA-PERNR = ZDMS1-PERNR.
*        ZDMS1_WA-WERKS = ZDMS1-WERKS.
*        ZDMS1_WA-D1 = ZDMS1-D1.
*        ZDMS1_WA-D2 = ZDMS1-D2.
*        ZDMS1_WA-D3 = ZDMS1-D3.
*        ZDMS1_WA-D4 = ZDMS1-D4.
*        ZDMS1_WA-D5 = ZDMS1-D5.
*        ZDMS1_WA-D6 = ZDMS1-D6.
*        ZDMS1_WA-D7 = ZDMS1-D7.
*        ZDMS1_WA-D8 = ZDMS1-D8.
*        ZDMS1_WA-D9 = ZDMS1-D9.
*        ZDMS1_WA-D10 = ZDMS1-D10.
*        ZDMS1_WA-D11 = ZDMS1-D11.
*        ZDMS1_WA-D12 = ZDMS1-D12.
*        ZDMS1_WA-ATEXT1 = ZDMS1-ATEXT1.
*        ZDMS1_WA-ATEXT2 = ZDMS1-ATEXT2.
*        ZDMS1_WA-ATEXT3 = ZDMS1-ATEXT3.
*        ZDMS1_WA-ATEXT4 = ZDMS1-ATEXT4.
*        ZDMS1_WA-ATEXT5 = ZDMS1-ATEXT5.
*        ZDMS1_WA-BTEXT1 = ZDMS1-BTEXT1.
*        ZDMS1_WA-BTEXT2 = ZDMS1-BTEXT2.
*        ZDMS1_WA-BTEXT3 = ZDMS1-BTEXT3.
*        ZDMS1_WA-BTEXT4 = ZDMS1-BTEXT4.
*        ZDMS1_WA-BTEXT5 = ZDMS1-BTEXT5.
*        ZDMS1_WA-CTEXT1 = ZDMS1-CTEXT1.
*        ZDMS1_WA-CTEXT2 = ZDMS1-CTEXT2.
*        ZDMS1_WA-CTEXT3 = ZDMS1-CTEXT3.
*        ZDMS1_WA-CTEXT4 = ZDMS1-CTEXT4.
*        ZDMS1_WA-CTEXT5 = ZDMS1-CTEXT5.
*        ZDMS1_WA-DTEXT1 = ZDMS1-DTEXT1.
*        ZDMS1_WA-DTEXT2 = ZDMS1-DTEXT2.
*        ZDMS1_WA-DTEXT3 = ZDMS1-DTEXT3.
*        ZDMS1_WA-DTEXT4 = ZDMS1-DTEXT4.
*        ZDMS1_WA-DTEXT5 = ZDMS1-DTEXT5.
*        ZDMS1_WA-ETEXT1 = ZDMS1-ETEXT1.
*        ZDMS1_WA-ETEXT2 = ZDMS1-ETEXT2.
*        ZDMS1_WA-ETEXT3 = ZDMS1-ETEXT3.
*        ZDMS1_WA-ETEXT4 = ZDMS1-ETEXT4.
*        ZDMS1_WA-ETEXT5 = ZDMS1-ETEXT5.
*        ZDMS1_WA-FTEXT1 = ZDMS1-FTEXT1.
*        ZDMS1_WA-FTEXT2 = ZDMS1-FTEXT2.
*        ZDMS1_WA-FTEXT3 = ZDMS1-FTEXT3.
*        ZDMS1_WA-FTEXT4 = ZDMS1-FTEXT4.
*        ZDMS1_WA-FTEXT5 = ZDMS1-FTEXT5.
*        ZDMS1_WA-APPROVE = ZDMS1-APPROVE.
*        ZDMS1_WA-REJECT = ZDMS1-REJECT.
*        ZDMS1_WA-APERNR = PERNR.
*
*        UPDATE ZDMS1 FROM ZDMS1_WA.
*        CLEAR : ZDMS1_WA.
*        IF ZDMS1-APPROVE EQ 'X'.
*          MESSAGE 'CHANGE CONTROL IS APPROVED' TYPE 'I'.
*        ELSEIF ZDMS1-REJECT EQ 'X'.
*          MESSAGE 'CHANGE CONTROL IS REJECTED' TYPE 'I'.
*        ENDIF.
**        CALL TRANSACTION 'ZDMS1'.
*        SET SCREEN 0.
*        LEAVE SCREEN.
*      ENDIF.
**      PERFORM UPDATE.
**      PERFORM UPDATE_DATA.
**        MESSAGE 'SAVED' TYPE 'I'.
**    WHEN 'ENTER'.
**      PERFORM UPDATE.
*    WHEN 'BACK' OR 'EXIT'.
*      SET SCREEN 0.
*      LEAVE SCREEN.
*
*  ENDCASE.
*ENDMODULE.
**&---------------------------------------------------------------------*
**&      Module  STATUS_9003  OUTPUT
**&---------------------------------------------------------------------*
**       text
**----------------------------------------------------------------------*
*MODULE STATUS_9003 OUTPUT.
*  SET PF-STATUS 'STATUS'.
*  SET TITLEBAR 'SELECT'.
*
*  LOOP AT IT_ZDMS1 INTO WA_ZDMS1.
*    SELECT SINGLE * FROM PA0001 WHERE PERNR EQ WA_ZDMS1-PERNR AND ENDDA GE SY-DATUM.
*    IF SY-SUBRC EQ 0.
*      ENAME = PA0001-ENAME.
*      IF PERNR EQ WA_ZDMS1-PERNR.
*        MESSAGE 'INITIATOR & APPROVER CAN NOT BE SAME PERSON' TYPE 'E'.
*      ENDIF.
*      SELECT SINGLE * FROM T001P WHERE BTRTL EQ PA0001-BTRTL.
*      IF SY-SUBRC EQ 0.
*        DEPT = T001P-BTEXT.
*      ENDIF.
*    ENDIF.
*    SELECT SINGLE * FROM PA0001 WHERE PERNR EQ WA_ZDMS1-APERNR AND ENDDA GE SY-DATUM.
*    IF SY-SUBRC EQ 0.
*      ANAME = PA0001-ENAME.
*    ENDIF.
*    SELECT SINGLE * FROM T001W WHERE WERKS EQ WA_ZDMS1-WERKS.
*    IF SY-SUBRC EQ 0.
*      KUNNR = T001W-KUNNR.
*    ENDIF.
*    ZDMS1-MJAHR = WA_ZDMS1-MJAHR.
*    ZDMS1-MBLNR = WA_ZDMS1-MBLNR.
*    ZDMS1-ZTYP = WA_ZDMS1-ZTYP.
*    ZDMS1-BUDAT = WA_ZDMS1-BUDAT.
*    ZDMS1-PERNR = WA_ZDMS1-PERNR.
*    ZDMS1-WERKS = WA_ZDMS1-WERKS.
*    ZDMS1-D1 = WA_ZDMS1-D1.
*    ZDMS1-D2 = WA_ZDMS1-D2.
*    ZDMS1-D3 = WA_ZDMS1-D3.
*    ZDMS1-D4 = WA_ZDMS1-D4.
*    ZDMS1-D5 = WA_ZDMS1-D5.
*    ZDMS1-D6 = WA_ZDMS1-D6.
*    ZDMS1-D7 = WA_ZDMS1-D7.
*    ZDMS1-D8 = WA_ZDMS1-D8.
*    ZDMS1-D9 = WA_ZDMS1-D9.
*    ZDMS1-D10 = WA_ZDMS1-D10.
*    ZDMS1-D11 = WA_ZDMS1-D11.
*    ZDMS1-D12 = WA_ZDMS1-D12.
*    ZDMS1-ATEXT1 = WA_ZDMS1-ATEXT1.
*    ZDMS1-ATEXT2 = WA_ZDMS1-ATEXT2.
*    ZDMS1-ATEXT3 = WA_ZDMS1-ATEXT3.
*    ZDMS1-ATEXT4 = WA_ZDMS1-ATEXT4.
*    ZDMS1-ATEXT5 = WA_ZDMS1-ATEXT5.
*
*    ZDMS1-BTEXT1 = WA_ZDMS1-BTEXT1.
*    ZDMS1-BTEXT2 = WA_ZDMS1-BTEXT2.
*    ZDMS1-BTEXT3 = WA_ZDMS1-BTEXT3.
*    ZDMS1-BTEXT4 = WA_ZDMS1-BTEXT4.
*    ZDMS1-BTEXT5 = WA_ZDMS1-BTEXT5.
*
*    ZDMS1-CTEXT1 = WA_ZDMS1-CTEXT1.
*    ZDMS1-CTEXT2 = WA_ZDMS1-CTEXT2.
*    ZDMS1-CTEXT3 = WA_ZDMS1-CTEXT3.
*    ZDMS1-CTEXT4 = WA_ZDMS1-CTEXT4.
*    ZDMS1-CTEXT5 = WA_ZDMS1-CTEXT5.
*
*    ZDMS1-DTEXT1 = WA_ZDMS1-DTEXT1.
*    ZDMS1-DTEXT2 = WA_ZDMS1-DTEXT2.
*    ZDMS1-DTEXT3 = WA_ZDMS1-DTEXT3.
*    ZDMS1-DTEXT4 = WA_ZDMS1-DTEXT4.
*    ZDMS1-DTEXT5 = WA_ZDMS1-DTEXT5.
*
*    ZDMS1-ETEXT1 = WA_ZDMS1-ETEXT1.
*    ZDMS1-ETEXT2 = WA_ZDMS1-ETEXT2.
*    ZDMS1-ETEXT3 = WA_ZDMS1-ETEXT3.
*    ZDMS1-ETEXT4 = WA_ZDMS1-ETEXT4.
*    ZDMS1-ETEXT5 = WA_ZDMS1-ETEXT5.
*
*    ZDMS1-FTEXT1 = WA_ZDMS1-FTEXT1.
*    ZDMS1-FTEXT2 = WA_ZDMS1-FTEXT2.
*    ZDMS1-FTEXT3 = WA_ZDMS1-FTEXT3.
*    ZDMS1-FTEXT4 = WA_ZDMS1-FTEXT4.
*    ZDMS1-FTEXT5 = WA_ZDMS1-FTEXT5.
*    ZDMS1-APPROVE = WA_ZDMS1-APPROVE.
*    ZDMS1-REJECT = WA_ZDMS1-REJECT.
*    ZDMS1-APERNR = WA_ZDMS1-APERNR.
*
*    ZDMS1-AD1 = WA_ZDMS1-AD1.
*    ZDMS1-AD2 = WA_ZDMS1-AD2.
*    ZDMS1-AD3 = WA_ZDMS1-AD3.
*    ZDMS1-AD4 = WA_ZDMS1-AD4.
*    ZDMS1-AD5 = WA_ZDMS1-AD5.
*    ZDMS1-AD6 = WA_ZDMS1-AD6.
*    ZDMS1-AD7 = WA_ZDMS1-AD7.
*    ZDMS1-AD8 = WA_ZDMS1-AD8.
*
*  ENDLOOP.
*ENDMODULE.
**&---------------------------------------------------------------------*
**&      Module  USER_COMMAND_9003  INPUT
**&---------------------------------------------------------------------*
**       text
**----------------------------------------------------------------------*
*MODULE USER_COMMAND_9003 INPUT.
*  CASE OK.
**   BREAK-POINT.
*    WHEN 'SAVE'.
*      IF CC1  EQ 'X' AND R5 EQ 'X'.
*        ZDMS1_WA-MJAHR = ZDMS1-MJAHR.
*        ZDMS1_WA-MBLNR = ZDMS1-MBLNR.
*        ZDMS1_WA-ZTYP = ZDMS1-ZTYP.
*        ZDMS1_WA-BUDAT = ZDMS1-BUDAT.
*        ZDMS1_WA-PERNR = ZDMS1-PERNR.
*        ZDMS1_WA-WERKS = ZDMS1-WERKS.
*        ZDMS1_WA-D1 = ZDMS1-D1.
*        ZDMS1_WA-D2 = ZDMS1-D2.
*        ZDMS1_WA-D3 = ZDMS1-D3.
*        ZDMS1_WA-D4 = ZDMS1-D4.
*        ZDMS1_WA-D5 = ZDMS1-D5.
*        ZDMS1_WA-D6 = ZDMS1-D6.
*        ZDMS1_WA-D7 = ZDMS1-D7.
*        ZDMS1_WA-D8 = ZDMS1-D8.
*        ZDMS1_WA-D9 = ZDMS1-D9.
*        ZDMS1_WA-D10 = ZDMS1-D10.
*        ZDMS1_WA-D11 = ZDMS1-D11.
*        ZDMS1_WA-D12 = ZDMS1-D12.
*        ZDMS1_WA-ATEXT1 = ZDMS1-ATEXT1.
*        ZDMS1_WA-ATEXT2 = ZDMS1-ATEXT2.
*        ZDMS1_WA-ATEXT3 = ZDMS1-ATEXT3.
*        ZDMS1_WA-ATEXT4 = ZDMS1-ATEXT4.
*        ZDMS1_WA-ATEXT5 = ZDMS1-ATEXT5.
*        ZDMS1_WA-BTEXT1 = ZDMS1-BTEXT1.
*        ZDMS1_WA-BTEXT2 = ZDMS1-BTEXT2.
*        ZDMS1_WA-BTEXT3 = ZDMS1-BTEXT3.
*        ZDMS1_WA-BTEXT4 = ZDMS1-BTEXT4.
*        ZDMS1_WA-BTEXT5 = ZDMS1-BTEXT5.
*        ZDMS1_WA-CTEXT1 = ZDMS1-CTEXT1.
*        ZDMS1_WA-CTEXT2 = ZDMS1-CTEXT2.
*        ZDMS1_WA-CTEXT3 = ZDMS1-CTEXT3.
*        ZDMS1_WA-CTEXT4 = ZDMS1-CTEXT4.
*        ZDMS1_WA-CTEXT5 = ZDMS1-CTEXT5.
*        ZDMS1_WA-DTEXT1 = ZDMS1-DTEXT1.
*        ZDMS1_WA-DTEXT2 = ZDMS1-DTEXT2.
*        ZDMS1_WA-DTEXT3 = ZDMS1-DTEXT3.
*        ZDMS1_WA-DTEXT4 = ZDMS1-DTEXT4.
*        ZDMS1_WA-DTEXT5 = ZDMS1-DTEXT5.
*        ZDMS1_WA-ETEXT1 = ZDMS1-ETEXT1.
*        ZDMS1_WA-ETEXT2 = ZDMS1-ETEXT2.
*        ZDMS1_WA-ETEXT3 = ZDMS1-ETEXT3.
*        ZDMS1_WA-ETEXT4 = ZDMS1-ETEXT4.
*        ZDMS1_WA-ETEXT5 = ZDMS1-ETEXT5.
*        ZDMS1_WA-FTEXT1 = ZDMS1-FTEXT1.
*        ZDMS1_WA-FTEXT2 = ZDMS1-FTEXT2.
*        ZDMS1_WA-FTEXT3 = ZDMS1-FTEXT3.
*        ZDMS1_WA-FTEXT4 = ZDMS1-FTEXT4.
*        ZDMS1_WA-FTEXT5 = ZDMS1-FTEXT5.
*        ZDMS1_WA-APPROVE = ZDMS1-APPROVE.
*        ZDMS1_WA-REJECT = ZDMS1-REJECT.
*        ZDMS1_WA-APERNR = ZDMS1-APERNR.
*        ZDMS1_WA-AD1 = ZDMS1-AD1.
*        ZDMS1_WA-AD2 = ZDMS1-AD2.
*        ZDMS1_WA-AD3 = ZDMS1-AD3.
*        ZDMS1_WA-AD4 = ZDMS1-AD4.
*        ZDMS1_WA-AD5 = ZDMS1-AD5.
*        ZDMS1_WA-AD6 = ZDMS1-AD6.
*        ZDMS1_WA-AD7 = ZDMS1-AD7.
*        ZDMS1_WA-AD8 = ZDMS1-AD8.
*
*        UPDATE ZDMS1 FROM ZDMS1_WA.
*        CLEAR : ZDMS1_WA.
*
*        MESSAGE 'DATA SAVED' TYPE 'I'.
*
**        CALL TRANSACTION 'ZDMS1'.
*        SET SCREEN 0.
*        LEAVE SCREEN.
*      ENDIF.
*
*    WHEN 'BACK' OR 'EXIT'.
*      SET SCREEN 0.
*      LEAVE SCREEN.
*
*  ENDCASE.
*ENDMODULE.
*&---------------------------------------------------------------------*
*&      Module  USER_COMMAND_9002  INPUT
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*MODULE USER_COMMAND_9002 INPUT.
*  CASE OK.
**   BREAK-POINT.
*    WHEN 'SAVE'.
*      IF CC1  EQ 'X' AND R3 EQ 'X'.
*        IF ZDMS2-APPROVE EQ 'X' AND ZDMS2-REJECT EQ 'X'.
*          MESSAGE ' SELECT APPROVE OR REJECT' TYPE 'E'.
*          EXIT.
*        ENDIF.
*
*        SELECT SINGLE * FROM PA0001 WHERE PERNR EQ PERNR AND BTRTL EQ ZDMS1-DEPT1.
*        IF SY-SUBRC EQ 0.
*          IF APPROVE1 EQ 'X' AND REJECT1 EQ 'X'.
*            MESSAGE 'EITHER APPROVE OR REJECT' TYPE 'I'.
*            EXIT.
*          ENDIF.
*
*          ZDMS2_WA-MJAHR = YEAR.
*          ZDMS2_WA-MBLNR = CCNUM.
*          ZDMS2_WA-DEPT = ZDMS1-DEPT1.
*          ZDMS2_WA-BUDAT = SY-DATUM.
*          ZDMS2_WA-PERNR = PERNR.
*          ZDMS2_WA-APPROVE = APPROVE1.
*          ZDMS2_WA-REJECT = REJECT1.
*          ZDMS2_WA-ATEXT1 = ATEXT1.
*          ZDMS2_WA-TDATE1 = ADATE1.
*          ZDMS2_WA-CTDATE1 = ADATE6.
*          ZDMS2_WA-FOLW1 = AFOLW1.
*          ZDMS2_WA-REM1 = AREM1.
*          ZDMS2_WA-ATEXT2 = ATEXT2.
*          ZDMS2_WA-TDATE2 = ADATE2.
*          ZDMS2_WA-CTDATE2 = ADATE7.
*          ZDMS2_WA-FOLW2 = AFOLW2.
*          ZDMS2_WA-REM2 = AREM2.
*          ZDMS2_WA-ATEXT3 = ATEXT3.
*          ZDMS2_WA-TDATE3 = ADATE3.
*          ZDMS2_WA-CTDATE3 = ADATE8.
*          ZDMS2_WA-FOLW3 = AFOLW3.
*          ZDMS2_WA-REM3 = AREM3.
*          ZDMS2_WA-ATEXT4 = ATEXT4.
*          ZDMS2_WA-TDATE4 = ADATE4.
*          ZDMS2_WA-CTDATE4 = ADATE9.
*          ZDMS2_WA-FOLW4 = AFOLW4.
*          ZDMS2_WA-REM4 = AREM4.
*          ZDMS2_WA-ATEXT5 = ATEXT5.
*          ZDMS2_WA-TDATE5 = ADATE5.
*          ZDMS2_WA-CTDATE5 = ADATE10.
*          ZDMS2_WA-FOLW5 = AFOLW5.
*          ZDMS2_WA-REM5 = AREM5.
*          MODIFY ZDMS2 FROM ZDMS2_WA.
*          CLEAR : ZDMS2_WA.
*          A = 1.
**        ELSE.
**
*        ENDIF.
*
*        SELECT SINGLE * FROM PA0001 WHERE PERNR EQ PERNR AND BTRTL EQ ZDMS1-DEPT2.
*        IF SY-SUBRC EQ 0.
*          IF APPROVE2 EQ 'X' AND REJECT2 EQ 'X'.
*            MESSAGE 'EITHER APPROVE OR REJECT' TYPE 'I'.
*            EXIT.
*          ENDIF.
*          ZDMS2_WA-MJAHR = YEAR.
*          ZDMS2_WA-MBLNR = CCNUM.
*          ZDMS2_WA-DEPT = ZDMS1-DEPT2.
*          ZDMS2_WA-BUDAT = SY-DATUM.
*          ZDMS2_WA-PERNR = PERNR.
*          ZDMS2_WA-APPROVE = APPROVE2.
*          ZDMS2_WA-REJECT = REJECT2.
*          ZDMS2_WA-ATEXT1 = BTEXT1.
*          ZDMS2_WA-TDATE1 = BDATE1.
*          ZDMS2_WA-CTDATE1 = BDATE6.
*          ZDMS2_WA-FOLW1 = BFOLW1.
*          ZDMS2_WA-REM1 = BREM1.
*          ZDMS2_WA-ATEXT2 = BTEXT2.
*          ZDMS2_WA-TDATE2 = BDATE2.
*          ZDMS2_WA-CTDATE2 = BDATE7.
*          ZDMS2_WA-FOLW2 = BFOLW2.
*          ZDMS2_WA-REM2 = BREM2.
*          ZDMS2_WA-ATEXT3 = BTEXT3.
*          ZDMS2_WA-TDATE3 = BDATE3.
*          ZDMS2_WA-CTDATE3 = BDATE8.
*          ZDMS2_WA-FOLW3 = BFOLW3.
*          ZDMS2_WA-REM3 = BREM3.
*          ZDMS2_WA-ATEXT4 = BTEXT4.
*          ZDMS2_WA-TDATE4 = BDATE4.
*          ZDMS2_WA-CTDATE4 = BDATE9.
*          ZDMS2_WA-FOLW4 = BFOLW4.
*          ZDMS2_WA-REM4 = BREM4.
*          ZDMS2_WA-ATEXT5 = BTEXT5.
*          ZDMS2_WA-TDATE5 = BDATE5.
*          ZDMS2_WA-CTDATE5 = BDATE10.
*          ZDMS2_WA-FOLW5 = BFOLW5.
*          ZDMS2_WA-REM5 = BREM5.
*          MODIFY ZDMS2 FROM ZDMS2_WA.
*          CLEAR : ZDMS2_WA.
*          A = 1.
**          MESSAGE 'NOT AUTHORISED USER TO ENTER DATA' TYPE 'I'.
**          EXIT.
*        ENDIF.
*
*        SELECT SINGLE * FROM PA0001 WHERE PERNR EQ PERNR AND BTRTL EQ ZDMS1-DEPT3.
*        IF SY-SUBRC EQ 0.
*          IF APPROVE3 EQ 'X' AND REJECT3 EQ 'X'.
*            MESSAGE 'EITHER APPROVE OR REJECT' TYPE 'I'.
*            EXIT.
*          ENDIF.
*          ZDMS2_WA-MJAHR = YEAR.
*          ZDMS2_WA-MBLNR = CCNUM.
*          ZDMS2_WA-DEPT = ZDMS1-DEPT3.
*          ZDMS2_WA-BUDAT = SY-DATUM.
*          ZDMS2_WA-PERNR = PERNR.
*          ZDMS2_WA-APPROVE = APPROVE3.
*          ZDMS2_WA-REJECT = REJECT3.
*          ZDMS2_WA-ATEXT1 = CTEXT1.
*          ZDMS2_WA-TDATE1 = CDATE1.
*          ZDMS2_WA-CTDATE1 = CDATE6.
*          ZDMS2_WA-FOLW1 = CFOLW1.
*          ZDMS2_WA-REM1 = CREM1.
*          ZDMS2_WA-ATEXT2 = CTEXT2.
*          ZDMS2_WA-TDATE2 = CDATE2.
*          ZDMS2_WA-CTDATE2 = CDATE7.
*          ZDMS2_WA-FOLW2 = CFOLW2.
*          ZDMS2_WA-REM2 = CREM2.
*          ZDMS2_WA-ATEXT3 = CTEXT3.
*          ZDMS2_WA-TDATE3 = CDATE3.
*          ZDMS2_WA-CTDATE3 = CDATE8.
*          ZDMS2_WA-FOLW3 = CFOLW3.
*          ZDMS2_WA-REM3 = CREM3.
*          ZDMS2_WA-ATEXT4 = CTEXT4.
*          ZDMS2_WA-TDATE4 = CDATE4.
*          ZDMS2_WA-CTDATE4 = CDATE9.
*          ZDMS2_WA-FOLW4 = CFOLW4.
*          ZDMS2_WA-REM4 = CREM4.
*          ZDMS2_WA-ATEXT5 = CTEXT5.
*          ZDMS2_WA-TDATE5 = CDATE5.
*          ZDMS2_WA-CTDATE5 = CDATE10.
*          ZDMS2_WA-FOLW5 = CFOLW5.
*          ZDMS2_WA-REM5 = CREM5.
*          MODIFY ZDMS2 FROM ZDMS2_WA.
*          CLEAR : ZDMS2_WA.
*          A = 1.
*        ENDIF.
*
*        SELECT SINGLE * FROM PA0001 WHERE PERNR EQ PERNR AND BTRTL EQ ZDMS1-DEPT4.
*        IF SY-SUBRC EQ 0.
*          IF APPROVE4 EQ 'X' AND REJECT4 EQ 'X'.
*            MESSAGE 'EITHER APPROVE OR REJECT' TYPE 'I'.
*            EXIT.
*          ENDIF.
*          ZDMS2_WA-MJAHR = YEAR.
*          ZDMS2_WA-MBLNR = CCNUM.
*          ZDMS2_WA-DEPT = ZDMS1-DEPT4.
*          ZDMS2_WA-BUDAT = SY-DATUM.
*          ZDMS2_WA-PERNR = PERNR.
*          ZDMS2_WA-APPROVE = APPROVE4.
*          ZDMS2_WA-REJECT = REJECT4.
*          ZDMS2_WA-ATEXT1 = DTEXT1.
*          ZDMS2_WA-TDATE1 = DDATE1.
*          ZDMS2_WA-CTDATE1 = DDATE6.
*          ZDMS2_WA-FOLW1 = DFOLW1.
*          ZDMS2_WA-REM1 = DREM1.
*          ZDMS2_WA-ATEXT2 = DTEXT2.
*          ZDMS2_WA-TDATE2 = DDATE2.
*          ZDMS2_WA-CTDATE2 = DDATE7.
*          ZDMS2_WA-FOLW2 = DFOLW2.
*          ZDMS2_WA-REM2 = DREM2.
*          ZDMS2_WA-ATEXT3 = DTEXT3.
*          ZDMS2_WA-TDATE3 = DDATE3.
*          ZDMS2_WA-CTDATE3 = DDATE8.
*          ZDMS2_WA-FOLW3 = DFOLW3.
*          ZDMS2_WA-REM3 = DREM3.
*          ZDMS2_WA-ATEXT4 = DTEXT4.
*          ZDMS2_WA-TDATE4 = DDATE4.
*          ZDMS2_WA-CTDATE4 = DDATE9.
*          ZDMS2_WA-FOLW4 = DFOLW4.
*          ZDMS2_WA-REM4 = DREM4.
*          ZDMS2_WA-ATEXT5 = DTEXT5.
*          ZDMS2_WA-TDATE5 = DDATE5.
*          ZDMS2_WA-CTDATE5 = DDATE10.
*          ZDMS2_WA-FOLW5 = DFOLW5.
*          ZDMS2_WA-REM5 = DREM5.
*          MODIFY ZDMS2 FROM ZDMS2_WA.
*          CLEAR : ZDMS2_WA.
*          A = 1.
*        ENDIF.
*
*        SELECT SINGLE * FROM PA0001 WHERE PERNR EQ PERNR AND BTRTL EQ ZDMS1-DEPT5 AND ENDDA GE SY-DATUM.
*        IF SY-SUBRC EQ 0.
*          IF APPROVE5 EQ 'X' AND REJECT5 EQ 'X'.
*            MESSAGE 'EITHER APPROVE OR REJECT' TYPE 'I'.
*            EXIT.
*          ENDIF.
*          ZDMS2_WA-MJAHR = YEAR.
*          ZDMS2_WA-MBLNR = CCNUM.
*          ZDMS2_WA-DEPT = ZDMS1-DEPT5.
*          ZDMS2_WA-BUDAT = SY-DATUM.
*          ZDMS2_WA-PERNR = PERNR.
*          ZDMS2_WA-APPROVE = APPROVE5.
*          ZDMS2_WA-REJECT = REJECT5.
*          ZDMS2_WA-ATEXT1 = ETEXT1.
*          ZDMS2_WA-TDATE1 = EDATE1.
*          ZDMS2_WA-CTDATE1 = EDATE6.
*          ZDMS2_WA-FOLW1 = EFOLW1.
*          ZDMS2_WA-REM1 = EREM1.
*          ZDMS2_WA-ATEXT2 = ETEXT2.
*          ZDMS2_WA-TDATE2 = EDATE2.
*          ZDMS2_WA-CTDATE2 = EDATE7.
*          ZDMS2_WA-FOLW2 = EFOLW2.
*          ZDMS2_WA-REM2 = EREM2.
*          ZDMS2_WA-ATEXT3 = ETEXT3.
*          ZDMS2_WA-TDATE3 = EDATE3.
*          ZDMS2_WA-CTDATE3 = EDATE8.
*          ZDMS2_WA-FOLW3 = EFOLW3.
*          ZDMS2_WA-REM3 = EREM3.
*          ZDMS2_WA-ATEXT4 = ETEXT4.
*          ZDMS2_WA-TDATE4 = EDATE4.
*          ZDMS2_WA-CTDATE4 = EDATE9.
*          ZDMS2_WA-FOLW4 = EFOLW4.
*          ZDMS2_WA-REM4 = EREM4.
*          ZDMS2_WA-ATEXT5 = ETEXT5.
*          ZDMS2_WA-TDATE5 = EDATE5.
*          ZDMS2_WA-CTDATE5 = EDATE10.
*          ZDMS2_WA-FOLW5 = EFOLW5.
*          ZDMS2_WA-REM5 = EREM5.
*          MODIFY ZDMS2 FROM ZDMS2_WA.
*          CLEAR : ZDMS2_WA.
*          A = 1.
*        ENDIF.
*
*        SELECT SINGLE * FROM PA0001 WHERE PERNR EQ PERNR AND BTRTL EQ ZDMS1-DEPT6.
*        IF SY-SUBRC EQ 0.
*          IF APPROVE6 EQ 'X' AND REJECT6 EQ 'X'.
*            MESSAGE 'EITHER APPROVE OR REJECT' TYPE 'I'.
*            EXIT.
*          ENDIF.
*          ZDMS2_WA-MJAHR = YEAR.
*          ZDMS2_WA-MBLNR = CCNUM.
*          ZDMS2_WA-DEPT = ZDMS1-DEPT6.
*          ZDMS2_WA-BUDAT = SY-DATUM.
*          ZDMS2_WA-PERNR = PERNR.
*          ZDMS2_WA-APPROVE = APPROVE6.
*          ZDMS2_WA-REJECT = REJECT6.
*          ZDMS2_WA-ATEXT1 = FTEXT1.
*          ZDMS2_WA-TDATE1 = FDATE1.
*          ZDMS2_WA-CTDATE1 = FDATE6.
*          ZDMS2_WA-FOLW1 = FFOLW1.
*          ZDMS2_WA-ATEXT2 = FTEXT2.
*          ZDMS2_WA-TDATE2 = FDATE2.
*          ZDMS2_WA-CTDATE2 = FDATE7.
*          ZDMS2_WA-FOLW2 = FFOLW2.
*          ZDMS2_WA-ATEXT3 = FTEXT3.
*          ZDMS2_WA-TDATE3 = FDATE3.
*          ZDMS2_WA-CTDATE3 = FDATE8.
*          ZDMS2_WA-FOLW3 = FFOLW3.
*          ZDMS2_WA-ATEXT4 = FTEXT4.
*          ZDMS2_WA-TDATE4 = FDATE4.
*          ZDMS2_WA-CTDATE4 = FDATE9.
*          ZDMS2_WA-FOLW4 = FFOLW4.
*          ZDMS2_WA-ATEXT5 = FTEXT5.
*          ZDMS2_WA-TDATE5 = FDATE5.
*          ZDMS2_WA-CTDATE5 = FDATE10.
*          ZDMS2_WA-FOLW5 = FFOLW5.
*          MODIFY ZDMS2 FROM ZDMS2_WA.
*          CLEAR : ZDMS2_WA.
*          A = 1.
*        ENDIF.
*
*        SELECT SINGLE * FROM PA0001 WHERE PERNR EQ PERNR AND BTRTL EQ ZDMS1-DEPT7.
*        IF SY-SUBRC EQ 0.
*          IF APPROVE7 EQ 'X' AND REJECT7 EQ 'X'.
*            MESSAGE 'EITHER APPROVE OR REJECT' TYPE 'I'.
*            EXIT.
*          ENDIF.
*          ZDMS2_WA-MJAHR = YEAR.
*          ZDMS2_WA-MBLNR = CCNUM.
*          ZDMS2_WA-DEPT = ZDMS1-DEPT7.
*          ZDMS2_WA-BUDAT = SY-DATUM.
*          ZDMS2_WA-PERNR = PERNR.
*          ZDMS2_WA-APPROVE = APPROVE7.
*          ZDMS2_WA-REJECT = REJECT7.
*          ZDMS2_WA-ATEXT1 = GTEXT1.
*          ZDMS2_WA-TDATE1 = GDATE1.
*          ZDMS2_WA-CTDATE1 = GDATE6.
*          ZDMS2_WA-FOLW1 = GFOLW1.
*          ZDMS2_WA-ATEXT2 = GTEXT2.
*          ZDMS2_WA-TDATE2 = GDATE2.
*          ZDMS2_WA-CTDATE2 = GDATE7.
*          ZDMS2_WA-FOLW2 = GFOLW2.
*          ZDMS2_WA-ATEXT3 = GTEXT3.
*          ZDMS2_WA-TDATE3 = GDATE3.
*          ZDMS2_WA-CTDATE3 = GDATE8.
*          ZDMS2_WA-FOLW3 = GFOLW3.
*          ZDMS2_WA-ATEXT4 = GTEXT4.
*          ZDMS2_WA-TDATE4 = GDATE4.
*          ZDMS2_WA-CTDATE4 = GDATE9.
*          ZDMS2_WA-FOLW4 = GFOLW4.
*          ZDMS2_WA-ATEXT5 = GTEXT5.
*          ZDMS2_WA-TDATE5 = GDATE5.
*          ZDMS2_WA-CTDATE5 = GDATE10.
*          ZDMS2_WA-FOLW5 = GFOLW5.
*          MODIFY ZDMS2 FROM ZDMS2_WA.
*          CLEAR : ZDMS2_WA.
*          A = 1.
*        ENDIF.
*
*        SELECT SINGLE * FROM PA0001 WHERE PERNR EQ PERNR AND BTRTL EQ ZDMS1-DEPT8.
*        IF SY-SUBRC EQ 0.
*          IF APPROVE8 EQ 'X' AND REJECT8 EQ 'X'.
*            MESSAGE 'EITHER APPROVE OR REJECT' TYPE 'I'.
*            EXIT.
*          ENDIF.
*          ZDMS2_WA-MJAHR = YEAR.
*          ZDMS2_WA-MBLNR = CCNUM.
*          ZDMS2_WA-DEPT = ZDMS1-DEPT8.
*          ZDMS2_WA-BUDAT = SY-DATUM.
*          ZDMS2_WA-PERNR = PERNR.
*          ZDMS2_WA-APPROVE = APPROVE8.
*          ZDMS2_WA-REJECT = REJECT8.
*          ZDMS2_WA-ATEXT1 = HTEXT1.
*          ZDMS2_WA-TDATE1 = HDATE1.
*          ZDMS2_WA-CTDATE1 = HDATE6.
*          ZDMS2_WA-FOLW1 = HFOLW1.
*          ZDMS2_WA-ATEXT2 = HTEXT2.
*          ZDMS2_WA-TDATE2 = HDATE2.
*          ZDMS2_WA-CTDATE2 = HDATE7.
*          ZDMS2_WA-FOLW2 = HFOLW2.
*          ZDMS2_WA-ATEXT3 = HTEXT3.
*          ZDMS2_WA-TDATE3 = HDATE3.
*          ZDMS2_WA-CTDATE3 = HDATE8.
*          ZDMS2_WA-FOLW3 = HFOLW3.
*          ZDMS2_WA-ATEXT4 = HTEXT4.
*          ZDMS2_WA-TDATE4 = HDATE4.
*          ZDMS2_WA-CTDATE4 = HDATE9.
*          ZDMS2_WA-FOLW4 = HFOLW4.
*          ZDMS2_WA-ATEXT5 = HTEXT5.
*          ZDMS2_WA-TDATE5 = HDATE5.
*          ZDMS2_WA-CTDATE5 = HDATE10.
*          ZDMS2_WA-FOLW5 = HFOLW5.
*          MODIFY ZDMS2 FROM ZDMS2_WA.
*          CLEAR : ZDMS2_WA.
*          A = 1.
*        ENDIF.
*
*        SELECT SINGLE * FROM PA0001 WHERE PERNR EQ PERNR AND BTRTL EQ ZDMS1-DEPT9.
*        IF SY-SUBRC EQ 0.
*          IF APPROVE9 EQ 'X' AND REJECT9 EQ 'X'.
*            MESSAGE 'EITHER APPROVE OR REJECT' TYPE 'I'.
*            EXIT.
*          ENDIF.
*          ZDMS2_WA-MJAHR = YEAR.
*          ZDMS2_WA-MBLNR = CCNUM.
*          ZDMS2_WA-DEPT = ZDMS1-DEPT9.
*          ZDMS2_WA-BUDAT = SY-DATUM.
*          ZDMS2_WA-PERNR = PERNR.
*          ZDMS2_WA-APPROVE = APPROVE9.
*          ZDMS2_WA-REJECT = REJECT9.
*          ZDMS2_WA-ATEXT1 = ITEXT1.
*          ZDMS2_WA-TDATE1 = IDATE1.
*          ZDMS2_WA-CTDATE1 = IDATE6.
*          ZDMS2_WA-FOLW1 = IFOLW1.
*          ZDMS2_WA-ATEXT2 = ITEXT2.
*          ZDMS2_WA-TDATE2 = IDATE2.
*          ZDMS2_WA-CTDATE2 = IDATE7.
*          ZDMS2_WA-FOLW2 = IFOLW2.
*          ZDMS2_WA-ATEXT3 = ITEXT3.
*          ZDMS2_WA-TDATE3 = IDATE3.
*          ZDMS2_WA-CTDATE3 = IDATE8.
*          ZDMS2_WA-FOLW3 = IFOLW3.
*          ZDMS2_WA-ATEXT4 = ITEXT4.
*          ZDMS2_WA-TDATE4 = IDATE4.
*          ZDMS2_WA-CTDATE4 = IDATE9.
*          ZDMS2_WA-FOLW4 = IFOLW4.
*          ZDMS2_WA-ATEXT5 = ITEXT5.
*          ZDMS2_WA-TDATE5 = IDATE5.
*          ZDMS2_WA-CTDATE5 = IDATE10.
*          ZDMS2_WA-FOLW5 = IFOLW5.
*          MODIFY ZDMS2 FROM ZDMS2_WA.
*          CLEAR : ZDMS2_WA.
*          A = 1.
*        ENDIF.
*
*        SELECT SINGLE * FROM PA0001 WHERE PERNR EQ PERNR AND BTRTL EQ ZDMS1-DEPT10.
*        IF SY-SUBRC EQ 0.
*          IF APPROVE10 EQ 'X' AND REJECT10 EQ 'X'.
*            MESSAGE 'EITHER APPROVE OR REJECT' TYPE 'I'.
*            EXIT.
*          ENDIF.
*          ZDMS2_WA-MJAHR = YEAR.
*          ZDMS2_WA-MBLNR = CCNUM.
*          ZDMS2_WA-DEPT = ZDMS1-DEPT10.
*          ZDMS2_WA-BUDAT = SY-DATUM.
*          ZDMS2_WA-PERNR = PERNR.
*          ZDMS2_WA-APPROVE = APPROVE10.
*          ZDMS2_WA-REJECT = REJECT10.
*          ZDMS2_WA-ATEXT1 = JTEXT1.
*          ZDMS2_WA-TDATE1 = JDATE1.
*          ZDMS2_WA-CTDATE1 = JDATE6.
*          ZDMS2_WA-FOLW1 = JFOLW1.
*          ZDMS2_WA-ATEXT2 = JTEXT2.
*          ZDMS2_WA-TDATE2 = JDATE2.
*          ZDMS2_WA-CTDATE2 = JDATE7.
*          ZDMS2_WA-FOLW2 = JFOLW2.
*          ZDMS2_WA-ATEXT3 = JTEXT3.
*          ZDMS2_WA-TDATE3 = JDATE3.
*          ZDMS2_WA-CTDATE3 = JDATE8.
*          ZDMS2_WA-FOLW3 = JFOLW3.
*          ZDMS2_WA-ATEXT4 = JTEXT4.
*          ZDMS2_WA-TDATE4 = JDATE4.
*          ZDMS2_WA-CTDATE4 = JDATE9.
*          ZDMS2_WA-FOLW4 = JFOLW4.
*          ZDMS2_WA-ATEXT5 = JTEXT5.
*          ZDMS2_WA-TDATE5 = JDATE5.
*          ZDMS2_WA-CTDATE5 = JDATE10.
*          ZDMS2_WA-FOLW5 = JFOLW5.
*          MODIFY ZDMS2 FROM ZDMS2_WA.
*          CLEAR : ZDMS2_WA.
*          A = 1.
*        ENDIF.
*        CLEAR : QHAPPROVE, QHREJECT, QHPERNR,TDAPPROVE, TDREJECT, TDPERNR,RPN_S,RPN_P,RPN_D, RTEXT1,RTEXT2, RTEXT3, CL1.
*        QHAPPROVE = ZDMS1-QHAPPROVE.
*        QHREJECT = ZDMS1-QHREJECT.
*        QHPERNR = PERNR.
*        TDAPPROVE = ZDMS1-TDAPPROVE.
*        TDREJECT = ZDMS1-TDREJECT.
*        TDPERNR = PERNR.
*        RPN_S = ZDMS1-RPN_S.
*        RPN_P = ZDMS1-RPN_P.
*        RPN_D = ZDMS1-RPN_D.
*        RPN = RPN_S + RPN_P + RPN_D.
*        RTEXT1 = ZDMS1-RTEXT1.
*        RTEXT2 = ZDMS1-RTEXT2.
*        RTEXT3 = ZDMS1-RTEXT3.
*        CL1 = ZDMS1-CL1.
**BREAK-POINT.
*************************** CHANGE CONTROL NUMBER**************************************************
*        SELECT SINGLE * FROM ZDMS1 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM AND CCNUMB EQ SPACE.
*        IF SY-SUBRC EQ 0.
*
*          SELECT * FROM ZDMS1 INTO TABLE IT_ZDMS1_1 WHERE MJAHR EQ YEAR AND ZTYP EQ 'CC'.
*          SORT IT_ZDMS1_1 DESCENDING BY CCNUMB.
*          READ TABLE IT_ZDMS1_1 INTO WA_ZDMS1_1 WITH KEY MJAHR = YEAR.
*          IF SY-SUBRC EQ 0.
*            VBELN1 = WA_ZDMS1_1-CCNUMB.
*          ENDIF.
*          FINV1 = VBELN1 + 1.
*          YEAR1 = YEAR+2(2).
*          IMPDEPT1 = IMPDEPT+2(2).
*          IF ZDMS1-WERKS EQ '1000'.
*            PLT = 'NK'.
*          ELSEIF ZDMS1-WERKS EQ '1001'.
*            PLT = 'GA'.
*          ELSE.
*            PLT = 'OS'.
*          ENDIF.
*          CONCATENATE 'CC/' YEAR1 '/' IMPDEPT1 '/' PLT '/' FINV1 INTO FINVNUMB.
*
*          IF QHAPPROVE EQ 'X' AND QHREJECT EQ 'X'.
*            MESSAGE 'SELECT EITHER APPROVE OR REJECT' TYPE 'I'.
*            EXIT.
*          ENDIF.
*          IF QHAPPROVE EQ 'X' OR QHREJECT EQ 'X'.
*            SELECT SINGLE * FROM ZDMS1 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM.
*            IF SY-SUBRC EQ 0.
*              MOVE-CORRESPONDING ZDMS1 TO ZDMS1_WA1.
*              ZDMS1_WA1-RPN_S = RPN_S.
*              ZDMS1_WA1-RPN_P = RPN_P.
*              ZDMS1_WA1-RPN_D = RPN_D.
*              ZDMS1_WA1-RTEXT1 = RTEXT1.
*              ZDMS1_WA1-RTEXT2 = RTEXT2.
*              ZDMS1_WA1-RTEXT3 = RTEXT3.
*              ZDMS1_WA1-QHAPPROVE = QHAPPROVE.
*              ZDMS1_WA1-QHREJECT = QHREJECT.
*              ZDMS1_WA1-QHPERNR = PERNR.
**            ZDMS1_WA1-TDAPPROVE = TDAPPROVE.
**            ZDMS1_WA1-TDREJECT = TDREJECT.
*              ZDMS1_WA1-CCNUMB = FINV1.
*              ZDMS1_WA1-CCNUMB1 = FINVNUMB.
*
**              SELECT SINGLE * FROM PA0001 WHERE PERNR EQ PERNR.
**              IF SY-SUBRC EQ 0.
**                IF PA0001-BTRTL NE '1228'.
**                  MESSAGE 'USER IS NOT FROM QA DEPARTMENT' TYPE 'E'.
**                  EXIT.
**                ENDIF.
**              ENDIF.
*              IF ZDMS1-WERKS EQ '1000' AND IMPDEPT NE '1228'.
**                MESSAGE 'USER IS NOT FROM QA DEPARTMENT' TYPE 'E'.
*              ENDIF.
*
*              UPDATE ZDMS1 FROM ZDMS1_WA1.
*              CLEAR ZDMS1_WA1.
*            ENDIF.
*          ENDIF.
*        ELSE.
*          IF QHAPPROVE EQ 'X' OR QHREJECT EQ 'X'.
*            SELECT SINGLE * FROM ZDMS1 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM.
*            IF SY-SUBRC EQ 0.
*              MOVE-CORRESPONDING ZDMS1 TO ZDMS1_WA1.
*              ZDMS1_WA1-RPN_S = RPN_S.
*              ZDMS1_WA1-RPN_P = RPN_P.
*              ZDMS1_WA1-RPN_D = RPN_D.
*              ZDMS1_WA1-RTEXT1 = RTEXT1.
*              ZDMS1_WA1-RTEXT2 = RTEXT2.
*              ZDMS1_WA1-RTEXT3 = RTEXT3.
*              ZDMS1_WA1-QHAPPROVE = QHAPPROVE.
*              ZDMS1_WA1-QHREJECT = QHREJECT.
*              ZDMS1_WA1-QHPERNR = PERNR.
**              SELECT SINGLE * FROM PA0001 WHERE PERNR EQ PERNR.
**              IF SY-SUBRC EQ 0.
**                IF PA0001-BTRTL NE '1228'.
**                  MESSAGE 'USER IS NOT FROM QA DEPARTMENT' TYPE 'E'.
**                ENDIF.
**              ENDIF.
*              IF ZDMS1-WERKS EQ '1000' AND IMPDEPT NE '1228'.
**                MESSAGE 'USER IS NOT FROM QA DEPARTMENT' TYPE 'E'.
*              ENDIF.
*              UPDATE ZDMS1 FROM ZDMS1_WA1.
*              CLEAR ZDMS1_WA1.
*            ENDIF.
*          ENDIF.
*        ENDIF.
*
*        IF TDAPPROVE EQ 'X' AND TDREJECT EQ 'X'.
*          MESSAGE 'SELECT EITHER APPROVE OR REJECT' TYPE 'I'.
*          EXIT.
*        ENDIF.
*        IF TDAPPROVE EQ 'X' OR TDREJECT EQ 'X'.
*          SELECT SINGLE * FROM ZDMS1 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM.
*          IF SY-SUBRC EQ 0.
*            MOVE-CORRESPONDING ZDMS1 TO ZDMS1_WA1.
*            ZDMS1_WA1-TDAPPROVE = TDAPPROVE.
*            ZDMS1_WA1-TDREJECT = TDREJECT.
*            ZDMS1_WA1-TDPERNR = PERNR.
**            ZDMS1_WA1-TDAPPROVE = TDAPPROVE.
**            ZDMS1_WA1-TDREJECT = TDREJECT.
**            ZDMS1_WA1-CCNUMB = FINV1.
**            ZDMS1_WA1-CCNUMB1 = FINVNUMB.
*
*            UPDATE ZDMS1 FROM ZDMS1_WA1.
*            CLEAR ZDMS1_WA1.
*          ENDIF.
*        ENDIF.
*
*
*        SELECT SINGLE * FROM ZDMS1 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM.
*        IF SY-SUBRC EQ 0.
*          MOVE-CORRESPONDING ZDMS1 TO ZDMS1_WA1.
*          ZDMS1_WA1-CL1 = CL1.
*          SELECT SINGLE * FROM PA0001 WHERE PERNR EQ PERNR.
**          IF SY-SUBRC EQ 0.
**            IF PA0001-BTRTL NE '1228'.
**              MESSAGE 'USER IS NOT FROM QA DEPARTMENT' TYPE 'E'.
**            ENDIF.
**          ENDIF.
*          IF ZDMS1-WERKS EQ '1000' AND IMPDEPT NE '1228'.
**            MESSAGE 'USER IS NOT FROM QA DEPARTMENT' TYPE 'E'.
*          ENDIF.
*          UPDATE ZDMS1 FROM ZDMS1_WA1.
*          CLEAR ZDMS1_WA1.
*        ENDIF.
*
*
*
**        IF A EQ 1.
***          MESSAGE 'IMPACTED ACTIVITIES ARE SAVED' TYPE 'I'.
**        ENDIF.
**        CALL TRANSACTION 'ZDMS1'.
*        SET SCREEN 0.
*        LEAVE SCREEN.
*      ENDIF.
*
*    WHEN 'BACK' OR 'EXIT'.
*      SET SCREEN 0.
*      LEAVE SCREEN.
*
*  ENDCASE.
*ENDMODULE.
*&---------------------------------------------------------------------*
*&      Form  DEPTTEXT
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM DEPTTEXT .

  SELECT SINGLE * FROM T001P WHERE BTRTL EQ  DEPT1 AND BTRTL NE SPACE.
  IF SY-SUBRC EQ 0.
    TSDEPT1 = T001P-BTEXT.
  ENDIF.
  SELECT SINGLE * FROM T001P WHERE BTRTL EQ  DEPT2 AND BTRTL NE SPACE.
  IF SY-SUBRC EQ 0.
    TSDEPT2 = T001P-BTEXT.
  ENDIF.
  SELECT SINGLE * FROM T001P WHERE BTRTL EQ  DEPT3  AND BTRTL NE SPACE.
  IF SY-SUBRC EQ 0.
    TSDEPT3 = T001P-BTEXT.
  ENDIF.
  SELECT SINGLE * FROM T001P WHERE BTRTL EQ  DEPT4 AND BTRTL NE SPACE.
  IF SY-SUBRC EQ 0.
    TSDEPT4 = T001P-BTEXT.
  ENDIF.
  SELECT SINGLE * FROM T001P WHERE BTRTL EQ  DEPT5 AND BTRTL NE SPACE.
  IF SY-SUBRC EQ 0.
    TSDEPT5 = T001P-BTEXT.
  ENDIF.
  SELECT SINGLE * FROM T001P WHERE BTRTL EQ  DEPT6 AND BTRTL NE SPACE.
  IF SY-SUBRC EQ 0.
    TSDEPT6 = T001P-BTEXT.
  ENDIF.
  SELECT SINGLE * FROM T001P WHERE BTRTL EQ  DEPT7 AND BTRTL NE SPACE.
  IF SY-SUBRC EQ 0.
    TSDEPT7 = T001P-BTEXT.
  ENDIF.
  SELECT SINGLE * FROM T001P WHERE BTRTL EQ  DEPT8 AND BTRTL NE SPACE.
  IF SY-SUBRC EQ 0.
    TSDEPT8 = T001P-BTEXT.
  ENDIF.
  SELECT SINGLE * FROM T001P WHERE BTRTL EQ  DEPT9 AND BTRTL NE SPACE.
  IF SY-SUBRC EQ 0.
    TSDEPT9 = T001P-BTEXT.
  ENDIF.

  SELECT SINGLE * FROM T001P WHERE BTRTL EQ  DEPT10 AND BTRTL NE SPACE.
  IF SY-SUBRC EQ 0.
    TSDEPT10 = T001P-BTEXT.
  ENDIF.
*************************
  SELECT SINGLE * FROM T001P WHERE BTRTL EQ  DEPT11 AND BTRTL NE SPACE.
  IF SY-SUBRC EQ 0.
    TSDEPT11 = T001P-BTEXT.
  ENDIF.
  SELECT SINGLE * FROM T001P WHERE BTRTL EQ  DEPT12 AND BTRTL NE SPACE.
  IF SY-SUBRC EQ 0.
    TSDEPT12 = T001P-BTEXT.
  ENDIF.
  SELECT SINGLE * FROM T001P WHERE BTRTL EQ  DEPT13  AND BTRTL NE SPACE.
  IF SY-SUBRC EQ 0.
    TSDEPT13 = T001P-BTEXT.
  ENDIF.
  SELECT SINGLE * FROM T001P WHERE BTRTL EQ  DEPT14 AND BTRTL NE SPACE.
  IF SY-SUBRC EQ 0.
    TSDEPT14 = T001P-BTEXT.
  ENDIF.
  SELECT SINGLE * FROM T001P WHERE BTRTL EQ  DEPT15 AND BTRTL NE SPACE.
  IF SY-SUBRC EQ 0.
    TSDEPT15 = T001P-BTEXT.
  ENDIF.
  SELECT SINGLE * FROM T001P WHERE BTRTL EQ  DEPT16 AND BTRTL NE SPACE.
  IF SY-SUBRC EQ 0.
    TSDEPT16 = T001P-BTEXT.
  ENDIF.
  SELECT SINGLE * FROM T001P WHERE BTRTL EQ  DEPT17 AND BTRTL NE SPACE.
  IF SY-SUBRC EQ 0.
    TSDEPT17 = T001P-BTEXT.
  ENDIF.
  SELECT SINGLE * FROM T001P WHERE BTRTL EQ  DEPT18 AND BTRTL NE SPACE.
  IF SY-SUBRC EQ 0.
    TSDEPT18 = T001P-BTEXT.
  ENDIF.
  SELECT SINGLE * FROM T001P WHERE BTRTL EQ  DEPT19 AND BTRTL NE SPACE.
  IF SY-SUBRC EQ 0.
    TSDEPT19 = T001P-BTEXT.
  ENDIF.

  SELECT SINGLE * FROM T001P WHERE BTRTL EQ  DEPT20 AND BTRTL NE SPACE.
  IF SY-SUBRC EQ 0.
    TSDEPT20 = T001P-BTEXT.
  ENDIF.

*********************************

*  SELECT SINGLE * FROM T001P WHERE BTRTL EQ WA_ZDMS1-DEPT1 AND BTRTL NE SPACE.
*  IF SY-SUBRC EQ 0.
*    TSDEPT1 = T001P-BTEXT.
*  ENDIF.
*  SELECT SINGLE * FROM T001P WHERE BTRTL EQ WA_ZDMS1-DEPT2 AND BTRTL NE SPACE.
*  IF SY-SUBRC EQ 0.
*    TSDEPT2 = T001P-BTEXT.
*  ENDIF.
*  SELECT SINGLE * FROM T001P WHERE BTRTL EQ WA_ZDMS1-DEPT3  AND BTRTL NE SPACE.
*  IF SY-SUBRC EQ 0.
*    TSDEPT3 = T001P-BTEXT.
*  ENDIF.
*  SELECT SINGLE * FROM T001P WHERE BTRTL EQ WA_ZDMS1-DEPT4 AND BTRTL NE SPACE.
*  IF SY-SUBRC EQ 0.
*    TSDEPT4 = T001P-BTEXT.
*  ENDIF.
*  SELECT SINGLE * FROM T001P WHERE BTRTL EQ WA_ZDMS1-DEPT5 AND BTRTL NE SPACE.
*  IF SY-SUBRC EQ 0.
*    TSDEPT5 = T001P-BTEXT.
*  ENDIF.
*  SELECT SINGLE * FROM T001P WHERE BTRTL EQ WA_ZDMS1-DEPT6 AND BTRTL NE SPACE.
*  IF SY-SUBRC EQ 0.
*    TSDEPT6 = T001P-BTEXT.
*  ENDIF.
*  SELECT SINGLE * FROM T001P WHERE BTRTL EQ WA_ZDMS1-DEPT7 AND BTRTL NE SPACE.
*  IF SY-SUBRC EQ 0.
*    TSDEPT7 = T001P-BTEXT.
*  ENDIF.
*  SELECT SINGLE * FROM T001P WHERE BTRTL EQ WA_ZDMS1-DEPT8 AND BTRTL NE SPACE.
*  IF SY-SUBRC EQ 0.
*    TSDEPT8 = T001P-BTEXT.
*  ENDIF.
*  SELECT SINGLE * FROM T001P WHERE BTRTL EQ WA_ZDMS1-DEPT9 AND BTRTL NE SPACE.
*  IF SY-SUBRC EQ 0.
*    TSDEPT9 = T001P-BTEXT.
*  ENDIF.
*
*  SELECT SINGLE * FROM T001P WHERE BTRTL EQ WA_ZDMS1-DEPT10 AND BTRTL NE SPACE.
*  IF SY-SUBRC EQ 0.
*    TSDEPT10 = T001P-BTEXT.
*  ENDIF.
**************************
*  SELECT SINGLE * FROM T001P WHERE BTRTL EQ WA_ZDMS1-DEPT11 AND BTRTL NE SPACE.
*  IF SY-SUBRC EQ 0.
*    TSDEPT11 = T001P-BTEXT.
*  ENDIF.
*  SELECT SINGLE * FROM T001P WHERE BTRTL EQ WA_ZDMS1-DEPT12 AND BTRTL NE SPACE.
*  IF SY-SUBRC EQ 0.
*    TSDEPT12 = T001P-BTEXT.
*  ENDIF.
*  SELECT SINGLE * FROM T001P WHERE BTRTL EQ WA_ZDMS1-DEPT13  AND BTRTL NE SPACE.
*  IF SY-SUBRC EQ 0.
*    TSDEPT13 = T001P-BTEXT.
*  ENDIF.
*  SELECT SINGLE * FROM T001P WHERE BTRTL EQ WA_ZDMS1-DEPT14 AND BTRTL NE SPACE.
*  IF SY-SUBRC EQ 0.
*    TSDEPT14 = T001P-BTEXT.
*  ENDIF.
*  SELECT SINGLE * FROM T001P WHERE BTRTL EQ WA_ZDMS1-DEPT15 AND BTRTL NE SPACE.
*  IF SY-SUBRC EQ 0.
*    TSDEPT15 = T001P-BTEXT.
*  ENDIF.
*  SELECT SINGLE * FROM T001P WHERE BTRTL EQ WA_ZDMS1-DEPT16 AND BTRTL NE SPACE.
*  IF SY-SUBRC EQ 0.
*    TSDEPT16 = T001P-BTEXT.
*  ENDIF.
*  SELECT SINGLE * FROM T001P WHERE BTRTL EQ WA_ZDMS1-DEPT17 AND BTRTL NE SPACE.
*  IF SY-SUBRC EQ 0.
*    TSDEPT17 = T001P-BTEXT.
*  ENDIF.
*  SELECT SINGLE * FROM T001P WHERE BTRTL EQ WA_ZDMS1-DEPT18 AND BTRTL NE SPACE.
*  IF SY-SUBRC EQ 0.
*    TSDEPT18 = T001P-BTEXT.
*  ENDIF.
*  SELECT SINGLE * FROM T001P WHERE BTRTL EQ WA_ZDMS1-DEPT19 AND BTRTL NE SPACE.
*  IF SY-SUBRC EQ 0.
*    TSDEPT19 = T001P-BTEXT.
*  ENDIF.
*
*  SELECT SINGLE * FROM T001P WHERE BTRTL EQ WA_ZDMS1-DEPT20 AND BTRTL NE SPACE.
*  IF SY-SUBRC EQ 0.
*    TSDEPT20 = T001P-BTEXT.
*  ENDIF.
ENDFORM.
*&---------------------------------------------------------------------*
*&      Form  UPDDEPT
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM UPDDEPT .
*  IF SDEPT1 IS NOT INITIAL.
*    ZDMS2_WA-MJAHR = YEAR.
*    ZDMS2_WA-MBLNR = CCNUM.
*    ZDMS2_WA-DEPT = SDEPT1.
*    MODIFY ZDMS2 FROM ZDMS2_WA.
*    CLEAR : ZDMS2_WA.
*  ENDIF.
*  IF SDEPT2 IS NOT INITIAL.
*    ZDMS2_WA-MJAHR = YEAR.
*    ZDMS2_WA-MBLNR = CCNUM.
*    ZDMS2_WA-DEPT = SDEPT2.
*    MODIFY ZDMS2 FROM ZDMS2_WA.
*    CLEAR : ZDMS2_WA.
*  ENDIF.
*  IF SDEPT3 IS NOT INITIAL.
*    ZDMS2_WA-MJAHR = YEAR.
*    ZDMS2_WA-MBLNR = CCNUM.
*    ZDMS2_WA-DEPT = SDEPT3.
*    MODIFY ZDMS2 FROM ZDMS2_WA.
*    CLEAR : ZDMS2_WA.
*  ENDIF.
*  IF SDEPT4 IS NOT INITIAL.
*    ZDMS2_WA-MJAHR = YEAR.
*    ZDMS2_WA-MBLNR = CCNUM.
*    ZDMS2_WA-DEPT = SDEPT4.
*    MODIFY ZDMS2 FROM ZDMS2_WA.
*    CLEAR : ZDMS2_WA.
*  ENDIF.
*  IF SDEPT5 IS NOT INITIAL.
*    ZDMS2_WA-MJAHR = YEAR.
*    ZDMS2_WA-MBLNR = CCNUM.
*    ZDMS2_WA-DEPT = SDEPT5.
*    MODIFY ZDMS2 FROM ZDMS2_WA.
*    CLEAR : ZDMS2_WA.
*  ENDIF.
*  IF SDEPT6 IS NOT INITIAL.
*    ZDMS2_WA-MJAHR = YEAR.
*    ZDMS2_WA-MBLNR = CCNUM.
*    ZDMS2_WA-DEPT = SDEPT6.
*    MODIFY ZDMS2 FROM ZDMS2_WA.
*    CLEAR : ZDMS2_WA.
*  ENDIF.
*  IF SDEPT7 IS NOT INITIAL.
*    ZDMS2_WA-MJAHR = YEAR.
*    ZDMS2_WA-MBLNR = CCNUM.
*    ZDMS2_WA-DEPT = SDEPT7.
*    MODIFY ZDMS2 FROM ZDMS2_WA.
*    CLEAR : ZDMS2_WA.
*  ENDIF.
*  IF SDEPT8 IS NOT INITIAL.
*    ZDMS2_WA-MJAHR = YEAR.
*    ZDMS2_WA-MBLNR = CCNUM.
*    ZDMS2_WA-DEPT = SDEPT8.
*    MODIFY ZDMS2 FROM ZDMS2_WA.
*    CLEAR : ZDMS2_WA.
*  ENDIF.
*  IF SDEPT8 IS NOT INITIAL.
*    ZDMS2_WA-MJAHR = YEAR.
*    ZDMS2_WA-MBLNR = CCNUM.
*    ZDMS2_WA-DEPT = SDEPT8.
*    MODIFY ZDMS2 FROM ZDMS2_WA.
*    CLEAR : ZDMS2_WA.
*  ENDIF.
*  IF SDEPT10 IS NOT INITIAL.
*    ZDMS2_WA-MJAHR = YEAR.
*    ZDMS2_WA-MBLNR = CCNUM.
*    ZDMS2_WA-DEPT = SDEPT10.
*    MODIFY ZDMS2 FROM ZDMS2_WA.
*    CLEAR : ZDMS2_WA.
*  ENDIF.
ENDFORM.
*&---------------------------------------------------------------------*
*&      Form  DEPTCHK
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM DEPTCHK.
*  CLEAR : S.
*  IF R33 EQ 'X'.
*    IF PERNR EQ '00014022'.
*      S = 1.
*    ENDIF.
*  ENDIF.
*
**  IF ZDMS1-WERKS EQ '1000' AND IMPDEPT EQ '1228'.
**    S = 1.
**  ENDIF.
*  READ TABLE IT_ZDMS1 INTO WA_ZDMS1 WITH KEY MJAHR = YEAR MBLNR = CCNUM DEPT1 = IMPDEPT.
*  IF SY-SUBRC EQ 0.
*    S = 1.
*  ENDIF.
*  READ TABLE IT_ZDMS1 INTO WA_ZDMS1 WITH KEY MJAHR = YEAR MBLNR = CCNUM DEPT2 = IMPDEPT.
*  IF SY-SUBRC EQ 0.
*    S = 1.
*  ENDIF.
*  READ TABLE IT_ZDMS1 INTO WA_ZDMS1 WITH KEY MJAHR = YEAR MBLNR = CCNUM DEPT3 = IMPDEPT.
*  IF SY-SUBRC EQ 0.
*    S = 1.
*  ENDIF.
*  READ TABLE IT_ZDMS1 INTO WA_ZDMS1 WITH KEY MJAHR = YEAR MBLNR = CCNUM DEPT4 = IMPDEPT.
*  IF SY-SUBRC EQ 0.
*    S = 1.
*  ENDIF.
*  READ TABLE IT_ZDMS1 INTO WA_ZDMS1 WITH KEY MJAHR = YEAR MBLNR = CCNUM DEPT5 = IMPDEPT.
*  IF SY-SUBRC EQ 0.
*    S = 1.
*  ENDIF.
*  READ TABLE IT_ZDMS1 INTO WA_ZDMS1 WITH KEY MJAHR = YEAR MBLNR = CCNUM DEPT6 = IMPDEPT.
*  IF SY-SUBRC EQ 0.
*    S = 1.
*  ENDIF.
*  READ TABLE IT_ZDMS1 INTO WA_ZDMS1 WITH KEY MJAHR = YEAR MBLNR = CCNUM DEPT7 = IMPDEPT.
*  IF SY-SUBRC EQ 0.
*    S = 1.
*  ENDIF.
*  READ TABLE IT_ZDMS1 INTO WA_ZDMS1 WITH KEY MJAHR = YEAR MBLNR = CCNUM DEPT8 = IMPDEPT.
*  IF SY-SUBRC EQ 0.
*    S = 1.
*  ENDIF.
*  READ TABLE IT_ZDMS1 INTO WA_ZDMS1 WITH KEY MJAHR = YEAR MBLNR = CCNUM DEPT9 = IMPDEPT.
*  IF SY-SUBRC EQ 0.
*    S = 1.
*  ENDIF.
*  READ TABLE IT_ZDMS1 INTO WA_ZDMS1 WITH KEY MJAHR = YEAR MBLNR = CCNUM DEPT10 = IMPDEPT.
*  IF SY-SUBRC EQ 0.
*    S = 1.
*  ENDIF.
*
*************************
*
*  READ TABLE IT_ZDMS1 INTO WA_ZDMS1 WITH KEY MJAHR = YEAR MBLNR = CCNUM DEPT11 = IMPDEPT.
*  IF SY-SUBRC EQ 0.
*    S = 1.
*  ENDIF.
*  READ TABLE IT_ZDMS1 INTO WA_ZDMS1 WITH KEY MJAHR = YEAR MBLNR = CCNUM DEPT12 = IMPDEPT.
*  IF SY-SUBRC EQ 0.
*    S = 1.
*  ENDIF.
*  READ TABLE IT_ZDMS1 INTO WA_ZDMS1 WITH KEY MJAHR = YEAR MBLNR = CCNUM DEPT13 = IMPDEPT.
*  IF SY-SUBRC EQ 0.
*    S = 1.
*  ENDIF.
*  READ TABLE IT_ZDMS1 INTO WA_ZDMS1 WITH KEY MJAHR = YEAR MBLNR = CCNUM DEPT14 = IMPDEPT.
*  IF SY-SUBRC EQ 0.
*    S = 1.
*  ENDIF.
*  READ TABLE IT_ZDMS1 INTO WA_ZDMS1 WITH KEY MJAHR = YEAR MBLNR = CCNUM DEPT15 = IMPDEPT.
*  IF SY-SUBRC EQ 0.
*    S = 1.
*  ENDIF.
*  READ TABLE IT_ZDMS1 INTO WA_ZDMS1 WITH KEY MJAHR = YEAR MBLNR = CCNUM DEPT16 = IMPDEPT.
*  IF SY-SUBRC EQ 0.
*    S = 1.
*  ENDIF.
*  READ TABLE IT_ZDMS1 INTO WA_ZDMS1 WITH KEY MJAHR = YEAR MBLNR = CCNUM DEPT17 = IMPDEPT.
*  IF SY-SUBRC EQ 0.
*    S = 1.
*  ENDIF.
*  READ TABLE IT_ZDMS1 INTO WA_ZDMS1 WITH KEY MJAHR = YEAR MBLNR = CCNUM DEPT18 = IMPDEPT.
*  IF SY-SUBRC EQ 0.
*    S = 1.
*  ENDIF.
*  READ TABLE IT_ZDMS1 INTO WA_ZDMS1 WITH KEY MJAHR = YEAR MBLNR = CCNUM DEPT19 = IMPDEPT.
*  IF SY-SUBRC EQ 0.
*    S = 1.
*  ENDIF.
*  READ TABLE IT_ZDMS1 INTO WA_ZDMS1 WITH KEY MJAHR = YEAR MBLNR = CCNUM DEPT20 = IMPDEPT.
*  IF SY-SUBRC EQ 0.
*    S = 1.
*  ENDIF.
*
*  IF S NE 1.
*    MESSAGE 'ENTER VALID EMPLOYEE CODE' TYPE 'E'.
*  ENDIF.

ENDFORM.
*&---------------------------------------------------------------------*
*&      Form  DEPTNAME
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM DEPTNAME .

*  SELECT SINGLE * FROM T001P WHERE BTRTL EQ ZDMS1-DEPT1 AND BTRTL NE SPACE.
*  IF SY-SUBRC EQ 0.
*    IDEPT1 = T001P-BTEXT.
*  ENDIF.
*  SELECT SINGLE * FROM T001P WHERE BTRTL EQ ZDMS1-DEPT2 AND BTRTL NE SPACE.
*  IF SY-SUBRC EQ 0.
*    IDEPT2 = T001P-BTEXT.
*  ENDIF.
*  SELECT SINGLE * FROM T001P WHERE BTRTL EQ ZDMS1-DEPT3 AND BTRTL NE SPACE.
*  IF SY-SUBRC EQ 0.
*    IDEPT3 = T001P-BTEXT.
*  ENDIF.
*  SELECT SINGLE * FROM T001P WHERE BTRTL EQ ZDMS1-DEPT4 AND BTRTL NE SPACE.
*  IF SY-SUBRC EQ 0.
*    IDEPT4 = T001P-BTEXT.
*  ENDIF.
*  SELECT SINGLE * FROM T001P WHERE BTRTL EQ ZDMS1-DEPT5 AND BTRTL NE SPACE.
*  IF SY-SUBRC EQ 0.
*    IDEPT5 = T001P-BTEXT.
*  ENDIF.
*  SELECT SINGLE * FROM T001P WHERE BTRTL EQ ZDMS1-DEPT6 AND BTRTL NE SPACE.
*  IF SY-SUBRC EQ 0.
*    IDEPT6 = T001P-BTEXT.
*  ENDIF.
*  SELECT SINGLE * FROM T001P WHERE BTRTL EQ ZDMS1-DEPT7 AND BTRTL NE SPACE.
*  IF SY-SUBRC EQ 0.
*    IDEPT7 = T001P-BTEXT.
*  ENDIF.
*  SELECT SINGLE * FROM T001P WHERE BTRTL EQ ZDMS1-DEPT8 AND BTRTL NE SPACE.
*  IF SY-SUBRC EQ 0.
*    IDEPT8 = T001P-BTEXT.
*  ENDIF.
*  SELECT SINGLE * FROM T001P WHERE BTRTL EQ ZDMS1-DEPT9 AND BTRTL NE SPACE.
*  IF SY-SUBRC EQ 0.
*    IDEPT9 = T001P-BTEXT.
*  ENDIF.
*  SELECT SINGLE * FROM T001P WHERE BTRTL EQ ZDMS1-DEPT10 AND BTRTL NE SPACE.
*  IF SY-SUBRC EQ 0.
*    IDEPT10 = T001P-BTEXT.
*  ENDIF.
*********************************
*  SELECT SINGLE * FROM T001P WHERE BTRTL EQ ZDMS1-DEPT11 AND BTRTL NE SPACE.
*  IF SY-SUBRC EQ 0.
*    IDEPT11 = T001P-BTEXT.
*  ENDIF.
*  SELECT SINGLE * FROM T001P WHERE BTRTL EQ ZDMS1-DEPT12 AND BTRTL NE SPACE.
*  IF SY-SUBRC EQ 0.
*    IDEPT12 = T001P-BTEXT.
*  ENDIF.
*  SELECT SINGLE * FROM T001P WHERE BTRTL EQ ZDMS1-DEPT13 AND BTRTL NE SPACE.
*  IF SY-SUBRC EQ 0.
*    IDEPT13 = T001P-BTEXT.
*  ENDIF.
*  SELECT SINGLE * FROM T001P WHERE BTRTL EQ ZDMS1-DEPT14 AND BTRTL NE SPACE.
*  IF SY-SUBRC EQ 0.
*    IDEPT14 = T001P-BTEXT.
*  ENDIF.
*  SELECT SINGLE * FROM T001P WHERE BTRTL EQ ZDMS1-DEPT15 AND BTRTL NE SPACE.
*  IF SY-SUBRC EQ 0.
*    IDEPT15 = T001P-BTEXT.
*  ENDIF.
*  SELECT SINGLE * FROM T001P WHERE BTRTL EQ ZDMS1-DEPT16 AND BTRTL NE SPACE.
*  IF SY-SUBRC EQ 0.
*    IDEPT16 = T001P-BTEXT.
*  ENDIF.
*  SELECT SINGLE * FROM T001P WHERE BTRTL EQ ZDMS1-DEPT17 AND BTRTL NE SPACE.
*  IF SY-SUBRC EQ 0.
*    IDEPT17 = T001P-BTEXT.
*  ENDIF.
*  SELECT SINGLE * FROM T001P WHERE BTRTL EQ ZDMS1-DEPT18 AND BTRTL NE SPACE.
*  IF SY-SUBRC EQ 0.
*    IDEPT18 = T001P-BTEXT.
*  ENDIF.
*  SELECT SINGLE * FROM T001P WHERE BTRTL EQ ZDMS1-DEPT19 AND BTRTL NE SPACE.
*  IF SY-SUBRC EQ 0.
*    IDEPT19 = T001P-BTEXT.
*  ENDIF.
*  SELECT SINGLE * FROM T001P WHERE BTRTL EQ ZDMS1-DEPT20 AND BTRTL NE SPACE.
*  IF SY-SUBRC EQ 0.
*    IDEPT20 = T001P-BTEXT.
*  ENDIF.
ENDFORM.
*&---------------------------------------------------------------------*
*&      Form  DATAUPDATE
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM DATAUPDATE.

*  LOOP AT IT_ZDMS2 INTO WA_ZDMS2 WHERE DEPT EQ ZDMS1-DEPT1.
*    SELECT SINGLE * FROM PA0001 WHERE PERNR EQ WA_ZDMS2-PERNR AND ENDDA GE SY-DATUM.
*    IF SY-SUBRC EQ 0.
*      INAME1 = PA0001-ENAME.
*    ENDIF.
*    APPROVE1 = WA_ZDMS2-APPROVE.
*    REJECT1 = WA_ZDMS2-REJECT.
*    ATEXT1 = WA_ZDMS2-ATEXT1.
*    ADATE1 = WA_ZDMS2-TDATE1.
*    ADATE6 = WA_ZDMS2-CTDATE1.
**    AFOLW1 = WA_ZDMS2-FOLW1.
*    ATEXT2 = WA_ZDMS2-ATEXT2.
*    ADATE2 = WA_ZDMS2-TDATE2.
*    ADATE7 = WA_ZDMS2-CTDATE2.
**    AFOLW2 = WA_ZDMS2-FOLW2.
*    ATEXT3 = WA_ZDMS2-ATEXT3.
*    ADATE3 = WA_ZDMS2-TDATE3.
*    ADATE8 = WA_ZDMS2-CTDATE3.
**    AFOLW3 = WA_ZDMS2-FOLW3.
*    ATEXT4 = WA_ZDMS2-ATEXT4.
*    ADATE4 = WA_ZDMS2-TDATE4.
*    ADATE9 = WA_ZDMS2-CTDATE4.
**    AFOLW4 = WA_ZDMS2-FOLW4.
*    ATEXT5 = WA_ZDMS2-ATEXT5.
*    ADATE5 = WA_ZDMS2-TDATE5.
*    ADATE10 = WA_ZDMS2-CTDATE5.
**    AFOLW5 = WA_ZDMS2-FOLW5.
*    AREM1 = WA_ZDMS2-REM1.
*    AREM2 = WA_ZDMS2-REM2.
*    AREM3 = WA_ZDMS2-REM3.
*    AREM4 = WA_ZDMS2-REM4.
*    AREM5 = WA_ZDMS2-REM5.
*  ENDLOOP.
*
*  LOOP AT IT_ZDMS2 INTO WA_ZDMS2 WHERE DEPT EQ ZDMS1-DEPT2.
*    SELECT SINGLE * FROM PA0001 WHERE PERNR EQ WA_ZDMS2-PERNR AND ENDDA GE SY-DATUM.
*    IF SY-SUBRC EQ 0.
*      INAME2 = PA0001-ENAME.
*    ENDIF.
*    APPROVE2 = WA_ZDMS2-APPROVE.
*    REJECT2 = WA_ZDMS2-REJECT.
*    BTEXT1 = WA_ZDMS2-ATEXT1.
*    BDATE1 = WA_ZDMS2-TDATE1.
*    BDATE6 = WA_ZDMS2-CTDATE1.
**    BFOLW1 = WA_ZDMS2-FOLW1.
*    BTEXT2 = WA_ZDMS2-ATEXT2.
*    BDATE2 = WA_ZDMS2-TDATE2.
*    BDATE7 = WA_ZDMS2-CTDATE2.
**    BFOLW2 = WA_ZDMS2-FOLW2.
*    BTEXT3 = WA_ZDMS2-ATEXT3.
*    BDATE3 = WA_ZDMS2-TDATE3.
*    BDATE8 = WA_ZDMS2-CTDATE3.
**    BFOLW3 = WA_ZDMS2-FOLW3.
*    BTEXT4 = WA_ZDMS2-ATEXT4.
*    BDATE4 = WA_ZDMS2-TDATE4.
*    BDATE9 = WA_ZDMS2-CTDATE4.
**    BFOLW4 = WA_ZDMS2-FOLW4.
*    BTEXT5 = WA_ZDMS2-ATEXT5.
*    BDATE5 = WA_ZDMS2-TDATE5.
*    BDATE10 = WA_ZDMS2-CTDATE5.
**    BFOLW5 = WA_ZDMS2-FOLW5.
*    BREM1 = WA_ZDMS2-REM1.
*    BREM2 = WA_ZDMS2-REM2.
*    BREM3 = WA_ZDMS2-REM3.
*    BREM4 = WA_ZDMS2-REM4.
*    BREM5 = WA_ZDMS2-REM5.
*  ENDLOOP.
*
*  LOOP AT IT_ZDMS2 INTO WA_ZDMS2 WHERE DEPT EQ ZDMS1-DEPT3.
*    SELECT SINGLE * FROM PA0001 WHERE PERNR EQ WA_ZDMS2-PERNR AND ENDDA GE SY-DATUM.
*    IF SY-SUBRC EQ 0.
*      INAME3 = PA0001-ENAME.
*    ENDIF.
*    APPROVE3 = WA_ZDMS2-APPROVE.
*    REJECT3 = WA_ZDMS2-REJECT.
*    CTEXT1 = WA_ZDMS2-ATEXT1.
*    CDATE1 = WA_ZDMS2-TDATE1.
*    CDATE6 = WA_ZDMS2-CTDATE1.
**    CFOLW1 = WA_ZDMS2-FOLW1.
*    CTEXT2 = WA_ZDMS2-ATEXT2.
*    CDATE2 = WA_ZDMS2-TDATE2.
*    CDATE7 = WA_ZDMS2-CTDATE2.
**    CFOLW2 = WA_ZDMS2-FOLW2.
*    CTEXT3 = WA_ZDMS2-ATEXT3.
*    CDATE3 = WA_ZDMS2-TDATE3.
*    CDATE8 = WA_ZDMS2-CTDATE3.
**    CFOLW3 = WA_ZDMS2-FOLW3.
*    CTEXT4 = WA_ZDMS2-ATEXT4.
*    CDATE4 = WA_ZDMS2-TDATE4.
*    CDATE9 = WA_ZDMS2-CTDATE4.
**    CFOLW4 = WA_ZDMS2-FOLW4.
*    CTEXT5 = WA_ZDMS2-ATEXT5.
*    CDATE5 = WA_ZDMS2-TDATE5.
*    CDATE10 = WA_ZDMS2-CTDATE5.
**    CFOLW5 = WA_ZDMS2-FOLW5.
*    CREM1 = WA_ZDMS2-REM1.
*    CREM2 = WA_ZDMS2-REM2.
*    CREM3 = WA_ZDMS2-REM3.
*    CREM4 = WA_ZDMS2-REM4.
*    CREM5 = WA_ZDMS2-REM5.
*  ENDLOOP.
*
*  LOOP AT IT_ZDMS2 INTO WA_ZDMS2 WHERE DEPT EQ ZDMS1-DEPT4.
*    SELECT SINGLE * FROM PA0001 WHERE PERNR EQ WA_ZDMS2-PERNR AND ENDDA GE SY-DATUM.
*    IF SY-SUBRC EQ 0.
*      INAME4 = PA0001-ENAME.
*    ENDIF.
*    APPROVE4 = WA_ZDMS2-APPROVE.
*    REJECT4 = WA_ZDMS2-REJECT.
*    DTEXT1 = WA_ZDMS2-ATEXT1.
*    DDATE1 = WA_ZDMS2-TDATE1.
*    DDATE6 = WA_ZDMS2-CTDATE1.
**    DFOLW1 = WA_ZDMS2-FOLW1.
*    DTEXT2 = WA_ZDMS2-ATEXT2.
*    DDATE2 = WA_ZDMS2-TDATE2.
*    DDATE7 = WA_ZDMS2-CTDATE2.
**    DFOLW2 = WA_ZDMS2-FOLW2.
*    DTEXT3 = WA_ZDMS2-ATEXT3.
*    DDATE3 = WA_ZDMS2-TDATE3.
*    DDATE8 = WA_ZDMS2-CTDATE3.
**    DFOLW3 = WA_ZDMS2-FOLW3.
*    DTEXT4 = WA_ZDMS2-ATEXT4.
*    DDATE4 = WA_ZDMS2-TDATE4.
*    DDATE9 = WA_ZDMS2-CTDATE4.
**    DFOLW4 = WA_ZDMS2-FOLW4.
*    DTEXT5 = WA_ZDMS2-ATEXT5.
*    DDATE5 = WA_ZDMS2-TDATE5.
*    DDATE10 = WA_ZDMS2-CTDATE5.
**    DFOLW5 = WA_ZDMS2-FOLW5.
*    DREM1 = WA_ZDMS2-REM1.
*    DREM2 = WA_ZDMS2-REM2.
*    DREM3 = WA_ZDMS2-REM3.
*    DREM4 = WA_ZDMS2-REM4.
*    DREM5 = WA_ZDMS2-REM5.
*  ENDLOOP.
*
*  LOOP AT IT_ZDMS2 INTO WA_ZDMS2 WHERE DEPT EQ ZDMS1-DEPT5.
*    SELECT SINGLE * FROM PA0001 WHERE PERNR EQ WA_ZDMS2-PERNR AND ENDDA GE SY-DATUM.
*    IF SY-SUBRC EQ 0.
*      INAME5 = PA0001-ENAME.
*    ENDIF.
*    APPROVE5 = WA_ZDMS2-APPROVE.
*    REJECT5 = WA_ZDMS2-REJECT.
*    ETEXT1 = WA_ZDMS2-ATEXT1.
*    EDATE1 = WA_ZDMS2-TDATE1.
*    EDATE6 = WA_ZDMS2-CTDATE1.
**    EFOLW1 = WA_ZDMS2-FOLW1.
*    ETEXT2 = WA_ZDMS2-ATEXT2.
*    EDATE2 = WA_ZDMS2-TDATE2.
*    EDATE7 = WA_ZDMS2-CTDATE2.
**    EFOLW2 = WA_ZDMS2-FOLW2.
*    ETEXT3 = WA_ZDMS2-ATEXT3.
*    EDATE3 = WA_ZDMS2-TDATE3.
*    EDATE8 = WA_ZDMS2-CTDATE3.
**    EFOLW3 = WA_ZDMS2-FOLW3.
*    ETEXT4 = WA_ZDMS2-ATEXT4.
*    EDATE4 = WA_ZDMS2-TDATE4.
*    EDATE9 = WA_ZDMS2-CTDATE4.
**    EFOLW4 = WA_ZDMS2-FOLW4.
*    ETEXT5 = WA_ZDMS2-ATEXT5.
*    EDATE5 = WA_ZDMS2-TDATE5.
*    EDATE10 = WA_ZDMS2-CTDATE5.
**    EFOLW5 = WA_ZDMS2-FOLW5.
*    EREM1 = WA_ZDMS2-REM1.
*    EREM2 = WA_ZDMS2-REM2.
*    EREM3 = WA_ZDMS2-REM3.
*    EREM4 = WA_ZDMS2-REM4.
*    EREM5 = WA_ZDMS2-REM5.
*  ENDLOOP.
*
*  LOOP AT IT_ZDMS2 INTO WA_ZDMS2 WHERE DEPT EQ ZDMS1-DEPT6.
*    SELECT SINGLE * FROM PA0001 WHERE PERNR EQ WA_ZDMS2-PERNR AND ENDDA GE SY-DATUM.
*    IF SY-SUBRC EQ 0.
*      INAME6 = PA0001-ENAME.
*    ENDIF.
*    APPROVE6 = WA_ZDMS2-APPROVE.
*    REJECT6 = WA_ZDMS2-REJECT.
*    FTEXT1 = WA_ZDMS2-ATEXT1.
*    FDATE1 = WA_ZDMS2-TDATE1.
*    FDATE6 = WA_ZDMS2-CTDATE1.
**    FFOLW1 = WA_ZDMS2-FOLW1.
*    FTEXT2 = WA_ZDMS2-ATEXT2.
*    FDATE2 = WA_ZDMS2-TDATE2.
*    FDATE7 = WA_ZDMS2-CTDATE2.
**    FFOLW2 = WA_ZDMS2-FOLW2.
*    FTEXT3 = WA_ZDMS2-ATEXT3.
*    FDATE3 = WA_ZDMS2-TDATE3.
*    FDATE8 = WA_ZDMS2-CTDATE3.
**    FFOLW3 = WA_ZDMS2-FOLW3.
*    FTEXT4 = WA_ZDMS2-ATEXT4.
*    FDATE4 = WA_ZDMS2-TDATE4.
*    FDATE9 = WA_ZDMS2-CTDATE4.
**    FFOLW4 = WA_ZDMS2-FOLW4.
*    FTEXT5 = WA_ZDMS2-ATEXT5.
*    FDATE5 = WA_ZDMS2-TDATE5.
*    FDATE10 = WA_ZDMS2-CTDATE5.
**    FFOLW5 = WA_ZDMS2-FOLW5.
*    FREM1 = WA_ZDMS2-REM1.
*    FREM2 = WA_ZDMS2-REM2.
*    FREM3 = WA_ZDMS2-REM3.
*    FREM4 = WA_ZDMS2-REM4.
*    FREM5 = WA_ZDMS2-REM5.
*  ENDLOOP.
*
*  LOOP AT IT_ZDMS2 INTO WA_ZDMS2 WHERE DEPT EQ ZDMS1-DEPT7.
*    SELECT SINGLE * FROM PA0001 WHERE PERNR EQ WA_ZDMS2-PERNR AND ENDDA GE SY-DATUM.
*    IF SY-SUBRC EQ 0.
*      INAME7 = PA0001-ENAME.
*    ENDIF.
*    APPROVE7 = WA_ZDMS2-APPROVE.
*    REJECT7 = WA_ZDMS2-REJECT.
*    GTEXT1 = WA_ZDMS2-ATEXT1.
*    GDATE1 = WA_ZDMS2-TDATE1.
*    GDATE6 = WA_ZDMS2-CTDATE1.
**    GFOLW1 = WA_ZDMS2-FOLW1.
*    GTEXT2 = WA_ZDMS2-ATEXT2.
*    GDATE2 = WA_ZDMS2-TDATE2.
*    GDATE7 = WA_ZDMS2-CTDATE2.
**    GFOLW2 = WA_ZDMS2-FOLW2.
*    GTEXT3 = WA_ZDMS2-ATEXT3.
*    GDATE3 = WA_ZDMS2-TDATE3.
*    GDATE8 = WA_ZDMS2-CTDATE3.
**    GFOLW3 = WA_ZDMS2-FOLW3.
*    GTEXT4 = WA_ZDMS2-ATEXT4.
*    GDATE4 = WA_ZDMS2-TDATE4.
*    GDATE9 = WA_ZDMS2-CTDATE4.
**    GFOLW4 = WA_ZDMS2-FOLW4.
*    GTEXT5 = WA_ZDMS2-ATEXT5.
*    GDATE5 = WA_ZDMS2-TDATE5.
*    GDATE10 = WA_ZDMS2-CTDATE5.
**    GFOLW5 = WA_ZDMS2-FOLW5.
*    GREM1 = WA_ZDMS2-REM1.
*    GREM2 = WA_ZDMS2-REM2.
*    GREM3 = WA_ZDMS2-REM3.
*    GREM4 = WA_ZDMS2-REM4.
*    GREM5 = WA_ZDMS2-REM5.
*  ENDLOOP.
*
*  LOOP AT IT_ZDMS2 INTO WA_ZDMS2 WHERE DEPT EQ ZDMS1-DEPT8.
*    SELECT SINGLE * FROM PA0001 WHERE PERNR EQ WA_ZDMS2-PERNR AND ENDDA GE SY-DATUM.
*    IF SY-SUBRC EQ 0.
*      INAME8 = PA0001-ENAME.
*    ENDIF.
*    APPROVE8 = WA_ZDMS2-APPROVE.
*    REJECT8 = WA_ZDMS2-REJECT.
*    HTEXT1 = WA_ZDMS2-ATEXT1.
*    HDATE1 = WA_ZDMS2-TDATE1.
*    HDATE6 = WA_ZDMS2-CTDATE1.
**    HFOLW1 = WA_ZDMS2-FOLW1.
*    HTEXT2 = WA_ZDMS2-ATEXT2.
*    HDATE2 = WA_ZDMS2-TDATE2.
*    HDATE7 = WA_ZDMS2-CTDATE2.
**    HFOLW2 = WA_ZDMS2-FOLW2.
*    HTEXT3 = WA_ZDMS2-ATEXT3.
*    HDATE3 = WA_ZDMS2-TDATE3.
*    HDATE8 = WA_ZDMS2-CTDATE3.
**    HFOLW3 = WA_ZDMS2-FOLW3.
*    HTEXT4 = WA_ZDMS2-ATEXT4.
*    HDATE4 = WA_ZDMS2-TDATE4.
*    HDATE9 = WA_ZDMS2-CTDATE4.
**    HFOLW4 = WA_ZDMS2-FOLW4.
*    HTEXT5 = WA_ZDMS2-ATEXT5.
*    HDATE5 = WA_ZDMS2-TDATE5.
*    HDATE10 = WA_ZDMS2-CTDATE5.
**    HFOLW5 = WA_ZDMS2-FOLW5.
*    HREM1 = WA_ZDMS2-REM1.
*    HREM2 = WA_ZDMS2-REM2.
*    HREM3 = WA_ZDMS2-REM3.
*    HREM4 = WA_ZDMS2-REM4.
*    HREM5 = WA_ZDMS2-REM5.
*  ENDLOOP.
*
*  LOOP AT IT_ZDMS2 INTO WA_ZDMS2 WHERE DEPT EQ ZDMS1-DEPT9.
*    SELECT SINGLE * FROM PA0001 WHERE PERNR EQ WA_ZDMS2-PERNR AND ENDDA GE SY-DATUM.
*    IF SY-SUBRC EQ 0.
*      INAME9 = PA0001-ENAME.
*    ENDIF.
*    APPROVE9 = WA_ZDMS2-APPROVE.
*    REJECT9 = WA_ZDMS2-REJECT.
*    ITEXT1 = WA_ZDMS2-ATEXT1.
*    IDATE1 = WA_ZDMS2-TDATE1.
*    IDATE6 = WA_ZDMS2-CTDATE1.
**    IFOLW1 = WA_ZDMS2-FOLW1.
*    ITEXT2 = WA_ZDMS2-ATEXT2.
*    IDATE2 = WA_ZDMS2-TDATE2.
*    IDATE7 = WA_ZDMS2-CTDATE2.
**    IFOLW2 = WA_ZDMS2-FOLW2.
*    ITEXT3 = WA_ZDMS2-ATEXT3.
*    IDATE3 = WA_ZDMS2-TDATE3.
*    IDATE8 = WA_ZDMS2-CTDATE3.
**    IFOLW3 = WA_ZDMS2-FOLW3.
*    ITEXT4 = WA_ZDMS2-ATEXT4.
*    IDATE4 = WA_ZDMS2-TDATE4.
*    IDATE9 = WA_ZDMS2-CTDATE4.
**    IFOLW4 = WA_ZDMS2-FOLW4.
*    ITEXT5 = WA_ZDMS2-ATEXT5.
*    IDATE5 = WA_ZDMS2-TDATE5.
*    IDATE10 = WA_ZDMS2-CTDATE5.
**    IFOLW5 = WA_ZDMS2-FOLW5.
*    IREM1 = WA_ZDMS2-REM1.
*    IREM2 = WA_ZDMS2-REM2.
*    IREM3 = WA_ZDMS2-REM3.
*    IREM4 = WA_ZDMS2-REM4.
*    IREM5 = WA_ZDMS2-REM5.
*  ENDLOOP.
*
*  LOOP AT IT_ZDMS2 INTO WA_ZDMS2 WHERE DEPT EQ ZDMS1-DEPT10.
*    SELECT SINGLE * FROM PA0001 WHERE PERNR EQ WA_ZDMS2-PERNR AND ENDDA GE SY-DATUM.
*    IF SY-SUBRC EQ 0.
*      INAME10 = PA0001-ENAME.
*    ENDIF.
*    APPROVE10 = WA_ZDMS2-APPROVE.
*    REJECT10 = WA_ZDMS2-REJECT.
*    JTEXT1 = WA_ZDMS2-ATEXT1.
*    JDATE1 = WA_ZDMS2-TDATE1.
*    JDATE6 = WA_ZDMS2-CTDATE1.
**    JFOLW1 = WA_ZDMS2-FOLW1.
*    JTEXT2 = WA_ZDMS2-ATEXT2.
*    JDATE2 = WA_ZDMS2-TDATE2.
*    JDATE7 = WA_ZDMS2-CTDATE2.
**    JFOLW2 = WA_ZDMS2-FOLW2.
*    JTEXT3 = WA_ZDMS2-ATEXT3.
*    JDATE3 = WA_ZDMS2-TDATE3.
*    JDATE8 = WA_ZDMS2-CTDATE3.
**    JFOLW3 = WA_ZDMS2-FOLW3.
*    JTEXT4 = WA_ZDMS2-ATEXT4.
*    JDATE4 = WA_ZDMS2-TDATE4.
*    JDATE9 = WA_ZDMS2-CTDATE4.
**    JFOLW4 = WA_ZDMS2-FOLW4.
*    JTEXT5 = WA_ZDMS2-ATEXT5.
*    JDATE5 = WA_ZDMS2-TDATE5.
*    JDATE10 = WA_ZDMS2-CTDATE5.
**    JFOLW5 = WA_ZDMS2-FOLW5.
*    JREM1 = WA_ZDMS2-REM1.
*    JREM2 = WA_ZDMS2-REM2.
*    JREM3 = WA_ZDMS2-REM3.
*    JREM4 = WA_ZDMS2-REM4.
*    JREM5 = WA_ZDMS2-REM5.
*  ENDLOOP.

ENDFORM.
*&---------------------------------------------------------------------*
*&      Form  DEPT
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM DEPT .

*IF DEPT1 NE SPACE.
*  ZDMS2_WA-MJAHR =
ENDFORM.
*&---------------------------------------------------------------------*
*&      Module  STATUS_9003  OUTPUT
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
MODULE STATUS_9003 OUTPUT.
  SET PF-STATUS 'CREATE'.
  SET TITLEBAR 'FOLLOWUP'.

  IF CC1 EQ 'X' AND R7 EQ 'X' .
*    OR R8 EQ 'X' OR R81 EQ 'X' OR R9 EQ 'X' OR R91 EQ 'X'.
    IF R7 EQ 'X'.
      PERFORM DEPTQA.
      SELECT SINGLE * FROM ZDMS4 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM.
      IF SY-SUBRC EQ 0.
        IF ZDMS4-CL1 EQ 'X' OR ZDMS4-QHCL1 EQ 'X'.
          LOOP AT SCREEN.
            SCREEN-INPUT = 0.
            MODIFY SCREEN.
          ENDLOOP.
        ELSE.
          LOOP AT SCREEN.
            IF SCREEN-GROUP1 EQ '001'.
              SCREEN-INPUT = 0.
              MODIFY SCREEN.
            ELSEIF SCREEN-GROUP2 EQ '001'.
              SCREEN-INPUT = 0.
              MODIFY SCREEN.
            ENDIF.
            IF SCREEN-GROUP1 EQ '002'.
              SCREEN-INPUT = 0.
              MODIFY SCREEN.
            ELSEIF SCREEN-GROUP2 EQ '002'.
              SCREEN-INPUT = 0.
              MODIFY SCREEN.
            ENDIF.
          ENDLOOP.
        ENDIF.
      ENDIF.
    ENDIF.



    PERFORM INITDET.
    PERFORM DEPTNAME.
    PERFORM DATAUPDATEFOL.

  ENDIF.

ENDMODULE.
*&---------------------------------------------------------------------*
*&      Module  USER_COMMAND_9003  INPUT
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
MODULE USER_COMMAND_9003 INPUT.

  CASE OK.
    WHEN 'SAVE'.
      IF CC1  EQ 'X' AND R7 EQ 'X'.
        PERFORM SDEPT1.
        LEAVE TO TRANSACTION 'ZQMS'.
      ENDIF.
      LEAVE TO TRANSACTION 'ZQMS'.
*      ENDIF.
    WHEN 'BACK' OR 'EXIT'.
      SET SCREEN 0.
      LEAVE SCREEN.

  ENDCASE.

*        SELECT SINGLE * FROM PA0001 WHERE PERNR EQ PERNR AND BTRTL EQ ZDMS1-DEPT2.
*        IF SY-SUBRC EQ 0.
*        IF ZDMS1-DEPT2 NE SPACE.
*          ZDMS3_WA-MJAHR = YEAR.
*          ZDMS3_WA-MBLNR = CCNUM.
*          ZDMS3_WA-DEPT = ZDMS1-DEPT2.
*          ZDMS3_WA-BUDAT = SY-DATUM.
*          ZDMS3_WA-PERNR = PERNR.
*          ZDMS3_WA-ATEXT1 =   LTEXT1.
*          ZDMS3_WA-TDATE1 = LDATE1.
*          ZDMS3_WA-CTDATE1 = LCDATE1.
*          ZDMS3_WA-ATEXT2 =   LTEXT2.
*          ZDMS3_WA-TDATE2 = LDATE2.
*          ZDMS3_WA-CTDATE2 = LCDATE2.
*          ZDMS3_WA-ATEXT3 =   LTEXT3.
*          ZDMS3_WA-TDATE3 = LDATE3.
*          ZDMS3_WA-CTDATE3 = LCDATE3.
*          ZDMS3_WA-ATEXT4 =   LTEXT4.
*          ZDMS3_WA-TDATE4 = LDATE4.
*          ZDMS3_WA-CTDATE4 = LCDATE4.
*          ZDMS3_WA-ATEXT5 =   LTEXT5.
*          ZDMS3_WA-TDATE5 = LDATE5.
*          ZDMS3_WA-CTDATE5 = LCDATE5.
*          MODIFY ZDMS3 FROM ZDMS3_WA.
*          CLEAR : ZDMS3_WA.
*          A = 1.
*        ENDIF.
*
**        SELECT SINGLE * FROM PA0001 WHERE PERNR EQ PERNR AND BTRTL EQ ZDMS1-DEPT3.
**        IF SY-SUBRC EQ 0.
*        IF ZDMS1-DEPT3 NE SPACE.
*          ZDMS3_WA-MJAHR = YEAR.
*          ZDMS3_WA-MBLNR = CCNUM.
*          ZDMS3_WA-DEPT = ZDMS1-DEPT3.
*          ZDMS3_WA-BUDAT = SY-DATUM.
*          ZDMS3_WA-PERNR = PERNR.
*          ZDMS3_WA-ATEXT1 =   MTEXT1.
*          ZDMS3_WA-TDATE1 = MDATE1.
*          ZDMS3_WA-CTDATE1 = MCDATE1.
*          ZDMS3_WA-ATEXT2 =   MTEXT2.
*          ZDMS3_WA-TDATE2 = MDATE2.
*          ZDMS3_WA-CTDATE2 = MCDATE2.
*          ZDMS3_WA-ATEXT3 =   MTEXT3.
*          ZDMS3_WA-TDATE3 = MDATE3.
*          ZDMS3_WA-CTDATE3 = MCDATE3.
*          ZDMS3_WA-ATEXT4 =   MTEXT4.
*          ZDMS3_WA-TDATE4 = MDATE4.
*          ZDMS3_WA-CTDATE4 = MCDATE4.
*          ZDMS3_WA-ATEXT5 =   MTEXT5.
*          ZDMS3_WA-TDATE5 = MDATE5.
*          ZDMS3_WA-CTDATE5 = MCDATE5.
*          MODIFY ZDMS3 FROM ZDMS3_WA.
*          CLEAR : ZDMS3_WA.
*          A = 1.
*        ENDIF.
**
**        SELECT SINGLE * FROM PA0001 WHERE PERNR EQ PERNR AND BTRTL EQ ZDMS1-DEPT4.
**        IF SY-SUBRC EQ 0.
*        IF ZDMS1-DEPT4 NE SPACE.
*          ZDMS3_WA-MJAHR = YEAR.
*          ZDMS3_WA-MBLNR = CCNUM.
*          ZDMS3_WA-DEPT = ZDMS1-DEPT4.
*          ZDMS3_WA-BUDAT = SY-DATUM.
*          ZDMS3_WA-PERNR = PERNR.
*          ZDMS3_WA-ATEXT1 =   NTEXT1.
*          ZDMS3_WA-TDATE1 = NDATE1.
*          ZDMS3_WA-CTDATE1 = NCDATE1.
*          ZDMS3_WA-ATEXT2 =   NTEXT2.
*          ZDMS3_WA-TDATE2 = NDATE2.
*          ZDMS3_WA-CTDATE2 = NCDATE2.
*          ZDMS3_WA-ATEXT3 =   NTEXT3.
*          ZDMS3_WA-TDATE3 = NDATE3.
*          ZDMS3_WA-CTDATE3 = NCDATE3.
*          ZDMS3_WA-ATEXT4 =   NTEXT4.
*          ZDMS3_WA-TDATE4 = NDATE4.
*          ZDMS3_WA-CTDATE4 = NCDATE4.
*          ZDMS3_WA-ATEXT5 =   NTEXT5.
*          ZDMS3_WA-TDATE5 = NDATE5.
*          ZDMS3_WA-CTDATE5 = NCDATE5.
*          MODIFY ZDMS3 FROM ZDMS3_WA.
*          CLEAR : ZDMS3_WA.
*          A = 1.
*        ENDIF.
**
**        SELECT SINGLE * FROM PA0001 WHERE PERNR EQ PERNR AND BTRTL EQ ZDMS1-DEPT5.
**        IF SY-SUBRC EQ 0.
*        IF ZDMS1-DEPT5 NE SPACE.
*          ZDMS3_WA-MJAHR = YEAR.
*          ZDMS3_WA-MBLNR = CCNUM.
*          ZDMS3_WA-DEPT = ZDMS1-DEPT5.
*          ZDMS3_WA-BUDAT = SY-DATUM.
*          ZDMS3_WA-PERNR = PERNR.
*          ZDMS3_WA-ATEXT1 = OTEXT1.
*          ZDMS3_WA-TDATE1 = ODATE1.
*          ZDMS3_WA-CTDATE1 = OCDATE1.
*          ZDMS3_WA-ATEXT2 =   OTEXT2.
*          ZDMS3_WA-TDATE2 = ODATE2.
*          ZDMS3_WA-CTDATE2 = OCDATE2.
*          ZDMS3_WA-ATEXT3 =   OTEXT3.
*          ZDMS3_WA-TDATE3 = ODATE3.
*          ZDMS3_WA-CTDATE3 = OCDATE3.
*          ZDMS3_WA-ATEXT4 =   OTEXT4.
*          ZDMS3_WA-TDATE4 = ODATE4.
*          ZDMS3_WA-CTDATE4 = OCDATE4.
*          ZDMS3_WA-ATEXT5 =   OTEXT5.
*          ZDMS3_WA-TDATE5 = ODATE5.
*          ZDMS3_WA-CTDATE5 = OCDATE5.
*          MODIFY ZDMS3 FROM ZDMS3_WA.
*          CLEAR : ZDMS3_WA.
*          A = 1.
*        ENDIF.
**
**        SELECT SINGLE * FROM PA0001 WHERE PERNR EQ PERNR AND BTRTL EQ ZDMS1-DEPT6.
**        IF SY-SUBRC EQ 0.
*        IF ZDMS1-DEPT6 NE SPACE.
*          ZDMS3_WA-MJAHR = YEAR.
*          ZDMS3_WA-MBLNR = CCNUM.
*          ZDMS3_WA-DEPT = ZDMS1-DEPT6.
*          ZDMS3_WA-BUDAT = SY-DATUM.
*          ZDMS3_WA-PERNR = PERNR.
*          ZDMS3_WA-ATEXT1 =   PTEXT1.
*          ZDMS3_WA-TDATE1 = PDATE1.
*          ZDMS3_WA-CTDATE1 = PCDATE1.
*          ZDMS3_WA-ATEXT2 =   PTEXT2.
*          ZDMS3_WA-TDATE2 = PDATE2.
*          ZDMS3_WA-CTDATE2 = PCDATE2.
*          ZDMS3_WA-ATEXT3 =   PTEXT3.
*          ZDMS3_WA-TDATE3 = PDATE3.
*          ZDMS3_WA-CTDATE3 = PCDATE3.
*          ZDMS3_WA-ATEXT4 =   PTEXT4.
*          ZDMS3_WA-TDATE4 = PDATE4.
*          ZDMS3_WA-CTDATE4 = PCDATE4.
*          ZDMS3_WA-ATEXT5 =   PTEXT5.
*          ZDMS3_WA-TDATE5 = PDATE5.
*          ZDMS3_WA-CTDATE5 = PCDATE5.
*          MODIFY ZDMS3 FROM ZDMS3_WA.
*          CLEAR : ZDMS3_WA.
*          A = 1.
*        ENDIF.
**
**        SELECT SINGLE * FROM PA0001 WHERE PERNR EQ PERNR AND BTRTL EQ ZDMS1-DEPT7.
**        IF SY-SUBRC EQ 0.
*        IF ZDMS1-DEPT7 NE SPACE.
*          ZDMS3_WA-MJAHR = YEAR.
*          ZDMS3_WA-MBLNR = CCNUM.
*          ZDMS3_WA-DEPT = ZDMS1-DEPT7.
*          ZDMS3_WA-BUDAT = SY-DATUM.
*          ZDMS3_WA-PERNR = PERNR.
*          ZDMS3_WA-ATEXT1 =   QTEXT1.
*          ZDMS3_WA-TDATE1 = QDATE1.
*          ZDMS3_WA-CTDATE1 = QCDATE1.
*          ZDMS3_WA-ATEXT2 =   QTEXT2.
*          ZDMS3_WA-TDATE2 = QDATE2.
*          ZDMS3_WA-CTDATE2 = QCDATE2.
*          ZDMS3_WA-ATEXT3 =   QTEXT3.
*          ZDMS3_WA-TDATE3 = QDATE3.
*          ZDMS3_WA-CTDATE3 = QCDATE3.
*          ZDMS3_WA-ATEXT4 =   QTEXT4.
*          ZDMS3_WA-TDATE4 = QDATE4.
*          ZDMS3_WA-CTDATE4 = QCDATE4.
*          ZDMS3_WA-ATEXT5 =   QTEXT5.
*          ZDMS3_WA-TDATE5 = QDATE5.
*          ZDMS3_WA-CTDATE5 = QCDATE5.
*          MODIFY ZDMS3 FROM ZDMS3_WA.
*          CLEAR : ZDMS3_WA.
*          A = 1.
*        ENDIF.
**
**        SELECT SINGLE * FROM PA0001 WHERE PERNR EQ PERNR AND BTRTL EQ ZDMS1-DEPT8.
**        IF SY-SUBRC EQ 0.
*        IF ZDMS1-DEPT8 NE SPACE.
*          ZDMS3_WA-MJAHR = YEAR.
*          ZDMS3_WA-MBLNR = CCNUM.
*          ZDMS3_WA-DEPT = ZDMS1-DEPT8.
*          ZDMS3_WA-BUDAT = SY-DATUM.
*          ZDMS3_WA-PERNR = PERNR.
*          ZDMS3_WA-ATEXT1 =   RRTEXT1.
*          ZDMS3_WA-TDATE1 = RRDATE1.
*          ZDMS3_WA-CTDATE1 = RRCDATE1.
*          ZDMS3_WA-ATEXT2 =   RRTEXT2.
*          ZDMS3_WA-TDATE2 = RRDATE2.
*          ZDMS3_WA-CTDATE2 = RRCDATE2.
*          ZDMS3_WA-ATEXT3 =   RRTEXT3.
*          ZDMS3_WA-TDATE3 = RRDATE3.
*          ZDMS3_WA-CTDATE3 = RRCDATE3.
*          ZDMS3_WA-ATEXT4 =   RRTEXT4.
*          ZDMS3_WA-TDATE4 = RRDATE4.
*          ZDMS3_WA-CTDATE4 = RRCDATE4.
*          ZDMS3_WA-ATEXT5 =   RRTEXT5.
*          ZDMS3_WA-TDATE5 = RRDATE5.
*          ZDMS3_WA-CTDATE5 = RRCDATE5.
*          MODIFY ZDMS3 FROM ZDMS3_WA.
*          CLEAR : ZDMS3_WA.
*          A = 1.
*        ENDIF.
**
**        SELECT SINGLE * FROM PA0001 WHERE PERNR EQ PERNR AND BTRTL EQ ZDMS1-DEPT9.
**        IF SY-SUBRC EQ 0.
*        IF ZDMS1-DEPT9 NE SPACE.
*          ZDMS3_WA-MJAHR = YEAR.
*          ZDMS3_WA-MBLNR = CCNUM.
*          ZDMS3_WA-DEPT = ZDMS1-DEPT9.
*          ZDMS3_WA-BUDAT = SY-DATUM.
*          ZDMS3_WA-PERNR = PERNR.
*          ZDMS3_WA-ATEXT1 =   STEXT1.
*          ZDMS3_WA-TDATE1 = SDATE1.
*          ZDMS3_WA-CTDATE1 = SCDATE1.
*          ZDMS3_WA-ATEXT2 =   STEXT2.
*          ZDMS3_WA-TDATE2 = SDATE2.
*          ZDMS3_WA-CTDATE2 = SCDATE2.
*          ZDMS3_WA-ATEXT3 =   STEXT3.
*          ZDMS3_WA-TDATE3 = SDATE3.
*          ZDMS3_WA-CTDATE3 = SCDATE3.
*          ZDMS3_WA-ATEXT4 =   STEXT4.
*          ZDMS3_WA-TDATE4 = SDATE4.
*          ZDMS3_WA-CTDATE4 = SCDATE4.
*          ZDMS3_WA-ATEXT5 =   STEXT5.
*          ZDMS3_WA-TDATE5 = SDATE5.
*          ZDMS3_WA-CTDATE5 = SCDATE5.
*          MODIFY ZDMS3 FROM ZDMS3_WA.
*          CLEAR : ZDMS3_WA.
*          A = 1.
*        ENDIF.
**
**        SELECT SINGLE * FROM PA0001 WHERE PERNR EQ PERNR AND BTRTL EQ ZDMS1-DEPT10.
**        IF SY-SUBRC EQ 0.
*        IF ZDMS1-DEPT10 NE SPACE.
*          ZDMS3_WA-MJAHR = YEAR.
*          ZDMS3_WA-MBLNR = CCNUM.
*          ZDMS3_WA-DEPT = ZDMS1-DEPT10.
*          ZDMS3_WA-BUDAT = SY-DATUM.
*          ZDMS3_WA-PERNR = PERNR.
*          ZDMS3_WA-ATEXT1 =   TTEXT1.
*          ZDMS3_WA-TDATE1 = TDATE1.
*          ZDMS3_WA-CTDATE1 = TCDATE1.
*          ZDMS3_WA-ATEXT2 =   TTEXT2.
*          ZDMS3_WA-TDATE2 = TDATE2.
*          ZDMS3_WA-CTDATE2 = TCDATE2.
*          ZDMS3_WA-ATEXT3 =   TTEXT3.
*          ZDMS3_WA-TDATE3 = TDATE3.
*          ZDMS3_WA-CTDATE3 = TCDATE3.
*          ZDMS3_WA-ATEXT4 =   TTEXT4.
*          ZDMS3_WA-TDATE4 = TDATE4.
*          ZDMS3_WA-CTDATE4 = TCDATE4.
*          ZDMS3_WA-ATEXT5 =   TTEXT5.
*          ZDMS3_WA-TDATE5 = TDATE5.
*          ZDMS3_WA-CTDATE5 = TCDATE5.
*          MODIFY ZDMS3 FROM ZDMS3_WA.
*          CLEAR : ZDMS3_WA.
*          A = 1.
*        ENDIF.
*        BREAK-POINT.


ENDMODULE.
*&---------------------------------------------------------------------*
*&      Form  DATAUPDATEFOL
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM DATAUPDATEFOL.
*  BREAK-POINT.

  SELECT * FROM ZDMS2 INTO TABLE IT_ZDMS2 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM.
  IF IT_ZDMS3 IS NOT INITIAL.
    PERFORM UPD1.
  ELSE.
    PERFORM UPD2.
  ENDIF.
  SELECT SINGLE * FROM ZDMS3 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM.
  IF SY-SUBRC EQ 0.
    SELECT SINGLE * FROM PA0001 WHERE PERNR EQ ZDMS3-PERNR AND ENDDA GE SY-DATUM.
    IF SY-SUBRC EQ 0.
      FOLWNAME = PA0001-ENAME.
    ENDIF.
    FOLWDT = ZDMS3-BUDAT.
  ENDIF.
  SELECT SINGLE * FROM ZDMS4 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM.
  IF SY-SUBRC EQ 0.

    CL1 = ZDMS4-CL1.
    CL1DT = ZDMS4-CL1DATE.
    CL1TXT1 = ZDMS4-CL1TXT1.
    CL1TXT2 = ZDMS4-CL1TXT2.
    CL1TXT3 = ZDMS4-CL1TXT3.

    QHCL1DT = ZDMS4-QHCL1DATE.
    QHCL1 = ZDMS4-QHCL1.
    SELECT SINGLE * FROM PA0001 WHERE PERNR EQ ZDMS4-CL1PERNR.
    IF SY-SUBRC EQ 0.
      CL1BY = PA0001-ENAME.
    ENDIF.
    SELECT SINGLE * FROM PA0001 WHERE PERNR EQ ZDMS4-QHCL1PERNR.
    IF SY-SUBRC EQ 0.
      QHCL1BY = PA0001-ENAME.
    ENDIF.
    CL2 = ZDMS4-CL2.
    CL2DT = ZDMS4-CL2DATE.
    CL2TXT1 = ZDMS4-CL2TXT1.
    CL2TXT2 = ZDMS4-CL2TXT2.
    CL2TXT3 = ZDMS4-CL2TXT3.
    QHCL2DT = ZDMS4-QHCL2DATE.
    QHCL2 = ZDMS4-QHCL2.
    SELECT SINGLE * FROM PA0001 WHERE PERNR EQ ZDMS4-CL2PERNR.
    IF SY-SUBRC EQ 0.
      CL2BY = PA0001-ENAME.
    ENDIF.
    SELECT SINGLE * FROM PA0001 WHERE PERNR EQ ZDMS4-QHCL2PERNR.
    IF SY-SUBRC EQ 0.
      QHCL2BY = PA0001-ENAME.
    ENDIF.
  ENDIF.


ENDFORM.
*&---------------------------------------------------------------------*
*&      Form  PASSW
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM PASSW.
  IF SY-UNAME EQ 'BASIS'.
  ELSE.
    JANDT+6(2) = '01'.
    JANDT+4(2) = '01'.
    JANDT+0(4) = '2020'.

    IF SY-DATUM GE JANDT.
    ELSE.
      MESSAGE 'ENTRY ALLOWED AFTER 1st Jan 2020' TYPE 'E'.
      EXIT.
    ENDIF.
  ENDIF.

  SELECT SINGLE * FROM ZPASSW WHERE PERNR = PERNR.
  IF SY-SUBRC EQ 0.

    IF SY-UNAME NE ZPASSW-UNAME.  "added on 18.5.23
      MESSAGE 'INVALID LOGIN ID' TYPE 'E'.
    ENDIF.
    V_EN_STRING = ZPASSW-PASSWORD.
*&** Decryption  String to String*&*
    TRY.
        CREATE OBJECT O_ENCRYPTOR.
        CALL METHOD O_ENCRYPTOR->DECRYPT_STRING2STRING
          EXPORTING
            THE_STRING = V_EN_STRING
          RECEIVING
            RESULT     = V_DE_STRING.
      CATCH CX_ENCRYPT_ERROR INTO O_CX_ENCRYPT_ERROR.
        CALL METHOD O_CX_ENCRYPT_ERROR->IF_MESSAGE~GET_TEXT
          RECEIVING
            RESULT = V_ERROR_MSG.
        MESSAGE V_ERROR_MSG TYPE 'E'.
    ENDTRY.
    IF V_DE_STRING EQ PASS.
*      message 'CORRECT PASSWORD' type 'I'.
    ELSE.
      MESSAGE 'INCORRECT PASSWORD' TYPE 'E'.
    ENDIF.
  ELSE.
    MESSAGE 'NOT VALID USER' TYPE 'E'.
    EXIT.
  ENDIF.
  CLEAR : PASS.
  PASS = '   '.

ENDFORM.
*&---------------------------------------------------------------------*
*&      Module  STATUS_9003  OUTPUT
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*

*&---------------------------------------------------------------------*
*&      Module  USER_COMMAND_9003  INPUT
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*&---------------------------------------------------------------------*
*&      Form  DATAUPDATEFOL
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
*&---------------------------------------------------------------------*
*&      Form  DEPTHEAD
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM DEPTHEADQA.

  CLEAR BTRTL.
  SELECT SINGLE * FROM ZDMS1 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM.
  IF SY-SUBRC EQ 0.
    IF ZDMS1-WERKS EQ '1001'.
      BTRTL = '1328'.
    ELSEIF ZDMS1-WERKS EQ '1000'.
      BTRTL = '1228'.
    ELSE.
      BTRTL = '1232'.
    ENDIF.
*    ******************************* QA HEAD ****************************

    CLEAR : DEPTHEAD, NDEPTHEAD.
    SELECT SINGLE * FROM ZQMS_DEPTHEAD1 WHERE BTRTL EQ BTRTL AND TO_DT GE SY-DATUM..  "24.7.22
    IF SY-SUBRC EQ 0.
      DEPTHEAD = ZQMS_DEPTHEAD1-PERNR.
    ENDIF.
*    SELECT SINGLE * FROM ZQMS_DEPTHEAD1 WHERE BTRTL EQ BTRTL AND TO_DT GE SY-DATUM..  "1.12.24
*    IF SY-SUBRC EQ 0.
*      NDEPTHEAD = ZQMS_DEPTHEAD1-PERNR1.
*    ENDIF.
    SELECT SINGLE * FROM ZQMS_DEPTHEAD2 WHERE BTRTL EQ BTRTL AND FROM_DT LE SY-DATUM AND TO_DT GE SY-DATUM..  "1.12.24
    IF SY-SUBRC EQ 0.
      NDEPTHEAD = ZQMS_DEPTHEAD2-PERNR.
    ENDIF.


*    SELECT SINGLE * FROM pa0001 WHERE pernr = pernr AND endda GE sy-datum AND btrtl EQ btrtl AND plans NE '99999999'..
*    IF sy-subrc EQ 0.
*      SELECT SINGLE * FROM hrp1000 WHERE objid EQ pa0001-plans AND otype EQ 'O'.
*      IF sy-subrc EQ 0.
**      WRITE :  'DEPARTMENT HEAD'.
*        depthead = pa0001-pernr.
*      ELSE.
*        SELECT SINGLE * FROM hrp1001 WHERE objid EQ pa0001-plans AND endda GT sy-datum AND rsign EQ 'A' AND relat EQ '003' .
*        IF sy-subrc EQ 0.
*          SELECT SINGLE * FROM hrp1001 WHERE objid EQ hrp1001-sobid AND endda GT sy-datum AND rsign EQ 'B' AND relat EQ '012'.
*          IF sy-subrc EQ 0.
*            SELECT SINGLE * FROM pa0001 WHERE plans EQ hrp1001-sobid AND endda GT sy-datum.
*            IF sy-subrc EQ 0.
*              depthead = pa0001-pernr.
*            ENDIF.
*          ENDIF.
*        ENDIF.
*      ENDIF.
*    ENDIF.
  ENDIF.
*  IF depthead NE pernr.
*    MESSAGE 'NOT DEPARTMENT HEAD' TYPE 'E'.
*  ENDIF.

  CLEAR : CHK2.  "31.5.22
  IF R32 EQ 'X'.
    IF PLANT EQ '3000' OR PLANT EQ '4000'.
      IF PERNR EQ '00005693'.
        CHK2 = 1.
      ENDIF.
    ENDIF.
  ENDIF.
  IF CHK2 NE 1.
*    IF DEPTHEAD NE PERNR.
*      MESSAGE 'NOT DEPARTMENT HEAD' TYPE 'E'.
*    ENDIF.
    IF DEPTHEAD NE PERNR.
      IF NDEPTHEAD NE PERNR.
        MESSAGE 'NOT DEPARTMENT HEAD' TYPE 'E'.
      ENDIF.
    ENDIF.
  ENDIF.

ENDFORM.

FORM DEPTHEAD.
*  BREAK-POINT.
  CLEAR  DEPTHEAD.
  SELECT SINGLE * FROM ZDMS1 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM.
  IF SY-SUBRC EQ 0.
    WRITE : / ZDMS1-MBLNR.

*    *******************************REPORTS TO ****************************

*    SELECT SINGLE * FROM PA0001 WHERE PERNR = ZDMS1-PERNR AND ENDDA GE SY-DATUM.
    SELECT SINGLE * FROM ZPA0001 WHERE PERNR = ZDMS1-PERNR AND ENDDA GE SY-DATUM.
    IF SY-SUBRC EQ 0.
      CLEAR : DEPTHEAD.
*      SELECT SINGLE * FROM ZQMS_DEPTHEAD1 WHERE BTRTL EQ PA0001-BTRTL AND TO_DT GE SY-DATUM..  "24.7.22
      SELECT SINGLE * FROM ZQMS_DEPTHEAD1 WHERE BTRTL EQ ZPA0001-BTRTL AND TO_DT GE SY-DATUM..  "24.7.22
      IF SY-SUBRC EQ 0.
        DEPTHEAD = ZQMS_DEPTHEAD1-PERNR.
      ENDIF.

*      SELECT SINGLE * FROM hrp1000 WHERE objid EQ pa0001-plans AND otype EQ 'O' AND langu EQ 'EN'.
*      IF sy-subrc EQ 0.
**      WRITE :  'DEPARTMENT HEAD'.
*        depthead = pa0001-pernr.
*      ELSE.
*        SELECT SINGLE * FROM hrp1001 WHERE objid EQ pa0001-plans AND endda GT sy-datum AND rsign EQ 'A' AND relat EQ '003' .
*        IF sy-subrc EQ 0.
*          SELECT SINGLE * FROM hrp1001 WHERE objid EQ hrp1001-sobid AND endda GT sy-datum AND rsign EQ 'B' AND relat EQ '012'.
*          IF sy-subrc EQ 0.
*            SELECT SINGLE * FROM pa0001 WHERE plans EQ hrp1001-sobid AND endda GT sy-datum.
*            IF sy-subrc EQ 0.
*              depthead = pa0001-pernr.
*            ENDIF.
*          ENDIF.
*        ENDIF.
*      ENDIF.
    ENDIF.

*    IF zdms1-pernr EQ '00002055'. "30.9.20  "deactivated on 5.1.21
*      depthead = '00010498'.
*    ENDIF.
  ENDIF.
*  IF PERNR EQ '00002055'.
*    DEPTHEAD = '00010498'.
*  ENDIF.

***** hardcode dept head
*  SELECT SINGLE * FROM zdms1 WHERE mjahr EQ year AND mblnr EQ ccnum.
*  IF sy-subrc EQ 0.
*    IF zdms1-pernr EQ '00014285'.
*      depthead = '00003861'.
*    ENDIF.
*  ENDIF.

  IF DEPTHEAD EQ '00000000'.
    MESSAGE 'DEPARTMENT HEAD - VACANT' TYPE 'I'.
    SELECT SINGLE * FROM ZDMS1 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM.
    IF SY-SUBRC EQ 0.
      IF PERNR NE ZDMS1-PERNR.
        MESSAGE 'IF DEPARTMENT HEAD IS VACANT, INITIATOR HAS TO APPROVE' TYPE 'E'.
      ENDIF.
    ENDIF.
*  ELSE.
*    IF depthead NE pernr."18.2.2020
*      IF depthead EQ '00005300'.
*        IF pernr EQ '00015033'.
*        ELSE.
*          MESSAGE 'NOT DEPARTMENT HEAD' TYPE 'E'.
*        ENDIF.
*      ELSE.
*        MESSAGE 'NOT DEPARTMENT HEAD' TYPE 'E'.
*      ENDIF.
*    ENDIF.
**    IF DEPTHEAD NE PERNR.
**      MESSAGE 'NOT DEPARTMENT HEAD' TYPE 'E'.
**    ENDIF.
  ENDIF.
ENDFORM.
*&---------------------------------------------------------------------*
*&      Form  DEPTQA
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM DEPTQA .
  CLEAR : BTRTL.
  SELECT SINGLE * FROM ZDMS1 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM.
  IF SY-SUBRC EQ 0.
    IF ZDMS1-WERKS EQ '1001'.
      BTRTL = '1328'.
    ELSEIF ZDMS1-WERKS EQ '1000'.
      BTRTL = '1228'.
    ELSE.
      BTRTL = '1232'.
    ENDIF.
  ENDIF.

***************NEW CONDITION********************* 6.12.23
  IF R4A EQ 'X'.
*    SELECT SINGLE * FROM PA0001 WHERE PERNR EQ ZDMS1-PERNR AND ENDDA GE SY-DATUM.
    SELECT SINGLE * FROM ZPA0001 WHERE PERNR EQ ZDMS1-PERNR AND ENDDA GE SY-DATUM.
    IF SY-SUBRC EQ 0.
*      SELECT SINGLE * FROM ZQMS_DEPTHEAD1 WHERE BTRTL EQ PA0001-BTRTL AND APPROVER GT 0 AND TO_DT GE SY-DATUM..
      SELECT SINGLE * FROM ZQMS_DEPTHEAD1 WHERE BTRTL EQ ZPA0001-BTRTL AND APPROVER GT 0 AND TO_DT GE SY-DATUM..
      IF SY-SUBRC EQ 0.
        IF ZDMS1-RAPPROVE1 NE 'X'.
          MESSAGE 'CHANGE CONTROL IS NOT YET APPROVED BY APPROVER' TYPE 'E'.
        ENDIF.
      ENDIF.
    ENDIF.
  ENDIF.
**************************************************************************************

  IF PERNR EQ '00014022'.

  ELSE.
*    SELECT SINGLE * FROM PA0001 WHERE PERNR EQ PERNR AND ENDDA GE SY-DATUM AND BTRTL EQ BTRTL AND PLANS NE '99999999'.
    SELECT SINGLE * FROM ZPA0001 WHERE PERNR EQ PERNR AND ENDDA GE SY-DATUM AND BTRTL EQ BTRTL .  "AND PLANS NE '99999999'.
    IF SY-SUBRC NE 0.
      IF BTRTL EQ '1232'.
        MESSAGE 'ENTRY ONLY FOR CQD DEPARTMRNT' TYPE 'E'.
        EXIT.
      ELSE.
        MESSAGE 'ENTRY ONLY FOR QA DEPARTMRNT' TYPE 'E'.
        EXIT.
      ENDIF.
    ENDIF.
  ENDIF.
  IF R8 EQ 'X' OR R81 EQ 'X' OR R82 EQ 'X' OR R9 EQ 'X' OR R91 EQ 'X'. "13.7.20

    SELECT SINGLE * FROM ZDMS4 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM AND TDAPPROVE EQ 'X'.  "10.7.20
    IF SY-SUBRC EQ 0.
    ELSE.
      MESSAGE 'CHNAGE CONTROL IS NOT YET APPROVED BY TECHNICAL DIRECTOR' TYPE 'E'.
      EXIT.
    ENDIF.
  ENDIF.

ENDFORM.
*&---------------------------------------------------------------------*
*&      Module  STATUS_9004  OUTPUT
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
MODULE STATUS_9004 OUTPUT.
*  BREAK-POINT.
  IF CC1  EQ 'X' AND R3 EQ 'X' .
    SET PF-STATUS 'CREATE'.
    SET TITLEBAR 'IMPACT'.

    SELECT SINGLE * FROM ZDMS4 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM.
    IF SY-SUBRC EQ 0.
      IF ZDMS4-TDAPPROVE EQ 'X' OR ZDMS4-TDREJECT EQ 'X'.
        LOOP AT SCREEN.
          IF SCREEN-GROUP1 EQ '001'.
          ELSEIF SCREEN-GROUP1 EQ '002'.
          ELSE.
            SCREEN-INPUT = 0.
            MODIFY SCREEN.
          ENDIF.
        ENDLOOP.
      ELSEIF ZDMS4-QHAPPROVE EQ 'X' OR ZDMS4-QHREJECT EQ 'X'.
        LOOP AT SCREEN.
          IF SCREEN-GROUP1 EQ '001'.
          ELSEIF SCREEN-GROUP1 EQ '002'.
          ELSE.
            SCREEN-INPUT = 0.
            MODIFY SCREEN.
          ENDIF.
        ENDLOOP.
      ELSE.
        LOOP AT SCREEN.
          IF SCREEN-GROUP1 EQ '002'.
            SCREEN-INPUT = 0.
            MODIFY SCREEN.
          ENDIF.
        ENDLOOP.
      ENDIF.

      IF ZDMS4-CL1 EQ 'X'.
        LOOP AT SCREEN.
*          IF SCREEN-GROUP1 EQ '001'.
*          ELSE.
          SCREEN-INPUT = 0.
          MODIFY SCREEN.
*          ENDIF.
        ENDLOOP.
      ENDIF.
      IF ZDMS4-CL2 EQ 'X'.
        LOOP AT SCREEN.
*          IF SCREEN-GROUP1 EQ '001'.
*            SCREEN-INPUT = 0.
*            MODIFY SCREEN.
*          ELSE.
          SCREEN-INPUT = 0.
          MODIFY SCREEN.
*          ENDIF.
        ENDLOOP.
      ENDIF.
    ELSE.
      LOOP AT SCREEN.
        IF SCREEN-GROUP1 EQ '002'.
          SCREEN-INPUT = 0.
          MODIFY SCREEN.
        ENDIF.
      ENDLOOP.
    ENDIF.

**********SUBJECT**************
    CLEAR : QSUB1,QSUB2,QSUB3.
    SELECT SINGLE * FROM ZDMS1 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM.
    IF SY-SUBRC EQ 0.
      QSUB1 = ZDMS1-QAREMARK1.
      QSUB2 = ZDMS1-QAREMARK2.
      QSUB3 = ZDMS1-QAREMARK3.
    ENDIF.

    SELECT SINGLE * FROM PA0001 WHERE PERNR EQ PERNR AND ENDDA GE SY-DATUM AND PLANS NE '99999999'.
      IF sy-subrc = 0.
 INAME1 = PA0001-ENAME.
      ENDIF.
    SELECT SINGLE * FROM ZPA0001 WHERE PERNR EQ PERNR AND ENDDA GE SY-DATUM.  " AND PLANS NE '99999999'.
    IF SY-SUBRC EQ 0.
      DEPT11 = ZPA0001-BTRTL.
*      INAME1 = PA0001-ENAME.
      SELECT SINGLE * FROM T001P WHERE BTRTL EQ DEPT11.
      IF SY-SUBRC EQ 0.
        IDEPT1 = T001P-BTEXT.
      ENDIF.
*      PERFORM DEPTCHK.
      PERFORM DEPTCHK1.

      PERFORM INITDET.


************************************
      LOOP AT IT_ZDMS2 INTO WA_ZDMS2 WHERE DEPT EQ DEPT11.
        APPROVE1 = WA_ZDMS2-APPROVE.
        REJECT1 = WA_ZDMS2-REJECT.
        NA = WA_ZDMS2-NA.
        NATEXT = WA_ZDMS2-NATEXT.
        ATEXT1 = WA_ZDMS2-ATEXT1.
        ADATE1 = WA_ZDMS2-TDATE1.
        ACDATE1 = WA_ZDMS2-CTDATE1.
*        AFOLW1 = WA_ZDMS2-FOLW1.
        ATEXT2 = WA_ZDMS2-ATEXT2.
        ADATE2 = WA_ZDMS2-TDATE2.
        ACDATE2 = WA_ZDMS2-CTDATE2.
*        AFOLW2 = WA_ZDMS2-FOLW2.
        ATEXT3 = WA_ZDMS2-ATEXT3.
        ADATE3 = WA_ZDMS2-TDATE3.
        ACDATE3 = WA_ZDMS2-CTDATE3.
*        AFOLW3 = WA_ZDMS2-FOLW3.
        ATEXT4 = WA_ZDMS2-ATEXT4.
        ADATE4 = WA_ZDMS2-TDATE4.
        ACDATE4 = WA_ZDMS2-CTDATE4.
*        AFOLW4 = WA_ZDMS2-FOLW4.
        ATEXT5 = WA_ZDMS2-ATEXT5.
        ADATE5 = WA_ZDMS2-TDATE5.
        ACDATE5 = WA_ZDMS2-CTDATE5.
*        AFOLW5 = WA_ZDMS2-FOLW5.
        AREM1 = WA_ZDMS2-REM1.
        AREM2 = WA_ZDMS2-REM2.
        AREM3 = WA_ZDMS2-REM3.
        AREM4 = WA_ZDMS2-REM4.
        AREM5 = WA_ZDMS2-REM5.
        IMDATE1 = WA_ZDMS2-UBUDAT.
      ENDLOOP.
    ENDIF.
***********************************
  ENDIF.
ENDMODULE.
*&---------------------------------------------------------------------*
*&      Module  USER_COMMAND_9004  INPUT
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
MODULE USER_COMMAND_9004 INPUT.
  CASE OK.

    WHEN 'SAVE'.
      IF CC1  EQ 'X' AND R3 EQ 'X'.
        IF APPROVE1 EQ 'X' AND REJECT1 EQ 'X'.
          MESSAGE 'Select either ACCEPT or NOT ACCEPT' TYPE 'I'.
          EXIT.
        ELSEIF APPROVE1 EQ 'X' AND NA EQ 'X'.
          MESSAGE 'Select either ACCEPT or NO IMPACT' TYPE 'I'.
          EXIT.
        ELSEIF REJECT1 EQ 'X' AND NA EQ 'X'.
          MESSAGE 'Select either NOT ACCEPT or NO IMPACT' TYPE 'I'.
          EXIT.
        ENDIF.
        IF REJECT1 EQ SPACE AND NA EQ SPACE AND APPROVE1 EQ SPACE.
          MESSAGE 'SELECT Change Accept OR Not Accept OR No Impact' TYPE 'I'.
          EXIT.
        ENDIF.

        IF REJECT1 EQ 'X' AND NATEXT EQ SPACE.
          MESSAGE ' IN CASE OF REJECTION ENTER REMARK' TYPE 'I'.
          EXIT.
        ENDIF.

        IF NA EQ 'X' AND NATEXT EQ SPACE.
          MESSAGE ' IN CASE OF NO IMPACT ENTER REMARK' TYPE 'I'.
          EXIT.
        ENDIF.


*******************checking*******
        IF ATEXT1 NE SPACE.
          IF ADATE1 EQ '00000000' AND AREM1 EQ SPACE.
            MESSAGE 'Enter either TARGET DATE or REMARK' TYPE 'I'.
            EXIT.
          ENDIF.
        ENDIF.
        IF ATEXT2 NE SPACE.
          IF ADATE2 EQ '00000000' AND AREM2 EQ SPACE.
            MESSAGE 'Enter either TARGET DATE or REMARK' TYPE 'I'.
            EXIT.
          ENDIF.
        ENDIF.
        IF ATEXT3 NE SPACE.
          IF ADATE3 EQ '00000000' AND AREM3 EQ SPACE.
            MESSAGE 'Enter either TARGET DATE or REMARK' TYPE 'I'.
            EXIT.
          ENDIF.
        ENDIF.
        IF ATEXT4 NE SPACE.
          IF ADATE4 EQ '00000000' AND AREM4 EQ SPACE.
            MESSAGE 'Enter either TARGET DATE or REMARK' TYPE 'I'.
            EXIT.
          ENDIF.
        ENDIF.
        IF ATEXT5 NE SPACE.
          IF ADATE5 EQ '00000000' AND AREM5 EQ SPACE.
            MESSAGE 'Enter either TARGET DATE or REMARK' TYPE 'I'.
            EXIT.
          ENDIF.
        ENDIF.
********************checking ends*************************
        SELECT SINGLE * FROM ZDMS1 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM.
        IF SY-SUBRC EQ 0.
          IF ADATE1 NE '00000000'.
            IF ADATE1 LT ZDMS1-BUDAT.
              MESSAGE 'Enter TARGET DATE after CC Initiation date' TYPE 'I'.
              EXIT.
            ENDIF.
          ENDIF.
          IF ACDATE1 NE '00000000'.
            IF ACDATE1 LT ZDMS1-BUDAT.
              MESSAGE 'Enter COMPLETION DATE after CC Initiation date' TYPE 'I'.
              EXIT.
            ENDIF.
          ENDIF.

          IF ADATE2 NE '00000000'.
            IF ADATE2 LT ZDMS1-BUDAT.
              MESSAGE 'Enter TARGET DATE after CC Initiation date' TYPE 'I'.
              EXIT.
            ENDIF.
          ENDIF.
          IF ACDATE2 NE '00000000'.
            IF ACDATE2 LT ZDMS1-BUDAT.
              MESSAGE 'Enter COMPLETION DATE after CC Initiation date' TYPE 'I'.
              EXIT.
            ENDIF.
          ENDIF.

          IF ADATE3 NE '00000000'.
            IF ADATE3 LT ZDMS1-BUDAT.
              MESSAGE 'Enter TARGET DATE after CC Initiation date' TYPE 'I'.
              EXIT.
            ENDIF.
          ENDIF.
          IF ACDATE3 NE '00000000'.
            IF ACDATE3 LT ZDMS1-BUDAT.
              MESSAGE 'Enter COMPLETION DATE after CC Initiation date' TYPE 'I'.
              EXIT.
            ENDIF.
          ENDIF.

          IF ADATE4 NE '00000000'.
            IF ADATE4 LT ZDMS1-BUDAT.
              MESSAGE 'Enter TARGET DATE after CC Initiation date' TYPE 'I'.
              EXIT.
            ENDIF.
          ENDIF.
          IF ACDATE4 NE '00000000'.
            IF ACDATE4 LT ZDMS1-BUDAT.
              MESSAGE 'Enter COMPLETION DATE after CC Initiation date' TYPE 'I'.
              EXIT.
            ENDIF.
          ENDIF.

          IF ADATE5 NE '00000000'.
            IF ADATE5 LT ZDMS1-BUDAT.
              MESSAGE 'Enter TARGET DATE after CC Initiation date' TYPE 'I'.
              EXIT.
            ENDIF.
          ENDIF.
          IF ACDATE5 NE '00000000'.
            IF ACDATE5 LT ZDMS1-BUDAT.
              MESSAGE 'Enter COMPLETION DATE after CC Initiation date' TYPE 'I'.
              EXIT.
            ENDIF.
          ENDIF.
        ENDIF.

*************************************************************

        SELECT SINGLE * FROM ZDMS2 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM AND DEPT EQ DEPT11.
        IF SY-SUBRC EQ 0.
          MOVE-CORRESPONDING ZDMS2 TO ZDMS2_WA.
*          ZDMS2_WA-MJAHR = YEAR.
*          ZDMS2_WA-MBLNR = CCNUM.
*          ZDMS2_WA-DEPT = DEPT11.
*          ZDMS2_WA-EBUDAT = EBUDAT.
*          ZDMS2_WA-EPERNR = EPERNR.
*          SELECT SINGLE * FROM ZDMS4 WHERE MBLNR EQ ZDMS2-MBLNR AND MJAHR EQ ZDMS2-MJAHR AND TDDATE NE '00000000'.
          SELECT SINGLE * FROM ZDMS4 WHERE MBLNR EQ ZDMS2-MBLNR AND MJAHR EQ ZDMS2-MJAHR AND QHDATE NE '00000000'.  "28.7.20  NO CHANGE IN ACT. AFTER QA HEAD APPROVAL
          IF SY-SUBRC EQ 0.
            ZDMS2_WA-UBUDAT = ZDMS2-UBUDAT.
            ZDMS2_WA-UZEIT = ZDMS2-UZEIT.
            ZDMS2_WA-UNAME = ZDMS2-UNAME.
          ELSE.
            ZDMS2_WA-UBUDAT = SY-DATUM.
            ZDMS2_WA-UZEIT = SY-UZEIT.
            ZDMS2_WA-UNAME = SY-UNAME.
          ENDIF.
          CLEAR : APRDT.  "23.11.21
          SELECT SINGLE * FROM ZDMS4 WHERE MBLNR EQ ZDMS2-MBLNR AND MJAHR EQ ZDMS2-MJAHR AND TDAPPROVE EQ 'X'.
          IF SY-SUBRC EQ 0.
            APRDT = ZDMS4-TDDATE.
          ELSE.
*          ZDMS2_WA-UBUDAT = SY-DATUM.  "17.8.23
            ZDMS2_WA-UPERNR = PERNR.
          ENDIF.
          ZDMS2_WA-APPROVE = APPROVE1.
          ZDMS2_WA-REJECT = REJECT1.
          ZDMS2_WA-NA = NA.
          ZDMS2_WA-NATEXT = NATEXT.
          ZDMS2_WA-ATEXT1 = ATEXT1.
          ZDMS2_WA-TDATE1 = ADATE1.
          IF ACDATE1 NE '00000000'.
            IF ACDATE1 GT SY-DATUM.
              MESSAGE 'FUTURE DATE IS NOT ALLOWED FOR COMPLETION' TYPE 'E'.
            ENDIF.
            IF ACDATE1 LT APRDT.
              MESSAGE 'COMPLETION DATE SHOULD BE AFTER CC APPROVAL DATE' TYPE 'E'.
            ENDIF.
          ENDIF.
          ZDMS2_WA-CTDATE1 = ACDATE1.
*        ZDMS2_WA-FOLW1 = AFOLW1.
          ZDMS2_WA-REM1 = AREM1.

          SELECT SINGLE * FROM ZDMS2 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM AND DEPT EQ DEPT11 AND CTDATE1 EQ '00000000'.  "8.2.22
          IF SY-SUBRC EQ 0.
            IF ZDMS2_WA-CTDATE1 GT 0.
              ZDMS2_WA-CTDT1ON = SY-DATUM.
            ENDIF.
          ENDIF.

          ZDMS2_WA-ATEXT2 = ATEXT2.
          ZDMS2_WA-TDATE2 = ADATE2.
          IF ACDATE2 NE '00000000'.
            IF ACDATE2 GT SY-DATUM.
              MESSAGE 'FUTURE DATE IS NOT ALLOWED FOR COMPLETION' TYPE 'E'.
            ENDIF.
            IF ACDATE2 LT APRDT.
              MESSAGE 'COMPLETION DATE SHOULD BE AFTER CC APPROVAL DATE' TYPE 'E'.
            ENDIF.
          ENDIF.
          ZDMS2_WA-CTDATE2 = ACDATE2.
*        ZDMS2_WA-FOLW2 = AFOLW2.
          ZDMS2_WA-REM2 = AREM2.

          SELECT SINGLE * FROM ZDMS2 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM AND DEPT EQ DEPT11 AND CTDATE2 EQ '00000000'.  "8.2.22
          IF SY-SUBRC EQ 0.
            IF ZDMS2_WA-CTDATE2 GT 0.
              ZDMS2_WA-CTDT2ON = SY-DATUM.
            ENDIF.
          ENDIF.

          ZDMS2_WA-ATEXT3 = ATEXT3.
          ZDMS2_WA-TDATE3 = ADATE3.
          IF ACDATE3 NE '00000000'.
            IF ACDATE3 GT SY-DATUM.
              MESSAGE 'FUTURE DATE IS NOT ALLOWED FOR COMPLETION' TYPE 'E'.
            ENDIF.
            IF ACDATE3 LT APRDT.
              MESSAGE 'COMPLETION DATE SHOULD BE AFTER CC APPROVAL DATE' TYPE 'E'.
            ENDIF.
          ENDIF.
          ZDMS2_WA-CTDATE3 = ACDATE3.
*        ZDMS2_WA-FOLW3 = AFOLW3.
          ZDMS2_WA-REM3 = AREM3.

          SELECT SINGLE * FROM ZDMS2 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM AND DEPT EQ DEPT11 AND CTDATE3 EQ '00000000'.  "8.2.22
          IF SY-SUBRC EQ 0.
            IF ZDMS2_WA-CTDATE3 GT 0.
              ZDMS2_WA-CTDT3ON = SY-DATUM.
            ENDIF.
          ENDIF.

          ZDMS2_WA-ATEXT4 = ATEXT4.
          ZDMS2_WA-TDATE4 = ADATE4.
          IF ACDATE4 NE '00000000'.
            IF ACDATE4 GT SY-DATUM.
              MESSAGE 'FUTURE DATE IS NOT ALLOWED FOR COMPLETION' TYPE 'E'.
            ENDIF.
            IF ACDATE4 LT APRDT.
              MESSAGE 'COMPLETION DATE SHOULD BE AFTER CC APPROVAL DATE' TYPE 'E'.
            ENDIF.
          ENDIF.
          ZDMS2_WA-CTDATE4 = ACDATE4.
*        ZDMS2_WA-FOLW4 = AFOLW4.
          ZDMS2_WA-REM4 = AREM4.

          SELECT SINGLE * FROM ZDMS2 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM AND DEPT EQ DEPT11 AND CTDATE4 EQ '00000000'.  "8.2.22
          IF SY-SUBRC EQ 0.
            IF ZDMS2_WA-CTDATE4 GT 0.
              ZDMS2_WA-CTDT4ON = SY-DATUM.
            ENDIF.
          ENDIF.

          ZDMS2_WA-ATEXT5 = ATEXT5.
          ZDMS2_WA-TDATE5 = ADATE5.
          IF ACDATE5 NE '00000000'.
            IF ACDATE5 GT SY-DATUM.
              MESSAGE 'FUTURE DATE IS NOT ALLOWED FOR COMPLETION' TYPE 'E'.
            ENDIF.
            IF ACDATE5 LT APRDT.
              MESSAGE 'COMPLETION DATE SHOULD BE AFTER CC APPROVAL DATE' TYPE 'E'.
            ENDIF.
          ENDIF.
          ZDMS2_WA-CTDATE5 = ACDATE5.
*        ZDMS2_WA-FOLW5 = AFOLW5.
          ZDMS2_WA-REM5 = AREM5.

          SELECT SINGLE * FROM ZDMS2 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM AND DEPT EQ DEPT11 AND CTDATE5 EQ '00000000'.  "8.2.22
          IF SY-SUBRC EQ 0.
            IF ZDMS2_WA-CTDATE5 GT 0.
              ZDMS2_WA-CTDT5ON = SY-DATUM.
            ENDIF.
          ENDIF.

          IF REJECT1 EQ 'X' .
            MESSAGE 'YOU ARE REJECTING CHANGE' TYPE 'W'.
          ENDIF.

          MODIFY ZDMS2 FROM ZDMS2_WA.
          COMMIT WORK AND WAIT .
          IF SY-SUBRC EQ 0.
            MESSAGE 'DATA UPDATED' TYPE 'I'.
          ENDIF.
          CLEAR : ZDMS2_WA.

        ENDIF.

************************add completion date in zdms3**************
        CLEAR : CTDATEN1,CTN.
        CLEAR: IT_ZDMS2_N ,WA_ZDMS2_N.
*        SELECT * FROM zdms2 INTO TABLE it_zdms2_n WHERE mjahr EQ year AND mblnr EQ ccnum AND dept EQ dept11.
*        IF it_zdms2_n IS NOT INITIAL.
*          LOOP AT it_zdms2_n INTO wa_zdms2_n WHERE mjahr EQ year AND mblnr EQ ccnum AND dept EQ dept11.
*            IF wa_zdms2_n-atext1 NE space AND wa_zdms2_n-ctdate1 EQ '00000000'.
*              ctn = 1.
*            ENDIF.
*            IF wa_zdms2_n-atext2 NE space AND wa_zdms2_n-ctdate2 EQ '00000000'.
*              ctn = 1.
*            ENDIF.
*            IF wa_zdms2_n-atext3 NE space AND wa_zdms2_n-ctdate3 EQ '00000000'.
*              ctn = 1.
*            ENDIF.
*            IF wa_zdms2_n-atext4 NE space AND wa_zdms2_n-ctdate4 EQ '00000000'.
*              ctn = 1.
*            ENDIF.
*            IF wa_zdms2_n-atext5 NE space AND wa_zdms2_n-ctdate5 EQ '00000000'.
*              ctn = 1.
*            ENDIF.
*          ENDLOOP.
*          IF ctn NE 1.
*            LOOP AT it_zdms2_n INTO wa_zdms2_n WHERE mjahr EQ year AND mblnr EQ ccnum AND dept EQ dept11.
*              IF wa_zdms2_n-ctdate1 NE '00000000'.
*                ctdaten1 = wa_zdms2_n-ctdate1.
*              ENDIF.
*              IF wa_zdms2_n-ctdate2 NE '00000000'.
*                IF ctdaten1 LT wa_zdms2_n-ctdate2.
*                  ctdaten1 = wa_zdms2_n-ctdate2.
*                ENDIF.
*              ENDIF.
*              IF wa_zdms2_n-ctdate3 NE '00000000'.
*                IF ctdaten1 LT wa_zdms2_n-ctdate3.
*                  ctdaten1 = wa_zdms2_n-ctdate3.
*                ENDIF.
*              ENDIF.
*              IF wa_zdms2_n-ctdate4 NE '00000000'.
*                IF ctdaten1 LT wa_zdms2_n-ctdate4.
*                  ctdaten1 = wa_zdms2_n-ctdate4.
*                ENDIF.
*              ENDIF.
*              IF wa_zdms2_n-ctdate5 NE '00000000'.
*                IF ctdaten1 LT wa_zdms2_n-ctdate5.
*                  ctdaten1 = wa_zdms2_n-ctdate5.
*                ENDIF.
*              ENDIF.
*            ENDLOOP.
*
*            CLEAR : it_zdms3_n,wa_zdms3_n.
*            SELECT * FROM zdms3 INTO TABLE it_zdms3_n WHERE mjahr EQ year AND mblnr EQ ccnum AND dept EQ dept11 AND ctdate1 EQ '00000000'.
*            IF it_zdms3_n IS NOT INITIAL.
*              LOOP AT it_zdms3_n INTO wa_zdms3_n.
*                MOVE-CORRESPONDING wa_zdms3_n TO zdms3_n_wa.
*                zdms3_n_wa-ctdate1 = ctdaten1.
*                MODIFY  zdms3 FROM zdms3_n_wa .
**                TRANSPORTING CTDATE1 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM AND DEPT EQ DEPT11.
*                CLEAR zdms3_n_wa.
*              ENDLOOP.
*              IF sy-subrc EQ 0.
*                MESSAGE 'COMPLETION DATE IS UPDATED ' TYPE 'I'.
*              ENDIF.
*            ENDIF.
*
*          ENDIF.
*        ENDIF.
*
*******************************zdms3 end****************************
*
*        MESSAGE 'DATA SAVED' TYPE 'I'.

************************* RESET DEPARTMENT HEAD'S APPROAL IF NA******************  deactivated on 17.4.23
*        IF reject1 EQ 'X'.
*          SELECT SINGLE * FROM zdms1 WHERE mjahr EQ year AND mblnr EQ ccnum.
*          IF sy-subrc EQ 0.
*            MOVE-CORRESPONDING zdms1 TO zdms1_wa.
*            zdms1_wa-approve = ' '.
*            zdms1_wa-reject = ' '.
*            zdms1_wa-rapprove1 = ' '.
*            zdms1_wa-rreject1 = ' '.
*            zdms1_wa-rapprove2 = ' '.
*            zdms1_wa-rreject2 = ' '.
*            MODIFY zdms1 FROM zdms1_wa.
*            CLEAR zdms1_wa.
*            MESSAGE 'DEPARTMET HEAD''S APPROVAL & ALL APPROVALS ARE RESET' TYPE 'I'.
*          ENDIF.
*        ENDIF.
************************ reset all impacted activities*****************************  deactivated on 17.4.23
****        BREAK-POINT.
***        SELECT * FROM zdms2 INTO TABLE it_zdms2_1 WHERE mjahr EQ year AND mblnr EQ ccnum.
***        IF reject1 EQ 'X'.
***          LOOP AT it_zdms2_1 INTO wa_zdms2_1.
***            MOVE-CORRESPONDING wa_zdms2_1 TO zdms2_wa.
***            zdms2_wa-atext1 = '  '.
***            zdms2_wa-tdate1 = 0.
***            zdms2_wa-ctdate1 = 0.
***            zdms2_wa-rem1 = '   '.
***
***            zdms2_wa-atext2 = '  '.
***            zdms2_wa-tdate2 = 0.
***            zdms2_wa-ctdate2 = 0.
***            zdms2_wa-rem2 = '   '.
***
***            zdms2_wa-atext3 = '  '.
***            zdms2_wa-tdate3 = 0.
***            zdms2_wa-ctdate3 = 0.
***            zdms2_wa-rem3 = '   '.
***
***            zdms2_wa-atext4 = '  '.
***            zdms2_wa-tdate4 = 0.
***            zdms2_wa-ctdate4 = 0.
***            zdms2_wa-rem4 = '   '.
***
***            zdms2_wa-atext5 = '  '.
***            zdms2_wa-tdate5 = 0.
***            zdms2_wa-ctdate5 = 0.
***            zdms2_wa-rem5 = '   '.
***
***            MODIFY zdms2 FROM zdms2_wa.
***            CLEAR zdms2_wa.
***          ENDLOOP.
***          PERFORM email.
****          LEAVE TO TRANSACTION 'ZQMS'.
***          LEAVE TO SCREEN 0.
***        ENDIF.

*        LOOP AT IT_ZDMS2_1 INTO WA_ZDMS2_1.
*          IF WA_ZDMS2_1-UPERNR EQ '00000000'.
*            IF REJECT EQ 'X'.
*              PERFORM EMAIL.
*            ENDIF.
*            LEAVE TO TRANSACTION 'ZQMS'.
*          ENDIF.
*        ENDLOOP.
***********check if all impacted activities are entered******************************
**        SELECT * FROM ZDMS2 INTO TABLE IT_ZDMS2_1 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM.
*        intc = 0.   "DO NOT SEND EMAIL AT CREATOR LEVEL.
*        LOOP AT it_zdms2_1 INTO wa_zdms2_1.
*          intc = intc + 1.
*        ENDLOOP.
*
*        LOOP AT it_zdms2_1 INTO wa_zdms2_1.
*          IF wa_zdms2_1-upernr EQ '00000000'.
**            LEAVE TO TRANSACTION 'ZQMS'.
*            LEAVE TO SCREEN 0.
*          ENDIF.
*        ENDLOOP.
*************************************************************************************
*        SELECT SINGLE * FROM zdms4 WHERE mjahr EQ year AND mblnr EQ ccnum AND tdapprove EQ 'X'. "14.10.2019
*        IF sy-subrc EQ 4.
*          IF intc GT 1.
*            PERFORM email.
*          ENDIF.
*        ENDIF.
**        PERFORM EMAIL.
**        LEAVE TO TRANSACTION 'ZQMS'.

******************send email if all impacted activities are completed...
        SELECT SINGLE * FROM ZDMS2 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM.
        IF SY-SUBRC EQ 0.
          SELECT SINGLE * FROM ZDMS2 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM AND APPROVE EQ SPACE.
          IF SY-SUBRC EQ 4.
            PERFORM EMAIL.
          ENDIF.
        ENDIF.


        LEAVE TO SCREEN 0.
      ENDIF.
    WHEN 'BACK' OR 'EXIT'.
      SET SCREEN 0.
      LEAVE SCREEN.

  ENDCASE.
ENDMODULE.
*&---------------------------------------------------------------------*
*&      Form  INITDET
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM INITDET .
  SELECT SINGLE * FROM ZDMS1 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM.
  IF SY-SUBRC EQ 0.
    SELECT SINGLE * FROM PA0001 WHERE PERNR EQ ZDMS1-PERNR AND ENDDA GE SY-DATUM.
       IF SY-SUBRC EQ 0.
      ENAME = PA0001-ENAME.
      endif.
    SELECT SINGLE * FROM PA0001 WHERE PERNR EQ ZDMS1-PERNR AND ENDDA GE SY-DATUM.
    IF SY-SUBRC EQ 0.
*      ENAME = PA0001-ENAME.
      SELECT SINGLE * FROM T001P WHERE BTRTL EQ ZPA0001-BTRTL.
      IF SY-SUBRC EQ 0.
        DEPT = T001P-BTEXT.
      ENDIF.
      SELECT SINGLE * FROM T001W WHERE WERKS EQ ZDMS1-WERKS.
      IF SY-SUBRC EQ 0.
        KUNNR = T001W-KUNNR.
      ENDIF.
    ENDIF.
    SELECT SINGLE * FROM ZDMS4 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM.
    IF SY-SUBRC EQ 0.
      CCNUMB1 = ZDMS4-CCNUMB1.
    ENDIF.
  ENDIF.
ENDFORM.
*&---------------------------------------------------------------------*
*&      Module  STATUS_9005  OUTPUT
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
MODULE STATUS_9005 OUTPUT.

  IF CC1  EQ 'X' AND ( R31 EQ 'X' OR R32 EQ 'X' OR R33 EQ 'X' ) .
    SET PF-STATUS 'CREATE'.
    SET TITLEBAR 'QA'.
*    PERFORM DEPTQA.
    PERFORM INITDET.


    IF R31 EQ 'X'.
      PERFORM DEPTQA.
      PERFORM PROCCHK.
      LOOP AT SCREEN.
        IF SCREEN-GROUP1 EQ '001'.
        ELSE.
          SCREEN-INPUT = 0.
          MODIFY SCREEN.
        ENDIF.
      ENDLOOP.
      SELECT SINGLE * FROM ZDMS4 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM.
      IF SY-SUBRC EQ 0.
        IF ZDMS4-QHAPPROVE EQ 'X' OR ZDMS4-QHREJECT EQ 'X'.
          MESSAGE 'APPROVAL / REJECTION IS ALREADY DONE' TYPE 'I'.
          LEAVE TO SCREEN 0.
          LOOP AT SCREEN.
            IF SCREEN-GROUP1 EQ '001'.
              SCREEN-INPUT = 0.
              MODIFY SCREEN.
            ENDIF.
          ENDLOOP.
        ENDIF.
      ENDIF.
    ELSEIF R32 EQ 'X'.

      PERFORM DEPTHEADQA.
*      PERFORM DEPTQAH.
      PERFORM REJECTION.
      PERFORM PROCCHK.  " check all impacted
      LOOP AT SCREEN.
        IF SCREEN-GROUP1 EQ '001'.
        ELSEIF SCREEN-GROUP1 EQ '002'.
        ELSE.
          SCREEN-INPUT = 0.
          MODIFY SCREEN.
        ENDIF.
      ENDLOOP.
      SELECT SINGLE * FROM ZDMS4 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM.
      IF SY-SUBRC EQ 0.
        IF ZDMS4-QHAPPROVE EQ 'X' OR ZDMS4-QHREJECT EQ 'X'.
          MESSAGE 'APPROVAL/REJECTION IS ALREADY DONE' TYPE 'I'.
          LEAVE TO SCREEN 0.
          LOOP AT SCREEN.
            IF SCREEN-GROUP1 EQ '001'.
              SCREEN-INPUT = 0.
              MODIFY SCREEN.
            ELSEIF SCREEN-GROUP1 EQ '002'.
              SCREEN-INPUT = 0.
              MODIFY SCREEN.
            ENDIF.
          ENDLOOP.
        ENDIF.
      ENDIF.
    ELSEIF R33 EQ 'X'.
      SELECT SINGLE * FROM ZDMS4 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM.
      IF SY-SUBRC EQ 0.
        IF ZDMS4-TDAPPROVE EQ 'X' OR ZDMS4-TDREJECT EQ 'X'.
          MESSAGE 'APPROVAL / REJECTION IS ALREADY DONE' TYPE 'I'.
          LEAVE TO SCREEN 0.
          LOOP AT SCREEN.
            SCREEN-INPUT = 0.
            MODIFY SCREEN.
          ENDLOOP.
        ENDIF.
      ENDIF.
*      BREAK-POINT .
*      LOOP AT IT_ZDMS2 INTO WA_ZDMS2.
*        IF WA_ZDMS2-NA NE 'X'.
*          IF WA_ZDMS2-ATEXT1 EQ SPACE.
*            MESSAGE 'IMPACTED ACTIVITIES ARE NOT YET ENTERD' TYPE 'E'.
*          ENDIF.
*        ENDIF.
*      ENDLOOP.
      SELECT SINGLE * FROM ZDMS4 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM.
      IF SY-SUBRC EQ 0.
        IF ZDMS4-QHAPPROVE EQ 'X' OR ZDMS4-QHREJECT EQ 'X'.
        ELSE.
          MESSAGE 'QA HEAD NOT YET APPROVE/REJECT CHANGE CONTROL' TYPE 'I'.
          LEAVE TO SCREEN 0.
        ENDIF.
      ELSE.
        MESSAGE 'QA HEAD NOT YET APPROVE/REJECT CHANGE CONTROL' TYPE 'I'.
        LEAVE TO SCREEN 0.
      ENDIF.
      PERFORM DEPTTD.
      LOOP AT SCREEN.
        IF SCREEN-GROUP1 EQ '001'.
*        ELSEIF SCREEN-GROUP1 EQ '002'.
        ELSEIF SCREEN-GROUP1 EQ '003'.
        ELSE.
          SCREEN-INPUT = 0.
          MODIFY SCREEN.
        ENDIF.
      ENDLOOP.
*      LOOP AT SCREEN.
*        IF SCREEN-GROUP1 EQ '003'.
*        ELSE.
*          SCREEN-INPUT = 0.
*          MODIFY SCREEN.
*        ENDIF.
*      ENDLOOP.
      SELECT SINGLE * FROM ZDMS4 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM.
      IF SY-SUBRC EQ 0.
        IF ZDMS4-CL1 EQ 'X'.
          LOOP AT SCREEN.
            IF SCREEN-GROUP1 EQ '003'.
              SCREEN-INPUT = 0.
              MODIFY SCREEN.
            ENDIF.
          ENDLOOP.
        ENDIF.
      ENDIF.
*    ELSEIF R34 EQ 'X'.
*      LOOP AT SCREEN.
*        IF SCREEN-GROUP1 EQ '004'.
*        ELSE.
*          SCREEN-INPUT = 0.
*          MODIFY SCREEN.
*        ENDIF.
*      ENDLOOP.
*      SELECT SINGLE * FROM ZDMS4 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM.
*      IF SY-SUBRC EQ 0.
*        IF ZDMS4-CL2 EQ 'X'.
*          LOOP AT SCREEN.
*            IF SCREEN-GROUP1 EQ '004'.
*              SCREEN-INPUT = 0.
*              MODIFY SCREEN.
*            ENDIF.
*          ENDLOOP.
*        ENDIF.
*      ENDIF.
    ENDIF.
*      BREAK-POINT.

*    ***********************SUBJECT*********************
    CLEAR : QSUB1,QSUB2,QSUB3.
    SELECT SINGLE * FROM ZDMS1 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM.
    IF SY-SUBRC EQ 0.
      QSUB1 = ZDMS1-QAREMARK1.
      QSUB2 = ZDMS1-QAREMARK2.
      QSUB3 = ZDMS1-QAREMARK3.
    ENDIF.

    SELECT SINGLE * FROM ZDMS1 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM.
    IF SY-SUBRC EQ 0.
      DTEXT1 = ZDMS1-DTEXT1.
      DTEXT2 = ZDMS1-DTEXT2.
      DTEXT3 = ZDMS1-DTEXT3.
      DTEXT4 = ZDMS1-DTEXT4.
      DTEXT5 = ZDMS1-DTEXT5.

      ETEXT1 = ZDMS1-ETEXT1.
      ETEXT2 = ZDMS1-ETEXT2.
      ETEXT3 = ZDMS1-ETEXT3.
      ETEXT4 = ZDMS1-ETEXT4.
      ETEXT5 = ZDMS1-ETEXT5.

      FTEXT1 = ZDMS1-FTEXT1.
      FTEXT2 = ZDMS1-FTEXT2.
      FTEXT3 = ZDMS1-FTEXT3.
      FTEXT4 = ZDMS1-FTEXT4.
      FTEXT5 = ZDMS1-FTEXT5.
    ENDIF.
    CLEAR: RPNSTAT.

    SELECT SINGLE * FROM ZDMS4 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM.
    IF SY-SUBRC EQ 0.
      RPN_S = ZDMS4-RPN_S.
      RPN_P = ZDMS4-RPN_P.
      RPN_D = ZDMS4-RPN_D.
      RRTEXT1 = ZDMS4-RTEXT1.
      RRTEXT2 = ZDMS4-RTEXT2.
      RRTEXT3 = ZDMS4-RTEXT3.
      RPN = RPN_S * RPN_P * RPN_D.
      CLEAR : RPNSTAT.
      IF RPN GT 0 AND RPN LE 25.
        RPNSTAT = 'MINOR'.
      ELSEIF RPN GT 25 AND RPN LE 75.
        RPNSTAT = 'MAJOR'.
      ELSEIF RPN GT 75 AND RPN LE 125.
        RPNSTAT = 'CRITICAL'.
      ENDIF.
      CHGTYPN = ZDMS4-CHGTYPN.
      CHGTYPM = ZDMS4-CHGTYPM.
      RPNPERNR = ZDMS4-PERNR.
      RPNDATE = ZDMS4-BUDAT.
      QHREM = ZDMS4-QHREM.
      QHAPPROVE = ZDMS4-QHAPPROVE.
      QHREJECT = ZDMS4-QHREJECT.
      TDREM = ZDMS4-TDREM.
      TDREM1 = ZDMS4-TDREM1.
      TDREM2 = ZDMS4-TDREM2.
      TDAPPROVE = ZDMS4-TDAPPROVE.
      TDREJECT = ZDMS4-TDREJECT.
      CL1 = ZDMS4-CL1.
      SELECT SINGLE * FROM PA0001 WHERE PERNR EQ ZDMS4-PERNR AND ENDDA GT SY-DATUM AND PLANS NE '99999999'.
      IF SY-SUBRC EQ 0.
        RPNNAME = PA0001-ENAME.
      ENDIF.
      RPNDT = ZDMS4-BUDAT.
      SELECT SINGLE * FROM PA0001 WHERE PERNR EQ ZDMS4-QHPERNR AND ENDDA GT SY-DATUM AND PLANS NE '99999999'.
      IF SY-SUBRC EQ 0.
        QHRPNNAME = PA0001-ENAME.
      ENDIF.
      QHRPNDT = ZDMS4-QHDATE.
      SELECT SINGLE * FROM PA0001 WHERE PERNR EQ ZDMS4-TDPERNR AND ENDDA GT SY-DATUM AND PLANS NE '99999999'.
      IF SY-SUBRC EQ 0.
        TDRPNNAME = PA0001-ENAME.
      ENDIF.
      TDRPNDT = ZDMS4-TDDATE.
    ENDIF.

  ENDIF.
ENDMODULE.
*&---------------------------------------------------------------------*
*&      Module  USER_COMMAND_9005  INPUT
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
MODULE USER_COMMAND_9005 INPUT.
  CASE OK.

    WHEN 'SAVE'.
      IF RPN_S GT 5 OR RPN_S LT 1.
        MESSAGE 'CHECK SEVERATY RATING' TYPE 'I'.
        EXIT.
      ENDIF.
      IF RPN_P GT 5 OR RPN_P LT 1.
        MESSAGE 'CHECK PROBABILITY RATING' TYPE 'I'.
        EXIT.
      ENDIF.
      IF RPN_D GT 5 OR RPN_D LT 1.
        MESSAGE 'CHECK DETECTION RATING' TYPE 'I'.
        EXIT.
      ENDIF.

      IF CHGTYPN EQ ' ' AND CHGTYPM EQ ' '.
        MESSAGE 'SELECT TYPE OF CHANGE EITHER NEW OR MODIFICATION' TYPE 'I'.
        EXIT.
      ENDIF.

      IF R31 EQ 'X'.

        IF CHGTYPN EQ 'X' AND CHGTYPM EQ 'X'.
          MESSAGE 'SELECT EITHER NEW OR MODIFICATION' TYPE 'I'.
          EXIT.
        ENDIF.

        SELECT SINGLE * FROM ZDMS4 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM.
        IF SY-SUBRC EQ 0.
          MOVE-CORRESPONDING ZDMS4 TO ZDMS4_WA.
          ZDMS4_WA-MJAHR = YEAR.
          ZDMS4_WA-MBLNR = CCNUM.
          ZDMS4_WA-PERNR = PERNR.
          ZDMS4_WA-BUDAT = SY-DATUM.
          ZDMS4_WA-UZEIT = SY-UZEIT.
          ZDMS4_WA-UNAME = SY-UNAME.
          ZDMS4_WA-RPN_S = RPN_S.
          ZDMS4_WA-RPN_P = RPN_P.
          ZDMS4_WA-RPN_D = RPN_D.
          ZDMS4_WA-RTEXT1 = RRTEXT1.
          ZDMS4_WA-RTEXT2 = RRTEXT2.
          ZDMS4_WA-RTEXT3 = RRTEXT3.
          ZDMS4_WA-CHGTYPN = CHGTYPN.
          ZDMS4_WA-CHGTYPM = CHGTYPM.
*        ZDMS4_WA-QHAPPROVE = QHAPPROVE.
*        ZDMS4_WA-QHREJECT = QHREJECT.

          MODIFY ZDMS4 FROM ZDMS4_WA.
          CLEAR ZDMS4_WA.
        ENDIF.

        SELECT SINGLE * FROM ZDMS1 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM.
        IF SY-SUBRC EQ 0.
          MOVE-CORRESPONDING ZDMS1 TO ZDMS1_WA.
          ZDMS1_WA-DTEXT1 = DTEXT1.
          ZDMS1_WA-DTEXT2 = DTEXT2.
          ZDMS1_WA-DTEXT3 = DTEXT3.
          ZDMS1_WA-DTEXT4 = DTEXT4.
          ZDMS1_WA-DTEXT5 = DTEXT5.

          ZDMS1_WA-ETEXT1 = ETEXT1.
          ZDMS1_WA-ETEXT2 = ETEXT2.
          ZDMS1_WA-ETEXT3 = ETEXT3.
          ZDMS1_WA-ETEXT4 = ETEXT4.
          ZDMS1_WA-ETEXT5 = ETEXT5.

          ZDMS1_WA-FTEXT1 = FTEXT1.
          ZDMS1_WA-FTEXT2 = FTEXT2.
          ZDMS1_WA-FTEXT3 = FTEXT3.
          ZDMS1_WA-FTEXT4 = FTEXT4.
          ZDMS1_WA-FTEXT5 = FTEXT5.
          MODIFY ZDMS1 FROM ZDMS1_WA.
          CLEAR ZDMS1_WA.
        ENDIF.

        MESSAGE 'DATA SAVED' TYPE 'I'.
*        LEAVE TO TRANSACTION 'ZQMS'.
        LEAVE TO SCREEN 0.
      ELSEIF R32 EQ 'X'.

*        BREAK-POINT.
        SELECT SINGLE * FROM ZDMS4 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM.
        IF SY-SUBRC EQ 0.
          PERFORM DEPTSTATUS.
          IF QHAPPROVE EQ 'X' AND QHREJECT EQ 'X'.
            MESSAGE 'EITHER APPROVE OR REJECT' TYPE 'I'.
            EXIT.
          ENDIF.

          IF QHAPPROVE EQ SPACE AND QHREJECT EQ SPACE.  "16.2.21
            MESSAGE 'EITHER APPROVE OR REJECT' TYPE 'I'.
            EXIT.
          ENDIF.
*           IF TDAPPROVE EQ ' ' AND TDREJECT EQ ' '.
*            MESSAGE 'EITHER APPROVE OR REJECT' TYPE 'I'.
*            EXIT.
*          ENDIF.
          MOVE-CORRESPONDING ZDMS4 TO ZDMS4_WA.
*          ZDMS4_WA-MJAHR = YEAR.
*          ZDMS4_WA-MBLNR = CCNUM.
          ZDMS4_WA-PERNR = RPNPERNR.
          ZDMS4_WA-BUDAT = RPNDATE.
          ZDMS4_WA-RPN_S = RPN_S.
          ZDMS4_WA-RPN_P = RPN_P.
          ZDMS4_WA-RPN_D = RPN_D.
          ZDMS4_WA-RTEXT1 = RRTEXT1.
          ZDMS4_WA-RTEXT2 = RRTEXT2.
          ZDMS4_WA-RTEXT3 = RRTEXT3.
          ZDMS4_WA-CHGTYPN = CHGTYPN.
          ZDMS4_WA-CHGTYPM = CHGTYPM.
          ZDMS4_WA-QHREM = QHREM.
          ZDMS4_WA-QHAPPROVE = QHAPPROVE.
          ZDMS4_WA-QHREJECT = QHREJECT.
          ZDMS4_WA-QHPERNR = PERNR.
          ZDMS4_WA-QHDATE = SY-DATUM.
          ZDMS4_WA-QHUZEIT = SY-UZEIT.
          ZDMS4_WA-QHUNAME = SY-UNAME.
*          ZDMS4_WA-CCNUMB = ZDMS4-CCNUMB.
*          ZDMS4_WA-CCNUMB1 = ZDMS4-CCNUMB1.
          MODIFY ZDMS4 FROM ZDMS4_WA.
          CLEAR ZDMS4_WA.

          SELECT SINGLE * FROM ZDMS1 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM.
          IF SY-SUBRC EQ 0.
            MOVE-CORRESPONDING ZDMS1 TO ZDMS1_WA.
            ZDMS1_WA-DTEXT1 = DTEXT1.
            ZDMS1_WA-DTEXT2 = DTEXT2.
            ZDMS1_WA-DTEXT3 = DTEXT3.
            ZDMS1_WA-DTEXT4 = DTEXT4.
            ZDMS1_WA-DTEXT5 = DTEXT5.

            ZDMS1_WA-ETEXT1 = ETEXT1.
            ZDMS1_WA-ETEXT2 = ETEXT2.
            ZDMS1_WA-ETEXT3 = ETEXT3.
            ZDMS1_WA-ETEXT4 = ETEXT4.
            ZDMS1_WA-ETEXT5 = ETEXT5.

            ZDMS1_WA-FTEXT1 = FTEXT1.
            ZDMS1_WA-FTEXT2 = FTEXT2.
            ZDMS1_WA-FTEXT3 = FTEXT3.
            ZDMS1_WA-FTEXT4 = FTEXT4.
            ZDMS1_WA-FTEXT5 = FTEXT5.
            MODIFY ZDMS1 FROM ZDMS1_WA.
            CLEAR ZDMS1_WA.
          ENDIF.

          MESSAGE 'DATA SAVED' TYPE 'I'.
          PERFORM EMAIL.
*          LEAVE TO TRANSACTION 'ZQMS'.
          LEAVE TO SCREEN 0.
        ELSE.
          MESSAGE 'RISK REVIEW NOT YET DONE' TYPE 'I'.
          LEAVE TO SCREEN 0.
        ENDIF.
*        ELSE.
*          PERFORM CCNUM.
*          ZDMS4_WA-MJAHR = YEAR.
*          ZDMS4_WA-MBLNR = CCNUM.
*          ZDMS4_WA-PERNR = RPNPERNR.
*          ZDMS4_WA-BUDAT = RPNDATE.
*          ZDMS4_WA-RPN_S = RPN_S.
*          ZDMS4_WA-RPN_P = RPN_P.
*          ZDMS4_WA-RPN_D = RPN_D.
*          ZDMS4_WA-RTEXT1 = RRTEXT1.
*          ZDMS4_WA-RTEXT2 = RRTEXT2.
*          ZDMS4_WA-RTEXT3 = RRTEXT3.
*          ZDMS4_WA-CHGTYPN = CHGTYPN.
*          ZDMS4_WA-CHGTYPM = CHGTYPM.
*          ZDMS4_WA-QHAPPROVE = QHAPPROVE.
*          ZDMS4_WA-QHREJECT = QHREJECT.
*          ZDMS4_WA-QHPERNR = PERNR.
*          ZDMS4_WA-QHDATE = SY-DATUM.
*          ZDMS4_WA-CCNUMB = FINV1.
*          ZDMS4_WA-CCNUMB1 = FINVNUMB.
*          MODIFY ZDMS4 FROM ZDMS4_WA.
*          CLEAR ZDMS4_WA.
*          MESSAGE 'DATA SAVED' TYPE 'I'.
*          SET SCREEN 0.
*          LEAVE SCREEN.
*        ENDIF.

      ELSEIF R33 EQ 'X'.

        SELECT SINGLE * FROM ZDMS4 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM AND CCNUMB1 NE SPACE.
        IF SY-SUBRC EQ 0.
*          IF QHAPPROVE EQ 'X' AND QHREJECT EQ 'X'.
          IF TDAPPROVE EQ 'X' AND TDREJECT EQ 'X'.
            MESSAGE 'EITHER APPROVE OR REJECT' TYPE 'I'.
            EXIT.
          ENDIF.
          IF TDAPPROVE EQ ' ' AND TDREJECT EQ ' '.
            MESSAGE 'EITHER APPROVE OR REJECT' TYPE 'I'.
            EXIT.
          ENDIF.
          MOVE-CORRESPONDING ZDMS4 TO ZDMS4_WA.
*          ZDMS4_WA-MJAHR = YEAR.
*          ZDMS4_WA-MBLNR = CCNUM.
          ZDMS4_WA-PERNR = RPNPERNR.
          ZDMS4_WA-BUDAT = RPNDATE.
          ZDMS4_WA-RPN_S = RPN_S.
          ZDMS4_WA-RPN_P = RPN_P.
          ZDMS4_WA-RPN_D = RPN_D.
          ZDMS4_WA-RTEXT1 = RRTEXT1.
          ZDMS4_WA-RTEXT2 = RRTEXT2.
          ZDMS4_WA-RTEXT3 = RRTEXT3.
          ZDMS4_WA-CHGTYPN = CHGTYPN.
          ZDMS4_WA-CHGTYPM = CHGTYPM.
*          ZDMS4_WA-QHAPPROVE = QHAPPROVE.
*          ZDMS4_WA-QHREJECT = QHREJECT.
*          ZDMS4_WA-QHPERNR = PERNR.
*          ZDMS4_WA-QHDATE = SY-DATUM.
*          ZDMS4_WA-CCNUMB = ZDMS4-CCNUMB.
*          ZDMS4_WA-CCNUMB1 = ZDMS4-CCNUMB1.
          ZDMS4_WA-TDREM = TDREM.
          ZDMS4_WA-TDREM1 = TDREM1.
          ZDMS4_WA-TDREM2 = TDREM2.
          ZDMS4_WA-TDAPPROVE = TDAPPROVE.
          ZDMS4_WA-TDREJECT = TDREJECT.
          ZDMS4_WA-TDPERNR = PERNR.
          ZDMS4_WA-TDDATE = SY-DATUM.
          ZDMS4_WA-TDUZEIT = SY-UZEIT.
          ZDMS4_WA-TDUNAME = SY-UNAME.
          MODIFY ZDMS4 FROM ZDMS4_WA.
          CLEAR ZDMS4_WA.

          SELECT SINGLE * FROM ZDMS1 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM.
          IF SY-SUBRC EQ 0.
            MOVE-CORRESPONDING ZDMS1 TO ZDMS1_WA.
            ZDMS1_WA-DTEXT1 = DTEXT1.
            ZDMS1_WA-DTEXT2 = DTEXT2.
            ZDMS1_WA-DTEXT3 = DTEXT3.
            ZDMS1_WA-DTEXT4 = DTEXT4.
            ZDMS1_WA-DTEXT5 = DTEXT5.

            ZDMS1_WA-ETEXT1 = ETEXT1.
            ZDMS1_WA-ETEXT2 = ETEXT2.
            ZDMS1_WA-ETEXT3 = ETEXT3.
            ZDMS1_WA-ETEXT4 = ETEXT4.
            ZDMS1_WA-ETEXT5 = ETEXT5.

            ZDMS1_WA-FTEXT1 = FTEXT1.
            ZDMS1_WA-FTEXT2 = FTEXT2.
            ZDMS1_WA-FTEXT3 = FTEXT3.
            ZDMS1_WA-FTEXT4 = FTEXT4.
            ZDMS1_WA-FTEXT5 = FTEXT5.
            MODIFY ZDMS1 FROM ZDMS1_WA.
            CLEAR ZDMS1_WA.
          ENDIF.

          MESSAGE 'DATA SAVED' TYPE 'I'.

          PERFORM EMAIL.

*          LEAVE TO TRANSACTION 'ZQMS'.
          LEAVE TO SCREEN 0.
          EXIT.
        ELSE.
          SELECT SINGLE * FROM ZDMS4 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM AND CCNUMB1 EQ SPACE.
          IF SY-SUBRC EQ 0.
            IF TDAPPROVE EQ 'X' AND TDREJECT EQ 'X'.
              MESSAGE 'EITHER APPROVE OR REJECT' TYPE 'I'.
              EXIT.
            ENDIF.
            IF TDAPPROVE EQ ' ' AND TDREJECT EQ ' '.
              MESSAGE 'EITHER APPROVE OR REJECT' TYPE 'I'.
              EXIT.
            ENDIF.
            MOVE-CORRESPONDING ZDMS4 TO ZDMS4_WA.
*            PERFORM CCNUM.
*          ZDMS4_WA-MJAHR = YEAR.
*          ZDMS4_WA-MBLNR = CCNUM.
            ZDMS4_WA-PERNR = RPNPERNR.
            ZDMS4_WA-BUDAT = RPNDATE.
            ZDMS4_WA-RPN_S = RPN_S.
            ZDMS4_WA-RPN_P = RPN_P.
            ZDMS4_WA-RPN_D = RPN_D.
            ZDMS4_WA-RTEXT1 = RRTEXT1.
            ZDMS4_WA-RTEXT2 = RRTEXT2.
            ZDMS4_WA-RTEXT3 = RRTEXT3.
            ZDMS4_WA-CHGTYPN = CHGTYPN.
            ZDMS4_WA-CHGTYPM = CHGTYPM.
*          ZDMS4_WA-QHAPPROVE = QHAPPROVE.
*          ZDMS4_WA-QHREJECT = QHREJECT.
*          ZDMS4_WA-QHPERNR = PERNR.
*          ZDMS4_WA-QHDATE = SY-DATUM.
            ZDMS4_WA-TDREM = TDREM.
            ZDMS4_WA-TDREM1 = TDREM1.
            ZDMS4_WA-TDREM2 = TDREM2.
            ZDMS4_WA-TDAPPROVE = TDAPPROVE.
            ZDMS4_WA-TDREJECT = TDREJECT.
            ZDMS4_WA-TDPERNR = PERNR.
            ZDMS4_WA-TDDATE = SY-DATUM.
            ZDMS4_WA-TDUZEIT = SY-UZEIT.
            ZDMS4_WA-TDUNAME = SY-UNAME.
*            ZDMS4_WA-CCNUMB = FINV1.
*            ZDMS4_WA-CCNUMB1 = FINVNUMB.
            MODIFY ZDMS4 FROM ZDMS4_WA.
            CLEAR ZDMS4_WA.

            SELECT SINGLE * FROM ZDMS1 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM.
            IF SY-SUBRC EQ 0.
              MOVE-CORRESPONDING ZDMS1 TO ZDMS1_WA.
              ZDMS1_WA-DTEXT1 = DTEXT1.
              ZDMS1_WA-DTEXT2 = DTEXT2.
              ZDMS1_WA-DTEXT3 = DTEXT3.
              ZDMS1_WA-DTEXT4 = DTEXT4.
              ZDMS1_WA-DTEXT5 = DTEXT5.

              ZDMS1_WA-ETEXT1 = ETEXT1.
              ZDMS1_WA-ETEXT2 = ETEXT2.
              ZDMS1_WA-ETEXT3 = ETEXT3.
              ZDMS1_WA-ETEXT4 = ETEXT4.
              ZDMS1_WA-ETEXT5 = ETEXT5.

              ZDMS1_WA-FTEXT1 = FTEXT1.
              ZDMS1_WA-FTEXT2 = FTEXT2.
              ZDMS1_WA-FTEXT3 = FTEXT3.
              ZDMS1_WA-FTEXT4 = FTEXT4.
              ZDMS1_WA-FTEXT5 = FTEXT5.
              MODIFY ZDMS1 FROM ZDMS1_WA.
              CLEAR ZDMS1_WA.
            ENDIF.
            MESSAGE 'DATA SAVED' TYPE 'I'.
            PERFORM EMAIL.
*            LEAVE TO TRANSACTION 'ZQMS'.
            LEAVE TO SCREEN 0.
          ENDIF.
        ENDIF.

*        SELECT SINGLE * FROM ZDMS4 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM.
*        IF SY-SUBRC EQ 0.
*          IF TDAPPROVE EQ 'X' AND TDREJECT EQ 'X'.
*            MESSAGE 'EITHER APPROVE OR REJECT' TYPE 'I'.
*            EXIT.
*          ENDIF.
*          MOVE-CORRESPONDING ZDMS4 TO ZDMS4_WA.
*          ZDMS4_WA-TDAPPROVE = TDAPPROVE.
*          ZDMS4_WA-TDREJECT = TDREJECT.
*          ZDMS4_WA-TDPERNR = PERNR.
*          ZDMS4_WA-TDDATE = SY-DATUM.
*          MODIFY ZDMS4 FROM ZDMS4_WA.
*          CLEAR ZDMS4_WA.
*          MESSAGE 'DATA SAVED' TYPE 'I'.
*          SET SCREEN 0.
*          LEAVE SCREEN.
*        ENDIF.


*      ELSEIF R34 EQ 'X'.
*        SELECT SINGLE * FROM ZDMS4 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM.
*        IF SY-SUBRC EQ 0.
*          MOVE-CORRESPONDING ZDMS4 TO ZDMS4_WA.
*          ZDMS4_WA-CL1 = CL1.
*          ZDMS4_WA-CL1PERNR = PERNR.
*          ZDMS4_WA-CL1DATE = SY-DATUM.
*          MODIFY ZDMS4 FROM ZDMS4_WA.
*          CLEAR ZDMS4_WA.
*          MESSAGE 'DATA SAVED' TYPE 'I'.
*          SET SCREEN 0.
*          LEAVE SCREEN.
*        ENDIF.
      ENDIF.


*        ZDMS4_WA-MJAHR = YEAR.
*        ZDMS4_WA-MBLNR = CCNUM.
*        ZDMS4_WA-PERNR = PERNR.
*        ZDMS4_WA-BUDAT = SY-DATUM.
*        ZDMS4_WA-RPN_S = RPN_S.
*        ZDMS4_WA-RPN_P = RPN_P.
*        ZDMS4_WA-RPN_D = RPN_D.
*        ZDMS4_WA-RTEXT1 = RTEXT1.
*        ZDMS4_WA-RTEXT2 = RTEXT2.
*        ZDMS4_WA-RTEXT3 = RTEXT3.
*        ZDMS4_WA-QHAPPROVE = QHAPPROVE.
*        ZDMS4_WA-QHREJECT = QHREJECT.
*        ZDMS4_WA-QHPERNR = PERNR.
*        MODIFY ZDMS4 FROM ZDMS4_WA.
*        CLEAR ZDMS4_WA.
*        MESSAGE 'DATA SAVED' TYPE 'I'.
*        SET SCREEN 0.
*        LEAVE SCREEN.
*        ENDIF.

    WHEN 'BACK' OR 'EXIT'.
      SET SCREEN 0.
      LEAVE SCREEN.

  ENDCASE.
ENDMODULE.
*&---------------------------------------------------------------------*
*&      Form  CCNUM
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM CCNUM .
*************************** CHANGE CONTROL NUMBER**************************************************
*  BREAK-POINT.
  SELECT SINGLE * FROM ZDMS1 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM AND ZTYP EQ 'CC'.
  IF SY-SUBRC EQ 0.
    SELECT SINGLE * FROM ZDMS4 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM AND CCNUMB1 EQ SPACE.
    IF SY-SUBRC EQ 0.
*      SELECT SINGLE * FROM PA0001 WHERE PERNR EQ ZDMS1-PERNR AND ENDDA GE SY-DATUM.
      SELECT SINGLE * FROM ZPA0001 WHERE PERNR EQ ZDMS1-PERNR AND ENDDA GE SY-DATUM.
      IF SY-SUBRC EQ 0.
*        IMPDEPT = PA0001-BTRTL.
        IMPDEPT = ZPA0001-BTRTL.
      ENDIF.
      SELECT * FROM ZDMS4 INTO TABLE IT_ZDMS4_1 WHERE MJAHR EQ YEAR AND WERKS EQ PLANT.
      SORT IT_ZDMS4_1 DESCENDING BY CCNUMB.
      READ TABLE IT_ZDMS4_1 INTO WA_ZDMS4_1 WITH KEY MJAHR = YEAR.
      IF SY-SUBRC EQ 0.
        VBELN1 = WA_ZDMS4_1-CCNUMB.
      ENDIF.
      FINV1 = VBELN1 + 1.
*      FINV1 = CCNUM.  " 15.12.2019
      YEAR1 = YEAR+2(2).
      IMPDEPT1 = IMPDEPT+2(2).
      IF ZDMS1-WERKS EQ '1000'.
        PLT = 'NK'.
      ELSEIF ZDMS1-WERKS EQ '1001'.
        PLT = 'GA'.
      ELSE.
        PLT = 'OS'.
      ENDIF.
      CONCATENATE 'CC/' YEAR1 '/' IMPDEPT1 '/' PLT '/' FINV1 INTO FINVNUMB.
    ENDIF.
  ENDIF.
ENDFORM.
*&---------------------------------------------------------------------*
*&      Module  STATUS_9006  OUTPUT
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
MODULE STATUS_9006 OUTPUT.
  SET PF-STATUS 'CREATE'.
  SET TITLEBAR 'TITLE'.
  PERFORM INITDET.
*  SELECT SINGLE * FROM ZDMS4 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM.
*  IF SY-SUBRC EQ 0.
*    CL2 = ZDMS4-CL2.
*  ENDIF.

  IF R8 EQ 'X'.
    PERFORM DEPTQA.
*    SELECT SINGLE * FROM ZDMS4 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM.
*    IF SY-SUBRC EQ 0.
*      IF ZDMS4-QHCL2 EQ 'X' OR ZDMS4-CL2 EQ 'X' OR ZDMS4-QHCL1 EQ 'X'.
*        LOOP AT SCREEN.
*          SCREEN-INPUT = 0.
*          MODIFY SCREEN.
*        ENDLOOP.
*      ENDIF.
*    ENDIF.

    LOOP AT SCREEN.
      IF SCREEN-GROUP2 EQ '001'.
      ELSEIF SCREEN-GROUP1 EQ '001'.
*          SCREEN-INPUT = 0.
*          MODIFY SCREEN.
      ELSE.
        SCREEN-INPUT = 0.
        MODIFY SCREEN.
      ENDIF.
    ENDLOOP.

  ELSEIF R81 EQ 'X'.
    PERFORM DEPTQA.
*    PERFORM DEPTQAH.
    PERFORM DEPTHEADQA.

    SELECT SINGLE * FROM ZDMS4 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM.
    IF SY-SUBRC EQ 0.
      IF ZDMS4-QHCL2 EQ 'X' OR ZDMS4-CL2 EQ 'X'.
        LOOP AT SCREEN.
          SCREEN-INPUT = 0.
          MODIFY SCREEN.
        ENDLOOP.
      ENDIF.
    ENDIF.

    LOOP AT SCREEN.
      IF SCREEN-GROUP1 EQ '002'.
      ELSEIF SCREEN-GROUP1 EQ '001'.
*          SCREEN-INPUT = 0.
*          MODIFY SCREEN.
      ELSE.
        SCREEN-INPUT = 0.
        MODIFY SCREEN.
      ENDIF.
    ENDLOOP.
  ELSEIF R9 EQ 'X'.

    SELECT SINGLE * FROM ZDMS4 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM AND TDAPPROVE EQ 'X' AND CL1 EQ 'X'. "10.7.20
    IF SY-SUBRC EQ 0.
    ELSE.
      MESSAGE 'PLEASE CHECK TECHNICAL DIRECTOR'' APPROVAL & CLOSURE ' TYPE 'E'.
      EXIT.
    ENDIF.


    SELECT SINGLE * FROM ZDMS4 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM.
    IF SY-SUBRC EQ 0.
      IF ZDMS4-QHCL2 EQ 'X'.
        LOOP AT SCREEN.
          SCREEN-INPUT = 0.
          MODIFY SCREEN.
        ENDLOOP.
      ENDIF.
    ENDIF.
    SELECT SINGLE * FROM ZDMS3 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM AND FOLW1 EQ 'X'.
    IF SY-SUBRC EQ 4.
      MESSAGE 'NO LONG TERM ACTIVITIES FOR CLOSURE-II' TYPE 'E'.
    ENDIF.

    LOOP AT SCREEN.
      IF SCREEN-GROUP2 EQ '003'.
      ELSEIF SCREEN-GROUP1 EQ '003'.
      ELSE.
        SCREEN-INPUT = 0.
        MODIFY SCREEN.
      ENDIF.
    ENDLOOP.
  ELSEIF R91 EQ 'X'.
    SELECT SINGLE * FROM ZDMS4 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM AND CL2 EQ 'X'. "10.7.20
    IF SY-SUBRC EQ 4.
      MESSAGE 'INVALID CHANGE CONTROL FOR CLOSURE-II' TYPE 'E'.
    ENDIF.

    SELECT SINGLE * FROM ZDMS4 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM AND TDAPPROVE EQ 'X' AND CL1 EQ 'X'. "10.7.20
    IF SY-SUBRC EQ 0.
    ELSE.
      MESSAGE 'PLEASE CHECK TECHNICAL DIRECTOR'' APPROVAL & CLOSURE ' TYPE 'E'.
      EXIT.
    ENDIF.

*    PERFORM DEPTQAH.
    PERFORM DEPTHEADQA.
    LOOP AT SCREEN.
      IF SCREEN-GROUP1 EQ '004'.
      ELSEIF SCREEN-GROUP1 EQ '003'.
      ELSE.
        SCREEN-INPUT = 0.
        MODIFY SCREEN.
      ENDIF.
    ENDLOOP.
  ENDIF.



  SELECT SINGLE * FROM ZDMS4 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM.
  IF SY-SUBRC EQ 0.
    CL1 = ZDMS4-CL1.
    CL1DT = ZDMS4-CL1DATE.
    CL1TXT1 = ZDMS4-CL1TXT1.
    CL1TXT2 = ZDMS4-CL1TXT2.
    CL1TXT3 = ZDMS4-CL1TXT3.

    QHCL1DT = ZDMS4-QHCL1DATE.
    QHCL1 = ZDMS4-QHCL1.
    SELECT SINGLE * FROM PA0001 WHERE PERNR EQ ZDMS4-CL1PERNR AND PLANS NE '99999999'.
    IF SY-SUBRC EQ 0.
      CL1BY = PA0001-ENAME.
    ENDIF.
    SELECT SINGLE * FROM PA0001 WHERE PERNR EQ ZDMS4-QHCL1PERNR AND PLANS NE '99999999'.
    IF SY-SUBRC EQ 0.
      QHCL1BY = PA0001-ENAME.
    ENDIF.
    CL2 = ZDMS4-CL2.
    CL2DT = ZDMS4-CL2DATE.
    CL2TXT1 = ZDMS4-CL2TXT1.
    CL2TXT2 = ZDMS4-CL2TXT2.
    CL2TXT3 = ZDMS4-CL2TXT3.
    QHCL2DT = ZDMS4-QHCL2DATE.
    QHCL2 = ZDMS4-QHCL2.
    SELECT SINGLE * FROM PA0001 WHERE PERNR EQ ZDMS4-CL2PERNR AND PLANS NE '99999999'.
    IF SY-SUBRC EQ 0.
      CL2BY = PA0001-ENAME.
    ENDIF.
    SELECT SINGLE * FROM PA0001 WHERE PERNR EQ ZDMS4-QHCL2PERNR AND PLANS NE '99999999'.
    IF SY-SUBRC EQ 0.
      QHCL2BY = PA0001-ENAME.
    ENDIF.
  ENDIF.


ENDMODULE.
*&---------------------------------------------------------------------*
*&      Module  USER_COMMAND_9006  INPUT
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
MODULE USER_COMMAND_9006 INPUT.
  CASE OK.
    WHEN 'SAVE'.

      IF CC1  EQ 'X' AND R8 EQ 'X'.
        SELECT SINGLE * FROM ZDMS4 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM.
        IF SY-SUBRC EQ 0.
          PERFORM CL1CHK.
          MOVE-CORRESPONDING ZDMS4 TO ZDMS4_WA.
          ZDMS4_WA-CL1 = CL1.
          ZDMS4_WA-CL1PERNR = PERNR.
          ZDMS4_WA-CL1DATE = SY-DATUM.
          ZDMS4_WA-CL1UZEIT = SY-UZEIT.
          ZDMS4_WA-CL1UNAME = SY-UNAME.
          ZDMS4_WA-CL1TXT1 = CL1TXT1.
          ZDMS4_WA-CL1TXT2 = CL1TXT2.
          ZDMS4_WA-CL1TXT3 = CL1TXT3.
          MODIFY ZDMS4 FROM ZDMS4_WA.
          CLEAR : ZDMS4_WA.
        ENDIF.
        IF SY-SUBRC EQ 0.
          MESSAGE 'DATA SAVED' TYPE 'I'.
        ENDIF.
*        LEAVE TO TRANSACTION 'ZQMS'.
        LEAVE TO SCREEN 0.
      ELSEIF CC1  EQ 'X' AND R81 EQ 'X'.
        SELECT SINGLE * FROM ZDMS4 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM.
        IF SY-SUBRC EQ 0.
          PERFORM CL1CHK.
          MOVE-CORRESPONDING ZDMS4 TO ZDMS4_WA.
          ZDMS4_WA-CL1TXT1 = CL1TXT1.
          ZDMS4_WA-CL1TXT2 = CL1TXT2.
          ZDMS4_WA-CL1TXT3 = CL1TXT3.
          ZDMS4_WA-QHCL1 = QHCL1.
          ZDMS4_WA-QHCL1PERNR = PERNR.
          ZDMS4_WA-QHCL1DATE = SY-DATUM.
          ZDMS4_WA-QHCL1UZEIT = SY-UZEIT.
          ZDMS4_WA-QHCL1UNAME = SY-UNAME.
          MODIFY ZDMS4 FROM ZDMS4_WA.
          CLEAR : ZDMS4_WA.
        ENDIF.
        PERFORM EMAIL.  "14.6.22
        IF SY-SUBRC EQ 0.
          MESSAGE 'DATA SAVED' TYPE 'I'.
        ENDIF.
*        LEAVE TO TRANSACTION 'ZQMS'.
        LEAVE TO SCREEN 0.
      ELSEIF CC1  EQ 'X' AND R9 EQ 'X'.
*        BREAK-POINT.
        SELECT SINGLE * FROM ZDMS4 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM.
        IF SY-SUBRC EQ 0.
          PERFORM CL2CHK.
          MOVE-CORRESPONDING ZDMS4 TO ZDMS4_WA.
          ZDMS4_WA-CL2 = CL2.
          ZDMS4_WA-CL2PERNR = PERNR.
          ZDMS4_WA-CL2DATE = SY-DATUM.
          ZDMS4_WA-CL2UZEIT = SY-UZEIT.
          ZDMS4_WA-CL2UNAME = SY-UNAME.
          ZDMS4_WA-CL2TXT1 = CL2TXT1.
          ZDMS4_WA-CL2TXT2 = CL2TXT2.
          ZDMS4_WA-CL2TXT3 = CL2TXT3.
          MODIFY ZDMS4 FROM ZDMS4_WA.
          CLEAR : ZDMS4_WA.
        ENDIF.
        IF SY-SUBRC EQ 0.
          MESSAGE 'DATA SAVED' TYPE 'I'.
        ENDIF.
*        LEAVE TO TRANSACTION 'ZQMS'.
        LEAVE TO SCREEN 0.
      ELSEIF CC1  EQ 'X' AND R91 EQ 'X'.
        SELECT SINGLE * FROM ZDMS4 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM.
        IF SY-SUBRC EQ 0.
          MOVE-CORRESPONDING ZDMS4 TO ZDMS4_WA.
          ZDMS4_WA-CL2TXT1 = CL2TXT1.
          ZDMS4_WA-CL2TXT2 = CL2TXT2.
          ZDMS4_WA-CL2TXT3 = CL2TXT3.
          ZDMS4_WA-QHCL2 = QHCL2.
          ZDMS4_WA-QHCL2PERNR = PERNR.
          ZDMS4_WA-QHCL2DATE = SY-DATUM.
          ZDMS4_WA-QHCL2UZEIT = SY-UZEIT.
          ZDMS4_WA-QHCL2UNAME = SY-UNAME.
          MODIFY ZDMS4 FROM ZDMS4_WA.
          CLEAR : ZDMS4_WA.
        ENDIF.

        PERFORM EMAIL.  "14.6.22
        IF SY-SUBRC EQ 0.
          MESSAGE 'DATA SAVED' TYPE 'I'.
        ENDIF.
*        LEAVE TO TRANSACTION 'ZQMS'.
        LEAVE TO SCREEN 0.
      ENDIF.
    WHEN 'BACK' OR 'EXIT'.
      LEAVE TO TRANSACTION 'ZQMS'.

  ENDCASE.


ENDMODULE.
*&---------------------------------------------------------------------*
*&      Form  UPD1
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM UPD1.

*  LOOP AT IT_ZDMS3 INTO WA_ZDMS3 WHERE DEPT EQ ZDMS1-DEPT1.
*    SELECT SINGLE * FROM PA0001 WHERE PERNR EQ WA_ZDMS3-PERNR AND ENDDA GE SY-DATUM.
*    IF SY-SUBRC EQ 0.
*      INAME1 = PA0001-ENAME.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 1.
*      KTEXT1 = WA_ZDMS3-ATEXT1.
*      KDATE1 = WA_ZDMS3-TDATE1.
*      KCDATE1 = WA_ZDMS3-CTDATE1.
*      KREM1 = WA_ZDMS3-REM1.
*      KFOLW1 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 2.
*      KTEXT2 = WA_ZDMS3-ATEXT1.
*      KDATE2 = WA_ZDMS3-TDATE1.
*      KCDATE2 = WA_ZDMS3-CTDATE1.
*      KREM2 = WA_ZDMS3-REM1.
*      KFOLW2 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 3.
*      KTEXT3 = WA_ZDMS3-ATEXT1.
*      KDATE3 = WA_ZDMS3-TDATE1.
*      KCDATE3 = WA_ZDMS3-CTDATE1.
*      KREM3 = WA_ZDMS3-REM1.
*      KFOLW3 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 4.
*      KTEXT4 = WA_ZDMS3-ATEXT1.
*      KDATE4 = WA_ZDMS3-TDATE1.
*      KCDATE4 = WA_ZDMS3-CTDATE1.
*      KREM4 = WA_ZDMS3-REM1.
*      KFOLW4 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 5.
*      KTEXT5 = WA_ZDMS3-ATEXT1.
*      KDATE5 = WA_ZDMS3-TDATE1.
*      KCDATE5 = WA_ZDMS3-CTDATE1.
*      KREM5 = WA_ZDMS3-REM1.
*      KFOLW5 = WA_ZDMS3-FOLW1.
*    ENDIF.
*
*    IF WA_ZDMS3-ZEILE EQ 6.
*      KTEXT6 = WA_ZDMS3-ATEXT1.
*      KDATE6 = WA_ZDMS3-TDATE1.
*      KCDATE6 = WA_ZDMS3-CTDATE1.
*      KREM6 = WA_ZDMS3-REM1.
*      KFOLW6 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 7.
*      KTEXT7 = WA_ZDMS3-ATEXT1.
*      KDATE7 = WA_ZDMS3-TDATE1.
*      KCDATE7 = WA_ZDMS3-CTDATE1.
*      KREM7 = WA_ZDMS3-REM1.
*      KFOLW7 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 8.
*      KTEXT8 = WA_ZDMS3-ATEXT1.
*      KDATE8 = WA_ZDMS3-TDATE1.
*      KCDATE8 = WA_ZDMS3-CTDATE1.
*      KREM8 = WA_ZDMS3-REM1.
*      KFOLW8 = WA_ZDMS3-FOLW1.
*    ENDIF.
*  ENDLOOP.
*
*  LOOP AT IT_ZDMS3 INTO WA_ZDMS3 WHERE DEPT EQ ZDMS1-DEPT2.
*    SELECT SINGLE * FROM PA0001 WHERE PERNR EQ WA_ZDMS3-PERNR AND ENDDA GE SY-DATUM.
*    IF SY-SUBRC EQ 0.
*      INAME2 = PA0001-ENAME.
*    ENDIF.
*
*    IF WA_ZDMS3-ZEILE EQ 1.
*      LTEXT1 = WA_ZDMS3-ATEXT1.
*      LDATE1 = WA_ZDMS3-TDATE1.
*      LCDATE1 = WA_ZDMS3-CTDATE1.
*      LREM1 = WA_ZDMS3-REM1.
*      LFOLW1 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 2.
*      LTEXT2 = WA_ZDMS3-ATEXT1.
*      LDATE2 = WA_ZDMS3-TDATE1.
*      LCDATE2 = WA_ZDMS3-CTDATE1.
*      LREM2 = WA_ZDMS3-REM1.
*      LFOLW2 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 3.
*      LTEXT3 = WA_ZDMS3-ATEXT1.
*      LDATE3 = WA_ZDMS3-TDATE1.
*      LCDATE3 = WA_ZDMS3-CTDATE1.
*      LREM3 = WA_ZDMS3-REM1.
*      LFOLW3 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 4.
*      LTEXT4 = WA_ZDMS3-ATEXT1.
*      LDATE4 = WA_ZDMS3-TDATE1.
*      LCDATE4 = WA_ZDMS3-CTDATE1.
*      LREM4 = WA_ZDMS3-REM1.
*      LFOLW4 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 5.
*      LTEXT5 = WA_ZDMS3-ATEXT1.
*      LDATE5 = WA_ZDMS3-TDATE1.
*      LCDATE5 = WA_ZDMS3-CTDATE1.
*      LREM5 = WA_ZDMS3-REM1.
*      LFOLW5 = WA_ZDMS3-FOLW1.
*    ENDIF.
*
*    IF WA_ZDMS3-ZEILE EQ 6.
*      LTEXT6 = WA_ZDMS3-ATEXT1.
*      LDATE6 = WA_ZDMS3-TDATE1.
*      LCDATE6 = WA_ZDMS3-CTDATE1.
*      LREM6 = WA_ZDMS3-REM1.
*      LFOLW6 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 7.
*      LTEXT7 = WA_ZDMS3-ATEXT1.
*      LDATE7 = WA_ZDMS3-TDATE1.
*      LCDATE7 = WA_ZDMS3-CTDATE1.
*      LREM7 = WA_ZDMS3-REM1.
*      LFOLW7 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 8.
*      LTEXT8 = WA_ZDMS3-ATEXT1.
*      LDATE8 = WA_ZDMS3-TDATE1.
*      LCDATE8 = WA_ZDMS3-CTDATE1.
*      LREM8 = WA_ZDMS3-REM1.
*      LFOLW8 = WA_ZDMS3-FOLW1.
*    ENDIF.
*  ENDLOOP.
*
**    ********************* 3 *************
*  LOOP AT IT_ZDMS3 INTO WA_ZDMS3 WHERE DEPT EQ ZDMS1-DEPT3.
*    SELECT SINGLE * FROM PA0001 WHERE PERNR EQ WA_ZDMS3-PERNR AND ENDDA GE SY-DATUM.
*    IF SY-SUBRC EQ 0.
*      INAME2 = PA0001-ENAME.
*    ENDIF.
*
*    IF WA_ZDMS3-ZEILE EQ 1.
*      MTEXT1 = WA_ZDMS3-ATEXT1.
*      MDATE1 = WA_ZDMS3-TDATE1.
*      MCDATE1 = WA_ZDMS3-CTDATE1.
*      MREM1 = WA_ZDMS3-REM1.
*      MFOLW1 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 2.
*      MTEXT2 = WA_ZDMS3-ATEXT1.
*      MDATE2 = WA_ZDMS3-TDATE1.
*      MCDATE2 = WA_ZDMS3-CTDATE1.
*      MREM2 = WA_ZDMS3-REM1.
*      MFOLW2 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 3.
*      MTEXT3 = WA_ZDMS3-ATEXT1.
*      MDATE3 = WA_ZDMS3-TDATE1.
*      MCDATE3 = WA_ZDMS3-CTDATE1.
*      MREM3 = WA_ZDMS3-REM1.
*      MFOLW3 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 4.
*      MTEXT4 = WA_ZDMS3-ATEXT1.
*      MDATE4 = WA_ZDMS3-TDATE1.
*      MCDATE4 = WA_ZDMS3-CTDATE1.
*      MREM4 = WA_ZDMS3-REM1.
*      MFOLW4 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 5.
*      MTEXT5 = WA_ZDMS3-ATEXT1.
*      MDATE5 = WA_ZDMS3-TDATE1.
*      MCDATE5 = WA_ZDMS3-CTDATE1.
*      MREM5 = WA_ZDMS3-REM1.
*      MFOLW5 = WA_ZDMS3-FOLW1.
*    ENDIF.
*
*    IF WA_ZDMS3-ZEILE EQ 6.
*      MTEXT6 = WA_ZDMS3-ATEXT1.
*      MDATE6 = WA_ZDMS3-TDATE1.
*      MCDATE6 = WA_ZDMS3-CTDATE1.
*      MREM6 = WA_ZDMS3-REM1.
*      MFOLW6 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 7.
*      MTEXT7 = WA_ZDMS3-ATEXT1.
*      MDATE7 = WA_ZDMS3-TDATE1.
*      MCDATE7 = WA_ZDMS3-CTDATE1.
*      MREM7 = WA_ZDMS3-REM1.
*      MFOLW7 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 8.
*      MTEXT8 = WA_ZDMS3-ATEXT1.
*      MDATE8 = WA_ZDMS3-TDATE1.
*      MCDATE8 = WA_ZDMS3-CTDATE1.
*      MREM8 = WA_ZDMS3-REM1.
*      MFOLW8 = WA_ZDMS3-FOLW1.
*    ENDIF.
*  ENDLOOP.
****************** 4 **********************
*  LOOP AT IT_ZDMS3 INTO WA_ZDMS3 WHERE DEPT EQ ZDMS1-DEPT4.
*    SELECT SINGLE * FROM PA0001 WHERE PERNR EQ WA_ZDMS3-PERNR AND ENDDA GE SY-DATUM.
*    IF SY-SUBRC EQ 0.
*      INAME2 = PA0001-ENAME.
*    ENDIF.
*
*    IF WA_ZDMS3-ZEILE EQ 1.
*      NTEXT1 = WA_ZDMS3-ATEXT1.
*      NDATE1 = WA_ZDMS3-TDATE1.
*      NCDATE1 = WA_ZDMS3-CTDATE1.
*      NREM1 = WA_ZDMS3-REM1.
*      NFOLW1 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 2.
*      NTEXT2 = WA_ZDMS3-ATEXT1.
*      NDATE2 = WA_ZDMS3-TDATE1.
*      NCDATE2 = WA_ZDMS3-CTDATE1.
*      NREM2 = WA_ZDMS3-REM1.
*      NFOLW2 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 3.
*      NTEXT3 = WA_ZDMS3-ATEXT1.
*      NDATE3 = WA_ZDMS3-TDATE1.
*      NCDATE3 = WA_ZDMS3-CTDATE1.
*      NREM3 = WA_ZDMS3-REM1.
*      NFOLW3 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 4.
*      NTEXT4 = WA_ZDMS3-ATEXT1.
*      NDATE4 = WA_ZDMS3-TDATE1.
*      NCDATE4 = WA_ZDMS3-CTDATE1.
*      NREM4 = WA_ZDMS3-REM1.
*      NFOLW4 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 5.
*      NTEXT5 = WA_ZDMS3-ATEXT1.
*      NDATE5 = WA_ZDMS3-TDATE1.
*      NCDATE5 = WA_ZDMS3-CTDATE1.
*      NREM5 = WA_ZDMS3-REM1.
*      NFOLW5 = WA_ZDMS3-FOLW1.
*    ENDIF.
*
*    IF WA_ZDMS3-ZEILE EQ 6.
*      NTEXT6 = WA_ZDMS3-ATEXT1.
*      NDATE6 = WA_ZDMS3-TDATE1.
*      NCDATE6 = WA_ZDMS3-CTDATE1.
*      NREM6 = WA_ZDMS3-REM1.
*      NFOLW6 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 7.
*      NTEXT7 = WA_ZDMS3-ATEXT1.
*      NDATE7 = WA_ZDMS3-TDATE1.
*      NCDATE7 = WA_ZDMS3-CTDATE1.
*      NREM7 = WA_ZDMS3-REM1.
*      NFOLW7 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 8.
*      NTEXT8 = WA_ZDMS3-ATEXT1.
*      NDATE8 = WA_ZDMS3-TDATE1.
*      NCDATE8 = WA_ZDMS3-CTDATE1.
*      NREM8 = WA_ZDMS3-REM1.
*      NFOLW8 = WA_ZDMS3-FOLW1.
*    ENDIF.
*  ENDLOOP.
******** 5***************
*  LOOP AT IT_ZDMS3 INTO WA_ZDMS3 WHERE DEPT EQ ZDMS1-DEPT5.
*    SELECT SINGLE * FROM PA0001 WHERE PERNR EQ WA_ZDMS3-PERNR AND ENDDA GE SY-DATUM.
*    IF SY-SUBRC EQ 0.
*      INAME2 = PA0001-ENAME.
*    ENDIF.
*
*    IF WA_ZDMS3-ZEILE EQ 1.
*      OTEXT1 = WA_ZDMS3-ATEXT1.
*      ODATE1 = WA_ZDMS3-TDATE1.
*      OCDATE1 = WA_ZDMS3-CTDATE1.
*      OREM1 = WA_ZDMS3-REM1.
*      OFOLW1 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 2.
*      OTEXT2 = WA_ZDMS3-ATEXT1.
*      ODATE2 = WA_ZDMS3-TDATE1.
*      OCDATE2 = WA_ZDMS3-CTDATE1.
*      OREM2 = WA_ZDMS3-REM1.
*      OFOLW2 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 3.
*      OTEXT3 = WA_ZDMS3-ATEXT1.
*      ODATE3 = WA_ZDMS3-TDATE1.
*      OCDATE3 = WA_ZDMS3-CTDATE1.
*      OREM3 = WA_ZDMS3-REM1.
*      OFOLW3 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 4.
*      OTEXT4 = WA_ZDMS3-ATEXT1.
*      ODATE4 = WA_ZDMS3-TDATE1.
*      OCDATE4 = WA_ZDMS3-CTDATE1.
*      OREM4 = WA_ZDMS3-REM1.
*      OFOLW4 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 5.
*      OTEXT5 = WA_ZDMS3-ATEXT1.
*      ODATE5 = WA_ZDMS3-TDATE1.
*      OCDATE5 = WA_ZDMS3-CTDATE1.
*      OREM5 = WA_ZDMS3-REM1.
*      OFOLW5 = WA_ZDMS3-FOLW1.
*    ENDIF.
*
*    IF WA_ZDMS3-ZEILE EQ 6.
*      OTEXT6 = WA_ZDMS3-ATEXT1.
*      ODATE6 = WA_ZDMS3-TDATE1.
*      OCDATE6 = WA_ZDMS3-CTDATE1.
*      OREM6 = WA_ZDMS3-REM1.
*      OFOLW6 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 7.
*      OTEXT7 = WA_ZDMS3-ATEXT1.
*      ODATE7 = WA_ZDMS3-TDATE1.
*      OCDATE7 = WA_ZDMS3-CTDATE1.
*      OREM7 = WA_ZDMS3-REM1.
*      OFOLW7 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 8.
*      OTEXT8 = WA_ZDMS3-ATEXT1.
*      ODATE8 = WA_ZDMS3-TDATE1.
*      OCDATE8 = WA_ZDMS3-CTDATE1.
*      OREM8 = WA_ZDMS3-REM1.
*      OFOLW8 = WA_ZDMS3-FOLW1.
*    ENDIF.
*  ENDLOOP.
***********6*************
*  LOOP AT IT_ZDMS3 INTO WA_ZDMS3 WHERE DEPT EQ ZDMS1-DEPT6.
*    SELECT SINGLE * FROM PA0001 WHERE PERNR EQ WA_ZDMS3-PERNR AND ENDDA GE SY-DATUM.
*    IF SY-SUBRC EQ 0.
*      INAME2 = PA0001-ENAME.
*    ENDIF.
*
*    IF WA_ZDMS3-ZEILE EQ 1.
*      PTEXT1 = WA_ZDMS3-ATEXT1.
*      PDATE1 = WA_ZDMS3-TDATE1.
*      PCDATE1 = WA_ZDMS3-CTDATE1.
*      PREM1 = WA_ZDMS3-REM1.
*      PFOLW1 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 2.
*      PTEXT2 = WA_ZDMS3-ATEXT1.
*      PDATE2 = WA_ZDMS3-TDATE1.
*      PCDATE2 = WA_ZDMS3-CTDATE1.
*      PREM2 = WA_ZDMS3-REM1.
*      PFOLW2 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 3.
*      PTEXT3 = WA_ZDMS3-ATEXT1.
*      PDATE3 = WA_ZDMS3-TDATE1.
*      PCDATE3 = WA_ZDMS3-CTDATE1.
*      PREM3 = WA_ZDMS3-REM1.
*      PFOLW3 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 4.
*      PTEXT4 = WA_ZDMS3-ATEXT1.
*      PDATE4 = WA_ZDMS3-TDATE1.
*      PCDATE4 = WA_ZDMS3-CTDATE1.
*      PREM4 = WA_ZDMS3-REM1.
*      PFOLW4 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 5.
*      PTEXT5 = WA_ZDMS3-ATEXT1.
*      PDATE5 = WA_ZDMS3-TDATE1.
*      PCDATE5 = WA_ZDMS3-CTDATE1.
*      PREM5 = WA_ZDMS3-REM1.
*      PFOLW5 = WA_ZDMS3-FOLW1.
*    ENDIF.
*
*    IF WA_ZDMS3-ZEILE EQ 6.
*      PTEXT6 = WA_ZDMS3-ATEXT1.
*      PDATE6 = WA_ZDMS3-TDATE1.
*      PCDATE6 = WA_ZDMS3-CTDATE1.
*      PREM6 = WA_ZDMS3-REM1.
*      PFOLW6 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 7.
*      PTEXT7 = WA_ZDMS3-ATEXT1.
*      PDATE7 = WA_ZDMS3-TDATE1.
*      PCDATE7 = WA_ZDMS3-CTDATE1.
*      PREM7 = WA_ZDMS3-REM1.
*      PFOLW7 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 8.
*      PTEXT8 = WA_ZDMS3-ATEXT1.
*      PDATE8 = WA_ZDMS3-TDATE1.
*      PCDATE8 = WA_ZDMS3-CTDATE1.
*      PREM8 = WA_ZDMS3-REM1.
*      PFOLW8 = WA_ZDMS3-FOLW1.
*    ENDIF.
*  ENDLOOP.
******** 7 *********
*
*  LOOP AT IT_ZDMS3 INTO WA_ZDMS3 WHERE DEPT EQ ZDMS1-DEPT7.
*    SELECT SINGLE * FROM PA0001 WHERE PERNR EQ WA_ZDMS3-PERNR AND ENDDA GE SY-DATUM.
*    IF SY-SUBRC EQ 0.
*      INAME2 = PA0001-ENAME.
*    ENDIF.
*
*    IF WA_ZDMS3-ZEILE EQ 1.
*      QTEXT1 = WA_ZDMS3-ATEXT1.
*      QDATE1 = WA_ZDMS3-TDATE1.
*      QCDATE1 = WA_ZDMS3-CTDATE1.
*      QREM1 = WA_ZDMS3-REM1.
*      QFOLW1 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 2.
*      QTEXT2 = WA_ZDMS3-ATEXT1.
*      QDATE2 = WA_ZDMS3-TDATE1.
*      QCDATE2 = WA_ZDMS3-CTDATE1.
*      QREM2 = WA_ZDMS3-REM1.
*      QFOLW2 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 3.
*      QTEXT3 = WA_ZDMS3-ATEXT1.
*      QDATE3 = WA_ZDMS3-TDATE1.
*      QCDATE3 = WA_ZDMS3-CTDATE1.
*      QREM3 = WA_ZDMS3-REM1.
*      QFOLW3 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 4.
*      QTEXT4 = WA_ZDMS3-ATEXT1.
*      QDATE4 = WA_ZDMS3-TDATE1.
*      QCDATE4 = WA_ZDMS3-CTDATE1.
*      QREM4 = WA_ZDMS3-REM1.
*      QFOLW4 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 5.
*      QTEXT5 = WA_ZDMS3-ATEXT1.
*      QDATE5 = WA_ZDMS3-TDATE1.
*      QCDATE5 = WA_ZDMS3-CTDATE1.
*      QREM5 = WA_ZDMS3-REM1.
*      QFOLW5 = WA_ZDMS3-FOLW1.
*    ENDIF.
*
*    IF WA_ZDMS3-ZEILE EQ 6.
*      QTEXT6 = WA_ZDMS3-ATEXT1.
*      QDATE6 = WA_ZDMS3-TDATE1.
*      QCDATE6 = WA_ZDMS3-CTDATE1.
*      QREM6 = WA_ZDMS3-REM1.
*      QFOLW6 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 7.
*      QTEXT7 = WA_ZDMS3-ATEXT1.
*      QDATE7 = WA_ZDMS3-TDATE1.
*      QCDATE7 = WA_ZDMS3-CTDATE1.
*      QREM7 = WA_ZDMS3-REM1.
*      QFOLW7 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 8.
*      QTEXT8 = WA_ZDMS3-ATEXT1.
*      QDATE8 = WA_ZDMS3-TDATE1.
*      QCDATE8 = WA_ZDMS3-CTDATE1.
*      QREM8 = WA_ZDMS3-REM1.
*      QFOLW8 = WA_ZDMS3-FOLW1.
*    ENDIF.
*  ENDLOOP.
*
**************** 8 *********
*
*  LOOP AT IT_ZDMS3 INTO WA_ZDMS3 WHERE DEPT EQ ZDMS1-DEPT8.
*    SELECT SINGLE * FROM PA0001 WHERE PERNR EQ WA_ZDMS3-PERNR AND ENDDA GE SY-DATUM.
*    IF SY-SUBRC EQ 0.
*      INAME2 = PA0001-ENAME.
*    ENDIF.
*
*    IF WA_ZDMS3-ZEILE EQ 1.
*      RTEXT1 = WA_ZDMS3-ATEXT1.
*      RDATE1 = WA_ZDMS3-TDATE1.
*      RCDATE1 = WA_ZDMS3-CTDATE1.
*      RREM1 = WA_ZDMS3-REM1.
*      RFOLW1 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 2.
*      RTEXT2 = WA_ZDMS3-ATEXT1.
*      RDATE2 = WA_ZDMS3-TDATE1.
*      RCDATE2 = WA_ZDMS3-CTDATE1.
*      RREM2 = WA_ZDMS3-REM1.
*      RFOLW2 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 3.
*      RTEXT3 = WA_ZDMS3-ATEXT1.
*      RDATE3 = WA_ZDMS3-TDATE1.
*      RCDATE3 = WA_ZDMS3-CTDATE1.
*      RREM3 = WA_ZDMS3-REM1.
*      RFOLW3 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 4.
*      RTEXT4 = WA_ZDMS3-ATEXT1.
*      RDATE4 = WA_ZDMS3-TDATE1.
*      RCDATE4 = WA_ZDMS3-CTDATE1.
*      RREM4 = WA_ZDMS3-REM1.
*      RFOLW4 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 5.
*      RTEXT5 = WA_ZDMS3-ATEXT1.
*      RDATE5 = WA_ZDMS3-TDATE1.
*      RCDATE5 = WA_ZDMS3-CTDATE1.
*      RREM5 = WA_ZDMS3-REM1.
*      RFOLW5 = WA_ZDMS3-FOLW1.
*    ENDIF.
*
*    IF WA_ZDMS3-ZEILE EQ 6.
*      RTEXT6 = WA_ZDMS3-ATEXT1.
*      RDATE6 = WA_ZDMS3-TDATE1.
*      RCDATE6 = WA_ZDMS3-CTDATE1.
*      RREM6 = WA_ZDMS3-REM1.
*      RFOLW6 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 7.
*      RTEXT7 = WA_ZDMS3-ATEXT1.
*      RDATE7 = WA_ZDMS3-TDATE1.
*      RCDATE7 = WA_ZDMS3-CTDATE1.
*      RREM7 = WA_ZDMS3-REM1.
*      RFOLW7 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 8.
*      RTEXT8 = WA_ZDMS3-ATEXT1.
*      RDATE8 = WA_ZDMS3-TDATE1.
*      RCDATE8 = WA_ZDMS3-CTDATE1.
*      RREM8 = WA_ZDMS3-REM1.
*      RFOLW8 = WA_ZDMS3-FOLW1.
*    ENDIF.
*  ENDLOOP.
*
*************** 9*****
*
*  LOOP AT IT_ZDMS3 INTO WA_ZDMS3 WHERE DEPT EQ ZDMS1-DEPT9.
*    SELECT SINGLE * FROM PA0001 WHERE PERNR EQ WA_ZDMS3-PERNR AND ENDDA GE SY-DATUM.
*    IF SY-SUBRC EQ 0.
*      INAME2 = PA0001-ENAME.
*    ENDIF.
*
*    IF WA_ZDMS3-ZEILE EQ 1.
*      STEXT1 = WA_ZDMS3-ATEXT1.
*      SDATE1 = WA_ZDMS3-TDATE1.
*      SCDATE1 = WA_ZDMS3-CTDATE1.
*      SREM1 = WA_ZDMS3-REM1.
*      SFOLW1 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 2.
*      STEXT2 = WA_ZDMS3-ATEXT1.
*      SDATE2 = WA_ZDMS3-TDATE1.
*      SCDATE2 = WA_ZDMS3-CTDATE1.
*      SREM2 = WA_ZDMS3-REM1.
*      SFOLW2 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 3.
*      STEXT3 = WA_ZDMS3-ATEXT1.
*      SDATE3 = WA_ZDMS3-TDATE1.
*      SCDATE3 = WA_ZDMS3-CTDATE1.
*      SREM3 = WA_ZDMS3-REM1.
*      SFOLW3 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 4.
*      STEXT4 = WA_ZDMS3-ATEXT1.
*      SDATE4 = WA_ZDMS3-TDATE1.
*      SCDATE4 = WA_ZDMS3-CTDATE1.
*      SREM4 = WA_ZDMS3-REM1.
*      SFOLW4 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 5.
*      STEXT5 = WA_ZDMS3-ATEXT1.
*      SDATE5 = WA_ZDMS3-TDATE1.
*      SCDATE5 = WA_ZDMS3-CTDATE1.
*      SREM5 = WA_ZDMS3-REM1.
*      SFOLW5 = WA_ZDMS3-FOLW1.
*    ENDIF.
*
*    IF WA_ZDMS3-ZEILE EQ 6.
*      STEXT6 = WA_ZDMS3-ATEXT1.
*      SDATE6 = WA_ZDMS3-TDATE1.
*      SCDATE6 = WA_ZDMS3-CTDATE1.
*      SREM6 = WA_ZDMS3-REM1.
*      SFOLW6 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 7.
*      STEXT7 = WA_ZDMS3-ATEXT1.
*      SDATE7 = WA_ZDMS3-TDATE1.
*      SCDATE7 = WA_ZDMS3-CTDATE1.
*      SREM7 = WA_ZDMS3-REM1.
*      SFOLW7 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 8.
*      STEXT8 = WA_ZDMS3-ATEXT1.
*      SDATE8 = WA_ZDMS3-TDATE1.
*      SCDATE8 = WA_ZDMS3-CTDATE1.
*      SREM8 = WA_ZDMS3-REM1.
*      SFOLW8 = WA_ZDMS3-FOLW1.
*    ENDIF.
*  ENDLOOP.
*************** 10 ***
*
*  LOOP AT IT_ZDMS3 INTO WA_ZDMS3 WHERE DEPT EQ ZDMS1-DEPT10.
*    SELECT SINGLE * FROM PA0001 WHERE PERNR EQ WA_ZDMS3-PERNR AND ENDDA GE SY-DATUM.
*    IF SY-SUBRC EQ 0.
*      INAME2 = PA0001-ENAME.
*    ENDIF.
*
*    IF WA_ZDMS3-ZEILE EQ 1.
*      TTEXT1 = WA_ZDMS3-ATEXT1.
*      TDATE1 = WA_ZDMS3-TDATE1.
*      TCDATE1 = WA_ZDMS3-CTDATE1.
*      TREM1 = WA_ZDMS3-REM1.
*      TFOLW1 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 2.
*      TTEXT2 = WA_ZDMS3-ATEXT1.
*      TDATE2 = WA_ZDMS3-TDATE1.
*      TCDATE2 = WA_ZDMS3-CTDATE1.
*      TREM2 = WA_ZDMS3-REM1.
*      TFOLW2 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 3.
*      TTEXT3 = WA_ZDMS3-ATEXT1.
*      TDATE3 = WA_ZDMS3-TDATE1.
*      TCDATE3 = WA_ZDMS3-CTDATE1.
*      TREM3 = WA_ZDMS3-REM1.
*      TFOLW3 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 4.
*      TTEXT4 = WA_ZDMS3-ATEXT1.
*      TDATE4 = WA_ZDMS3-TDATE1.
*      TCDATE4 = WA_ZDMS3-CTDATE1.
*      TREM4 = WA_ZDMS3-REM1.
*      TFOLW4 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 5.
*      TTEXT5 = WA_ZDMS3-ATEXT1.
*      TDATE5 = WA_ZDMS3-TDATE1.
*      TCDATE5 = WA_ZDMS3-CTDATE1.
*      TREM5 = WA_ZDMS3-REM1.
*      TFOLW5 = WA_ZDMS3-FOLW1.
*    ENDIF.
*
*    IF WA_ZDMS3-ZEILE EQ 6.
*      TTEXT6 = WA_ZDMS3-ATEXT1.
*      TDATE6 = WA_ZDMS3-TDATE1.
*      TCDATE6 = WA_ZDMS3-CTDATE1.
*      TREM6 = WA_ZDMS3-REM1.
*      TFOLW6 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 7.
*      TTEXT7 = WA_ZDMS3-ATEXT1.
*      TDATE7 = WA_ZDMS3-TDATE1.
*      TCDATE7 = WA_ZDMS3-CTDATE1.
*      TREM7 = WA_ZDMS3-REM1.
*      TFOLW7 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 8.
*      TTEXT8 = WA_ZDMS3-ATEXT1.
*      TDATE8 = WA_ZDMS3-TDATE1.
*      TCDATE8 = WA_ZDMS3-CTDATE1.
*      TREM8 = WA_ZDMS3-REM1.
*      TFOLW8 = WA_ZDMS3-FOLW1.
*    ENDIF.
*  ENDLOOP.
********************** 11 *************************************
*
*  LOOP AT IT_ZDMS3 INTO WA_ZDMS3 WHERE DEPT EQ ZDMS1-DEPT11.
*    SELECT SINGLE * FROM PA0001 WHERE PERNR EQ WA_ZDMS3-PERNR AND ENDDA GE SY-DATUM.
*    IF SY-SUBRC EQ 0.
*      INAME1 = PA0001-ENAME.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 1.
*      NKTEXT1 = WA_ZDMS3-ATEXT1.
*      NKDATE1 = WA_ZDMS3-TDATE1.
*      NKCDATE1 = WA_ZDMS3-CTDATE1.
*      NKREM1 = WA_ZDMS3-REM1.
*      NKFOLW1 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 2.
*      NKTEXT2 = WA_ZDMS3-ATEXT1.
*      NKDATE2 = WA_ZDMS3-TDATE1.
*      NKCDATE2 = WA_ZDMS3-CTDATE1.
*      NKREM2 = WA_ZDMS3-REM1.
*      NKFOLW2 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 3.
*      NKTEXT3 = WA_ZDMS3-ATEXT1.
*      NKDATE3 = WA_ZDMS3-TDATE1.
*      NKCDATE3 = WA_ZDMS3-CTDATE1.
*      NKREM3 = WA_ZDMS3-REM1.
*      NKFOLW3 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 4.
*      NKTEXT4 = WA_ZDMS3-ATEXT1.
*      NKDATE4 = WA_ZDMS3-TDATE1.
*      NKCDATE4 = WA_ZDMS3-CTDATE1.
*      NKREM4 = WA_ZDMS3-REM1.
*      NKFOLW4 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 5.
*      NKTEXT5 = WA_ZDMS3-ATEXT1.
*      NKDATE5 = WA_ZDMS3-TDATE1.
*      NKCDATE5 = WA_ZDMS3-CTDATE1.
*      NKREM5 = WA_ZDMS3-REM1.
*      NKFOLW5 = WA_ZDMS3-FOLW1.
*    ENDIF.
*
*    IF WA_ZDMS3-ZEILE EQ 6.
*      NKTEXT6 = WA_ZDMS3-ATEXT1.
*      NKDATE6 = WA_ZDMS3-TDATE1.
*      NKCDATE6 = WA_ZDMS3-CTDATE1.
*      NKREM6 = WA_ZDMS3-REM1.
*      NKFOLW6 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 7.
*      NKTEXT7 = WA_ZDMS3-ATEXT1.
*      NKDATE7 = WA_ZDMS3-TDATE1.
*      NKCDATE7 = WA_ZDMS3-CTDATE1.
*      NKREM7 = WA_ZDMS3-REM1.
*      NKFOLW7 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 8.
*      NKTEXT8 = WA_ZDMS3-ATEXT1.
*      NKDATE8 = WA_ZDMS3-TDATE1.
*      NKCDATE8 = WA_ZDMS3-CTDATE1.
*      NKREM8 = WA_ZDMS3-REM1.
*      NKFOLW8 = WA_ZDMS3-FOLW1.
*    ENDIF.
*  ENDLOOP.
**************** 12 ****************
*  LOOP AT IT_ZDMS3 INTO WA_ZDMS3 WHERE DEPT EQ ZDMS1-DEPT12.
*    SELECT SINGLE * FROM PA0001 WHERE PERNR EQ WA_ZDMS3-PERNR AND ENDDA GE SY-DATUM.
*    IF SY-SUBRC EQ 0.
*      INAME2 = PA0001-ENAME.
*    ENDIF.
*
*    IF WA_ZDMS3-ZEILE EQ 1.
*      NLTEXT1 = WA_ZDMS3-ATEXT1.
*      NLDATE1 = WA_ZDMS3-TDATE1.
*      NLCDATE1 = WA_ZDMS3-CTDATE1.
*      NLREM1 = WA_ZDMS3-REM1.
*      NLFOLW1 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 2.
*      NLTEXT2 = WA_ZDMS3-ATEXT1.
*      NLDATE2 = WA_ZDMS3-TDATE1.
*      NLCDATE2 = WA_ZDMS3-CTDATE1.
*      NLREM2 = WA_ZDMS3-REM1.
*      NLFOLW2 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 3.
*      NLTEXT3 = WA_ZDMS3-ATEXT1.
*      NLDATE3 = WA_ZDMS3-TDATE1.
*      NLCDATE3 = WA_ZDMS3-CTDATE1.
*      NLREM3 = WA_ZDMS3-REM1.
*      NLFOLW3 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 4.
*      NLTEXT4 = WA_ZDMS3-ATEXT1.
*      NLDATE4 = WA_ZDMS3-TDATE1.
*      NLCDATE4 = WA_ZDMS3-CTDATE1.
*      NLREM4 = WA_ZDMS3-REM1.
*      NLFOLW4 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 5.
*      NLTEXT5 = WA_ZDMS3-ATEXT1.
*      NLDATE5 = WA_ZDMS3-TDATE1.
*      NLCDATE5 = WA_ZDMS3-CTDATE1.
*      NLREM5 = WA_ZDMS3-REM1.
*      NLFOLW5 = WA_ZDMS3-FOLW1.
*    ENDIF.
*
*    IF WA_ZDMS3-ZEILE EQ 6.
*      NLTEXT6 = WA_ZDMS3-ATEXT1.
*      NLDATE6 = WA_ZDMS3-TDATE1.
*      NLCDATE6 = WA_ZDMS3-CTDATE1.
*      NLREM6 = WA_ZDMS3-REM1.
*      NLFOLW6 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 7.
*      NLTEXT7 = WA_ZDMS3-ATEXT1.
*      NLDATE7 = WA_ZDMS3-TDATE1.
*      NLCDATE7 = WA_ZDMS3-CTDATE1.
*      NLREM7 = WA_ZDMS3-REM1.
*      NLFOLW7 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 8.
*      NLTEXT8 = WA_ZDMS3-ATEXT1.
*      NLDATE8 = WA_ZDMS3-TDATE1.
*      NLCDATE8 = WA_ZDMS3-CTDATE1.
*      NLREM8 = WA_ZDMS3-REM1.
*      NLFOLW8 = WA_ZDMS3-FOLW1.
*    ENDIF.
*  ENDLOOP.
*
*********************** 13 *************
*  LOOP AT IT_ZDMS3 INTO WA_ZDMS3 WHERE DEPT EQ ZDMS1-DEPT13.
*    SELECT SINGLE * FROM PA0001 WHERE PERNR EQ WA_ZDMS3-PERNR AND ENDDA GE SY-DATUM.
*    IF SY-SUBRC EQ 0.
*      INAME2 = PA0001-ENAME.
*    ENDIF.
*
*    IF WA_ZDMS3-ZEILE EQ 1.
*      NMTEXT1 = WA_ZDMS3-ATEXT1.
*      NMDATE1 = WA_ZDMS3-TDATE1.
*      NMCDATE1 = WA_ZDMS3-CTDATE1.
*      NMREM1 = WA_ZDMS3-REM1.
*      NMFOLW1 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 2.
*      NMTEXT2 = WA_ZDMS3-ATEXT1.
*      NMDATE2 = WA_ZDMS3-TDATE1.
*      NMCDATE2 = WA_ZDMS3-CTDATE1.
*      NMREM2 = WA_ZDMS3-REM1.
*      NMFOLW2 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 3.
*      NMTEXT3 = WA_ZDMS3-ATEXT1.
*      NMDATE3 = WA_ZDMS3-TDATE1.
*      NMCDATE3 = WA_ZDMS3-CTDATE1.
*      NMREM3 = WA_ZDMS3-REM1.
*      NMFOLW3 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 4.
*      NMTEXT4 = WA_ZDMS3-ATEXT1.
*      NMDATE4 = WA_ZDMS3-TDATE1.
*      NMCDATE4 = WA_ZDMS3-CTDATE1.
*      NMREM4 = WA_ZDMS3-REM1.
*      NMFOLW4 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 5.
*      NMTEXT5 = WA_ZDMS3-ATEXT1.
*      NMDATE5 = WA_ZDMS3-TDATE1.
*      NMCDATE5 = WA_ZDMS3-CTDATE1.
*      NMREM5 = WA_ZDMS3-REM1.
*      NMFOLW5 = WA_ZDMS3-FOLW1.
*    ENDIF.
*
*    IF WA_ZDMS3-ZEILE EQ 6.
*      NMTEXT6 = WA_ZDMS3-ATEXT1.
*      NMDATE6 = WA_ZDMS3-TDATE1.
*      NMCDATE6 = WA_ZDMS3-CTDATE1.
*      NMREM6 = WA_ZDMS3-REM1.
*      NMFOLW6 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 7.
*      NMTEXT7 = WA_ZDMS3-ATEXT1.
*      NMDATE7 = WA_ZDMS3-TDATE1.
*      NMCDATE7 = WA_ZDMS3-CTDATE1.
*      NMREM7 = WA_ZDMS3-REM1.
*      NMFOLW7 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 8.
*      NMTEXT8 = WA_ZDMS3-ATEXT1.
*      NMDATE8 = WA_ZDMS3-TDATE1.
*      NMCDATE8 = WA_ZDMS3-CTDATE1.
*      NMREM8 = WA_ZDMS3-REM1.
*      NMFOLW8 = WA_ZDMS3-FOLW1.
*    ENDIF.
*  ENDLOOP.
****************** 14 **********************
*  LOOP AT IT_ZDMS3 INTO WA_ZDMS3 WHERE DEPT EQ ZDMS1-DEPT14.
*    SELECT SINGLE * FROM PA0001 WHERE PERNR EQ WA_ZDMS3-PERNR AND ENDDA GE SY-DATUM.
*    IF SY-SUBRC EQ 0.
*      INAME2 = PA0001-ENAME.
*    ENDIF.
*
*    IF WA_ZDMS3-ZEILE EQ 1.
*      NNTEXT1 = WA_ZDMS3-ATEXT1.
*      NNDATE1 = WA_ZDMS3-TDATE1.
*      NNCDATE1 = WA_ZDMS3-CTDATE1.
*      NNREM1 = WA_ZDMS3-REM1.
*      NNFOLW1 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 2.
*      NNTEXT2 = WA_ZDMS3-ATEXT1.
*      NNDATE2 = WA_ZDMS3-TDATE1.
*      NNCDATE2 = WA_ZDMS3-CTDATE1.
*      NNREM2 = WA_ZDMS3-REM1.
*      NNFOLW2 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 3.
*      NNTEXT3 = WA_ZDMS3-ATEXT1.
*      NNDATE3 = WA_ZDMS3-TDATE1.
*      NNCDATE3 = WA_ZDMS3-CTDATE1.
*      NNREM3 = WA_ZDMS3-REM1.
*      NNFOLW3 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 4.
*      NNTEXT4 = WA_ZDMS3-ATEXT1.
*      NNDATE4 = WA_ZDMS3-TDATE1.
*      NNCDATE4 = WA_ZDMS3-CTDATE1.
*      NNREM4 = WA_ZDMS3-REM1.
*      NNFOLW4 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 5.
*      NNTEXT5 = WA_ZDMS3-ATEXT1.
*      NNDATE5 = WA_ZDMS3-TDATE1.
*      NNCDATE5 = WA_ZDMS3-CTDATE1.
*      NNREM5 = WA_ZDMS3-REM1.
*      NNFOLW5 = WA_ZDMS3-FOLW1.
*    ENDIF.
*
*    IF WA_ZDMS3-ZEILE EQ 6.
*      NNTEXT6 = WA_ZDMS3-ATEXT1.
*      NNDATE6 = WA_ZDMS3-TDATE1.
*      NNCDATE6 = WA_ZDMS3-CTDATE1.
*      NNREM6 = WA_ZDMS3-REM1.
*      NNFOLW6 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 7.
*      NNTEXT7 = WA_ZDMS3-ATEXT1.
*      NNDATE7 = WA_ZDMS3-TDATE1.
*      NNCDATE7 = WA_ZDMS3-CTDATE1.
*      NNREM7 = WA_ZDMS3-REM1.
*      NNFOLW7 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 8.
*      NNTEXT8 = WA_ZDMS3-ATEXT1.
*      NNDATE8 = WA_ZDMS3-TDATE1.
*      NNCDATE8 = WA_ZDMS3-CTDATE1.
*      NNREM8 = WA_ZDMS3-REM1.
*      NNFOLW8 = WA_ZDMS3-FOLW1.
*    ENDIF.
*  ENDLOOP.
******** 15 ***************
*  LOOP AT IT_ZDMS3 INTO WA_ZDMS3 WHERE DEPT EQ ZDMS1-DEPT15.
*    SELECT SINGLE * FROM PA0001 WHERE PERNR EQ WA_ZDMS3-PERNR AND ENDDA GE SY-DATUM.
*    IF SY-SUBRC EQ 0.
*      INAME2 = PA0001-ENAME.
*    ENDIF.
*
*    IF WA_ZDMS3-ZEILE EQ 1.
*      NOTEXT1 = WA_ZDMS3-ATEXT1.
*      NODATE1 = WA_ZDMS3-TDATE1.
*      NOCDATE1 = WA_ZDMS3-CTDATE1.
*      NOREM1 = WA_ZDMS3-REM1.
*      NOFOLW1 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 2.
*      NOTEXT2 = WA_ZDMS3-ATEXT1.
*      NODATE2 = WA_ZDMS3-TDATE1.
*      NOCDATE2 = WA_ZDMS3-CTDATE1.
*      NOREM2 = WA_ZDMS3-REM1.
*      NOFOLW2 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 3.
*      NOTEXT3 = WA_ZDMS3-ATEXT1.
*      NODATE3 = WA_ZDMS3-TDATE1.
*      NOCDATE3 = WA_ZDMS3-CTDATE1.
*      NOREM3 = WA_ZDMS3-REM1.
*      NOFOLW3 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 4.
*      NOTEXT4 = WA_ZDMS3-ATEXT1.
*      NODATE4 = WA_ZDMS3-TDATE1.
*      NOCDATE4 = WA_ZDMS3-CTDATE1.
*      NOREM4 = WA_ZDMS3-REM1.
*      NOFOLW4 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 5.
*      NOTEXT5 = WA_ZDMS3-ATEXT1.
*      NODATE5 = WA_ZDMS3-TDATE1.
*      NOCDATE5 = WA_ZDMS3-CTDATE1.
*      NOREM5 = WA_ZDMS3-REM1.
*      NOFOLW5 = WA_ZDMS3-FOLW1.
*    ENDIF.
*
*    IF WA_ZDMS3-ZEILE EQ 6.
*      NOTEXT6 = WA_ZDMS3-ATEXT1.
*      NODATE6 = WA_ZDMS3-TDATE1.
*      NOCDATE6 = WA_ZDMS3-CTDATE1.
*      NOREM6 = WA_ZDMS3-REM1.
*      NOFOLW6 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 7.
*      NOTEXT7 = WA_ZDMS3-ATEXT1.
*      NODATE7 = WA_ZDMS3-TDATE1.
*      NOCDATE7 = WA_ZDMS3-CTDATE1.
*      NOREM7 = WA_ZDMS3-REM1.
*      NOFOLW7 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 8.
*      NOTEXT8 = WA_ZDMS3-ATEXT1.
*      NODATE8 = WA_ZDMS3-TDATE1.
*      NOCDATE8 = WA_ZDMS3-CTDATE1.
*      NOREM8 = WA_ZDMS3-REM1.
*      NOFOLW8 = WA_ZDMS3-FOLW1.
*    ENDIF.
*  ENDLOOP.
***********16*************
*  LOOP AT IT_ZDMS3 INTO WA_ZDMS3 WHERE DEPT EQ ZDMS1-DEPT16.
*    SELECT SINGLE * FROM PA0001 WHERE PERNR EQ WA_ZDMS3-PERNR AND ENDDA GE SY-DATUM.
*    IF SY-SUBRC EQ 0.
*      INAME2 = PA0001-ENAME.
*    ENDIF.
*
*    IF WA_ZDMS3-ZEILE EQ 1.
*      NPTEXT1 = WA_ZDMS3-ATEXT1.
*      NPDATE1 = WA_ZDMS3-TDATE1.
*      NPCDATE1 = WA_ZDMS3-CTDATE1.
*      NPREM1 = WA_ZDMS3-REM1.
*      NPFOLW1 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 2.
*      NPTEXT2 = WA_ZDMS3-ATEXT1.
*      NPDATE2 = WA_ZDMS3-TDATE1.
*      NPCDATE2 = WA_ZDMS3-CTDATE1.
*      NPREM2 = WA_ZDMS3-REM1.
*      NPFOLW2 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 3.
*      NPTEXT3 = WA_ZDMS3-ATEXT1.
*      NPDATE3 = WA_ZDMS3-TDATE1.
*      NPCDATE3 = WA_ZDMS3-CTDATE1.
*      NPREM3 = WA_ZDMS3-REM1.
*      NPFOLW3 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 4.
*      NPTEXT4 = WA_ZDMS3-ATEXT1.
*      NPDATE4 = WA_ZDMS3-TDATE1.
*      NPCDATE4 = WA_ZDMS3-CTDATE1.
*      NPREM4 = WA_ZDMS3-REM1.
*      NPFOLW4 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 5.
*      NPTEXT5 = WA_ZDMS3-ATEXT1.
*      NPDATE5 = WA_ZDMS3-TDATE1.
*      NPCDATE5 = WA_ZDMS3-CTDATE1.
*      NPREM5 = WA_ZDMS3-REM1.
*      NPFOLW5 = WA_ZDMS3-FOLW1.
*    ENDIF.
*
*    IF WA_ZDMS3-ZEILE EQ 6.
*      NPTEXT6 = WA_ZDMS3-ATEXT1.
*      NPDATE6 = WA_ZDMS3-TDATE1.
*      NPCDATE6 = WA_ZDMS3-CTDATE1.
*      NPREM6 = WA_ZDMS3-REM1.
*      NPFOLW6 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 7.
*      NPTEXT7 = WA_ZDMS3-ATEXT1.
*      NPDATE7 = WA_ZDMS3-TDATE1.
*      NPCDATE7 = WA_ZDMS3-CTDATE1.
*      NPREM7 = WA_ZDMS3-REM1.
*      NPFOLW7 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 8.
*      NPTEXT8 = WA_ZDMS3-ATEXT1.
*      NPDATE8 = WA_ZDMS3-TDATE1.
*      NPCDATE8 = WA_ZDMS3-CTDATE1.
*      NPREM8 = WA_ZDMS3-REM1.
*      NPFOLW8 = WA_ZDMS3-FOLW1.
*    ENDIF.
*  ENDLOOP.
******** 17 *********
*
*  LOOP AT IT_ZDMS3 INTO WA_ZDMS3 WHERE DEPT EQ ZDMS1-DEPT17.
*    SELECT SINGLE * FROM PA0001 WHERE PERNR EQ WA_ZDMS3-PERNR AND ENDDA GE SY-DATUM.
*    IF SY-SUBRC EQ 0.
*      INAME2 = PA0001-ENAME.
*    ENDIF.
*
*    IF WA_ZDMS3-ZEILE EQ 1.
*      NQTEXT1 = WA_ZDMS3-ATEXT1.
*      NQDATE1 = WA_ZDMS3-TDATE1.
*      NQCDATE1 = WA_ZDMS3-CTDATE1.
*      NQREM1 = WA_ZDMS3-REM1.
*      NQFOLW1 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 2.
*      NQTEXT2 = WA_ZDMS3-ATEXT1.
*      NQDATE2 = WA_ZDMS3-TDATE1.
*      NQCDATE2 = WA_ZDMS3-CTDATE1.
*      NQREM2 = WA_ZDMS3-REM1.
*      NQFOLW2 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 3.
*      NQTEXT3 = WA_ZDMS3-ATEXT1.
*      NQDATE3 = WA_ZDMS3-TDATE1.
*      NQCDATE3 = WA_ZDMS3-CTDATE1.
*      NQREM3 = WA_ZDMS3-REM1.
*      NQFOLW3 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 4.
*      NQTEXT4 = WA_ZDMS3-ATEXT1.
*      NQDATE4 = WA_ZDMS3-TDATE1.
*      NQCDATE4 = WA_ZDMS3-CTDATE1.
*      NQREM4 = WA_ZDMS3-REM1.
*      NQFOLW4 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 5.
*      NQTEXT5 = WA_ZDMS3-ATEXT1.
*      NQDATE5 = WA_ZDMS3-TDATE1.
*      NQCDATE5 = WA_ZDMS3-CTDATE1.
*      NQREM5 = WA_ZDMS3-REM1.
*      NQFOLW5 = WA_ZDMS3-FOLW1.
*    ENDIF.
*
*    IF WA_ZDMS3-ZEILE EQ 6.
*      NQTEXT6 = WA_ZDMS3-ATEXT1.
*      NQDATE6 = WA_ZDMS3-TDATE1.
*      NQCDATE6 = WA_ZDMS3-CTDATE1.
*      NQREM6 = WA_ZDMS3-REM1.
*      NQFOLW6 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 7.
*      NQTEXT7 = WA_ZDMS3-ATEXT1.
*      NQDATE7 = WA_ZDMS3-TDATE1.
*      NQCDATE7 = WA_ZDMS3-CTDATE1.
*      NQREM7 = WA_ZDMS3-REM1.
*      NQFOLW7 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 8.
*      NQTEXT8 = WA_ZDMS3-ATEXT1.
*      NQDATE8 = WA_ZDMS3-TDATE1.
*      NQCDATE8 = WA_ZDMS3-CTDATE1.
*      NQREM8 = WA_ZDMS3-REM1.
*      NQFOLW8 = WA_ZDMS3-FOLW1.
*    ENDIF.
*  ENDLOOP.
*
**************** 18 *********
*
*  LOOP AT IT_ZDMS3 INTO WA_ZDMS3 WHERE DEPT EQ ZDMS1-DEPT18.
*    SELECT SINGLE * FROM PA0001 WHERE PERNR EQ WA_ZDMS3-PERNR AND ENDDA GE SY-DATUM.
*    IF SY-SUBRC EQ 0.
*      INAME2 = PA0001-ENAME.
*    ENDIF.
*
*    IF WA_ZDMS3-ZEILE EQ 1.
*      NRTEXT1 = WA_ZDMS3-ATEXT1.
*      NRDATE1 = WA_ZDMS3-TDATE1.
*      NRCDATE1 = WA_ZDMS3-CTDATE1.
*      NRREM1 = WA_ZDMS3-REM1.
*      NRFOLW1 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 2.
*      NRTEXT2 = WA_ZDMS3-ATEXT1.
*      NRDATE2 = WA_ZDMS3-TDATE1.
*      NRCDATE2 = WA_ZDMS3-CTDATE1.
*      NRREM2 = WA_ZDMS3-REM1.
*      NRFOLW2 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 3.
*      NRTEXT3 = WA_ZDMS3-ATEXT1.
*      NRDATE3 = WA_ZDMS3-TDATE1.
*      NRCDATE3 = WA_ZDMS3-CTDATE1.
*      NRREM3 = WA_ZDMS3-REM1.
*      NRFOLW3 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 4.
*      NRTEXT4 = WA_ZDMS3-ATEXT1.
*      NRDATE4 = WA_ZDMS3-TDATE1.
*      NRCDATE4 = WA_ZDMS3-CTDATE1.
*      NRREM4 = WA_ZDMS3-REM1.
*      NRFOLW4 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 5.
*      NRTEXT5 = WA_ZDMS3-ATEXT1.
*      NRDATE5 = WA_ZDMS3-TDATE1.
*      NRCDATE5 = WA_ZDMS3-CTDATE1.
*      NRREM5 = WA_ZDMS3-REM1.
*      NRFOLW5 = WA_ZDMS3-FOLW1.
*    ENDIF.
*
*    IF WA_ZDMS3-ZEILE EQ 6.
*      NRTEXT6 = WA_ZDMS3-ATEXT1.
*      NRDATE6 = WA_ZDMS3-TDATE1.
*      NRCDATE6 = WA_ZDMS3-CTDATE1.
*      NRREM6 = WA_ZDMS3-REM1.
*      NRFOLW6 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 7.
*      NRTEXT7 = WA_ZDMS3-ATEXT1.
*      NRDATE7 = WA_ZDMS3-TDATE1.
*      NRCDATE7 = WA_ZDMS3-CTDATE1.
*      NRREM7 = WA_ZDMS3-REM1.
*      NRFOLW7 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 8.
*      NRTEXT8 = WA_ZDMS3-ATEXT1.
*      NRDATE8 = WA_ZDMS3-TDATE1.
*      NRCDATE8 = WA_ZDMS3-CTDATE1.
*      NRREM8 = WA_ZDMS3-REM1.
*      NRFOLW8 = WA_ZDMS3-FOLW1.
*    ENDIF.
*  ENDLOOP.
*
*************** 19*****
*
*  LOOP AT IT_ZDMS3 INTO WA_ZDMS3 WHERE DEPT EQ ZDMS1-DEPT19.
*    SELECT SINGLE * FROM PA0001 WHERE PERNR EQ WA_ZDMS3-PERNR AND ENDDA GE SY-DATUM.
*    IF SY-SUBRC EQ 0.
*      INAME2 = PA0001-ENAME.
*    ENDIF.
*
*    IF WA_ZDMS3-ZEILE EQ 1.
*      NSTEXT1 = WA_ZDMS3-ATEXT1.
*      NSDATE1 = WA_ZDMS3-TDATE1.
*      NSCDATE1 = WA_ZDMS3-CTDATE1.
*      NSREM1 = WA_ZDMS3-REM1.
*      NSFOLW1 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 2.
*      NSTEXT2 = WA_ZDMS3-ATEXT1.
*      NSDATE2 = WA_ZDMS3-TDATE1.
*      NSCDATE2 = WA_ZDMS3-CTDATE1.
*      NSREM2 = WA_ZDMS3-REM1.
*      NSFOLW2 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 3.
*      NSTEXT3 = WA_ZDMS3-ATEXT1.
*      NSDATE3 = WA_ZDMS3-TDATE1.
*      NSCDATE3 = WA_ZDMS3-CTDATE1.
*      NSREM3 = WA_ZDMS3-REM1.
*      NSFOLW3 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 4.
*      NSTEXT4 = WA_ZDMS3-ATEXT1.
*      NSDATE4 = WA_ZDMS3-TDATE1.
*      NSCDATE4 = WA_ZDMS3-CTDATE1.
*      NSREM4 = WA_ZDMS3-REM1.
*      NSFOLW4 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 5.
*      NSTEXT5 = WA_ZDMS3-ATEXT1.
*      NSDATE5 = WA_ZDMS3-TDATE1.
*      NSCDATE5 = WA_ZDMS3-CTDATE1.
*      NSREM5 = WA_ZDMS3-REM1.
*      NSFOLW5 = WA_ZDMS3-FOLW1.
*    ENDIF.
*
*    IF WA_ZDMS3-ZEILE EQ 6.
*      NSTEXT6 = WA_ZDMS3-ATEXT1.
*      NSDATE6 = WA_ZDMS3-TDATE1.
*      NSCDATE6 = WA_ZDMS3-CTDATE1.
*      NSREM6 = WA_ZDMS3-REM1.
*      NSFOLW6 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 7.
*      NSTEXT7 = WA_ZDMS3-ATEXT1.
*      NSDATE7 = WA_ZDMS3-TDATE1.
*      NSCDATE7 = WA_ZDMS3-CTDATE1.
*      NSREM7 = WA_ZDMS3-REM1.
*      NSFOLW7 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 8.
*      NSTEXT8 = WA_ZDMS3-ATEXT1.
*      NSDATE8 = WA_ZDMS3-TDATE1.
*      NSCDATE8 = WA_ZDMS3-CTDATE1.
*      NSREM8 = WA_ZDMS3-REM1.
*      NSFOLW8 = WA_ZDMS3-FOLW1.
*    ENDIF.
*  ENDLOOP.
*************** 20 ***
*
*  LOOP AT IT_ZDMS3 INTO WA_ZDMS3 WHERE DEPT EQ ZDMS1-DEPT20.
*    SELECT SINGLE * FROM PA0001 WHERE PERNR EQ WA_ZDMS3-PERNR AND ENDDA GE SY-DATUM.
*    IF SY-SUBRC EQ 0.
*      INAME2 = PA0001-ENAME.
*    ENDIF.
*
*    IF WA_ZDMS3-ZEILE EQ 1.
*      NTTEXT1 = WA_ZDMS3-ATEXT1.
*      NTDATE1 = WA_ZDMS3-TDATE1.
*      NTCDATE1 = WA_ZDMS3-CTDATE1.
*      NTREM1 = WA_ZDMS3-REM1.
*      NTFOLW1 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 2.
*      NTTEXT2 = WA_ZDMS3-ATEXT1.
*      NTDATE2 = WA_ZDMS3-TDATE1.
*      NTCDATE2 = WA_ZDMS3-CTDATE1.
*      NTREM2 = WA_ZDMS3-REM1.
*      NTFOLW2 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 3.
*      NTTEXT3 = WA_ZDMS3-ATEXT1.
*      NTDATE3 = WA_ZDMS3-TDATE1.
*      NTCDATE3 = WA_ZDMS3-CTDATE1.
*      NTREM3 = WA_ZDMS3-REM1.
*      NTFOLW3 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 4.
*      NTTEXT4 = WA_ZDMS3-ATEXT1.
*      NTDATE4 = WA_ZDMS3-TDATE1.
*      NTCDATE4 = WA_ZDMS3-CTDATE1.
*      NTREM4 = WA_ZDMS3-REM1.
*      NTFOLW4 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 5.
*      NTTEXT5 = WA_ZDMS3-ATEXT1.
*      NTDATE5 = WA_ZDMS3-TDATE1.
*      NTCDATE5 = WA_ZDMS3-CTDATE1.
*      NTREM5 = WA_ZDMS3-REM1.
*      NTFOLW5 = WA_ZDMS3-FOLW1.
*    ENDIF.
*
*    IF WA_ZDMS3-ZEILE EQ 6.
*      NTTEXT6 = WA_ZDMS3-ATEXT1.
*      NTDATE6 = WA_ZDMS3-TDATE1.
*      NTCDATE6 = WA_ZDMS3-CTDATE1.
*      NTREM6 = WA_ZDMS3-REM1.
*      NTFOLW6 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 7.
*      NTTEXT7 = WA_ZDMS3-ATEXT1.
*      NTDATE7 = WA_ZDMS3-TDATE1.
*      NTCDATE7 = WA_ZDMS3-CTDATE1.
*      NTREM7 = WA_ZDMS3-REM1.
*      NTFOLW7 = WA_ZDMS3-FOLW1.
*    ENDIF.
*    IF WA_ZDMS3-ZEILE EQ 8.
*      NTTEXT8 = WA_ZDMS3-ATEXT1.
*      NTDATE8 = WA_ZDMS3-TDATE1.
*      NTCDATE8 = WA_ZDMS3-CTDATE1.
*      NTREM8 = WA_ZDMS3-REM1.
*      NTFOLW8 = WA_ZDMS3-FOLW1.
*    ENDIF.
*  ENDLOOP.


**************************

ENDFORM.
*&---------------------------------------------------------------------*
*&      Form  UPD2
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM UPD2.

*  LOOP AT IT_ZDMS2 INTO WA_ZDMS2 WHERE DEPT EQ ZDMS1-DEPT1.
*    SELECT SINGLE * FROM PA0001 WHERE PERNR EQ WA_ZDMS2-PERNR AND ENDDA GE SY-DATUM.
*    IF SY-SUBRC EQ 0.
*      INAME1 = PA0001-ENAME.
*    ENDIF.
*    KTEXT1 = WA_ZDMS2-ATEXT1.
*    KDATE1 = WA_ZDMS2-TDATE1.
*    KCDATE1 = WA_ZDMS2-CTDATE1.
*    KREM1 = WA_ZDMS2-REM1.
*    KTEXT2 = WA_ZDMS2-ATEXT2.
*    KDATE2 = WA_ZDMS2-TDATE2.
*    KCDATE2 = WA_ZDMS2-CTDATE2.
*    KREM2 = WA_ZDMS2-REM2.
*    KTEXT3 = WA_ZDMS2-ATEXT3.
*    KDATE3 = WA_ZDMS2-TDATE3.
*    KCDATE3 = WA_ZDMS2-CTDATE3.
*    KREM3 = WA_ZDMS2-REM3.
*    KTEXT4 = WA_ZDMS2-ATEXT4.
*    KDATE4 = WA_ZDMS2-TDATE4.
*    KCDATE4 = WA_ZDMS2-CTDATE4.
*    KREM4 = WA_ZDMS2-REM4.
*    KTEXT5 = WA_ZDMS2-ATEXT5.
*    KDATE5 = WA_ZDMS2-TDATE5.
*    KCDATE5 = WA_ZDMS2-CTDATE5.
*    KREM5 = WA_ZDMS2-REM5.
*  ENDLOOP.
*
************************************
*  LOOP AT IT_ZDMS2 INTO WA_ZDMS2 WHERE DEPT EQ ZDMS1-DEPT2.
*    SELECT SINGLE * FROM PA0001 WHERE PERNR EQ WA_ZDMS2-PERNR AND ENDDA GE SY-DATUM.
*    IF SY-SUBRC EQ 0.
*      INAME1 = PA0001-ENAME.
*    ENDIF.
*    LTEXT1 = WA_ZDMS2-ATEXT1.
*    LDATE1 = WA_ZDMS2-TDATE1.
*    LCDATE1 = WA_ZDMS2-CTDATE1.
*    LREM1 = WA_ZDMS2-REM1.
*    LTEXT2 = WA_ZDMS2-ATEXT2.
*    LDATE2 = WA_ZDMS2-TDATE2.
*    LCDATE2 = WA_ZDMS2-CTDATE2.
*    LREM2 = WA_ZDMS2-REM2.
*    LTEXT3 = WA_ZDMS2-ATEXT3.
*    LDATE3 = WA_ZDMS2-TDATE3.
*    LCDATE3 = WA_ZDMS2-CTDATE3.
*    LREM3 = WA_ZDMS2-REM3.
*    LTEXT4 = WA_ZDMS2-ATEXT4.
*    LDATE4 = WA_ZDMS2-TDATE4.
*    LCDATE4 = WA_ZDMS2-CTDATE4.
*    LREM4 = WA_ZDMS2-REM4.
*    LTEXT5 = WA_ZDMS2-ATEXT5.
*    LDATE5 = WA_ZDMS2-TDATE5.
*    LCDATE5 = WA_ZDMS2-CTDATE5.
*    LREM5 = WA_ZDMS2-REM5.
*  ENDLOOP.
*
*  LOOP AT IT_ZDMS2 INTO WA_ZDMS2 WHERE DEPT EQ ZDMS1-DEPT3.
*    SELECT SINGLE * FROM PA0001 WHERE PERNR EQ WA_ZDMS2-PERNR AND ENDDA GE SY-DATUM.
*    IF SY-SUBRC EQ 0.
*      INAME1 = PA0001-ENAME.
*    ENDIF.
*    MTEXT1 = WA_ZDMS2-ATEXT1.
*    MDATE1 = WA_ZDMS2-TDATE1.
*    MCDATE1 = WA_ZDMS2-CTDATE1.
*    MREM1 = WA_ZDMS2-REM1.
*    MTEXT2 = WA_ZDMS2-ATEXT2.
*    MDATE2 = WA_ZDMS2-TDATE2.
*    MCDATE2 = WA_ZDMS2-CTDATE2.
*    MREM2 = WA_ZDMS2-REM2.
*    MTEXT3 = WA_ZDMS2-ATEXT3.
*    MDATE3 = WA_ZDMS2-TDATE3.
*    MCDATE3 = WA_ZDMS2-CTDATE3.
*    MREM3 = WA_ZDMS2-REM3.
*    MTEXT4 = WA_ZDMS2-ATEXT4.
*    MDATE4 = WA_ZDMS2-TDATE4.
*    MCDATE4 = WA_ZDMS2-CTDATE4.
*    MREM4 = WA_ZDMS2-REM4.
*    MTEXT5 = WA_ZDMS2-ATEXT5.
*    MDATE5 = WA_ZDMS2-TDATE5.
*    MCDATE5 = WA_ZDMS2-CTDATE5.
*    MREM5 = WA_ZDMS2-REM5.
*  ENDLOOP.
*
*  LOOP AT IT_ZDMS2 INTO WA_ZDMS2 WHERE DEPT EQ ZDMS1-DEPT4.
*    SELECT SINGLE * FROM PA0001 WHERE PERNR EQ WA_ZDMS2-PERNR AND ENDDA GE SY-DATUM.
*    IF SY-SUBRC EQ 0.
*      INAME1 = PA0001-ENAME.
*    ENDIF.
*    NTEXT1 = WA_ZDMS2-ATEXT1.
*    NDATE1 = WA_ZDMS2-TDATE1.
*    NCDATE1 = WA_ZDMS2-CTDATE1.
*    NREM1 = WA_ZDMS2-REM1.
*    NTEXT2 = WA_ZDMS2-ATEXT2.
*    NDATE2 = WA_ZDMS2-TDATE2.
*    NCDATE2 = WA_ZDMS2-CTDATE2.
*    NREM2 = WA_ZDMS2-REM2.
*    NTEXT3 = WA_ZDMS2-ATEXT3.
*    NDATE3 = WA_ZDMS2-TDATE3.
*    NCDATE3 = WA_ZDMS2-CTDATE3.
*    NREM3 = WA_ZDMS2-REM3.
*    NTEXT4 = WA_ZDMS2-ATEXT4.
*    NDATE4 = WA_ZDMS2-TDATE4.
*    NCDATE4 = WA_ZDMS2-CTDATE4.
*    NREM4 = WA_ZDMS2-REM4.
*    NTEXT5 = WA_ZDMS2-ATEXT5.
*    NDATE5 = WA_ZDMS2-TDATE5.
*    NCDATE5 = WA_ZDMS2-CTDATE5.
*    NREM5 = WA_ZDMS2-REM5.
*  ENDLOOP.
*
*  LOOP AT IT_ZDMS2 INTO WA_ZDMS2 WHERE DEPT EQ ZDMS1-DEPT5.
*    SELECT SINGLE * FROM PA0001 WHERE PERNR EQ WA_ZDMS2-PERNR AND ENDDA GE SY-DATUM.
*    IF SY-SUBRC EQ 0.
*      INAME1 = PA0001-ENAME.
*    ENDIF.
*    OTEXT1 = WA_ZDMS2-ATEXT1.
*    ODATE1 = WA_ZDMS2-TDATE1.
*    OCDATE1 = WA_ZDMS2-CTDATE1.
*    OREM1 = WA_ZDMS2-REM1.
*    OTEXT2 = WA_ZDMS2-ATEXT2.
*    ODATE2 = WA_ZDMS2-TDATE2.
*    OCDATE2 = WA_ZDMS2-CTDATE2.
*    OREM2 = WA_ZDMS2-REM2.
*    OTEXT3 = WA_ZDMS2-ATEXT3.
*    ODATE3 = WA_ZDMS2-TDATE3.
*    OCDATE3 = WA_ZDMS2-CTDATE3.
*    OREM3 = WA_ZDMS2-REM3.
*    OTEXT4 = WA_ZDMS2-ATEXT4.
*    ODATE4 = WA_ZDMS2-TDATE4.
*    OCDATE4 = WA_ZDMS2-CTDATE4.
*    OREM4 = WA_ZDMS2-REM4.
*    OTEXT5 = WA_ZDMS2-ATEXT5.
*    ODATE5 = WA_ZDMS2-TDATE5.
*    OCDATE5 = WA_ZDMS2-CTDATE5.
*    OREM5 = WA_ZDMS2-REM5.
*  ENDLOOP.
*
*
*  LOOP AT IT_ZDMS2 INTO WA_ZDMS2 WHERE DEPT EQ ZDMS1-DEPT6.
*    SELECT SINGLE * FROM PA0001 WHERE PERNR EQ WA_ZDMS2-PERNR AND ENDDA GE SY-DATUM.
*    IF SY-SUBRC EQ 0.
*      INAME1 = PA0001-ENAME.
*    ENDIF.
*    PTEXT1 = WA_ZDMS2-ATEXT1.
*    PDATE1 = WA_ZDMS2-TDATE1.
*    PCDATE1 = WA_ZDMS2-CTDATE1.
*    PREM1 = WA_ZDMS2-REM1.
*    PTEXT2 = WA_ZDMS2-ATEXT2.
*    PDATE2 = WA_ZDMS2-TDATE2.
*    PCDATE2 = WA_ZDMS2-CTDATE2.
*    PREM2 = WA_ZDMS2-REM2.
*    PTEXT3 = WA_ZDMS2-ATEXT3.
*    PDATE3 = WA_ZDMS2-TDATE3.
*    PCDATE3 = WA_ZDMS2-CTDATE3.
*    PREM3 = WA_ZDMS2-REM3.
*    PTEXT4 = WA_ZDMS2-ATEXT4.
*    PDATE4 = WA_ZDMS2-TDATE4.
*    PCDATE4 = WA_ZDMS2-CTDATE4.
*    PREM4 = WA_ZDMS2-REM4.
*    PTEXT5 = WA_ZDMS2-ATEXT5.
*    PDATE5 = WA_ZDMS2-TDATE5.
*    PCDATE5 = WA_ZDMS2-CTDATE5.
*    PREM5 = WA_ZDMS2-REM5.
*  ENDLOOP.
*
*  LOOP AT IT_ZDMS2 INTO WA_ZDMS2 WHERE DEPT EQ ZDMS1-DEPT7.
*    SELECT SINGLE * FROM PA0001 WHERE PERNR EQ WA_ZDMS2-PERNR AND ENDDA GE SY-DATUM.
*    IF SY-SUBRC EQ 0.
*      INAME1 = PA0001-ENAME.
*    ENDIF.
*    QTEXT1 = WA_ZDMS2-ATEXT1.
*    QDATE1 = WA_ZDMS2-TDATE1.
*    QCDATE1 = WA_ZDMS2-CTDATE1.
*    QREM1 = WA_ZDMS2-REM1.
*    QTEXT2 = WA_ZDMS2-ATEXT2.
*    QDATE2 = WA_ZDMS2-TDATE2.
*    QCDATE2 = WA_ZDMS2-CTDATE2.
*    QREM2 = WA_ZDMS2-REM2.
*    QTEXT3 = WA_ZDMS2-ATEXT3.
*    QDATE3 = WA_ZDMS2-TDATE3.
*    QCDATE3 = WA_ZDMS2-CTDATE3.
*    QREM3 = WA_ZDMS2-REM3.
*    QTEXT4 = WA_ZDMS2-ATEXT4.
*    QDATE4 = WA_ZDMS2-TDATE4.
*    QCDATE4 = WA_ZDMS2-CTDATE4.
*    QREM4 = WA_ZDMS2-REM4.
*    QTEXT5 = WA_ZDMS2-ATEXT5.
*    QDATE5 = WA_ZDMS2-TDATE5.
*    QCDATE5 = WA_ZDMS2-CTDATE5.
*    QREM5 = WA_ZDMS2-REM5.
*  ENDLOOP.
*
*  LOOP AT IT_ZDMS2 INTO WA_ZDMS2 WHERE DEPT EQ ZDMS1-DEPT8.
*    SELECT SINGLE * FROM PA0001 WHERE PERNR EQ WA_ZDMS2-PERNR AND ENDDA GE SY-DATUM.
*    IF SY-SUBRC EQ 0.
*      INAME1 = PA0001-ENAME.
*    ENDIF.
*    RTEXT1 = WA_ZDMS2-ATEXT1.
*    RDATE1 = WA_ZDMS2-TDATE1.
*    RCDATE1 = WA_ZDMS2-CTDATE1.
*    RREM1 = WA_ZDMS2-REM1.
*    RTEXT2 = WA_ZDMS2-ATEXT2.
*    RDATE2 = WA_ZDMS2-TDATE2.
*    RCDATE2 = WA_ZDMS2-CTDATE2.
*    RREM2 = WA_ZDMS2-REM2.
*    RTEXT3 = WA_ZDMS2-ATEXT3.
*    RDATE3 = WA_ZDMS2-TDATE3.
*    RCDATE3 = WA_ZDMS2-CTDATE3.
*    RREM3 = WA_ZDMS2-REM3.
*    RTEXT4 = WA_ZDMS2-ATEXT4.
*    RDATE4 = WA_ZDMS2-TDATE4.
*    RCDATE4 = WA_ZDMS2-CTDATE4.
*    RREM4 = WA_ZDMS2-REM4.
*    RTEXT5 = WA_ZDMS2-ATEXT5.
*    RDATE5 = WA_ZDMS2-TDATE5.
*    RCDATE5 = WA_ZDMS2-CTDATE5.
*    RREM5 = WA_ZDMS2-REM5.
*  ENDLOOP.
*
*  LOOP AT IT_ZDMS2 INTO WA_ZDMS2 WHERE DEPT EQ ZDMS1-DEPT9.
*    SELECT SINGLE * FROM PA0001 WHERE PERNR EQ WA_ZDMS2-PERNR AND ENDDA GE SY-DATUM.
*    IF SY-SUBRC EQ 0.
*      INAME1 = PA0001-ENAME.
*    ENDIF.
*    STEXT1 = WA_ZDMS2-ATEXT1.
*    SDATE1 = WA_ZDMS2-TDATE1.
*    SCDATE1 = WA_ZDMS2-CTDATE1.
*    SREM1 = WA_ZDMS2-REM1.
*    STEXT2 = WA_ZDMS2-ATEXT2.
*    SDATE2 = WA_ZDMS2-TDATE2.
*    SCDATE2 = WA_ZDMS2-CTDATE2.
*    SREM2 = WA_ZDMS2-REM2.
*    STEXT3 = WA_ZDMS2-ATEXT3.
*    SDATE3 = WA_ZDMS2-TDATE3.
*    SCDATE3 = WA_ZDMS2-CTDATE3.
*    SREM3 = WA_ZDMS2-REM3.
*    STEXT4 = WA_ZDMS2-ATEXT4.
*    SDATE4 = WA_ZDMS2-TDATE4.
*    SCDATE4 = WA_ZDMS2-CTDATE4.
*    SREM4 = WA_ZDMS2-REM4.
*    STEXT5 = WA_ZDMS2-ATEXT5.
*    SDATE5 = WA_ZDMS2-TDATE5.
*    SCDATE5 = WA_ZDMS2-CTDATE5.
*    SREM5 = WA_ZDMS2-REM5.
*  ENDLOOP.
*
*  LOOP AT IT_ZDMS2 INTO WA_ZDMS2 WHERE DEPT EQ ZDMS1-DEPT10.
*    SELECT SINGLE * FROM PA0001 WHERE PERNR EQ WA_ZDMS2-PERNR AND ENDDA GE SY-DATUM.
*    IF SY-SUBRC EQ 0.
*      INAME1 = PA0001-ENAME.
*    ENDIF.
*    TTEXT1 = WA_ZDMS2-ATEXT1.
*    TDATE1 = WA_ZDMS2-TDATE1.
*    TCDATE1 = WA_ZDMS2-CTDATE1.
*    TREM1 = WA_ZDMS2-REM1.
*    TTEXT2 = WA_ZDMS2-ATEXT2.
*    TDATE2 = WA_ZDMS2-TDATE2.
*    TCDATE2 = WA_ZDMS2-CTDATE2.
*    TREM2 = WA_ZDMS2-REM2.
*    TTEXT3 = WA_ZDMS2-ATEXT3.
*    TDATE3 = WA_ZDMS2-TDATE3.
*    TCDATE3 = WA_ZDMS2-CTDATE3.
*    TREM3 = WA_ZDMS2-REM3.
*    TTEXT4 = WA_ZDMS2-ATEXT4.
*    TDATE4 = WA_ZDMS2-TDATE4.
*    TCDATE4 = WA_ZDMS2-CTDATE4.
*    TREM4 = WA_ZDMS2-REM4.
*    TTEXT5 = WA_ZDMS2-ATEXT5.
*    TDATE5 = WA_ZDMS2-TDATE5.
*    TCDATE5 = WA_ZDMS2-CTDATE5.
*    TREM5 = WA_ZDMS2-REM5.
*  ENDLOOP.
*******************************************
*
*  LOOP AT IT_ZDMS2 INTO WA_ZDMS2 WHERE DEPT EQ ZDMS1-DEPT11.
*    SELECT SINGLE * FROM PA0001 WHERE PERNR EQ WA_ZDMS2-PERNR AND ENDDA GE SY-DATUM.
*    IF SY-SUBRC EQ 0.
*      INAME1 = PA0001-ENAME.
*    ENDIF.
*    NKTEXT1 = WA_ZDMS2-ATEXT1.
*    NKDATE1 = WA_ZDMS2-TDATE1.
*    NKCDATE1 = WA_ZDMS2-CTDATE1.
*    NKREM1 = WA_ZDMS2-REM1.
*    NKTEXT2 = WA_ZDMS2-ATEXT2.
*    NKDATE2 = WA_ZDMS2-TDATE2.
*    NKCDATE2 = WA_ZDMS2-CTDATE2.
*    NKREM2 = WA_ZDMS2-REM2.
*    NKTEXT3 = WA_ZDMS2-ATEXT3.
*    NKDATE3 = WA_ZDMS2-TDATE3.
*    NKCDATE3 = WA_ZDMS2-CTDATE3.
*    NKREM3 = WA_ZDMS2-REM3.
*    NKTEXT4 = WA_ZDMS2-ATEXT4.
*    NKDATE4 = WA_ZDMS2-TDATE4.
*    NKCDATE4 = WA_ZDMS2-CTDATE4.
*    NKREM4 = WA_ZDMS2-REM4.
*    NKTEXT5 = WA_ZDMS2-ATEXT5.
*    NKDATE5 = WA_ZDMS2-TDATE5.
*    NKCDATE5 = WA_ZDMS2-CTDATE5.
*    NKREM5 = WA_ZDMS2-REM5.
*  ENDLOOP.
*
************************************
*  LOOP AT IT_ZDMS2 INTO WA_ZDMS2 WHERE DEPT EQ ZDMS1-DEPT12.
*    SELECT SINGLE * FROM PA0001 WHERE PERNR EQ WA_ZDMS2-PERNR AND ENDDA GE SY-DATUM.
*    IF SY-SUBRC EQ 0.
*      INAME1 = PA0001-ENAME.
*    ENDIF.
*    NLTEXT1 = WA_ZDMS2-ATEXT1.
*    NLDATE1 = WA_ZDMS2-TDATE1.
*    NLCDATE1 = WA_ZDMS2-CTDATE1.
*    NLREM1 = WA_ZDMS2-REM1.
*    NLTEXT2 = WA_ZDMS2-ATEXT2.
*    NLDATE2 = WA_ZDMS2-TDATE2.
*    NLCDATE2 = WA_ZDMS2-CTDATE2.
*    NLREM2 = WA_ZDMS2-REM2.
*    NLTEXT3 = WA_ZDMS2-ATEXT3.
*    NLDATE3 = WA_ZDMS2-TDATE3.
*    NLCDATE3 = WA_ZDMS2-CTDATE3.
*    NLREM3 = WA_ZDMS2-REM3.
*    NLTEXT4 = WA_ZDMS2-ATEXT4.
*    NLDATE4 = WA_ZDMS2-TDATE4.
*    NLCDATE4 = WA_ZDMS2-CTDATE4.
*    NLREM4 = WA_ZDMS2-REM4.
*    NLTEXT5 = WA_ZDMS2-ATEXT5.
*    NLDATE5 = WA_ZDMS2-TDATE5.
*    NLCDATE5 = WA_ZDMS2-CTDATE5.
*    NLREM5 = WA_ZDMS2-REM5.
*  ENDLOOP.
*
*  LOOP AT IT_ZDMS2 INTO WA_ZDMS2 WHERE DEPT EQ ZDMS1-DEPT13.
*    SELECT SINGLE * FROM PA0001 WHERE PERNR EQ WA_ZDMS2-PERNR AND ENDDA GE SY-DATUM.
*    IF SY-SUBRC EQ 0.
*      INAME1 = PA0001-ENAME.
*    ENDIF.
*    NMTEXT1 = WA_ZDMS2-ATEXT1.
*    NMDATE1 = WA_ZDMS2-TDATE1.
*    NMCDATE1 = WA_ZDMS2-CTDATE1.
*    NMREM1 = WA_ZDMS2-REM1.
*    NMTEXT2 = WA_ZDMS2-ATEXT2.
*    NMDATE2 = WA_ZDMS2-TDATE2.
*    NMCDATE2 = WA_ZDMS2-CTDATE2.
*    NMREM2 = WA_ZDMS2-REM2.
*    NMTEXT3 = WA_ZDMS2-ATEXT3.
*    NMDATE3 = WA_ZDMS2-TDATE3.
*    NMCDATE3 = WA_ZDMS2-CTDATE3.
*    NMREM3 = WA_ZDMS2-REM3.
*    NMTEXT4 = WA_ZDMS2-ATEXT4.
*    NMDATE4 = WA_ZDMS2-TDATE4.
*    NMCDATE4 = WA_ZDMS2-CTDATE4.
*    NMREM4 = WA_ZDMS2-REM4.
*    NMTEXT5 = WA_ZDMS2-ATEXT5.
*    NMDATE5 = WA_ZDMS2-TDATE5.
*    NMCDATE5 = WA_ZDMS2-CTDATE5.
*    NMREM5 = WA_ZDMS2-REM5.
*  ENDLOOP.
*
*  LOOP AT IT_ZDMS2 INTO WA_ZDMS2 WHERE DEPT EQ ZDMS1-DEPT14.
*    SELECT SINGLE * FROM PA0001 WHERE PERNR EQ WA_ZDMS2-PERNR AND ENDDA GE SY-DATUM.
*    IF SY-SUBRC EQ 0.
*      INAME1 = PA0001-ENAME.
*    ENDIF.
*    NNTEXT1 = WA_ZDMS2-ATEXT1.
*    NNDATE1 = WA_ZDMS2-TDATE1.
*    NNCDATE1 = WA_ZDMS2-CTDATE1.
*    NNREM1 = WA_ZDMS2-REM1.
*    NNTEXT2 = WA_ZDMS2-ATEXT2.
*    NNDATE2 = WA_ZDMS2-TDATE2.
*    NNCDATE2 = WA_ZDMS2-CTDATE2.
*    NNREM2 = WA_ZDMS2-REM2.
*    NNTEXT3 = WA_ZDMS2-ATEXT3.
*    NNDATE3 = WA_ZDMS2-TDATE3.
*    NNCDATE3 = WA_ZDMS2-CTDATE3.
*    NNREM3 = WA_ZDMS2-REM3.
*    NNTEXT4 = WA_ZDMS2-ATEXT4.
*    NNDATE4 = WA_ZDMS2-TDATE4.
*    NNCDATE4 = WA_ZDMS2-CTDATE4.
*    NNREM4 = WA_ZDMS2-REM4.
*    NNTEXT5 = WA_ZDMS2-ATEXT5.
*    NNDATE5 = WA_ZDMS2-TDATE5.
*    NNCDATE5 = WA_ZDMS2-CTDATE5.
*    NNREM5 = WA_ZDMS2-REM5.
*  ENDLOOP.
*
*  LOOP AT IT_ZDMS2 INTO WA_ZDMS2 WHERE DEPT EQ ZDMS1-DEPT15.
*    SELECT SINGLE * FROM PA0001 WHERE PERNR EQ WA_ZDMS2-PERNR AND ENDDA GE SY-DATUM.
*    IF SY-SUBRC EQ 0.
*      INAME1 = PA0001-ENAME.
*    ENDIF.
*    NOTEXT1 = WA_ZDMS2-ATEXT1.
*    NODATE1 = WA_ZDMS2-TDATE1.
*    NOCDATE1 = WA_ZDMS2-CTDATE1.
*    NOREM1 = WA_ZDMS2-REM1.
*    NOTEXT2 = WA_ZDMS2-ATEXT2.
*    NODATE2 = WA_ZDMS2-TDATE2.
*    NOCDATE2 = WA_ZDMS2-CTDATE2.
*    NOREM2 = WA_ZDMS2-REM2.
*    NOTEXT3 = WA_ZDMS2-ATEXT3.
*    NODATE3 = WA_ZDMS2-TDATE3.
*    NOCDATE3 = WA_ZDMS2-CTDATE3.
*    NOREM3 = WA_ZDMS2-REM3.
*    NOTEXT4 = WA_ZDMS2-ATEXT4.
*    NODATE4 = WA_ZDMS2-TDATE4.
*    NOCDATE4 = WA_ZDMS2-CTDATE4.
*    NOREM4 = WA_ZDMS2-REM4.
*    NOTEXT5 = WA_ZDMS2-ATEXT5.
*    NODATE5 = WA_ZDMS2-TDATE5.
*    NOCDATE5 = WA_ZDMS2-CTDATE5.
*    NOREM5 = WA_ZDMS2-REM5.
*  ENDLOOP.
*
*
*  LOOP AT IT_ZDMS2 INTO WA_ZDMS2 WHERE DEPT EQ ZDMS1-DEPT16.
*    SELECT SINGLE * FROM PA0001 WHERE PERNR EQ WA_ZDMS2-PERNR AND ENDDA GE SY-DATUM.
*    IF SY-SUBRC EQ 0.
*      INAME1 = PA0001-ENAME.
*    ENDIF.
*    NPTEXT1 = WA_ZDMS2-ATEXT1.
*    NPDATE1 = WA_ZDMS2-TDATE1.
*    NPCDATE1 = WA_ZDMS2-CTDATE1.
*    NPREM1 = WA_ZDMS2-REM1.
*    NPTEXT2 = WA_ZDMS2-ATEXT2.
*    NPDATE2 = WA_ZDMS2-TDATE2.
*    NPCDATE2 = WA_ZDMS2-CTDATE2.
*    NPREM2 = WA_ZDMS2-REM2.
*    NPTEXT3 = WA_ZDMS2-ATEXT3.
*    NPDATE3 = WA_ZDMS2-TDATE3.
*    NPCDATE3 = WA_ZDMS2-CTDATE3.
*    NPREM3 = WA_ZDMS2-REM3.
*    NPTEXT4 = WA_ZDMS2-ATEXT4.
*    NPDATE4 = WA_ZDMS2-TDATE4.
*    NPCDATE4 = WA_ZDMS2-CTDATE4.
*    NPREM4 = WA_ZDMS2-REM4.
*    NPTEXT5 = WA_ZDMS2-ATEXT5.
*    NPDATE5 = WA_ZDMS2-TDATE5.
*    NPCDATE5 = WA_ZDMS2-CTDATE5.
*    NPREM5 = WA_ZDMS2-REM5.
*  ENDLOOP.
*
*  LOOP AT IT_ZDMS2 INTO WA_ZDMS2 WHERE DEPT EQ ZDMS1-DEPT17.
*    SELECT SINGLE * FROM PA0001 WHERE PERNR EQ WA_ZDMS2-PERNR AND ENDDA GE SY-DATUM.
*    IF SY-SUBRC EQ 0.
*      INAME1 = PA0001-ENAME.
*    ENDIF.
*    NQTEXT1 = WA_ZDMS2-ATEXT1.
*    NQDATE1 = WA_ZDMS2-TDATE1.
*    NQCDATE1 = WA_ZDMS2-CTDATE1.
*    NQREM1 = WA_ZDMS2-REM1.
*    NQTEXT2 = WA_ZDMS2-ATEXT2.
*    NQDATE2 = WA_ZDMS2-TDATE2.
*    NQCDATE2 = WA_ZDMS2-CTDATE2.
*    NQREM2 = WA_ZDMS2-REM2.
*    NQTEXT3 = WA_ZDMS2-ATEXT3.
*    NQDATE3 = WA_ZDMS2-TDATE3.
*    NQCDATE3 = WA_ZDMS2-CTDATE3.
*    NQREM3 = WA_ZDMS2-REM3.
*    NQTEXT4 = WA_ZDMS2-ATEXT4.
*    NQDATE4 = WA_ZDMS2-TDATE4.
*    NQCDATE4 = WA_ZDMS2-CTDATE4.
*    NQREM4 = WA_ZDMS2-REM4.
*    NQTEXT5 = WA_ZDMS2-ATEXT5.
*    NQDATE5 = WA_ZDMS2-TDATE5.
*    NQCDATE5 = WA_ZDMS2-CTDATE5.
*    NQREM5 = WA_ZDMS2-REM5.
*  ENDLOOP.
*
*  LOOP AT IT_ZDMS2 INTO WA_ZDMS2 WHERE DEPT EQ ZDMS1-DEPT18.
*    SELECT SINGLE * FROM PA0001 WHERE PERNR EQ WA_ZDMS2-PERNR AND ENDDA GE SY-DATUM.
*    IF SY-SUBRC EQ 0.
*      INAME1 = PA0001-ENAME.
*    ENDIF.
*    NRTEXT1 = WA_ZDMS2-ATEXT1.
*    NRDATE1 = WA_ZDMS2-TDATE1.
*    NRCDATE1 = WA_ZDMS2-CTDATE1.
*    NRREM1 = WA_ZDMS2-REM1.
*    NRTEXT2 = WA_ZDMS2-ATEXT2.
*    NRDATE2 = WA_ZDMS2-TDATE2.
*    NRCDATE2 = WA_ZDMS2-CTDATE2.
*    NRREM2 = WA_ZDMS2-REM2.
*    NRTEXT3 = WA_ZDMS2-ATEXT3.
*    NRDATE3 = WA_ZDMS2-TDATE3.
*    NRCDATE3 = WA_ZDMS2-CTDATE3.
*    NRREM3 = WA_ZDMS2-REM3.
*    NRTEXT4 = WA_ZDMS2-ATEXT4.
*    NRDATE4 = WA_ZDMS2-TDATE4.
*    NRCDATE4 = WA_ZDMS2-CTDATE4.
*    NRREM4 = WA_ZDMS2-REM4.
*    NRTEXT5 = WA_ZDMS2-ATEXT5.
*    NRDATE5 = WA_ZDMS2-TDATE5.
*    NRCDATE5 = WA_ZDMS2-CTDATE5.
*    NRREM5 = WA_ZDMS2-REM5.
*  ENDLOOP.
*
*  LOOP AT IT_ZDMS2 INTO WA_ZDMS2 WHERE DEPT EQ ZDMS1-DEPT19.
*    SELECT SINGLE * FROM PA0001 WHERE PERNR EQ WA_ZDMS2-PERNR AND ENDDA GE SY-DATUM.
*    IF SY-SUBRC EQ 0.
*      INAME1 = PA0001-ENAME.
*    ENDIF.
*    NSTEXT1 = WA_ZDMS2-ATEXT1.
*    NSDATE1 = WA_ZDMS2-TDATE1.
*    NSCDATE1 = WA_ZDMS2-CTDATE1.
*    NSREM1 = WA_ZDMS2-REM1.
*    NSTEXT2 = WA_ZDMS2-ATEXT2.
*    NSDATE2 = WA_ZDMS2-TDATE2.
*    NSCDATE2 = WA_ZDMS2-CTDATE2.
*    NSREM2 = WA_ZDMS2-REM2.
*    NSTEXT3 = WA_ZDMS2-ATEXT3.
*    NSDATE3 = WA_ZDMS2-TDATE3.
*    NSCDATE3 = WA_ZDMS2-CTDATE3.
*    NSREM3 = WA_ZDMS2-REM3.
*    NSTEXT4 = WA_ZDMS2-ATEXT4.
*    NSDATE4 = WA_ZDMS2-TDATE4.
*    NSCDATE4 = WA_ZDMS2-CTDATE4.
*    NSREM4 = WA_ZDMS2-REM4.
*    NSTEXT5 = WA_ZDMS2-ATEXT5.
*    NSDATE5 = WA_ZDMS2-TDATE5.
*    NSCDATE5 = WA_ZDMS2-CTDATE5.
*    NSREM5 = WA_ZDMS2-REM5.
*  ENDLOOP.
*
*  LOOP AT IT_ZDMS2 INTO WA_ZDMS2 WHERE DEPT EQ ZDMS1-DEPT20.
*    SELECT SINGLE * FROM PA0001 WHERE PERNR EQ WA_ZDMS2-PERNR AND ENDDA GE SY-DATUM.
*    IF SY-SUBRC EQ 0.
*      INAME1 = PA0001-ENAME.
*    ENDIF.
*    NTTEXT1 = WA_ZDMS2-ATEXT1.
*    NTDATE1 = WA_ZDMS2-TDATE1.
*    NTCDATE1 = WA_ZDMS2-CTDATE1.
*    NTREM1 = WA_ZDMS2-REM1.
*    NTTEXT2 = WA_ZDMS2-ATEXT2.
*    NTDATE2 = WA_ZDMS2-TDATE2.
*    NTCDATE2 = WA_ZDMS2-CTDATE2.
*    NTREM2 = WA_ZDMS2-REM2.
*    NTTEXT3 = WA_ZDMS2-ATEXT3.
*    NTDATE3 = WA_ZDMS2-TDATE3.
*    NTCDATE3 = WA_ZDMS2-CTDATE3.
*    NTREM3 = WA_ZDMS2-REM3.
*    NTTEXT4 = WA_ZDMS2-ATEXT4.
*    NTDATE4 = WA_ZDMS2-TDATE4.
*    NTCDATE4 = WA_ZDMS2-CTDATE4.
*    NTREM4 = WA_ZDMS2-REM4.
*    NTTEXT5 = WA_ZDMS2-ATEXT5.
*    NTDATE5 = WA_ZDMS2-TDATE5.
*    NTCDATE5 = WA_ZDMS2-CTDATE5.
*    NTREM5 = WA_ZDMS2-REM5.
*  ENDLOOP.

ENDFORM.
*&---------------------------------------------------------------------*
*&      Form  SDEPT1
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM SDEPT1 .


*  IF ZDMS1-DEPT1 NE SPACE.
*    ZEILE = 1.
*    IF KTEXT1 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT1.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   KTEXT1.
*      ZDMS3_WA-TDATE1 = KDATE1.
*      ZDMS3_WA-CTDATE1 = KCDATE1.
*      ZDMS3_WA-REM1 = KREM1.
*      ZDMS3_WA-FOLW1 = KFOLW1.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*
*    IF KTEXT2 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT1.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   KTEXT2.
*      ZDMS3_WA-TDATE1 = KDATE2.
*      ZDMS3_WA-CTDATE1 = KCDATE2.
*      ZDMS3_WA-REM1 = KREM2.
*      ZDMS3_WA-FOLW1 = KFOLW2.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*    IF KTEXT3 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT1.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   KTEXT3.
*      ZDMS3_WA-TDATE1 = KDATE3.
*      ZDMS3_WA-CTDATE1 = KCDATE3.
*      ZDMS3_WA-REM1 = KREM3.
*      ZDMS3_WA-FOLW1 = KFOLW3.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*    IF KTEXT4 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT1.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   KTEXT4.
*      ZDMS3_WA-TDATE1 = KDATE4.
*      ZDMS3_WA-CTDATE1 = KCDATE4.
*      ZDMS3_WA-REM1 = KREM4.
*      ZDMS3_WA-FOLW1 = KFOLW4.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*    IF KTEXT5 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT1.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   KTEXT5.
*      ZDMS3_WA-TDATE1 = KDATE5.
*      ZDMS3_WA-CTDATE1 = KCDATE5.
*      ZDMS3_WA-REM1 = KREM5.
*      ZDMS3_WA-FOLW1 = KFOLW5.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*    IF KTEXT6 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT1.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   KTEXT6.
*      ZDMS3_WA-TDATE1 = KDATE6.
*      ZDMS3_WA-CTDATE1 = KCDATE6.
*      ZDMS3_WA-REM1 = KREM6.
*      ZDMS3_WA-FOLW1 = KFOLW6.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*    IF KTEXT7 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT1.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   KTEXT7.
*      ZDMS3_WA-TDATE1 = KDATE7.
*      ZDMS3_WA-CTDATE1 = KCDATE7.
*      ZDMS3_WA-REM1 = KREM7.
*      ZDMS3_WA-FOLW1 = KFOLW7.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*    IF KTEXT8 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT1.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   KTEXT8.
*      ZDMS3_WA-TDATE1 = KDATE8.
*      ZDMS3_WA-CTDATE1 = KCDATE8.
*      ZDMS3_WA-REM1 = KREM8.
*      ZDMS3_WA-FOLW1 = KFOLW8.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*    ENDIF.
*    A = 1.
*  ENDIF.
**************  2 *********
*  IF ZDMS1-DEPT2 NE SPACE.
*    ZEILE = 1.
*    IF LTEXT1 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT2.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   LTEXT1.
*      ZDMS3_WA-TDATE1 = LDATE1.
*      ZDMS3_WA-CTDATE1 = LCDATE1.
*      ZDMS3_WA-REM1 = LREM1.
*      ZDMS3_WA-FOLW1 = LFOLW1.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*
*    IF LTEXT2 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT2.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   LTEXT2.
*      ZDMS3_WA-TDATE1 = LDATE2.
*      ZDMS3_WA-CTDATE1 = LCDATE2.
*      ZDMS3_WA-REM1 = LREM2.
*      ZDMS3_WA-FOLW1 = LFOLW2.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*    IF LTEXT3 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT2.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   LTEXT3.
*      ZDMS3_WA-TDATE1 = LDATE3.
*      ZDMS3_WA-CTDATE1 = LCDATE3.
*      ZDMS3_WA-REM1 = LREM3.
*      ZDMS3_WA-FOLW1 = LFOLW3.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*    IF LTEXT4 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT2.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   LTEXT4.
*      ZDMS3_WA-TDATE1 = LDATE4.
*      ZDMS3_WA-CTDATE1 = LCDATE4.
*      ZDMS3_WA-REM1 = LREM4.
*      ZDMS3_WA-FOLW1 = LFOLW4.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*    IF LTEXT5 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT2.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   LTEXT5.
*      ZDMS3_WA-TDATE1 = LDATE5.
*      ZDMS3_WA-CTDATE1 = LCDATE5.
*      ZDMS3_WA-REM1 = LREM5.
*      ZDMS3_WA-FOLW1 = LFOLW5.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*    IF LTEXT6 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT2.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   LTEXT6.
*      ZDMS3_WA-TDATE1 = LDATE6.
*      ZDMS3_WA-CTDATE1 = LCDATE6.
*      ZDMS3_WA-REM1 = LREM6.
*      ZDMS3_WA-FOLW1 = LFOLW6.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*    IF LTEXT7 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT2.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   LTEXT7.
*      ZDMS3_WA-TDATE1 = LDATE7.
*      ZDMS3_WA-CTDATE1 = LCDATE7.
*      ZDMS3_WA-REM1 = LREM7.
*      ZDMS3_WA-FOLW1 = LFOLW7.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*    IF LTEXT8 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT2.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   LTEXT8.
*      ZDMS3_WA-TDATE1 = LDATE8.
*      ZDMS3_WA-CTDATE1 = LCDATE8.
*      ZDMS3_WA-REM1 = LREM8.
*      ZDMS3_WA-FOLW1 = LFOLW8.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*    ENDIF.
*    A = 1.
*  ENDIF.
*
******** 3 *****************
*
*  IF ZDMS1-DEPT3 NE SPACE.
*    ZEILE = 1.
*    IF MTEXT1 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT3.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   MTEXT1.
*      ZDMS3_WA-TDATE1 = MDATE1.
*      ZDMS3_WA-CTDATE1 = MCDATE1.
*      ZDMS3_WA-REM1 = MREM1.
*      ZDMS3_WA-FOLW1 = MFOLW1.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*
*    IF MTEXT2 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT3.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   MTEXT2.
*      ZDMS3_WA-TDATE1 = MDATE2.
*      ZDMS3_WA-CTDATE1 = MCDATE2.
*      ZDMS3_WA-REM1 = MREM2.
*      ZDMS3_WA-FOLW1 = MFOLW2.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*    IF MTEXT3 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT3.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   MTEXT3.
*      ZDMS3_WA-TDATE1 = MDATE3.
*      ZDMS3_WA-CTDATE1 = MCDATE3.
*      ZDMS3_WA-REM1 = MREM3.
*      ZDMS3_WA-FOLW1 = MFOLW3.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*    IF MTEXT4 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT3.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   MTEXT4.
*      ZDMS3_WA-TDATE1 = MDATE4.
*      ZDMS3_WA-CTDATE1 = MCDATE4.
*      ZDMS3_WA-REM1 = MREM4.
*      ZDMS3_WA-FOLW1 = MFOLW4.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*    IF MTEXT5 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT3.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   MTEXT5.
*      ZDMS3_WA-TDATE1 = MDATE5.
*      ZDMS3_WA-CTDATE1 = MCDATE5.
*      ZDMS3_WA-REM1 = MREM5.
*      ZDMS3_WA-FOLW1 = MFOLW5.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*
*    IF MTEXT6 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT3.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   MTEXT6.
*      ZDMS3_WA-TDATE1 = MDATE6.
*      ZDMS3_WA-CTDATE1 = MCDATE6.
*      ZDMS3_WA-REM1 = MREM6.
*      ZDMS3_WA-FOLW1 = MFOLW6.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*
*    IF MTEXT7 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT3.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   MTEXT7.
*      ZDMS3_WA-TDATE1 = MDATE7.
*      ZDMS3_WA-CTDATE1 = MCDATE7.
*      ZDMS3_WA-REM1 = MREM7.
*      ZDMS3_WA-FOLW1 = MFOLW7.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*    IF MTEXT8 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT3.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   MTEXT8.
*      ZDMS3_WA-TDATE1 = MDATE8.
*      ZDMS3_WA-CTDATE1 = MCDATE8.
*      ZDMS3_WA-REM1 = MREM8.
*      ZDMS3_WA-FOLW1 = MFOLW8.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*    ENDIF.
*    A = 1.
*  ENDIF.
*
************4**********
*
*  IF ZDMS1-DEPT4 NE SPACE.
*    ZEILE = 1.
*    IF NTEXT1 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT4.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   NTEXT1.
*      ZDMS3_WA-TDATE1 = NDATE1.
*      ZDMS3_WA-CTDATE1 = NCDATE1.
*      ZDMS3_WA-REM1 = NREM1.
*      ZDMS3_WA-FOLW1 = NFOLW1.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*
*    IF NTEXT2 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT4.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   NTEXT2.
*      ZDMS3_WA-TDATE1 = NDATE2.
*      ZDMS3_WA-CTDATE1 = NCDATE2.
*      ZDMS3_WA-REM1 = NREM2.
*      ZDMS3_WA-FOLW1 = NFOLW2.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*    IF NTEXT3 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT4.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   NTEXT3.
*      ZDMS3_WA-TDATE1 = NDATE3.
*      ZDMS3_WA-CTDATE1 = NCDATE3.
*      ZDMS3_WA-REM1 = NREM3.
*      ZDMS3_WA-FOLW1 = NFOLW3.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*    IF NTEXT4 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT4.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   NTEXT4.
*      ZDMS3_WA-TDATE1 = NDATE4.
*      ZDMS3_WA-CTDATE1 = NCDATE4.
*      ZDMS3_WA-REM1 = NREM4.
*      ZDMS3_WA-FOLW1 = NFOLW4.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*    IF NTEXT5 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT4.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   NTEXT5.
*      ZDMS3_WA-TDATE1 = NDATE5.
*      ZDMS3_WA-CTDATE1 = NCDATE5.
*      ZDMS3_WA-REM1 = NREM5.
*      ZDMS3_WA-FOLW1 = NFOLW5.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*    IF NTEXT6 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT4.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   NTEXT6.
*      ZDMS3_WA-TDATE1 = NDATE6.
*      ZDMS3_WA-CTDATE1 = NCDATE6.
*      ZDMS3_WA-REM1 = NREM6.
*      ZDMS3_WA-FOLW1 = NFOLW6.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*    IF NTEXT7 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT4.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   NTEXT7.
*      ZDMS3_WA-TDATE1 = NDATE7.
*      ZDMS3_WA-CTDATE1 = NCDATE7.
*      ZDMS3_WA-REM1 = NREM7.
*      ZDMS3_WA-FOLW1 = NFOLW7.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*    IF NTEXT8 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT4.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   NTEXT8.
*      ZDMS3_WA-TDATE1 = NDATE8.
*      ZDMS3_WA-CTDATE1 = NCDATE8.
*      ZDMS3_WA-REM1 = NREM8.
*      ZDMS3_WA-FOLW1 = NFOLW8.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*    ENDIF.
*    A = 1.
*  ENDIF.
*
******** 5 *******
*
*  IF ZDMS1-DEPT5 NE SPACE.
*    ZEILE = 1.
*    IF OTEXT1 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT5.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   OTEXT1.
*      ZDMS3_WA-TDATE1 = ODATE1.
*      ZDMS3_WA-CTDATE1 = OCDATE1.
*      ZDMS3_WA-REM1 = OREM1.
*      ZDMS3_WA-FOLW1 = OFOLW1.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*
*    IF OTEXT2 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT5.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   OTEXT2.
*      ZDMS3_WA-TDATE1 = ODATE2.
*      ZDMS3_WA-CTDATE1 = OCDATE2.
*      ZDMS3_WA-REM1 = OREM2.
*      ZDMS3_WA-FOLW1 = OFOLW2.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*    IF OTEXT3 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT5.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   OTEXT3.
*      ZDMS3_WA-TDATE1 = ODATE3.
*      ZDMS3_WA-CTDATE1 = OCDATE3.
*      ZDMS3_WA-REM1 = OREM3.
*      ZDMS3_WA-FOLW1 = OFOLW3.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*    IF OTEXT4 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT5.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   OTEXT4.
*      ZDMS3_WA-TDATE1 = ODATE4.
*      ZDMS3_WA-CTDATE1 = OCDATE4.
*      ZDMS3_WA-REM1 = OREM4.
*      ZDMS3_WA-FOLW1 = OFOLW4.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*    IF OTEXT5 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT5.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   OTEXT5.
*      ZDMS3_WA-TDATE1 = ODATE5.
*      ZDMS3_WA-CTDATE1 = OCDATE5.
*      ZDMS3_WA-REM1 = OREM5.
*      ZDMS3_WA-FOLW1 = OFOLW5.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*
*    IF OTEXT6 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT5.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   OTEXT6.
*      ZDMS3_WA-TDATE1 = ODATE6.
*      ZDMS3_WA-CTDATE1 = OCDATE6.
*      ZDMS3_WA-REM1 = OREM6.
*      ZDMS3_WA-FOLW1 = OFOLW6.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*    IF OTEXT7 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT5.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   OTEXT7.
*      ZDMS3_WA-TDATE1 = ODATE7.
*      ZDMS3_WA-CTDATE1 = OCDATE7.
*      ZDMS3_WA-REM1 = OREM7.
*      ZDMS3_WA-FOLW1 = OFOLW7.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*    IF OTEXT8 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT5.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   OTEXT8.
*      ZDMS3_WA-TDATE1 = ODATE8.
*      ZDMS3_WA-CTDATE1 = OCDATE8.
*      ZDMS3_WA-REM1 = OREM8.
*      ZDMS3_WA-FOLW1 = OFOLW8.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*    ENDIF.
*    A = 1.
*  ENDIF.
*
*******   6 ********
*
*  IF ZDMS1-DEPT6 NE SPACE.
*    ZEILE = 1.
*    IF PTEXT1 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT6.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   PTEXT1.
*      ZDMS3_WA-TDATE1 = PDATE1.
*      ZDMS3_WA-CTDATE1 = PCDATE1.
*      ZDMS3_WA-REM1 = PREM1.
*      ZDMS3_WA-FOLW1 = PFOLW1.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*
*    IF PTEXT2 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT6.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   PTEXT2.
*      ZDMS3_WA-TDATE1 = PDATE2.
*      ZDMS3_WA-CTDATE1 = PCDATE2.
*      ZDMS3_WA-REM1 = PREM2.
*      ZDMS3_WA-FOLW1 = PFOLW2.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*    IF PTEXT3 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT6.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   PTEXT3.
*      ZDMS3_WA-TDATE1 = PDATE3.
*      ZDMS3_WA-CTDATE1 = PCDATE3.
*      ZDMS3_WA-REM1 = PREM3.
*      ZDMS3_WA-FOLW1 = PFOLW3.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*    IF PTEXT4 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT6.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   PTEXT4.
*      ZDMS3_WA-TDATE1 = PDATE4.
*      ZDMS3_WA-CTDATE1 = PCDATE4.
*      ZDMS3_WA-REM1 = PREM4.
*      ZDMS3_WA-FOLW1 = PFOLW4.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*    IF PTEXT5 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT6.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   PTEXT5.
*      ZDMS3_WA-TDATE1 = PDATE5.
*      ZDMS3_WA-CTDATE1 = PCDATE5.
*      ZDMS3_WA-REM1 = PREM5.
*      ZDMS3_WA-FOLW1 = PFOLW5.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*
*    IF PTEXT6 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT6.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   PTEXT6.
*      ZDMS3_WA-TDATE1 = PDATE6.
*      ZDMS3_WA-CTDATE1 = PCDATE6.
*      ZDMS3_WA-REM1 = PREM6.
*      ZDMS3_WA-FOLW1 = PFOLW6.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*    IF PTEXT7 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT6.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   PTEXT7.
*      ZDMS3_WA-TDATE1 = PDATE7.
*      ZDMS3_WA-CTDATE1 = PCDATE7.
*      ZDMS3_WA-REM1 = PREM7.
*      ZDMS3_WA-FOLW1 = PFOLW7.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*    IF PTEXT8 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT6.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   PTEXT8.
*      ZDMS3_WA-TDATE1 = PDATE8.
*      ZDMS3_WA-CTDATE1 = PCDATE8.
*      ZDMS3_WA-REM1 = PREM8.
*      ZDMS3_WA-FOLW1 = PFOLW8.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*    ENDIF.
*    A = 1.
*  ENDIF.
*
*********** 7--------
*
*  IF ZDMS1-DEPT7 NE SPACE.
*    ZEILE = 1.
*    IF QTEXT1 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT7.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   QTEXT1.
*      ZDMS3_WA-TDATE1 = QDATE1.
*      ZDMS3_WA-CTDATE1 = QCDATE1.
*      ZDMS3_WA-REM1 = QREM1.
*      ZDMS3_WA-FOLW1 = QFOLW1.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*
*    IF QTEXT2 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT7.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   QTEXT2.
*      ZDMS3_WA-TDATE1 = QDATE2.
*      ZDMS3_WA-CTDATE1 = QCDATE2.
*      ZDMS3_WA-REM1 = QREM2.
*      ZDMS3_WA-FOLW1 = QFOLW2.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*    IF QTEXT3 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT7.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   QTEXT3.
*      ZDMS3_WA-TDATE1 = QDATE3.
*      ZDMS3_WA-CTDATE1 = QCDATE3.
*      ZDMS3_WA-REM1 = QREM3.
*      ZDMS3_WA-FOLW1 = QFOLW3.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*    IF QTEXT4 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT7.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   QTEXT4.
*      ZDMS3_WA-TDATE1 = QDATE4.
*      ZDMS3_WA-CTDATE1 = QCDATE4.
*      ZDMS3_WA-REM1 = QREM4.
*      ZDMS3_WA-FOLW1 = QFOLW4.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*    IF QTEXT5 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT7.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   QTEXT5.
*      ZDMS3_WA-TDATE1 = QDATE5.
*      ZDMS3_WA-CTDATE1 = QCDATE5.
*      ZDMS3_WA-REM1 = QREM5.
*      ZDMS3_WA-FOLW1 = QFOLW5.
*      ZEILE = ZEILE + 1.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*    ENDIF.
*
*    IF QTEXT6 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT7.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   QTEXT6.
*      ZDMS3_WA-TDATE1 = QDATE6.
*      ZDMS3_WA-CTDATE1 = QCDATE6.
*      ZDMS3_WA-REM1 = QREM6.
*      ZDMS3_WA-FOLW1 = QFOLW6.
*      ZEILE = ZEILE + 1.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*    ENDIF.
*    IF QTEXT7 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT7.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   QTEXT7.
*      ZDMS3_WA-TDATE1 = QDATE7.
*      ZDMS3_WA-CTDATE1 = QCDATE7.
*      ZDMS3_WA-REM1 = QREM7.
*      ZDMS3_WA-FOLW1 = QFOLW7.
*      ZEILE = ZEILE + 1.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*    ENDIF.
*    IF QTEXT8 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT7.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   QTEXT8.
*      ZDMS3_WA-TDATE1 = QDATE8.
*      ZDMS3_WA-CTDATE1 = QCDATE8.
*      ZDMS3_WA-REM1 = QREM8.
*      ZDMS3_WA-FOLW1 = QFOLW8.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*    ENDIF.
*    A = 1.
*  ENDIF.
*
***************8************
*
*  IF ZDMS1-DEPT8 NE SPACE.
*    ZEILE = 1.
*    IF RRTEXT1 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT8.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 = RTEXT1.
*      ZDMS3_WA-TDATE1 = RDATE1.
*      ZDMS3_WA-CTDATE1 = RCDATE1.
*      ZDMS3_WA-REM1 = RREM1.
*      ZDMS3_WA-FOLW1 = RFOLW1.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*
*    IF RRTEXT2 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT8.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 = RTEXT2.
*      ZDMS3_WA-TDATE1 = RDATE2.
*      ZDMS3_WA-CTDATE1 = RCDATE2.
*      ZDMS3_WA-REM1 = RREM2.
*      ZDMS3_WA-FOLW1 = RFOLW2.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*    IF RRTEXT3 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT8.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 = RTEXT3.
*      ZDMS3_WA-TDATE1 = RDATE3.
*      ZDMS3_WA-CTDATE1 = RCDATE3.
*      ZDMS3_WA-REM1 = RREM3.
*      ZDMS3_WA-FOLW1 = RFOLW3.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*    IF RTEXT4 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT8.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 = RTEXT4.
*      ZDMS3_WA-TDATE1 = RDATE4.
*      ZDMS3_WA-CTDATE1 = RCDATE4.
*      ZDMS3_WA-REM1 = RREM4.
*      ZDMS3_WA-FOLW1 = RFOLW5.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*    IF RTEXT5 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT8.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   RTEXT5.
*      ZDMS3_WA-TDATE1 = RDATE5.
*      ZDMS3_WA-CTDATE1 = RCDATE5.
*      ZDMS3_WA-REM1 = RREM5.
*      ZDMS3_WA-FOLW1 = RFOLW5.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*
*    IF RTEXT6 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT8.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   RTEXT6.
*      ZDMS3_WA-TDATE1 = RDATE6.
*      ZDMS3_WA-CTDATE1 = RCDATE6.
*      ZDMS3_WA-REM1 = RREM6.
*      ZDMS3_WA-FOLW1 = RFOLW6.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*    IF RTEXT7 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT8.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   RTEXT7.
*      ZDMS3_WA-TDATE1 = RDATE7.
*      ZDMS3_WA-CTDATE1 = RCDATE7.
*      ZDMS3_WA-REM1 = RREM7.
*      ZDMS3_WA-FOLW1 = RFOLW7.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*    IF RTEXT8 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT8.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   RTEXT8.
*      ZDMS3_WA-TDATE1 = RDATE8.
*      ZDMS3_WA-CTDATE1 = RCDATE8.
*      ZDMS3_WA-REM1 = RREM8.
*      ZDMS3_WA-FOLW1 = RFOLW8.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*    A = 1.
*  ENDIF.
*
*************9***********
*
*  IF ZDMS1-DEPT9 NE SPACE.
*    ZEILE = 1.
*    IF STEXT1 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT9.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   STEXT1.
*      ZDMS3_WA-TDATE1 = SDATE1.
*      ZDMS3_WA-CTDATE1 = SCDATE1.
*      ZDMS3_WA-REM1 = SREM1.
*      ZDMS3_WA-FOLW1 = SFOLW1.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*
*    IF STEXT2 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT9.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   STEXT2.
*      ZDMS3_WA-TDATE1 = SDATE2.
*      ZDMS3_WA-CTDATE1 = SCDATE2.
*      ZDMS3_WA-REM1 = SREM2.
*      ZDMS3_WA-FOLW1 = SFOLW2.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*    IF STEXT3 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT9.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   STEXT3.
*      ZDMS3_WA-TDATE1 = SDATE3.
*      ZDMS3_WA-CTDATE1 = SCDATE3.
*      ZDMS3_WA-REM1 = SREM3.
*      ZDMS3_WA-FOLW1 = SFOLW3.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*    IF STEXT4 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT9.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   STEXT4.
*      ZDMS3_WA-TDATE1 = SDATE4.
*      ZDMS3_WA-CTDATE1 = SCDATE4.
*      ZDMS3_WA-REM1 = SREM4.
*      ZDMS3_WA-FOLW1 = SFOLW4.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*    IF STEXT5 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT9.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   STEXT5.
*      ZDMS3_WA-TDATE1 = SDATE5.
*      ZDMS3_WA-CTDATE1 = SCDATE5.
*      ZDMS3_WA-REM1 = SREM5.
*      ZDMS3_WA-FOLW1 = SFOLW5.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*
*    IF STEXT6 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT9.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   STEXT6.
*      ZDMS3_WA-TDATE1 = SDATE6.
*      ZDMS3_WA-CTDATE1 = SCDATE6.
*      ZDMS3_WA-REM1 = SREM6.
*      ZDMS3_WA-FOLW1 = SFOLW6.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*    IF STEXT7 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT9.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   STEXT7.
*      ZDMS3_WA-TDATE1 = SDATE7.
*      ZDMS3_WA-CTDATE1 = SCDATE7.
*      ZDMS3_WA-REM1 = SREM7.
*      ZDMS3_WA-FOLW1 = SFOLW7.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*    IF STEXT8 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT9.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   STEXT8.
*      ZDMS3_WA-TDATE1 = SDATE8.
*      ZDMS3_WA-CTDATE1 = SCDATE8.
*      ZDMS3_WA-REM1 = SREM8.
*      ZDMS3_WA-FOLW1 = SFOLW8.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*    A = 1.
*  ENDIF.
*
*************** 10 ****
*
*  IF ZDMS1-DEPT10 NE SPACE.
*    ZEILE = 1.
*    IF TTEXT1 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT10.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   TTEXT1.
*      ZDMS3_WA-TDATE1 = TDATE1.
*      ZDMS3_WA-CTDATE1 = TCDATE1.
*      ZDMS3_WA-REM1 = TREM1.
*      ZDMS3_WA-FOLW1 = TFOLW1.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*
*    IF TTEXT2 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT10.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   TTEXT2.
*      ZDMS3_WA-TDATE1 = TDATE2.
*      ZDMS3_WA-CTDATE1 = TCDATE2.
*      ZDMS3_WA-REM1 = TREM2.
*      ZDMS3_WA-FOLW1 = TFOLW2.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*    IF TTEXT3 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT10.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   TTEXT3.
*      ZDMS3_WA-TDATE1 = TDATE3.
*      ZDMS3_WA-CTDATE1 = TCDATE3.
*      ZDMS3_WA-REM1 = TREM3.
*      ZDMS3_WA-FOLW1 = TFOLW3.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*    IF TTEXT4 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT10.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   TTEXT4.
*      ZDMS3_WA-TDATE1 = TDATE4.
*      ZDMS3_WA-CTDATE1 = TCDATE4.
*      ZDMS3_WA-REM1 = TREM4.
*      ZDMS3_WA-FOLW1 = TFOLW4.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*    IF TTEXT5 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT10.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   TTEXT5.
*      ZDMS3_WA-TDATE1 = TDATE5.
*      ZDMS3_WA-CTDATE1 = TCDATE5.
*      ZDMS3_WA-REM1 = TREM5.
*      ZDMS3_WA-FOLW1 = TFOLW5.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*
*    IF TTEXT6 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT10.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   TTEXT6.
*      ZDMS3_WA-TDATE1 = TDATE6.
*      ZDMS3_WA-CTDATE1 = TCDATE6.
*      ZDMS3_WA-REM1 = TREM6.
*      ZDMS3_WA-FOLW1 = TFOLW6.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*    IF TTEXT7 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT10.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   TTEXT7.
*      ZDMS3_WA-TDATE1 = TDATE7.
*      ZDMS3_WA-CTDATE1 = TCDATE7.
*      ZDMS3_WA-REM1 = TREM7.
*      ZDMS3_WA-FOLW1 = TFOLW7.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*    IF TTEXT8 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT10.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   TTEXT8.
*      ZDMS3_WA-TDATE1 = TDATE8.
*      ZDMS3_WA-CTDATE1 = TCDATE8.
*      ZDMS3_WA-REM1 = TREM8.
*      ZDMS3_WA-FOLW1 = TFOLW8.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*    A = 1.
*  ENDIF.
*
************** 11 TO 20 ****************************************
*
*  IF ZDMS1-DEPT11 NE SPACE.
*    ZEILE = 1.
*    IF NKTEXT1 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT11.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   NKTEXT1.
*      ZDMS3_WA-TDATE1 = NKDATE1.
*      ZDMS3_WA-CTDATE1 = NKCDATE1.
*      ZDMS3_WA-REM1 = NKREM1.
*      ZDMS3_WA-FOLW1 = NKFOLW1.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*
*    IF NKTEXT2 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT11.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   NKTEXT2.
*      ZDMS3_WA-TDATE1 = NKDATE2.
*      ZDMS3_WA-CTDATE1 = NKCDATE2.
*      ZDMS3_WA-REM1 = NKREM2.
*      ZDMS3_WA-FOLW1 = NKFOLW2.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*    IF NKTEXT3 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT11.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   NKTEXT3.
*      ZDMS3_WA-TDATE1 = NKDATE3.
*      ZDMS3_WA-CTDATE1 = NKCDATE3.
*      ZDMS3_WA-REM1 = NKREM3.
*      ZDMS3_WA-FOLW1 = NKFOLW3.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*    IF NKTEXT4 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT11.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   NKTEXT4.
*      ZDMS3_WA-TDATE1 = NKDATE4.
*      ZDMS3_WA-CTDATE1 = NKCDATE4.
*      ZDMS3_WA-REM1 = NKREM4.
*      ZDMS3_WA-FOLW1 = NKFOLW4.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*    IF NKTEXT5 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT11.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   NKTEXT5.
*      ZDMS3_WA-TDATE1 = NKDATE5.
*      ZDMS3_WA-CTDATE1 = NKCDATE5.
*      ZDMS3_WA-REM1 = NKREM5.
*      ZDMS3_WA-FOLW1 = NKFOLW5.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*    IF NKTEXT6 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT11.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   NKTEXT6.
*      ZDMS3_WA-TDATE1 = NKDATE6.
*      ZDMS3_WA-CTDATE1 = NKCDATE6.
*      ZDMS3_WA-REM1 = NKREM6.
*      ZDMS3_WA-FOLW1 = NKFOLW6.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*    IF NKTEXT7 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT11.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   NKTEXT7.
*      ZDMS3_WA-TDATE1 = NKDATE7.
*      ZDMS3_WA-CTDATE1 = NKCDATE7.
*      ZDMS3_WA-REM1 = NKREM7.
*      ZDMS3_WA-FOLW1 = NKFOLW7.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*    IF NKTEXT8 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT11.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   NKTEXT8.
*      ZDMS3_WA-TDATE1 = NKDATE8.
*      ZDMS3_WA-CTDATE1 = NKCDATE8.
*      ZDMS3_WA-REM1 = NKREM8.
*      ZDMS3_WA-FOLW1 = NKFOLW8.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*    ENDIF.
*    A = 1.
*  ENDIF.
**************  2 *********
*  IF ZDMS1-DEPT12 NE SPACE.
*    ZEILE = 1.
*    IF NLTEXT1 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT12.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   NLTEXT1.
*      ZDMS3_WA-TDATE1 = NLDATE1.
*      ZDMS3_WA-CTDATE1 = NLCDATE1.
*      ZDMS3_WA-REM1 = NLREM1.
*      ZDMS3_WA-FOLW1 = NLFOLW1.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*
*    IF NLTEXT2 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT12.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   NLTEXT2.
*      ZDMS3_WA-TDATE1 = NLDATE2.
*      ZDMS3_WA-CTDATE1 = NLCDATE2.
*      ZDMS3_WA-REM1 = NLREM2.
*      ZDMS3_WA-FOLW1 = NLFOLW2.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*    IF NLTEXT3 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT12.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   NLTEXT3.
*      ZDMS3_WA-TDATE1 = NLDATE3.
*      ZDMS3_WA-CTDATE1 = NLCDATE3.
*      ZDMS3_WA-REM1 = NLREM3.
*      ZDMS3_WA-FOLW1 = NLFOLW3.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*    IF NLTEXT4 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT12.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   NLTEXT4.
*      ZDMS3_WA-TDATE1 = NLDATE4.
*      ZDMS3_WA-CTDATE1 = NLCDATE4.
*      ZDMS3_WA-REM1 = NLREM4.
*      ZDMS3_WA-FOLW1 = NLFOLW4.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*    IF NLTEXT5 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT12.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   NLTEXT5.
*      ZDMS3_WA-TDATE1 = NLDATE5.
*      ZDMS3_WA-CTDATE1 = NLCDATE5.
*      ZDMS3_WA-REM1 = NLREM5.
*      ZDMS3_WA-FOLW1 = NLFOLW5.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*    IF NLTEXT6 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT12.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   NLTEXT6.
*      ZDMS3_WA-TDATE1 = NLDATE6.
*      ZDMS3_WA-CTDATE1 = NLCDATE6.
*      ZDMS3_WA-REM1 = NLREM6.
*      ZDMS3_WA-FOLW1 = NLFOLW6.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*    IF NLTEXT7 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT12.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   NLTEXT7.
*      ZDMS3_WA-TDATE1 = NLDATE7.
*      ZDMS3_WA-CTDATE1 = NLCDATE7.
*      ZDMS3_WA-REM1 = NLREM7.
*      ZDMS3_WA-FOLW1 = NLFOLW7.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*    IF NLTEXT8 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT12.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   NLTEXT8.
*      ZDMS3_WA-TDATE1 = NLDATE8.
*      ZDMS3_WA-CTDATE1 = NLCDATE8.
*      ZDMS3_WA-REM1 = NLREM8.
*      ZDMS3_WA-FOLW1 = NLFOLW8.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*    ENDIF.
*    A = 1.
*  ENDIF.
*
******** 3 *****************
*
*  IF ZDMS1-DEPT13 NE SPACE.
*    ZEILE = 1.
*    IF NMTEXT1 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT13.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   NMTEXT1.
*      ZDMS3_WA-TDATE1 = NMDATE1.
*      ZDMS3_WA-CTDATE1 = NMCDATE1.
*      ZDMS3_WA-REM1 = NMREM1.
*      ZDMS3_WA-FOLW1 = NMFOLW1.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*
*    IF NMTEXT2 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT13.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   NMTEXT2.
*      ZDMS3_WA-TDATE1 = NMDATE2.
*      ZDMS3_WA-CTDATE1 = NMCDATE2.
*      ZDMS3_WA-REM1 = NMREM2.
*      ZDMS3_WA-FOLW1 = NMFOLW2.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*    IF NMTEXT3 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT13.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   NMTEXT3.
*      ZDMS3_WA-TDATE1 = NMDATE3.
*      ZDMS3_WA-CTDATE1 = NMCDATE3.
*      ZDMS3_WA-REM1 = NMREM3.
*      ZDMS3_WA-FOLW1 = NMFOLW3.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*    IF NMTEXT4 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT13.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   NMTEXT4.
*      ZDMS3_WA-TDATE1 = NMDATE4.
*      ZDMS3_WA-CTDATE1 = NMCDATE4.
*      ZDMS3_WA-REM1 = NMREM4.
*      ZDMS3_WA-FOLW1 = NMFOLW4.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*    IF NMTEXT5 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT13.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   NMTEXT5.
*      ZDMS3_WA-TDATE1 = NMDATE5.
*      ZDMS3_WA-CTDATE1 = NMCDATE5.
*      ZDMS3_WA-REM1 = NMREM5.
*      ZDMS3_WA-FOLW1 = NMFOLW5.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*
*    IF NMTEXT6 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT13.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   NMTEXT6.
*      ZDMS3_WA-TDATE1 = NMDATE6.
*      ZDMS3_WA-CTDATE1 = NMCDATE6.
*      ZDMS3_WA-REM1 = NMREM6.
*      ZDMS3_WA-FOLW1 = NMFOLW6.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*
*    IF NMTEXT7 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT13.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   NMTEXT7.
*      ZDMS3_WA-TDATE1 = NMDATE7.
*      ZDMS3_WA-CTDATE1 = NMCDATE7.
*      ZDMS3_WA-REM1 = NMREM7.
*      ZDMS3_WA-FOLW1 = NMFOLW7.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*    IF NMTEXT8 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT13.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   NMTEXT8.
*      ZDMS3_WA-TDATE1 = NMDATE8.
*      ZDMS3_WA-CTDATE1 = NMCDATE8.
*      ZDMS3_WA-REM1 = NMREM8.
*      ZDMS3_WA-FOLW1 = NMFOLW8.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*    ENDIF.
*    A = 1.
*  ENDIF.
*
************4**********
*
*  IF ZDMS1-DEPT14 NE SPACE.
*    ZEILE = 1.
*    IF NNTEXT1 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT14.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   NNTEXT1.
*      ZDMS3_WA-TDATE1 = NNDATE1.
*      ZDMS3_WA-CTDATE1 = NNCDATE1.
*      ZDMS3_WA-REM1 = NNREM1.
*      ZDMS3_WA-FOLW1 = NNFOLW1.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*
*    IF NNTEXT2 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT14.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   NNTEXT2.
*      ZDMS3_WA-TDATE1 = NNDATE2.
*      ZDMS3_WA-CTDATE1 = NNCDATE2.
*      ZDMS3_WA-REM1 = NNREM2.
*      ZDMS3_WA-FOLW1 = NNFOLW2.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*    IF NNTEXT3 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT14.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   NNTEXT3.
*      ZDMS3_WA-TDATE1 = NNDATE3.
*      ZDMS3_WA-CTDATE1 = NNCDATE3.
*      ZDMS3_WA-REM1 = NNREM3.
*      ZDMS3_WA-FOLW1 = NNFOLW3.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*    IF NNTEXT4 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT14.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   NNTEXT4.
*      ZDMS3_WA-TDATE1 = NNDATE4.
*      ZDMS3_WA-CTDATE1 = NNCDATE4.
*      ZDMS3_WA-REM1 = NNREM4.
*      ZDMS3_WA-FOLW1 = NNFOLW4.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*    IF NNTEXT5 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT14.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   NNTEXT5.
*      ZDMS3_WA-TDATE1 = NNDATE5.
*      ZDMS3_WA-CTDATE1 = NNCDATE5.
*      ZDMS3_WA-REM1 = NNREM5.
*      ZDMS3_WA-FOLW1 = NNFOLW5.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*    IF NNTEXT6 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT14.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   NNTEXT6.
*      ZDMS3_WA-TDATE1 = NNDATE6.
*      ZDMS3_WA-CTDATE1 = NNCDATE6.
*      ZDMS3_WA-REM1 = NNREM6.
*      ZDMS3_WA-FOLW1 = NNFOLW6.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*    IF NNTEXT7 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT14.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   NNTEXT7.
*      ZDMS3_WA-TDATE1 = NNDATE7.
*      ZDMS3_WA-CTDATE1 = NNCDATE7.
*      ZDMS3_WA-REM1 = NNREM7.
*      ZDMS3_WA-FOLW1 = NNFOLW7.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*    IF NNTEXT8 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT14.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   NNTEXT8.
*      ZDMS3_WA-TDATE1 = NNDATE8.
*      ZDMS3_WA-CTDATE1 = NNCDATE8.
*      ZDMS3_WA-REM1 = NNREM8.
*      ZDMS3_WA-FOLW1 = NNFOLW8.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*    ENDIF.
*    A = 1.
*  ENDIF.
*
******** 5 *******
*
*  IF ZDMS1-DEPT15 NE SPACE.
*    ZEILE = 1.
*    IF NOTEXT1 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT15.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   NOTEXT1.
*      ZDMS3_WA-TDATE1 = NODATE1.
*      ZDMS3_WA-CTDATE1 = NOCDATE1.
*      ZDMS3_WA-REM1 = NOREM1.
*      ZDMS3_WA-FOLW1 = NOFOLW1.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*
*    IF NOTEXT2 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT15.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   NOTEXT2.
*      ZDMS3_WA-TDATE1 = NODATE2.
*      ZDMS3_WA-CTDATE1 = NOCDATE2.
*      ZDMS3_WA-REM1 = NOREM2.
*      ZDMS3_WA-FOLW1 = NOFOLW2.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*    IF NOTEXT3 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT15.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   NOTEXT3.
*      ZDMS3_WA-TDATE1 = NODATE3.
*      ZDMS3_WA-CTDATE1 = NOCDATE3.
*      ZDMS3_WA-REM1 = NOREM3.
*      ZDMS3_WA-FOLW1 = NOFOLW3.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*    IF NOTEXT4 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT15.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   NOTEXT4.
*      ZDMS3_WA-TDATE1 = NODATE4.
*      ZDMS3_WA-CTDATE1 = NOCDATE4.
*      ZDMS3_WA-REM1 = NOREM4.
*      ZDMS3_WA-FOLW1 = NOFOLW4.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*    IF NOTEXT5 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT15.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   NOTEXT5.
*      ZDMS3_WA-TDATE1 = NODATE5.
*      ZDMS3_WA-CTDATE1 = NOCDATE5.
*      ZDMS3_WA-REM1 = NOREM5.
*      ZDMS3_WA-FOLW1 = NOFOLW5.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*
*    IF NOTEXT6 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT15.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   NOTEXT6.
*      ZDMS3_WA-TDATE1 = NODATE6.
*      ZDMS3_WA-CTDATE1 = NOCDATE6.
*      ZDMS3_WA-REM1 = NOREM6.
*      ZDMS3_WA-FOLW1 = NOFOLW6.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*    IF NOTEXT7 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT15.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   NOTEXT7.
*      ZDMS3_WA-TDATE1 = NODATE7.
*      ZDMS3_WA-CTDATE1 = NOCDATE7.
*      ZDMS3_WA-REM1 = NOREM7.
*      ZDMS3_WA-FOLW1 = NOFOLW7.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*    IF NOTEXT8 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT15.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   NOTEXT8.
*      ZDMS3_WA-TDATE1 = NODATE8.
*      ZDMS3_WA-CTDATE1 = NOCDATE8.
*      ZDMS3_WA-REM1 = NOREM8.
*      ZDMS3_WA-FOLW1 = NOFOLW8.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*    ENDIF.
*    A = 1.
*  ENDIF.
*
*******   6 ********
*
*  IF ZDMS1-DEPT16 NE SPACE.
*    ZEILE = 1.
*    IF NPTEXT1 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT16.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   NPTEXT1.
*      ZDMS3_WA-TDATE1 = NPDATE1.
*      ZDMS3_WA-CTDATE1 = NPCDATE1.
*      ZDMS3_WA-REM1 = NPREM1.
*      ZDMS3_WA-FOLW1 = NPFOLW1.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*
*    IF NPTEXT2 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT16.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   NPTEXT2.
*      ZDMS3_WA-TDATE1 = NPDATE2.
*      ZDMS3_WA-CTDATE1 = NPCDATE2.
*      ZDMS3_WA-REM1 = NPREM2.
*      ZDMS3_WA-FOLW1 = NPFOLW2.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*    IF NPTEXT3 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT16.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   NPTEXT3.
*      ZDMS3_WA-TDATE1 = NPDATE3.
*      ZDMS3_WA-CTDATE1 = NPCDATE3.
*      ZDMS3_WA-REM1 = NPREM3.
*      ZDMS3_WA-FOLW1 = NPFOLW3.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*    IF NPTEXT4 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT16.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   NPTEXT4.
*      ZDMS3_WA-TDATE1 = NPDATE4.
*      ZDMS3_WA-CTDATE1 = NPCDATE4.
*      ZDMS3_WA-REM1 = NPREM4.
*      ZDMS3_WA-FOLW1 = NPFOLW4.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*    IF NPTEXT5 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT16.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   NPTEXT5.
*      ZDMS3_WA-TDATE1 = NPDATE5.
*      ZDMS3_WA-CTDATE1 = NPCDATE5.
*      ZDMS3_WA-REM1 = NPREM5.
*      ZDMS3_WA-FOLW1 = NPFOLW5.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*
*    IF NPTEXT6 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT16.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   NPTEXT6.
*      ZDMS3_WA-TDATE1 = NPDATE6.
*      ZDMS3_WA-CTDATE1 = NPCDATE6.
*      ZDMS3_WA-REM1 = NPREM6.
*      ZDMS3_WA-FOLW1 = NPFOLW6.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*    IF NPTEXT7 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT16.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   NPTEXT7.
*      ZDMS3_WA-TDATE1 = NPDATE7.
*      ZDMS3_WA-CTDATE1 = NPCDATE7.
*      ZDMS3_WA-REM1 = NPREM7.
*      ZDMS3_WA-FOLW1 = NPFOLW7.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*    IF NPTEXT8 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT16.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   NPTEXT8.
*      ZDMS3_WA-TDATE1 = NPDATE8.
*      ZDMS3_WA-CTDATE1 = NPCDATE8.
*      ZDMS3_WA-REM1 = NPREM8.
*      ZDMS3_WA-FOLW1 = NPFOLW8.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*    ENDIF.
*    A = 1.
*  ENDIF.
*
*********** 7--------
*
*  IF ZDMS1-DEPT17 NE SPACE.
*    ZEILE = 1.
*    IF NQTEXT1 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT17.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   NQTEXT1.
*      ZDMS3_WA-TDATE1 = NQDATE1.
*      ZDMS3_WA-CTDATE1 = NQCDATE1.
*      ZDMS3_WA-REM1 = NQREM1.
*      ZDMS3_WA-FOLW1 = NQFOLW1.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*
*    IF NQTEXT2 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT17.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   NQTEXT2.
*      ZDMS3_WA-TDATE1 = NQDATE2.
*      ZDMS3_WA-CTDATE1 = NQCDATE2.
*      ZDMS3_WA-REM1 = NQREM2.
*      ZDMS3_WA-FOLW1 = NQFOLW2.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*    IF NQTEXT3 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT17.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   NQTEXT3.
*      ZDMS3_WA-TDATE1 = NQDATE3.
*      ZDMS3_WA-CTDATE1 = NQCDATE3.
*      ZDMS3_WA-REM1 = NQREM3.
*      ZDMS3_WA-FOLW1 = NQFOLW3.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*    IF NQTEXT4 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT17.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   NQTEXT4.
*      ZDMS3_WA-TDATE1 = NQDATE4.
*      ZDMS3_WA-CTDATE1 = NQCDATE4.
*      ZDMS3_WA-REM1 = NQREM4.
*      ZDMS3_WA-FOLW1 = NQFOLW4.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*    IF NQTEXT5 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT17.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   NQTEXT5.
*      ZDMS3_WA-TDATE1 = NQDATE5.
*      ZDMS3_WA-CTDATE1 = NQCDATE5.
*      ZDMS3_WA-REM1 = NQREM5.
*      ZDMS3_WA-FOLW1 = NQFOLW5.
*      ZEILE = ZEILE + 1.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*    ENDIF.
*
*    IF NQTEXT6 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT17.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   NQTEXT6.
*      ZDMS3_WA-TDATE1 = NQDATE6.
*      ZDMS3_WA-CTDATE1 = NQCDATE6.
*      ZDMS3_WA-REM1 = NQREM6.
*      ZDMS3_WA-FOLW1 = NQFOLW6.
*      ZEILE = ZEILE + 1.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*    ENDIF.
*    IF NQTEXT7 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT17.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   NQTEXT7.
*      ZDMS3_WA-TDATE1 = NQDATE7.
*      ZDMS3_WA-CTDATE1 = NQCDATE7.
*      ZDMS3_WA-REM1 = NQREM7.
*      ZDMS3_WA-FOLW1 = NQFOLW7.
*      ZEILE = ZEILE + 1.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*    ENDIF.
*    IF NQTEXT8 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT17.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   NQTEXT8.
*      ZDMS3_WA-TDATE1 = NQDATE8.
*      ZDMS3_WA-CTDATE1 = NQCDATE8.
*      ZDMS3_WA-REM1 = NQREM8.
*      ZDMS3_WA-FOLW1 = NQFOLW8.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*    ENDIF.
*    A = 1.
*  ENDIF.
*
***************8************
*
*  IF ZDMS1-DEPT18 NE SPACE.
*    ZEILE = 1.
*    IF NRTEXT1 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT18.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 = NRTEXT1.
*      ZDMS3_WA-TDATE1 = NRDATE1.
*      ZDMS3_WA-CTDATE1 = NRCDATE1.
*      ZDMS3_WA-REM1 = NRREM1.
*      ZDMS3_WA-FOLW1 = NRFOLW1.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*
*    IF NRTEXT2 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT18.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 = NRTEXT2.
*      ZDMS3_WA-TDATE1 = NRDATE2.
*      ZDMS3_WA-CTDATE1 = NRCDATE2.
*      ZDMS3_WA-REM1 = NRREM2.
*      ZDMS3_WA-FOLW1 = NRFOLW2.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*    IF NRTEXT3 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT18.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 = NRTEXT3.
*      ZDMS3_WA-TDATE1 = NRDATE3.
*      ZDMS3_WA-CTDATE1 = NRCDATE3.
*      ZDMS3_WA-REM1 = NRREM3.
*      ZDMS3_WA-FOLW1 = NRFOLW3.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*    IF NRTEXT4 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT18.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 = NRTEXT4.
*      ZDMS3_WA-TDATE1 = NRDATE4.
*      ZDMS3_WA-CTDATE1 = NRCDATE4.
*      ZDMS3_WA-REM1 = NRREM4.
*      ZDMS3_WA-FOLW1 = NRFOLW5.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*    IF NRTEXT5 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT18.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   NRTEXT5.
*      ZDMS3_WA-TDATE1 = NRDATE5.
*      ZDMS3_WA-CTDATE1 = NRCDATE5.
*      ZDMS3_WA-REM1 = NRREM5.
*      ZDMS3_WA-FOLW1 = NRFOLW5.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*
*    IF NRTEXT6 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT18.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   NRTEXT6.
*      ZDMS3_WA-TDATE1 = NRDATE6.
*      ZDMS3_WA-CTDATE1 = NRCDATE6.
*      ZDMS3_WA-REM1 = NRREM6.
*      ZDMS3_WA-FOLW1 = NRFOLW6.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*    IF NRTEXT7 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT18.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   NRTEXT7.
*      ZDMS3_WA-TDATE1 = NRDATE7.
*      ZDMS3_WA-CTDATE1 = NRCDATE7.
*      ZDMS3_WA-REM1 = NRREM7.
*      ZDMS3_WA-FOLW1 = NRFOLW7.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*    IF NRTEXT8 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT18.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   NRTEXT8.
*      ZDMS3_WA-TDATE1 = NRDATE8.
*      ZDMS3_WA-CTDATE1 = NRCDATE8.
*      ZDMS3_WA-REM1 = NRREM8.
*      ZDMS3_WA-FOLW1 = NRFOLW8.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*    A = 1.
*  ENDIF.
*
*************9***********
*
*  IF ZDMS1-DEPT19 NE SPACE.
*    ZEILE = 1.
*    IF NSTEXT1 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT19.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   NSTEXT1.
*      ZDMS3_WA-TDATE1 = NSDATE1.
*      ZDMS3_WA-CTDATE1 = NSCDATE1.
*      ZDMS3_WA-REM1 = NSREM1.
*      ZDMS3_WA-FOLW1 = NSFOLW1.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*
*    IF NSTEXT2 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT19.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   NSTEXT2.
*      ZDMS3_WA-TDATE1 = NSDATE2.
*      ZDMS3_WA-CTDATE1 = NSCDATE2.
*      ZDMS3_WA-REM1 = NSREM2.
*      ZDMS3_WA-FOLW1 = NSFOLW2.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*    IF NSTEXT3 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT19.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   NSTEXT3.
*      ZDMS3_WA-TDATE1 = NSDATE3.
*      ZDMS3_WA-CTDATE1 = NSCDATE3.
*      ZDMS3_WA-REM1 = NSREM3.
*      ZDMS3_WA-FOLW1 = NSFOLW3.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*    IF NSTEXT4 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT19.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   NSTEXT4.
*      ZDMS3_WA-TDATE1 = NSDATE4.
*      ZDMS3_WA-CTDATE1 = NSCDATE4.
*      ZDMS3_WA-REM1 = NSREM4.
*      ZDMS3_WA-FOLW1 = NSFOLW4.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*    IF NSTEXT5 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT19.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   NSTEXT5.
*      ZDMS3_WA-TDATE1 = NSDATE5.
*      ZDMS3_WA-CTDATE1 = NSCDATE5.
*      ZDMS3_WA-REM1 = NSREM5.
*      ZDMS3_WA-FOLW1 = NSFOLW5.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*
*    IF NSTEXT6 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT19.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   NSTEXT6.
*      ZDMS3_WA-TDATE1 = NSDATE6.
*      ZDMS3_WA-CTDATE1 = NSCDATE6.
*      ZDMS3_WA-REM1 = NSREM6.
*      ZDMS3_WA-FOLW1 = NSFOLW6.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*    IF NSTEXT7 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT19.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   NSTEXT7.
*      ZDMS3_WA-TDATE1 = NSDATE7.
*      ZDMS3_WA-CTDATE1 = NSCDATE7.
*      ZDMS3_WA-REM1 = NSREM7.
*      ZDMS3_WA-FOLW1 = NSFOLW7.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*    IF NSTEXT8 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT19.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   NSTEXT8.
*      ZDMS3_WA-TDATE1 = NSDATE8.
*      ZDMS3_WA-CTDATE1 = NSCDATE8.
*      ZDMS3_WA-REM1 = NSREM8.
*      ZDMS3_WA-FOLW1 = NSFOLW8.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*    A = 1.
*  ENDIF.
*
*************** 10 ****
*
*  IF ZDMS1-DEPT20 NE SPACE.
*    ZEILE = 1.
*    IF NTTEXT1 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT20.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   NTTEXT1.
*      ZDMS3_WA-TDATE1 = NTDATE1.
*      ZDMS3_WA-CTDATE1 = NTCDATE1.
*      ZDMS3_WA-REM1 = NTREM1.
*      ZDMS3_WA-FOLW1 = NTFOLW1.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*
*    IF NTTEXT2 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT20.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   NTTEXT2.
*      ZDMS3_WA-TDATE1 = NTDATE2.
*      ZDMS3_WA-CTDATE1 = NTCDATE2.
*      ZDMS3_WA-REM1 = NTREM2.
*      ZDMS3_WA-FOLW1 = NTFOLW2.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*    IF NTTEXT3 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT20.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   NTTEXT3.
*      ZDMS3_WA-TDATE1 = NTDATE3.
*      ZDMS3_WA-CTDATE1 = NTCDATE3.
*      ZDMS3_WA-REM1 = NTREM3.
*      ZDMS3_WA-FOLW1 = NTFOLW3.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*    IF NTTEXT4 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT20.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   NTTEXT4.
*      ZDMS3_WA-TDATE1 = NTDATE4.
*      ZDMS3_WA-CTDATE1 = NTCDATE4.
*      ZDMS3_WA-REM1 = NTREM4.
*      ZDMS3_WA-FOLW1 = NTFOLW4.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*    IF NTTEXT5 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT20.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   NTTEXT5.
*      ZDMS3_WA-TDATE1 = NTDATE5.
*      ZDMS3_WA-CTDATE1 = NTCDATE5.
*      ZDMS3_WA-REM1 = NTREM5.
*      ZDMS3_WA-FOLW1 = NTFOLW5.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*
*    IF NTTEXT6 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT20.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   NTTEXT6.
*      ZDMS3_WA-TDATE1 = NTDATE6.
*      ZDMS3_WA-CTDATE1 = NTCDATE6.
*      ZDMS3_WA-REM1 = NTREM6.
*      ZDMS3_WA-FOLW1 = NTFOLW6.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*    IF NTTEXT7 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT20.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   NTTEXT7.
*      ZDMS3_WA-TDATE1 = NTDATE7.
*      ZDMS3_WA-CTDATE1 = NTCDATE7.
*      ZDMS3_WA-REM1 = NTREM7.
*      ZDMS3_WA-FOLW1 = NTFOLW7.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*    IF NTTEXT8 NE SPACE.
*      ZDMS3_WA-MJAHR = YEAR.
*      ZDMS3_WA-MBLNR = CCNUM.
*      ZDMS3_WA-DEPT = ZDMS1-DEPT20.
*      ZDMS3_WA-ZEILE = ZEILE.
*      ZDMS3_WA-BUDAT = SY-DATUM.
*      ZDMS3_WA-PERNR = PERNR.
*      ZDMS3_WA-ATEXT1 =   NTTEXT8.
*      ZDMS3_WA-TDATE1 = NTDATE8.
*      ZDMS3_WA-CTDATE1 = NTCDATE8.
*      ZDMS3_WA-REM1 = NTREM8.
*      ZDMS3_WA-FOLW1 = NTFOLW8.
*      MODIFY ZDMS3 FROM ZDMS3_WA.
*      CLEAR : ZDMS3_WA.
*      ZEILE = ZEILE + 1.
*    ENDIF.
*    A = 1.
*  ENDIF.

*  **********************************
ENDFORM.
*&---------------------------------------------------------------------*
*&      Form  DEPTQAH
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM DEPTQAH .
  SELECT SINGLE * FROM ZDMS1 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM.
  IF SY-SUBRC EQ 0.
    IF ZDMS1-WERKS EQ '1000'.
*      SELECT SINGLE * FROM PA0001 WHERE PERNR EQ PERNR AND ENDDA GE SY-DATUM AND BTRTL EQ '1228'.
*      IF SY-SUBRC eq 0.
*      IF pernr NE '00002051'.
      IF PERNR NE '00005693'. "13.6.22
        MESSAGE 'ENTRY ONLY FOR QA DEPARTMRNT HEAD' TYPE 'E'.
        EXIT.
      ENDIF.
*      ENDIF.
    ENDIF.
  ENDIF.
ENDFORM.
*&---------------------------------------------------------------------*
*&      Form  DEPTTD
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM DEPTTD .
  SELECT SINGLE * FROM ZDMS1 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM.
  IF SY-SUBRC EQ 0.
*    IF ZDMS1-WERKS EQ '1000'.
*      SELECT SINGLE * FROM PA0001 WHERE PERNR EQ PERNR AND ENDDA GE SY-DATUM AND BTRTL EQ '1228'.
*      IF SY-SUBRC eq 0.
    IF PERNR NE '00014022'.
      MESSAGE 'ENTRY ONLY FOR TECHNICAL DIRECTOR' TYPE 'E'.
      EXIT.
    ENDIF.
*      ENDIF.
*    ENDIF.
  ENDIF.
ENDFORM.
*&---------------------------------------------------------------------*
*&      Form  CL1CHK
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM CL1CHK .
*  BREAK-POINT.
  LOOP AT IT_ZDMS3 INTO WA_ZDMS3.
    IF WA_ZDMS3-FOLW1 NE 'X'.
      IF WA_ZDMS3-CTDATE1 GT SY-DATUM.
        MESSAGE 'ACTIVITY COMPLETION DATE NOT YET REACHED' TYPE 'E'.
      ENDIF.
    ENDIF.
    IF WA_ZDMS3-FOLW1 NE 'X'.
      IF WA_ZDMS3-CTDATE1 IS INITIAL.
        MESSAGE 'COMPLETION DATE IS NOT ENTERD' TYPE 'E'.
      ENDIF.
    ENDIF.
  ENDLOOP.


*  LOOP AT IT_ZDMS2 INTO WA_ZDMS2.
*    IF WA_ZDMS2-TDATE1 NE '00000000'.
*      IF WA_ZDMS2-CTDATE1 EQ '00000000'.
*        MESSAGE 'ACTIVITY COMPLETION DATE NOT YET ENTERED' TYPE 'E'.
*      ENDIF.
*    ENDIF.
*    IF WA_ZDMS2-TDATE2 NE '00000000'.
*      IF WA_ZDMS2-CTDATE2 EQ '00000000'.
*        MESSAGE 'ACTIVITY COMPLETION DATE NOT YET ENTERED' TYPE 'E'.
*      ENDIF.
*    ENDIF.
*    IF WA_ZDMS2-TDATE3 NE '00000000'.
*      IF WA_ZDMS2-CTDATE3 EQ '00000000'.
*        MESSAGE 'ACTIVITY COMPLETION DATE NOT YET ENTERED' TYPE 'E'.
*      ENDIF.
*    ENDIF.
*    IF WA_ZDMS2-TDATE4 NE '00000000'.
*      IF WA_ZDMS2-CTDATE4 EQ '00000000'.
*        MESSAGE 'ACTIVITY COMPLETION DATE NOT YET ENTERED' TYPE 'E'.
*      ENDIF.
*    ENDIF.
*    IF WA_ZDMS2-TDATE5 NE '00000000'.
*      IF WA_ZDMS2-CTDATE5 EQ '00000000'.
*        MESSAGE 'ACTIVITY COMPLETION DATE NOT YET ENTERED' TYPE 'E'.
*      ENDIF.
*    ENDIF.
*  ENDLOOP.
ENDFORM.
*&---------------------------------------------------------------------*
*&      Form  CL2CHK
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM CL2CHK .

  LOOP AT IT_ZDMS3 INTO WA_ZDMS3.
    IF WA_ZDMS3-FOLW1 EQ 'X'.
      IF WA_ZDMS3-CTDATE1 GT SY-DATUM.
        MESSAGE 'ACTIVITY COMPLETION DATE NOT YET REACHED' TYPE 'E'.
      ENDIF.
    ENDIF.
    IF WA_ZDMS3-FOLW1 EQ 'X'.
      IF WA_ZDMS3-CTDATE1 IS INITIAL.
        MESSAGE 'ENTER COMPLETION DATE' TYPE 'E'.
      ENDIF.
    ENDIF.
  ENDLOOP.

ENDFORM.
*&---------------------------------------------------------------------*
*&      Form  PRINT
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM PRINT.

  CLEAR : UNAME.
  SELECT SINGLE * FROM PA0002 WHERE PERNR EQ PERNR AND ENDDA GE SY-DATUM.
  IF SY-SUBRC EQ 0.
    CONCATENATE PA0002-VORNA PA0002-NACHN INTO UNAME SEPARATED BY SPACE.
  ENDIF.

  CLEAR : CCOUNT,FCOUNT.
  CCOUNT = 1.
  FCOUNT = 1.


  FORMNAME1 = 'CHANGE CONTROL FORM'.
  CLEAR : PDEPT.
  IF PLANT EQ '1000'.
    PDEPT = 'Q.A.'.
    IF ZDMS1-BUDAT GE '20210901'.
      SOP = 'Format No.: SOP/QAD/003-10-F1 (Ref. SOP No.: SOP/QAD/003)'.
    ELSE.
      SOP = 'Format No.: SOP/QAD/003-09-F1 (Ref. SOP No.: SOP/QAD/003)'.
    ENDIF.
    LOC = 'Nashik'.
    RSOP = '(Ref. SOP No.: SOP/QAD/062, Quality Risk Management)'.
  ELSEIF PLANT EQ '3000'.
    PDEPT = 'CQD'.
    IF ZDMS1-BUDAT GE '20210901'.
      SOP = 'Format No.: SOP/CQD/013-02-F1 (Ref. SOP No.: SOP/CQD/013)'.
    ELSE.
      SOP = 'Format No.: SOP/CQD/013-01-F1 (Ref. SOP No.: SOP/CQD/013)'.
    ENDIF.
    LOC = 'Mumbai'.
    RSOP = '(Ref. SOP No.: SOP/QAD/062, Quality Risk Management)'.
  ELSEIF PLANT EQ '1001'.
    PDEPT = 'Q.A.'.
    IF ZDMS1-BUDAT LT '20200422'.
      SOP = 'Format No.: QA/GM/005-10-F1 (Ref. SOP No.: QA/GM/005)'. "29.4.2020
    ELSEIF ZDMS1-BUDAT GE '20200422' AND ZDMS1-BUDAT LE '20210805'.
      SOP = 'Format No.: QA/GM/005-11-F1 (Ref. SOP No.: QA/GM/005)'.
    ELSEIF ZDMS1-BUDAT GE '20210806'.
      SOP = 'Format No.: QA/GM/005-12-F1 (Ref. SOP No.: QA/GM/005)'.
    ENDIF.
    RSOP = '(Ref. SOP No.: QA/GM/044, Quality Risk Management)'.
    LOC = 'Goa'.
  ELSE.
    PDEPT = 'CQD'.
    IF ZDMS1-BUDAT GE '20210901'.
      SOP = 'Format No.: SOP/CQD/013-02-F1 (Ref. SOP No.: SOP/CQD/013)'.
    ELSE.
      SOP = 'Format No.: SOP/CQD/013-01-F1 (Ref. SOP No.: SOP/CQD/013)'.
    ENDIF.
    RSOP = '(Ref. SOP No.: SOP/QAD/062, Quality Risk Management)'.
    LOC = 'CQD'.
  ENDIF.

  YEAR11 = YEAR.
*  BREAK-POINT.

  CLEAR : CCPRT.  " 29.8.23
  SELECT SINGLE * FROM ZQMS_PRINT WHERE MBLNR EQ CCNUM AND MJAHR EQ YEAR.
  IF SY-SUBRC EQ 0.
    CCPRT = 'Y'.
    PDATUM = ZQMS_PRINT-PDATUM.
    PUZEIT = ZQMS_PRINT-PUZEIT.
    IF PUZEIT LE 0.
      PUZEIT = SY-UZEIT.
    ENDIF.
  ENDIF.
  CLEAR: IT_ZDMS1,WA_ZDMS1,IT_ZDMS2,WA_ZDMS2,IT_ZDMS3,WA_ZDMS3,IT_ZDMS4,WA_ZDMS4.
  SELECT * FROM ZDMS1 INTO TABLE IT_ZDMS1 WHERE MBLNR EQ CCNUM AND MJAHR EQ YEAR.
  SELECT * FROM ZDMS2 INTO TABLE IT_ZDMS2 WHERE MBLNR EQ CCNUM AND MJAHR EQ YEAR.
  SELECT * FROM ZDMS3 INTO TABLE IT_ZDMS3 WHERE MBLNR EQ CCNUM AND MJAHR EQ YEAR.
  SELECT * FROM ZDMS4 INTO TABLE IT_ZDMS4 WHERE MBLNR EQ CCNUM AND MJAHR EQ YEAR.
  CLEAR : RPNVAL,CHGTYP,RPNSTAT,CCNUMB1,
  ZDMS1D1,ZDMS1D2,ZDMS1D3,ZDMS1D4,ZDMS1D5,ZDMS1D6,ZDMS1D7,ZDMS1D8,ZDMS1D9,ZDMS1D10,ZDMS1D11,ZDMS1D12.

*****************  STATUS******************
  CLEAR : R.
  R = SPACE.
  SELECT SINGLE * FROM ZDMS1 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM.
  IF SY-SUBRC EQ 0.
    IF ZDMS1-REJECT EQ 'X' OR ZDMS1-RREJECT1 EQ 'X' OR ZDMS1-RREJECT2 EQ 'X' OR ZDMS1-QREJECT1 EQ 'X'.
      R = '1'.
    ENDIF.
  ENDIF.
  SELECT SINGLE * FROM ZDMS4 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM.
  IF SY-SUBRC EQ 0.
    IF ZDMS4-QHREJECT EQ 'X' OR ZDMS4-TDREJECT EQ 'X'.
      R = '1'.
    ENDIF.
  ENDIF.
  CLEAR : CCSTAT,CL1STAT,CL2STAT.
  IF R EQ '1'.
    CCSTAT = '(CCR REJECTED AND STANDS CLOSED)'.
    CL1STAT = 'CLOSURE ACTIVITY NOT APPLICABLE'.
    CL2STAT = 'CLOSURE ACTIVITY NOT APPLICABLE'.
  ENDIF.

  CLEAR : APPRNAME,APPRDT,APPRTM.
  CLEAR : CHGTYP,CCNUMB1,RPNVAL.
  READ TABLE IT_ZDMS4 INTO WA_ZDMS4 WITH KEY  MJAHR = YEAR MBLNR = CCNUM.
  IF SY-SUBRC EQ 0.
    IF WA_ZDMS4-CHGTYPN EQ 'X'.
      CHGTYP = 'NEW'.
    ELSEIF WA_ZDMS4-CHGTYPM EQ 'X'.
      CHGTYP = 'MODIFICATION'.
    ENDIF.
    CCNUMB1 = WA_ZDMS4-CCNUMB1.
    IF WA_ZDMS4-TDREJECT EQ 'X'.
*      CCSTAT = '(CCR REJECTED AND STANDS CLOSED)'.
*      CL1STAT = 'CLOSED'.
*      CL2STAT = 'CLOSED'.
    ELSE.
*      CCSTAT = SPACE.
    ENDIF.

*    WRITE :/ 'Category of Change',CHGTYP.
    RPNVAL = WA_ZDMS4-RPN_S * WA_ZDMS4-RPN_P * WA_ZDMS4-RPN_D.
    CLEAR : RPNSTAT.
    IF RPNVAL GT 0 AND RPNVAL LE 25.
      RPNSTAT = 'MINOR'.
    ELSEIF RPNVAL GE 25 AND RPNVAL LE 75.
      RPNSTAT = 'MAJOR'.
    ELSEIF RPNVAL GT 75 AND RPNVAL LE 125.
      RPNSTAT = 'CRITICAL'.
    ENDIF.

    SELECT SINGLE * FROM PA0001 WHERE PERNR EQ WA_ZDMS4-QHPERNR AND ENDDA GE SY-DATUM.
*       AND PLANS NE '99999999'.
    IF SY-SUBRC EQ 0.
      APPRNAME = PA0001-ENAME.
    ENDIF.
    APPRDT = WA_ZDMS4-QHDATE.
    APPRTM = WA_ZDMS4-QHUZEIT.
  ENDIF.
*************  DMS ATTACHMENT**************

  CLEAR : DOC_KEY,DOCKEY,ATTACHFILE,ATTACH.
  DOCKEY = CCNUM.
  PACK DOCKEY TO DOCKEY.
  CONDENSE DOCKEY.
  CONCATENATE DOCKEY '_' YEAR INTO DOC_KEY.

  SELECT * FROM ZDMS_GOS INTO TABLE IT_ZDMS_GOS WHERE DOC_KEY EQ DOC_KEY.

  LOOP AT IT_ZDMS_GOS INTO WA_ZDMS_GOS.
    CONCATENATE ATTACH WA_ZDMS_GOS-FILENAME ',' INTO ATTACH.
    CONDENSE ATTACH.
  ENDLOOP.


  SELECT SINGLE * FROM ZDMS_GOS WHERE DOC_KEY EQ DOC_KEY.
  IF SY-SUBRC EQ 0.
    CONCATENATE 'ATTACHED_FILES: ' ATTACH  INTO ATTACHFILE .
  ENDIF.

  CLEAR :REJ1DT,REJ1REM1,REJ1REM2,REJ1REM3.
  READ TABLE IT_ZDMS1 INTO WA_ZDMS1 WITH KEY  MJAHR = YEAR MBLNR = CCNUM QREJECT1 = 'X'. "10.7.20
  IF SY-SUBRC EQ 0.
    SELECT SINGLE * FROM PA0001 WHERE PERNR EQ ZDMS1-QPERNR1 AND ENDDA GE SY-DATUM.
    IF SY-SUBRC EQ 0.
      REJ1NAME = PA0001-ENAME.
    ENDIF.
    REJ1DT = WA_ZDMS1-QDATE1.
    REJ1REM1 = WA_ZDMS1-QAREMARK1.
    REJ1REM2 = WA_ZDMS1-QAREMARK2.
    REJ1REM3 = WA_ZDMS1-QAREMARK3.
  ELSE.

*************************************************17.12.20*****
    READ TABLE IT_ZDMS1 INTO WA_ZDMS1 WITH KEY  MJAHR = YEAR MBLNR = CCNUM REJECT = 'X'. "17.12.20
    IF SY-SUBRC EQ 0.
      SELECT SINGLE * FROM PA0001 WHERE PERNR EQ ZDMS1-APERNR AND ENDDA GE SY-DATUM.
      IF SY-SUBRC EQ 0.
        REJ1NAME = PA0001-ENAME.
      ENDIF.
      REJ1DT = WA_ZDMS1-ADATE.
      REJ1REM1 = WA_ZDMS1-DREM1.
      REJ1REM2 = WA_ZDMS1-DREM2.
      REJ1REM3 = WA_ZDMS1-DREM3.
    ENDIF.

*******************************************************************
  ENDIF.

  READ TABLE IT_ZDMS1 INTO WA_ZDMS1 WITH KEY  MJAHR = YEAR MBLNR = CCNUM.
  IF SY-SUBRC EQ 0.

*    WRITE : / 'Change Applicable to:'.
    IF WA_ZDMS1-D1 EQ 'X'.
      ZDMS1D1 = 'Product,'.
    ENDIF.
    IF WA_ZDMS1-D2 EQ 'X'.
      ZDMS1D2 =  'Facility,'.
    ENDIF.
    IF WA_ZDMS1-D3 EQ 'X'.
      ZDMS1D3 =  'System,'.
    ENDIF.
    IF WA_ZDMS1-D4 EQ 'X'.
      ZDMS1D4 =  'Document,'.
    ENDIF.
    IF WA_ZDMS1-D5 EQ 'X'.
      ZDMS1D5 =  'Equipment / Instrument,'.
    ENDIF.
    IF WA_ZDMS1-D6 EQ 'X'.
      ZDMS1D6 =  'Procedure,'.
    ENDIF.
    IF WA_ZDMS1-D7 EQ 'X'.
      ZDMS1D7 =  'Process,'.
    ENDIF.
    IF WA_ZDMS1-D8 EQ 'X'.
      ZDMS1D8 =  'Material,'.
    ENDIF.
    IF WA_ZDMS1-D9 EQ 'X'.
      ZDMS1D9 =  'Statbility,'.
    ENDIF.
    IF WA_ZDMS1-D10 EQ 'X'.
      ZDMS1D10 =  'Analytical method,'.
    ENDIF.
    IF WA_ZDMS1-D11 EQ 'X'.
      ZDMS1D11 =  'Calibration,'.
    ENDIF.
    IF WA_ZDMS1-D12 EQ 'X'.
      ZDMS1D12 =  'Artwork'.
    ENDIF.
    IF WA_ZDMS1-DTEXT NE SPACE.
      ZDMS1D13 = WA_ZDMS1-DTEXT.
    ENDIF.

    CLEAR : IDEPT,INAME.  "28.1.21
    SELECT SINGLE * FROM PA0001 WHERE PERNR EQ WA_ZDMS1-PERNR AND BEGDA LE WA_ZDMS1-BUDAT AND ENDDA GE WA_ZDMS1-BUDAT.
      IF sy-subrc = 0.
 INAME = PA0001-ENAME.
      ENDIF.
    SELECT SINGLE * FROM ZPA0001 WHERE PERNR EQ WA_ZDMS1-PERNR AND BEGDA LE WA_ZDMS1-BUDAT AND ENDDA GE WA_ZDMS1-BUDAT.
    IF SY-SUBRC EQ 0.
*      SELECT SINGLE * FROM T001P WHERE BTRTL EQ PA0001-BTRTL.
      SELECT SINGLE * FROM T001P WHERE BTRTL EQ ZPA0001-BTRTL.
      IF SY-SUBRC EQ 0.
        IDEPT = T001P-BTEXT.
      ENDIF.
*      INAME = PA0001-ENAME.
*      WRITE : 'Initiator name:',PA0001-ENAME,'Date',WA_ZDMS1-BUDAT.
    ENDIF.

    CLEAR : DNAME.
    SELECT SINGLE * FROM PA0001 WHERE PERNR EQ WA_ZDMS1-APERNR AND ENDDA GE SY-DATUM.
    IF SY-SUBRC EQ 0.
      DNAME = PA0001-ENAME.
    ENDIF.
    CLEAR : DEPTSTAT.
    IF WA_ZDMS1-APPROVE EQ 'X'.
      DEPTSTAT = 'Approved by:'.
    ELSEIF WA_ZDMS1-REJECT EQ 'X'.
      DEPTSTAT = 'Rejected by:'.
    ENDIF.

    CLEAR : DEPTNAME,DEPTDT,DEPTTM.  "21.7.20

*    BREAK-POINT.
    SELECT SINGLE * FROM ZDMS1 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM AND USELDEPT NE '00000000'.
    IF SY-SUBRC EQ 0.
      SELECT SINGLE * FROM PA0001 WHERE PERNR EQ ZDMS1-USELDEPT AND ENDDA GE SY-DATUM.
      IF SY-SUBRC EQ 0.
        DEPTNAME = PA0001-ENAME.
      ENDIF.
      DEPTDT = ZDMS1-DTSELDEPT.
      DEPTTM = ZDMS1-DTSELTM.
*      EXIT.
    ELSE.

      SELECT SINGLE * FROM ZDMS2 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM AND EBUDAT GT 0.
      IF SY-SUBRC EQ 0.
        LOOP AT IT_ZDMS2 INTO WA_ZDMS2 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM.
*        IF wa_zdms1-werks EQ '1000' AND wa_zdms2-dept EQ '1223'.  "31.7.20
          IF WA_ZDMS1-WERKS EQ '1000' AND WA_ZDMS2-DEPT EQ '1228'.  "24.1.21
            SELECT SINGLE * FROM PA0001 WHERE PERNR EQ WA_ZDMS2-EPERNR AND ENDDA GE SY-DATUM.
            IF SY-SUBRC EQ 0.
              DEPTNAME = PA0001-ENAME.
            ENDIF.
            DEPTDT = WA_ZDMS2-EBUDAT.
            DEPTTM = WA_ZDMS2-EUZEIT.
            EXIT.
          ELSEIF WA_ZDMS1-WERKS EQ '1001' AND WA_ZDMS2-DEPT EQ '1328'.
            SELECT SINGLE * FROM PA0001 WHERE PERNR EQ WA_ZDMS2-EPERNR AND ENDDA GE SY-DATUM.
            IF SY-SUBRC EQ 0.
              DEPTNAME = PA0001-ENAME.
            ENDIF.
            DEPTDT = WA_ZDMS2-EBUDAT.
            DEPTTM = WA_ZDMS2-EUZEIT.
            EXIT.
          ELSEIF WA_ZDMS1-WERKS EQ '3000' AND WA_ZDMS2-DEPT EQ '1232'.
            SELECT SINGLE * FROM PA0001 WHERE PERNR EQ WA_ZDMS2-EPERNR AND ENDDA GE SY-DATUM.
            IF SY-SUBRC EQ 0.
              DEPTNAME = PA0001-ENAME.
            ENDIF.
            DEPTDT = WA_ZDMS2-EBUDAT.
            DEPTTM = WA_ZDMS2-EUZEIT.
            EXIT.
          ELSEIF WA_ZDMS1-WERKS EQ '4000' AND WA_ZDMS2-DEPT EQ '1232'.
            SELECT SINGLE * FROM PA0001 WHERE PERNR EQ WA_ZDMS2-EPERNR AND ENDDA GE SY-DATUM.
            IF SY-SUBRC EQ 0.
              DEPTNAME = PA0001-ENAME.
            ENDIF.
            DEPTDT = WA_ZDMS2-EBUDAT.
            DEPTTM = WA_ZDMS2-EUZEIT.
            EXIT.
          ENDIF.
        ENDLOOP.
      ENDIF.
    ENDIF.


    CLEAR : REVER,REVNAME,REVPOS,REV1STAT,REV2NAME,REV2POS, REV2STAT.
    IF WA_ZDMS1-RPERNR NE '00000000' OR WA_ZDMS1-RPERNR2 NE '00000000'.
      SELECT SINGLE * FROM PA0001 WHERE PERNR EQ WA_ZDMS1-RPERNR AND ENDDA GE SY-DATUM.
      IF SY-SUBRC EQ 0.
        REVNAME = PA0001-ENAME.
        SELECT SINGLE * FROM HRP1000 WHERE OBJID EQ PA0001-PLANS AND ENDDA GT SY-DATUM.
        IF SY-SUBRC EQ 0.
          REVPOS = HRP1000-STEXT.
        ENDIF.
      ENDIF.
      IF WA_ZDMS1-RAPPROVE1 EQ 'X'.
        REV1STAT = 'Approved By:'.
      ELSEIF WA_ZDMS1-RREJECT1 EQ 'X'.
        REV1STAT = 'Rejected By:'.
      ENDIF.
      SELECT SINGLE * FROM PA0001 WHERE PERNR EQ WA_ZDMS1-RPERNR2 AND ENDDA GE SY-DATUM.
      IF SY-SUBRC EQ 0.
        REV2NAME = PA0001-ENAME.
        SELECT SINGLE * FROM HRP1000 WHERE OBJID EQ PA0001-PLANS AND ENDDA GT SY-DATUM.
        IF SY-SUBRC EQ 0.
          REV2POS = HRP1000-STEXT.
        ENDIF.
      ENDIF.
      IF WA_ZDMS1-RAPPROVE2 EQ 'X'.
        REV2STAT = 'Approved By:'.
      ELSEIF WA_ZDMS1-RREJECT2 EQ 'X'.
        REV2STAT = 'Rejected By:'.
      ENDIF.
      REVER = 1.
    ENDIF.
  ENDIF.
****************************************


  CLEAR : IT_DEPT1,WA_DEPT1,IT_DEPT2,WA_DEPT2.
  CLEAR : DEPTTXT1,DEPTTXT2,DEPTTXT3,DEPTTXT4,DEPTTXT5.
  CLEAR : COUNTD.
  CLEAR : IMPDEPTXT,IMPSTAT,IMPNAME,IMPTXT.
  LOOP AT IT_ZDMS2 INTO WA_ZDMS2.
    CLEAR : IMPDEPTXT,IMPSTAT,IMPNAME,IMPTXT.
    SELECT SINGLE * FROM T001P WHERE BTRTL EQ WA_ZDMS2-DEPT.
    IF SY-SUBRC EQ 0.
      IF T001P-BTRTL NE '1232'.
        IF T001P-WERKS EQ '1100'.
          IMPTXT = 'Mum-'.
        ELSEIF T001P-WERKS EQ '1200'.
          IMPTXT = 'Nsk-'.
        ELSEIF T001P-WERKS EQ '1300'.
          IMPTXT = 'Goa-'.
        ENDIF.
      ENDIF.
      IMPDEPTXT = T001P-BTEXT.
      IF COUNTD LE 4.
        CONCATENATE DEPTTXT1 IMPTXT IMPDEPTXT ',' INTO DEPTTXT1 SEPARATED BY SPACE.
      ELSEIF COUNTD GT 4 AND COUNTD LE 8.
        CONCATENATE DEPTTXT2 IMPTXT IMPDEPTXT ',' INTO DEPTTXT2 SEPARATED BY SPACE.
      ELSEIF COUNTD GT 8 AND COUNTD LE 12.
        CONCATENATE DEPTTXT3 IMPTXT IMPDEPTXT ',' INTO DEPTTXT3 SEPARATED BY SPACE.
      ELSEIF COUNTD GT 12 AND COUNTD LE 16.
        CONCATENATE DEPTTXT4 IMPTXT IMPDEPTXT ',' INTO DEPTTXT4 SEPARATED BY SPACE.
      ELSE.
        CONCATENATE DEPTTXT5 IMPTXT IMPDEPTXT ',' INTO DEPTTXT5 SEPARATED BY SPACE.
      ENDIF.
    ENDIF.
    COUNTD = COUNTD + 1.
  ENDLOOP.

  CONDENSE : DEPTTXT1,DEPTTXT2,DEPTTXT3,DEPTTXT4,DEPTTXT5.
  CLEAR : IMPDEPTXT,IMPSTAT,IMPNAME,IMPDATE,IMPTM.
  LOOP AT IT_ZDMS2 INTO WA_ZDMS2.
    CLEAR : IMPDEPTXT,IMPSTAT,IMPNAME,IMPDATE,IMPTM.
    SELECT SINGLE * FROM T001P WHERE BTRTL EQ WA_ZDMS2-DEPT.
    IF SY-SUBRC EQ 0.
      IMPDEPTXT = T001P-BTEXT.
    ENDIF.
    IF WA_ZDMS2-APPROVE EQ 'X'.
      IMPSTAT = 'Change Accepted'.
    ELSEIF WA_ZDMS2-REJECT EQ 'X'.
      IMPSTAT = 'Change Not Accepted'.
    ELSEIF WA_ZDMS2-NA EQ 'X'.
      IMPSTAT = 'No Impact'.
    ENDIF.
    SELECT SINGLE * FROM PA0001 WHERE PERNR EQ WA_ZDMS2-UPERNR AND ENDDA GE SY-DATUM.
    IF SY-SUBRC EQ 0.
      IMPNAME = PA0001-ENAME.
    ENDIF.
    IMPDATE =  WA_ZDMS2-UBUDAT.
    IMPTM =  WA_ZDMS2-UZEIT.

    WA_DEPT1-BTRTL = WA_ZDMS2-DEPT.
    COLLECT WA_DEPT1 INTO IT_DEPT1.
    CLEAR WA_DEPT1.
  ENDLOOP.

  SORT IT_DEPT1 BY BTRTL.
  DELETE ADJACENT DUPLICATES FROM IT_DEPT1 COMPARING BTRTL.
  CLEAR : IT_DEPT2,WA_DEPT2.
  LOOP AT IT_DEPT1 INTO WA_DEPT1.
    CLEAR : IMPSTAT.
    SELECT SINGLE * FROM ZDMS2 WHERE MBLNR EQ CCNUM AND MJAHR EQ YEAR AND DEPT EQ WA_DEPT1-BTRTL.
    IF SY-SUBRC EQ 0.
      IF ZDMS2-ATEXT1 NE SPACE.
        WA_DEPT2-TXT = 'Y'.
      ENDIF.
      IF ZDMS2-REM1 NE SPACE.
        WA_DEPT2-TXT = 'Y'.
      ENDIF.
      IF ZDMS2-NATEXT NE SPACE.
        WA_DEPT2-TXT = 'Y'.
      ENDIF.
      WA_DEPT2-BTRTL = WA_DEPT1-BTRTL.
      SELECT SINGLE * FROM T001P WHERE BTRTL EQ ZDMS2-DEPT.
      IF SY-SUBRC EQ 0.
        IF T001P-WERKS EQ '1200'.
          WA_DEPT2-LOC = 'Nsk'.
        ELSEIF T001P-WERKS EQ '1300'.
          WA_DEPT2-LOC = 'Goa'.
        ELSE.
          WA_DEPT2-LOC = 'Mum'.
        ENDIF.
        WA_DEPT2-DEPTNAME = T001P-BTEXT.
      ENDIF.
      IF ZDMS2-APPROVE EQ 'X'.
        IMPSTAT = 'Change Accepted'.
      ELSEIF ZDMS2-REJECT EQ 'X'.
        IMPSTAT = 'Change Not Accepted'.
      ELSEIF ZDMS2-NA EQ 'X'.
        IMPSTAT = 'No Impact'.
      ENDIF.
      WA_DEPT2-STATUS = IMPSTAT.
      SELECT SINGLE * FROM PA0001 WHERE PERNR EQ ZDMS2-UPERNR AND ENDDA GE SY-DATUM.
      IF SY-SUBRC EQ 0.
        WA_DEPT2-NAME = PA0001-ENAME.
      ENDIF.
      WA_DEPT2-IMPDATE =  ZDMS2-UBUDAT.
      WA_DEPT2-IMPTM =  ZDMS2-UZEIT.
      COLLECT WA_DEPT2 INTO IT_DEPT2.
      CLEAR WA_DEPT2.
    ENDIF.
  ENDLOOP.
*  BREAK-POINT.
  CLEAR : IT_DEPT3,WA_DEPT3.
  CLEAR COUNT.
  LOOP AT IT_DEPT2 INTO WA_DEPT2.
    COUNT = 1.
    LOOP AT IT_ZDMS2 INTO WA_ZDMS2 WHERE MBLNR EQ CCNUM AND MJAHR EQ YEAR AND DEPT EQ WA_DEPT2-BTRTL.
      WA_DEPT3-BTRTL = WA_DEPT2-BTRTL.
      WA_DEPT3-COUNT = COUNT.
      WA_DEPT3-ATEXT = WA_ZDMS2-ATEXT1.
      WA_DEPT3-REMARK = WA_ZDMS2-REM1.
      WA_DEPT3-TDATE = WA_ZDMS2-TDATE1.
      WA_DEPT3-CDATE = WA_ZDMS2-CTDATE1.
      IF WA_ZDMS2-NATEXT NE SPACE.
        WA_DEPT3-REMARK = WA_ZDMS2-NATEXT.
      ENDIF.
      COLLECT WA_DEPT3 INTO IT_DEPT3.
      CLEAR WA_DEPT3.
      COUNT = COUNT + 1.
      IF WA_ZDMS2-ATEXT2 NE SPACE.
        WA_DEPT3-BTRTL = WA_DEPT2-BTRTL.
        WA_DEPT3-COUNT = COUNT.
        WA_DEPT3-ATEXT = WA_ZDMS2-ATEXT2.
        WA_DEPT3-REMARK = WA_ZDMS2-REM2.
        WA_DEPT3-TDATE = WA_ZDMS2-TDATE2.
        WA_DEPT3-CDATE = WA_ZDMS2-CTDATE2.
        COLLECT WA_DEPT3 INTO IT_DEPT3.
        CLEAR WA_DEPT3.
      ENDIF.
      COUNT = COUNT + 1.
      IF WA_ZDMS2-ATEXT3 NE SPACE.
        WA_DEPT3-BTRTL = WA_DEPT2-BTRTL.
        WA_DEPT3-COUNT = COUNT.
        WA_DEPT3-ATEXT = WA_ZDMS2-ATEXT3.
        WA_DEPT3-REMARK = WA_ZDMS2-REM3.
        WA_DEPT3-TDATE = WA_ZDMS2-TDATE3.
        WA_DEPT3-CDATE = WA_ZDMS2-CTDATE3.
        COLLECT WA_DEPT3 INTO IT_DEPT3.
        CLEAR WA_DEPT3.
      ENDIF.
      COUNT = COUNT + 1.
      IF WA_ZDMS2-ATEXT4 NE SPACE.
        WA_DEPT3-BTRTL = WA_DEPT2-BTRTL.
        WA_DEPT3-COUNT = COUNT.
        WA_DEPT3-ATEXT = WA_ZDMS2-ATEXT4.
        WA_DEPT3-REMARK = WA_ZDMS2-REM4.
        WA_DEPT3-TDATE = WA_ZDMS2-TDATE4.
        WA_DEPT3-CDATE = WA_ZDMS2-CTDATE4.
        COLLECT WA_DEPT3 INTO IT_DEPT3.
        CLEAR WA_DEPT3.
      ENDIF.
      COUNT = COUNT + 1.
      IF WA_ZDMS2-ATEXT5 NE SPACE.
        WA_DEPT3-BTRTL = WA_DEPT2-BTRTL.
        WA_DEPT3-COUNT = COUNT.
        WA_DEPT3-ATEXT = WA_ZDMS2-ATEXT5.
        WA_DEPT3-REMARK = WA_ZDMS2-REM5.
        WA_DEPT3-TDATE = WA_ZDMS2-TDATE5.
        WA_DEPT3-CDATE = WA_ZDMS2-CTDATE5.
        COLLECT WA_DEPT3 INTO IT_DEPT3.
        CLEAR WA_DEPT3.
      ENDIF.
      COUNT = COUNT + 1.
    ENDLOOP.
  ENDLOOP.

  CLEAR : IMPRDT,IMPRTM.  "29.8.22
  CLEAR : TCLOSEDT,TCLOSEDTNAME,TCLOSEDTON,TCLOSETMON.
  CLEAR : RPN1,RPN2,RPN3,RPNVAL,TCLOSEDT, TCLOSEDTNAME,TCLOSEDTON,TCLOSETMON,RNAME,RANAME,IMPRDT,IMPRTM.
  READ TABLE IT_ZDMS4 INTO WA_ZDMS4 WITH KEY MJAHR = YEAR  MBLNR = CCNUM.
  IF SY-SUBRC EQ 0.
    RPN1 = WA_ZDMS4-RPN_S.
    RPN2 = WA_ZDMS4-RPN_P.
    RPN3 = WA_ZDMS4-RPN_D.
    RPNVAL  = RPN1 * RPN2 * RPN3.
    TCLOSEDT = WA_ZDMS4-TCLOSEDT.  "TENTATIVE CLOSURE DATE
    SELECT SINGLE * FROM PA0001 WHERE PERNR EQ WA_ZDMS4-TCLOSEDTBY AND ENDDA GT SY-DATUM.
    IF SY-SUBRC EQ 0.
      TCLOSEDTNAME = PA0001-ENAME.
    ENDIF.
    TCLOSEDTON = WA_ZDMS4-TCLOSEDTON.
    TCLOSETMON = WA_ZDMS4-TCLOSETMON.
    CLEAR : RNAME,RANAME.
    SELECT SINGLE * FROM PA0001 WHERE PERNR EQ WA_ZDMS4-PERNR AND ENDDA GE SY-DATUM.
    IF SY-SUBRC EQ 0.
      RNAME = PA0001-ENAME.
    ENDIF.
    SELECT SINGLE * FROM PA0001 WHERE PERNR EQ WA_ZDMS4-QHPERNR AND ENDDA GE SY-DATUM.
    IF SY-SUBRC EQ 0.
      RANAME = PA0001-ENAME.
    ENDIF.
    IF ZDMS1-BUDAT GE '20230510'.
      SELECT SINGLE * FROM ZDMS3 WHERE  MJAHR = YEAR  AND MBLNR = CCNUM.
      IF SY-SUBRC EQ 0.
        IMPRDT = ZDMS3-BUDAT.  "added on 10.5.23
        IMPRTM = ZDMS3-UZEIT.  "added on 10.5.23
      ENDIF.
    ELSE.
      IMPRDT = WA_ZDMS4-BUDAT.  "added on 29.8.22
      IMPRTM = WA_ZDMS4-UZEIT.  "added on 29.8.22
    ENDIF.
  ENDIF.

  C = 1.
*  CLEAR : imprname,  imprdt.

  CLEAR : IMPRNAME.
  CLEAR : IT_IDEPT1,WA_IDEPT1.
  LOOP AT IT_ZDMS3 INTO WA_ZDMS3 WHERE FOLW1 NE 'X'.
    SELECT SINGLE * FROM PA0001 WHERE PERNR EQ WA_ZDMS3-PERNR AND ENDDA GE SY-DATUM.
    IF SY-SUBRC EQ 0.
      IMPRNAME = PA0001-ENAME.
    ENDIF.
    WA_IDEPT1-BTRTL = WA_ZDMS3-DEPT.
    COLLECT WA_IDEPT1 INTO IT_IDEPT1.
    CLEAR WA_IDEPT1.
  ENDLOOP.
  CLEAR : COUNT.
  COUNT = 1.
*  LOOP AT it_idept1 INTO wa_idept1.
  COUNT = 1.
  CLEAR : IT_IDEPT2,WA_IDEPT2.
  LOOP AT IT_ZDMS3 INTO WA_ZDMS3 WHERE FOLW1 NE 'X' AND MBLNR EQ CCNUM AND MJAHR EQ YEAR.
    SELECT SINGLE * FROM T001P WHERE BTRTL EQ WA_ZDMS3-DEPT.
    IF SY-SUBRC EQ 0.
      WA_IDEPT2-BTRTL = WA_ZDMS3-DEPT.
      WA_IDEPT2-COUNT = COUNT.
      WA_IDEPT2-ATEXT = WA_ZDMS3-ATEXT1.
      WA_IDEPT2-REMARK = WA_ZDMS3-REM1.
      WA_IDEPT2-DEPTNAME = T001P-BTEXT.
      WA_IDEPT2-TDATE = WA_ZDMS3-TDATE1.
      WA_IDEPT2-CTDATE = WA_ZDMS3-CTDATE1.
      COLLECT WA_IDEPT2 INTO IT_IDEPT2.
      CLEAR WA_IDEPT2.
      COUNT = COUNT + 1.
    ENDIF.
  ENDLOOP.
********long term**********


  CLEAR : LIMPRNAME.
  CLEAR : IT_LIDEPT1,WA_LIDEPT1.
  LOOP AT IT_ZDMS3 INTO WA_ZDMS3 WHERE FOLW1 EQ 'X'.
    SELECT SINGLE * FROM PA0001 WHERE PERNR EQ WA_ZDMS3-PERNR AND ENDDA GE SY-DATUM.
    IF SY-SUBRC EQ 0.
      LIMPRNAME = PA0001-ENAME.
    ENDIF.
    WA_LIDEPT1-BTRTL = WA_ZDMS3-DEPT.
    COLLECT WA_LIDEPT1 INTO IT_LIDEPT1.
    CLEAR WA_LIDEPT1.
  ENDLOOP.
  CLEAR : COUNT.
  COUNT = 1.
*  LOOP AT it_idept1 INTO wa_idept1.
  COUNT = 1.
  CLEAR : IT_LIDEPT2,WA_LIDEPT2.
  LOOP AT IT_ZDMS3 INTO WA_ZDMS3 WHERE FOLW1 EQ 'X' AND MBLNR EQ CCNUM AND MJAHR EQ YEAR.
    SELECT SINGLE * FROM T001P WHERE BTRTL EQ WA_ZDMS3-DEPT.
    IF SY-SUBRC EQ 0.
      WA_LIDEPT2-BTRTL = WA_ZDMS3-DEPT.
      WA_LIDEPT2-COUNT = COUNT.
      WA_LIDEPT2-ATEXT = WA_ZDMS3-ATEXT1.
      WA_LIDEPT2-REMARK = WA_ZDMS3-REM1.
      WA_LIDEPT2-DEPTNAME = T001P-BTEXT.
      WA_LIDEPT2-TDATE = WA_ZDMS3-TDATE1.
      WA_LIDEPT2-CTDATE = WA_ZDMS3-CTDATE1.
      COLLECT WA_LIDEPT2 INTO IT_LIDEPT2.
      CLEAR WA_LIDEPT2.
      COUNT = COUNT + 1.
    ENDIF.
  ENDLOOP.

****************
*  ENDLOOP.

  IF IMPRNAME EQ SPACE.  "29.8.22
    IMPRDT = 0.
  ENDIF.


  CLEAR : CHGSTAT,CHGAUT,SFTDDATE,SFTCLOSEDT.
  READ TABLE IT_ZDMS4 INTO WA_ZDMS4 WITH KEY MJAHR = YEAR MBLNR = CCNUM.
  IF SY-SUBRC EQ 0.
    IF WA_ZDMS4-QHAPPROVE EQ 'X'.
      CHGSTAT = 'APPROVED'.
    ELSEIF WA_ZDMS4-QHREJECT EQ 'X'.
      CHGSTAT = 'REJECTED'.
    ENDIF.

*    WRITE :  'By DGM-QA'.
    CLEAR : CHGAPR.
    SELECT SINGLE * FROM PA0001 WHERE PERNR EQ WA_ZDMS4-QHPERNR AND ENDDA GE SY-DATUM.
    IF SY-SUBRC EQ 0.
      CHGAPR = PA0001-ENAME.
    ENDIF.
    SFTDDATE = WA_ZDMS4-TDDATE.
    SFTCLOSEDT = WA_ZDMS4-TCLOSEDT.
*    CHGAPRDT = WA_ZDMS4-TDDATE.
  ENDIF.
*  SKIP.
*  WRITE : / 'Proposed change is '.
  READ TABLE IT_ZDMS4 INTO WA_ZDMS4 WITH KEY MJAHR = YEAR MBLNR = CCNUM.
  IF SY-SUBRC EQ 0.
    IF WA_ZDMS4-TDAPPROVE EQ 'X'.
      CHGAUT = 'AUTHORIZED'.
    ELSEIF WA_ZDMS4-TDREJECT EQ 'X'.
      CHGAUT = 'REJECTED'.
    ENDIF.
*    WRITE :  'By Technical Director'.
    CLEAR : CHGAUR.
    SELECT SINGLE * FROM PA0001 WHERE PERNR EQ WA_ZDMS4-TDPERNR AND ENDDA GE SY-DATUM.
    IF SY-SUBRC EQ 0.
      CHGAUR = PA0001-ENAME.
    ENDIF.
  ENDIF.
*  ULINE.

*  WRITE : / 'SECTION-VI: CLOSURE OF CHANGE'.

  CLEAR : STDREM,SQHREM.
  READ TABLE IT_ZDMS4 INTO WA_ZDMS4 WITH KEY MJAHR = YEAR MBLNR = CCNUM.
  IF SY-SUBRC EQ 0.
    SQHREM = WA_ZDMS4-QHREM.
    CONCATENATE WA_ZDMS4-TDREM WA_ZDMS4-TDREM1 WA_ZDMS4-TDREM2 INTO STDREM.

*    WRITE : / 'Closure of Change : '.
    IF WA_ZDMS4-CL1 EQ 'X'.
      CL1STAT = 'CLOSED'.
    ELSE.
      IF R EQ SPACE.
        CL1STAT = 'OPEN'.
      ENDIF.
    ENDIF.
    IF WA_ZDMS4-TDREJECT EQ 'X'.
      CL1STAT = 'CLOSURE ACTIVITY NOT APPLICABLE'.
    ENDIF.
    CLEAR : CL1NAME, CL1ANAME.
    SELECT SINGLE * FROM PA0001 WHERE PERNR EQ WA_ZDMS4-CL1PERNR AND ENDDA GE SY-DATUM.
    IF SY-SUBRC EQ 0.
      CL1NAME = PA0001-ENAME.
    ENDIF.
    SELECT SINGLE * FROM PA0001 WHERE PERNR EQ WA_ZDMS4-QHCL1PERNR AND ENDDA GE SY-DATUM.
    IF SY-SUBRC EQ 0.
      CL1ANAME = PA0001-ENAME.
    ENDIF.
  ENDIF.

  SELECT SINGLE * FROM ZDMS3 WHERE MJAHR = YEAR AND MBLNR = CCNUM AND FOLW1 EQ 'X'.
  IF SY-SUBRC EQ 0.
    CLEAR : FOLWDT,FCOUNT,FCOUNT1,FOLWTM.
    CLEAR : FOLWNAME.
    LOOP AT IT_ZDMS3 INTO WA_ZDMS3 WHERE FOLW1 EQ 'X'.
      SELECT SINGLE * FROM PA0001 WHERE PERNR EQ WA_ZDMS3-PERNR AND ENDDA GE SY-DATUM.
      IF SY-SUBRC EQ 0.
        FOLWNAME = PA0001-ENAME.
      ENDIF.
      FOLWDT = WA_ZDMS3-BUDAT.
      FOLWTM = WA_ZDMS3-UZEIT.
      FCOUNT = FCOUNT + 1.
      FCOUNT1 = FCOUNT.
    ENDLOOP.
    SORT IT_ZDMS3 DESCENDING BY CTCPUDT.
    READ TABLE IT_ZDMS3 INTO WA_ZDMS3 WITH KEY MJAHR = YEAR MBLNR = CCNUM FOLW1 = 'X'.
    IF SY-SUBRC EQ 0.
      IF ZDMS3-CTPERNR GT 0.
        SELECT SINGLE * FROM PA0001 WHERE PERNR EQ ZDMS3-CTPERNR AND ENDDA GE SY-DATUM.
        IF SY-SUBRC EQ 0.
          FOLWNAME = PA0001-ENAME.
        ENDIF.
      ENDIF.
      IF ZDMS3-CTCPUDT GT 0.
        FOLWDT = ZDMS3-CTCPUDT.
        FOLWTM = ZDMS3-CTUZEIT.
      ENDIF.
    ENDIF.
    READ TABLE IT_ZDMS4 INTO WA_ZDMS4 WITH KEY MJAHR = YEAR MBLNR = CCNUM.
    IF SY-SUBRC EQ 0.
      IF WA_ZDMS4-CL2 EQ 'X'.
        CL2STAT = 'CLOSED'.
      ELSE.
        IF R EQ SPACE.
          CL2STAT = 'OPEN'.
        ENDIF.
      ENDIF.
      IF WA_ZDMS4-TDREJECT EQ 'X'.
        CL2STAT = 'CLOSURE ACTIVITY NOT APPLICABLE'.
      ENDIF.

      SELECT SINGLE * FROM PA0001 WHERE PERNR EQ WA_ZDMS4-CL2PERNR AND ENDDA GE SY-DATUM.
      IF SY-SUBRC EQ 0.
        CL2NAME = PA0001-ENAME.
      ENDIF.
      SELECT SINGLE * FROM PA0001 WHERE PERNR EQ WA_ZDMS4-QHCL2PERNR AND ENDDA GE SY-DATUM.
      IF SY-SUBRC EQ 0.
        CL2ANAME = PA0001-ENAME.
      ENDIF.
    ENDIF.
  ENDIF.
*  BREAK-POINT.
  CLEAR :  SRTEXT1,SRTEXT2,SRTEXT3,SRTEXT4,SRTEXT5,SRTEXT6,SRTEXT7,SRTEXT8,SRTEXT9,SRTEXT10,EIDAYS,EIDATE,EIUZEIT.
  CLEAR : EXT.
  CLEAR : EXTP.  "EXTENSION
  CLEAR :  QAPPRDT, QATEXT1, QATEXT2, QATEXT3, QATEXT4, QATEXT5,QAREVDT, QAPPRTM,QADAYS, EIDAYS,EIDATE,EIUZEIT.
  SELECT SINGLE * FROM ZDMS5 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM.
  IF SY-SUBRC EQ 0.
    QAPPRDT = ZDMS5-QAPPRDT.
    QATEXT1 = ZDMS5-QATEXT1.
    QATEXT2 = ZDMS5-QATEXT2.
    QATEXT3 = ZDMS5-QATEXT3.
    QATEXT4 = ZDMS5-QATEXT4.
    QATEXT5 = ZDMS5-QATEXT5.
    QAREVDT = ZDMS5-QAREVDT.
    QAPPRTM = ZDMS5-QAPPRTM.
    QADAYS = ZDMS5-QADAYS.
    EIDAYS = ZDMS5-EIDAYS.
    EIDATE = ZDMS5-EIDATE.
    EIUZEIT = ZDMS5-EIUZEIT.
    EXT = 'Y'.
    FORMNAME1 = 'TARGET COMPLETION DATE EXTENSION FORM'.
    SY-PAGNO  = 1.
    EXTP = 1.
    CLEAR : QACQD.
    IF ZDMS1-WERKS EQ '1000' OR ZDMS1-WERKS EQ '1001'.
      QACQD = 'QA'.
    ELSE.
      QACQD = 'CQD'.
    ENDIF.
    CLEAR : SOP.
    IF ZDMS1-WERKS EQ '1000'.
      SOP = 'Format No.: SOP/QAD/003-10-F3(Ref. SOP No.: SOP/QAD/003)'.
    ELSEIF ZDMS1-WERKS EQ '1001'.
      SOP = 'Format No.: QA/GM/005-12-F3(Ref. SOP No.: QA/GM/005)'.
    ELSE.
      SOP = 'Format No.: SOP/CQD/013-02-F3(Ref. SOP No.: SOP/CQD/013)'.
    ENDIF.
    CLEAR : EXTPDNAME, EXTPDDT,EXTDEPTNAME,EXTPDTM.
    CLEAR : EXTPNAME,EXTPDT,EXTPTM,EXTINITDEPT.


    SELECT SINGLE * FROM ZPA0001 WHERE PERNR EQ ZDMS5-EIPERNR AND ENDDA GE SY-DATUM.
      IF sy-subrc = 0.
 EXTINITDEPT = ZPA0001-BTRTL.
      ENDIF.
    SELECT SINGLE * FROM PA0001 WHERE PERNR EQ ZDMS5-EIPERNR AND ENDDA GE SY-DATUM.
    IF SY-SUBRC EQ 0.
*      EXTINITDEPT = PA0001-BTRTL.
      EXTPNAME = PA0001-ENAME.
      EXTPDT = ZDMS5-EIDATE.
      EXTPTM = ZDMS5-EIUZEIT.
      SELECT SINGLE * FROM T001P WHERE BTRTL EQ ZPA0001-BTRTL.
      IF SY-SUBRC EQ 0.
        EXTDEPTNAME = T001P-BTEXT.
      ENDIF.
      EXTPDDT = ZDMS5-DEPTHDT.
      EXTPDTM = ZDMS5-DEPTHTM.
      SELECT SINGLE * FROM PA0001 WHERE PERNR EQ ZDMS5-DEPTH AND ENDDA GE SY-DATUM.
      IF SY-SUBRC EQ 0.
        EXTPDNAME = PA0001-ENAME.
      ENDIF.
    ENDIF.
********************************************************

    CLEAR : IT_ZDMS6,WA_ZDMS6.
    CLEAR : IT_EXT1,WA_EXT1.
    SELECT * FROM ZDMS6 INTO TABLE IT_ZDMS6 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM .
*      AND btrtl NE extinitdept.
    LOOP AT IT_ZDMS6 INTO WA_ZDMS6.
      CLEAR : EXTPONAME, EXTPODT,EXTODEPTNAME.
      SELECT SINGLE * FROM T001P WHERE BTRTL EQ WA_ZDMS6-BTRTL.
      IF SY-SUBRC EQ 0.
        WA_EXT1-DEPTNAME = T001P-BTEXT.
      ENDIF.
      SELECT SINGLE * FROM PA0001 WHERE PERNR EQ WA_ZDMS6-APERNR AND ENDDA GE SY-DATUM.
      IF SY-SUBRC EQ 0.
        WA_EXT1-NAME = PA0001-ENAME.
        WA_EXT1-IMPDATE = WA_ZDMS6-ACCEPTDT.
      ENDIF.
      COLLECT WA_EXT1 INTO IT_EXT1.
      CLEAR WA_EXT1.
    ENDLOOP.
************qa/cqd head*********************************
    CLEAR : QAHEADNAME.
    CLEAR : SRTEXT1,SRTEXT2,SRTEXT3,SRTEXT4,SRTEXT5,SRTEXT6,SRTEXT7,SRTEXT8,SRTEXT9,SRTEXT10.
*    ,revextdt.
    SELECT SINGLE * FROM PA0001 WHERE PERNR EQ ZDMS5-QAPERNR AND ENDDA GE SY-DATUM.
    IF SY-SUBRC EQ 0.
      QAHEADNAME = PA0001-ENAME.
    ENDIF.
    SRTEXT1 = ZDMS5-RTEXT1.
    SRTEXT2 = ZDMS5-RTEXT2.
    SRTEXT3 = ZDMS5-RTEXT3.
    SRTEXT4 = ZDMS5-RTEXT4.
    SRTEXT5 = ZDMS5-RTEXT5.
    SRTEXT6 = ZDMS5-RTEXT6.
    SRTEXT7 = ZDMS5-RTEXT7.
    SRTEXT8 = ZDMS5-RTEXT8.
    SRTEXT9 = ZDMS5-RTEXT9.
    SRTEXT10 = ZDMS5-RTEXT10.
  ENDIF.
**************************************************************************
  MBLNR = CCNUM.
  READ TABLE IT_ZDMS1 INTO WA_ZDMS1 WITH KEY MBLNR = CCNUM MJAHR = YEAR.
  IF SY-SUBRC EQ 0.
    IF WA_ZDMS1-RPERNR2 NE '000000'.
      REV = 'Y'.  "reviewer
    ENDIF.
    IF WA_ZDMS1-RPERNR NE '000000'.
      REV1 = 'Y'.  "approver
    ENDIF.
  ENDIF.

  CLEAR :  SQAREMARK1,SQAREMARK2,SQAREMARK3.
  READ TABLE IT_ZDMS4 INTO WA_ZDMS4 WITH KEY MBLNR = CCNUM MJAHR = YEAR.
  IF SY-SUBRC EQ 0.
    SQAREMARK1 = WA_ZDMS4-RTEXT1.
    SQAREMARK2 = WA_ZDMS4-RTEXT2.
    SQAREMARK3 = WA_ZDMS4-RTEXT3.
  ENDIF.

  CLEAR : RPN11,RPN12,RPN13,RPNVAL1.
  MBLNR = CCNUM.
  RPN11 = RPN1.
  RPN12 = RPN2.
  RPN13 = RPN3.
  RPNVAL1 = RPNVAL.
  CONDENSE : RPN11,RPN12,RPN13,RPNVAL1.

*  IF SY-SUBRC EQ 0.
*    WA_SF1-
*  BREAK-POINT.
***************************************************************
*  CALL FUNCTION 'SSF_FUNCTION_MODULE_NAME'
*    EXPORTING
**     formname           = 'ZQMS1'
*      formname           = 'ZQMS2'
**     VARIANT            = ' '
**     DIRECT_CALL        = ' '
*    IMPORTING
*      fm_name            = v_fm
*    EXCEPTIONS
*      no_form            = 1
*      no_function_module = 2
*      OTHERS             = 3.
**  BREAK-POINT .
*
*
*  CALL FUNCTION v_fm
*    EXPORTING
*      mblnr            = mblnr
*      year             = year
*      werks            = werks
*      iname            = iname
*      deptstat         = deptstat
*      dname            = dname
*      rev2stat         = rev2stat
*      rev2pos          = rev2pos
*      rev2name         = rev2name
*      rev              = rev
*      rev1             = rev1
*      rev1stat         = rev1stat
*      revpos           = revpos
*      revname          = revname
*      pdept            = pdept
*      deptname         = deptname
*      deptdt           = deptdt
*      depttm           = depttm
*      depttxt1         = depttxt1
*      depttxt2         = depttxt2
*      depttxt3         = depttxt3
*      depttxt4         = depttxt4
*      depttxt5         = depttxt5
*      rsop             = rsop
*      rpn11            = rpn11
*      rpn12            = rpn12
*      rpn13            = rpn13
*      rpnval1          = rpnval1
*      rpnstat          = rpnstat
*      sqaremark1       = sqaremark1
*      sqaremark2       = sqaremark2
*      sqaremark3       = sqaremark3
*      rname            = rname
*      raname           = raname
*      imprname         = imprname
*      imprdt           = imprdt
*      imprtm           = imprtm
*      tclosedt         = tclosedt
*      tclosedtname     = tclosedtname
*      tclosedton       = tclosedton
*      tclosetmon       = tclosetmon
*      chgstat          = chgstat
*      chgapr           = chgapr
*      chgaut           = chgaut
*      chgaur           = chgaur
*      stdrem           = stdrem
*      sqhrem           = sqhrem
*      cl1stat          = cl1stat
*      cl1name          = cl1name
*      cl1aname         = cl1aname
*      ext              = ext
*    TABLES
*      it_zdms1         = it_zdms1
*      it_zdms2         = it_zdms2
*      it_zdms4         = it_zdms4
*      it_dept2         = it_dept2
*      it_dept3         = it_dept3
*      it_idept2        = it_idept2
***        it_tab1          = it_tab1
***        it_tab2          = it_tab2
***        it_tab3          = it_tab3
***        it_tab4          = it_tab4
***        it_tab5          = it_tab5
***        it_tab6          = it_tab6
***        it_tab7          = it_tab7
***        it_tab8          = it_tab8
****       it_vbrp          = it_vbrp
****       ITAB_DIVISION    = ITAB_DIVISION
****       ITAB_STORAGE     = ITAB_STORAGE
****       ITAB_PA0002      = ITAB_PA0002
*    EXCEPTIONS
*      formatting_error = 1
*      internal_error   = 2
*      send_error       = 3
*      user_canceled    = 4
*      OTHERS           = 5.
*
*****************************************************************************************
  CLEAR : NEW.
  READ TABLE IT_ZDMS1 INTO WA_ZDMS1 WITH KEY MBLNR = CCNUM MJAHR = YEAR.
  IF SY-SUBRC EQ 0.
    IF WA_ZDMS1-BUDAT GE '20230522'.
      NEW = 'Y'.
    ENDIF.
  ENDIF.

  CLEAR : IT_ZDMS5,WA_ZDMS5.
  CLEAR : IT_CHECK,WA_CHECK.
  SELECT * FROM ZDMS5 INTO TABLE IT_ZDMS5 WHERE MBLNR = CCNUM AND MJAHR = YEAR.
  READ TABLE IT_ZDMS1 INTO WA_ZDMS1 WITH KEY MBLNR = CCNUM MJAHR = YEAR.
  IF SY-SUBRC EQ 0.
    WA_CHECK-MBLNR = WA_ZDMS1-MBLNR.
    WA_CHECK-MJAHR = WA_ZDMS1-MJAHR.
    WA_CHECK-FORM = 'N'.
    COLLECT WA_CHECK INTO IT_CHECK.
    CLEAR WA_CHECK.
  ENDIF.
  READ TABLE IT_ZDMS5 INTO WA_ZDMS5 WITH KEY MBLNR = CCNUM MJAHR = YEAR.
  IF SY-SUBRC EQ 0.
    WA_CHECK-MBLNR = WA_ZDMS5-MBLNR.
    WA_CHECK-MJAHR = WA_ZDMS5-MJAHR.
    WA_CHECK-FORM = 'E'.
    COLLECT WA_CHECK INTO IT_CHECK.
    CLEAR WA_CHECK.
  ENDIF.

  CALL FUNCTION 'SSF_FUNCTION_MODULE_NAME'
    EXPORTING
*     formname           = 'ZQMS'
      FORMNAME           = 'ZQMS11'
*     VARIANT            = ' '
*     DIRECT_CALL        = ' '
    IMPORTING
      FM_NAME            = V_FM
    EXCEPTIONS
      NO_FORM            = 1
      NO_FUNCTION_MODULE = 2
      OTHERS             = 3.

  CONTROL-NO_OPEN   = 'X'.
  CONTROL-NO_CLOSE  = 'X'.

*BREAK-POINT.
  CALL FUNCTION 'SSF_OPEN'
    EXPORTING
      CONTROL_PARAMETERS = CONTROL.
*  BREAK-POINT.
*  CLEAR : new1.
  LOOP AT IT_CHECK INTO WA_CHECK.
    CLEAR: FORM1,TITLE1.
    FORM1 = WA_CHECK-FORM.
    IF FORM1 EQ 'N'.
      TITLE1 = 'CHANGE CONTROL FORM'.
    ELSEIF FORM1 EQ 'E'.
      TITLE1 = 'TARGET COMPLETION DATE EXTENSION FORM'.
    ENDIF.

*BREAK-POINT.
    CALL FUNCTION V_FM
      EXPORTING
        CONTROL_PARAMETERS = CONTROL
        USER_SETTINGS      = 'X'
        OUTPUT_OPTIONS     = W_SSFCOMPOP
        MBLNR              = MBLNR
        YEAR               = YEAR
        WERKS              = WERKS
        INAME              = INAME
        DEPTSTAT           = DEPTSTAT
        DNAME              = DNAME
        REV2STAT           = REV2STAT
        REV2POS            = REV2POS
        REV2NAME           = REV2NAME
        REV                = REV
        REV1               = REV1
        REV1STAT           = REV1STAT
        REVPOS             = REVPOS
        REVNAME            = REVNAME
        PDEPT              = PDEPT
        DEPTNAME           = DEPTNAME
        DEPTDT             = DEPTDT
        DEPTTM             = DEPTTM
        DEPTTXT1           = DEPTTXT1
        DEPTTXT2           = DEPTTXT2
        DEPTTXT3           = DEPTTXT3
        DEPTTXT4           = DEPTTXT4
        DEPTTXT5           = DEPTTXT5
        RSOP               = RSOP
        RPN11              = RPN11
        RPN12              = RPN12
        RPN13              = RPN13
        RPNVAL1            = RPNVAL1
        RPNSTAT            = RPNSTAT
        SQAREMARK1         = SQAREMARK1
        SQAREMARK2         = SQAREMARK2
        SQAREMARK3         = SQAREMARK3
        RNAME              = RNAME
        RANAME             = RANAME
        IMPRNAME           = IMPRNAME
        IMPRDT             = IMPRDT
        IMPRTM             = IMPRTM
        TCLOSEDT           = TCLOSEDT
        TCLOSEDTNAME       = TCLOSEDTNAME
        TCLOSEDTON         = TCLOSEDTON
        TCLOSETMON         = TCLOSETMON
        CHGSTAT            = CHGSTAT
        CHGAPR             = CHGAPR
        CHGAUT             = CHGAUT
        CHGAUR             = CHGAUR
        STDREM             = STDREM
        SQHREM             = SQHREM
        CL1STAT            = CL1STAT
        CL1NAME            = CL1NAME
        CL1ANAME           = CL1ANAME
        CL2STAT            = CL2STAT
        CL2NAME            = CL2NAME
        CL2ANAME           = CL2ANAME
        EXT                = EXT
        FORM1              = FORM1
        TITLE1             = TITLE1
        CCNUMB1            = CCNUMB1
        CCNUM              = CCNUM
        YEAR11             = YEAR11
        CCSTAT             = CCSTAT
        LOC                = LOC
        CHGTYP             = CHGTYP
        ATTACHFILE         = ATTACHFILE
        SFTDDATE           = SFTDDATE
        SFTCLOSEDT         = SFTCLOSEDT
        EIDAYS             = EIDAYS
        SRTEXT1            = SRTEXT1
        SRTEXT2            = SRTEXT2
        SRTEXT3            = SRTEXT3
        SRTEXT4            = SRTEXT4
        SRTEXT5            = SRTEXT5
        SRTEXT6            = SRTEXT6
        SRTEXT7            = SRTEXT7
        SRTEXT8            = SRTEXT8
        SRTEXT9            = SRTEXT9
        SRTEXT10           = SRTEXT10
        EXTPNAME           = EXTPNAME
        EIDATE             = EIDATE
        EIUZEIT            = EIUZEIT
        EXTDEPTNAME        = EXTDEPTNAME
        EXTPDNAME          = EXTPDNAME
        EXTPDDT            = EXTPDDT
        EXTPDTM            = EXTPDTM
        QACQD              = QACQD
        QADAYS             = QADAYS
        QATEXT1            = QATEXT1
        QATEXT2            = QATEXT2
        QATEXT3            = QATEXT3
        QATEXT4            = QATEXT4
        QATEXT5            = QATEXT5
        QAREVDT            = QAREVDT
        QAHEADNAME         = QAHEADNAME
        QAPPRDT            = QAPPRDT
        QAPPRTM            = QAPPRTM
        ZDMS1D1            = ZDMS1D1
        ZDMS1D2            = ZDMS1D2
        ZDMS1D3            = ZDMS1D3
        ZDMS1D4            = ZDMS1D4
        ZDMS1D5            = ZDMS1D5
        ZDMS1D6            = ZDMS1D6
        ZDMS1D7            = ZDMS1D7
        ZDMS1D8            = ZDMS1D8
        ZDMS1D9            = ZDMS1D9
        ZDMS1D10           = ZDMS1D10
        ZDMS1D11           = ZDMS1D11
        ZDMS1D12           = ZDMS1D12
        ZDMS1D13           = ZDMS1D13
        IDEPT              = IDEPT
        SOP                = SOP
        UNAME              = UNAME
        NEW                = NEW
        LIMPRNAME          = LIMPRNAME
        FOLWNAME           = FOLWNAME
        FOLWDT             = FOLWDT
        FOLWTM             = FOLWTM
      TABLES
        IT_ZDMS1           = IT_ZDMS1
        IT_ZDMS2           = IT_ZDMS2
        IT_ZDMS4           = IT_ZDMS4
        IT_ZDMS5           = IT_ZDMS5
        IT_DEPT2           = IT_DEPT2
        IT_DEPT3           = IT_DEPT3
        IT_IDEPT2          = IT_IDEPT2
        IT_LIDEPT2         = IT_LIDEPT2
        IT_EXT1            = IT_EXT1
**        it_tab1          = it_tab1
**        it_tab2          = it_tab2
**        it_tab3          = it_tab3
**        it_tab4          = it_tab4
**        it_tab5          = it_tab5
**        it_tab6          = it_tab6
**        it_tab7          = it_tab7
**        it_tab8          = it_tab8
***       it_vbrp          = it_vbrp
***       ITAB_DIVISION    = ITAB_DIVISION
***       ITAB_STORAGE     = ITAB_STORAGE
***       ITAB_PA0002      = ITAB_PA0002
      EXCEPTIONS
        FORMATTING_ERROR   = 1
        INTERNAL_ERROR     = 2
        SEND_ERROR         = 3
        USER_CANCELED      = 4
        OTHERS             = 5.
*




  ENDLOOP.
  CALL FUNCTION 'SSF_CLOSE'.

  IF PERNR EQ '00014022'.

  ELSE.

    CLEAR :   MBLNR, YEAR,WERKS,INAME,DEPTSTAT, DNAME,REV2STAT,REV2POS,REV2NAME,REV,REV1,REV1STAT,REVPOS,REVNAME, PDEPT,DEPTNAME,DEPTDT,
    DEPTTM,DEPTTXT1,DEPTTXT2,DEPTTXT3,DEPTTXT4,DEPTTXT5,RSOP,RPN11,RPN12,RPN13,RPNVAL1,RPNSTAT,SQAREMARK1,
    SQAREMARK2,SQAREMARK3,RNAME,RANAME,IMPRNAME,IMPRDT,IMPRTM,TCLOSEDT,TCLOSEDTNAME,TCLOSEDTON,TCLOSETMON,
    CHGSTAT,CHGAPR,CHGAUT,CHGAUR,STDREM,SQHREM,CL1STAT,CL1NAME,CL1ANAME,EXT,FORM1,TITLE1,CCNUMB1,CCNUM,
    YEAR11,CCSTAT,LOC,CHGTYP,ATTACHFILE,SFTDDATE,SFTCLOSEDT,EIDAYS, SRTEXT1,SRTEXT2,SRTEXT3,SRTEXT4,SRTEXT5,
    SRTEXT6,SRTEXT7,SRTEXT8,SRTEXT9,SRTEXT10,EXTPNAME,EIDATE,EIUZEIT,EXTDEPTNAME, EXTPDNAME,EXTPDDT,EXTPDTM,
    QACQD,QADAYS,QATEXT1,QATEXT2, QATEXT3,QATEXT4,QATEXT5,QAREVDT,QAHEADNAME,QAPPRDT,QAPPRTM,ZDMS1D1,
    ZDMS1D2,ZDMS1D3,ZDMS1D4,ZDMS1D5,ZDMS1D6,ZDMS1D7,ZDMS1D8,ZDMS1D9,ZDMS1D10,ZDMS1D11,ZDMS1D12,ZDMS1D13,IDEPT.
    CLEAR : IT_ZDMS1,WA_ZDMS1,IT_ZDMS2,WA_ZDMS2,IT_ZDMS4,WA_ZDMS4,IT_ZDMS5,WA_ZDMS5,IT_DEPT2,WA_DEPT2,
    IT_DEPT3,WA_DEPT3,IT_IDEPT2,WA_IDEPT2, IT_EXT1,WA_EXT1.
  ENDIF.

*  ENDIF.
*  IF r11 EQ 'X'.
*    MESSAGE 'EMAIL SENT' TYPE 'I'.
*  ENDIF.
  IF R33 EQ 'X'.
    CALL SCREEN 9005.
  ELSE.
    CALL SCREEN 9009.
  ENDIF.


*  LEAVE TO TRANSACTION 'ZQMS'.
*  LEAVE TO SCREEN 0.
ENDFORM.
*&---------------------------------------------------------------------*
*&      Form  REJECTION
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM REJECTION .
  LOOP AT IT_ZDMS2 INTO WA_ZDMS2 WHERE REJECT EQ 'X'.
    MESSAGE 'IT IS MARKED FOR REJECTION- ENTRY NOT ALLOWED' TYPE 'E'.
    EXIT.
  ENDLOOP.
ENDFORM.
*&---------------------------------------------------------------------*
*&      Form  DEPTSTATUS
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM DEPTSTATUS.

*LOOP at it_zdms4 INTO wa_ZDMS4 WHERE MJahr eq YEAR AND mblnr eq ccnum.
*  SELECT SINGLE * FROM zdms1 WHERE mjahr eq wa_zdms4-majhr AND mblnr = wa_zdms4-mblnr.
*    if sy-subrc eq 0.
*      if
*    endif.
*ENDLOOP.

ENDFORM.

FORM PRINT_FORM.
  PERFORM OPEN-FORM.
  CNT = 0.
  SELECT * FROM ZDMS1 INTO TABLE IT_ZDMS1 WHERE MBLNR EQ CCNUM AND MJAHR EQ YEAR.
  SELECT * FROM ZDMS2 INTO TABLE IT_ZDMS2 WHERE MBLNR EQ CCNUM AND MJAHR EQ YEAR.
  SELECT * FROM ZDMS3 INTO TABLE IT_ZDMS3 WHERE MBLNR EQ CCNUM AND MJAHR EQ YEAR.
  SELECT * FROM ZDMS4 INTO TABLE IT_ZDMS4 WHERE MBLNR EQ CCNUM AND MJAHR EQ YEAR.
  CLEAR : RPNVAL,CHGTYP,RPNSTAT.
  IF CNT > 0.
    CALL FUNCTION 'CONTROL_FORM'
      EXPORTING
        COMMAND   = 'NEW-PAGE'
      EXCEPTIONS
        UNOPENED  = 1
        UNSTARTED = 2
        OTHERS    = 3.
    IF SY-SUBRC <> 0.
      MESSAGE ID SY-MSGID TYPE SY-MSGTY NUMBER SY-MSGNO
      WITH SY-MSGV1 SY-MSGV2 SY-MSGV3 SY-MSGV4.
    ENDIF.
  ENDIF.

  READ TABLE IT_ZDMS4 INTO WA_ZDMS4 WITH KEY  MJAHR = YEAR MBLNR = CCNUM.
  IF SY-SUBRC EQ 0.
    IF WA_ZDMS4-CHGTYPN EQ 'X'.
      CHGTYP = 'NEW'.
    ELSEIF WA_ZDMS4-CHGTYPM EQ 'X'.
      CHGTYP = 'MODIFICATION'.
    ENDIF.
    " write :/ 'Category of Change',CHGTYP.
    RPNVAL = WA_ZDMS4-RPN_S + WA_ZDMS4-RPN_P + WA_ZDMS4-RPN_D.
    IF RPNVAL GT 0 AND RPNVAL LE 25.
      RPNSTAT = 'MINOR'.
    ELSEIF RPNVAL GE 25 AND RPNVAL LE 75.
      RPNSTAT = 'MAJOR'.
    ELSEIF RPNVAL GT 75 AND RPNVAL LE 125.
      RPNSTAT = 'CRITICAL'.
    ENDIF.
    " write : / 'Type of Change',RPNSTAT.
  ENDIF.
  " uline.
  SKIP.
  " write : / 'SECTION-I: REQUEST FOR CHANGE'.
  SKIP.

  READ TABLE IT_ZDMS1 INTO WA_ZDMS1 WITH KEY  MJAHR = YEAR MBLNR = CCNUM.
  IF SY-SUBRC EQ 0.
    " write : / 'Change Applicable to:'.
    IF WA_ZDMS1-D1 EQ 'X'.
      " write : / 'Product'.
    ENDIF.
    IF WA_ZDMS1-D2 EQ 'X'.
      " write : / 'Facility'.
    ENDIF.
    IF WA_ZDMS1-D3 EQ 'X'.
      " write : / 'System'.
    ENDIF.
    IF WA_ZDMS1-D4 EQ 'X'.
      " write : / 'Document'.
    ENDIF.
    IF WA_ZDMS1-D5 EQ 'X'.
      " write : / 'Equipment / Instrument'.
    ENDIF.
    IF WA_ZDMS1-D5 EQ 'X'.
      " write : / 'Equipment / Instrument'.
    ENDIF.
    IF WA_ZDMS1-D6 EQ 'X'.
      " write : / 'Procedure'.
    ENDIF.
    IF WA_ZDMS1-D7 EQ 'X'.
      " write : / 'Process'.
    ENDIF.
    IF WA_ZDMS1-D8 EQ 'X'.
      " write : / 'Material'.
    ENDIF.
    IF WA_ZDMS1-D9 EQ 'X'.
      " write : / 'Statbility'.
    ENDIF.
    IF WA_ZDMS1-D10 EQ 'X'.
      " write : / 'Analytical method'.
    ENDIF.
    IF WA_ZDMS1-D11 EQ 'X'.
      " write : / 'Calibration'.
    ENDIF.
    IF WA_ZDMS1-D12 EQ 'X'.
      " write : / 'Artwork'.
    ENDIF.
    SKIP.
    " write : / 'Initiating Department:'.
    SELECT SINGLE * FROM PA0001 WHERE PERNR EQ WA_ZDMS1-PERNR AND ENDDA GE SY-DATUM.
      IF sy-subrc = 0.
 INAME = PA0001-ENAME.
      ENDIF.
    SELECT SINGLE * FROM ZPA0001 WHERE PERNR EQ WA_ZDMS1-PERNR AND ENDDA GE SY-DATUM.
    IF SY-SUBRC EQ 0.
*      SELECT SINGLE * FROM T001P WHERE BTRTL EQ PA0001-BTRTL.
      SELECT SINGLE * FROM T001P WHERE BTRTL EQ ZPA0001-BTRTL.
      IF SY-SUBRC EQ 0.
        " write : T001P-BTEXT.
      ENDIF.
*      INAME = PA0001-ENAME.
      " write : 'Initiator name:',PA0001-ENAME,'Date',WA_ZDMS1-BUDAT.
    ENDIF.
    SELECT SINGLE * FROM PA0001 WHERE PERNR EQ WA_ZDMS1-APERNR AND ENDDA GE SY-DATUM.
    IF SY-SUBRC EQ 0.
      DNAME = PA0001-ENAME.
    ENDIF.
    " uline.
    " write : / '1. Current Status Details:',
*                                        / WA_ZDMS1-ATEXT1,
*                                        / WA_ZDMS1-ATEXT2,
*                                        / WA_ZDMS1-ATEXT3,
*                                        / WA_ZDMS1-ATEXT4,
*                                        / WA_ZDMS1-ATEXT5.
    SKIP.
    " write : / '2. Description of Proposed Change:',
*                                        / WA_ZDMS1-BTEXT1,
*                                        / WA_ZDMS1-BTEXT2,
*                                        / WA_ZDMS1-BTEXT3,
*                                        / WA_ZDMS1-BTEXT4,
*                                        / WA_ZDMS1-BTEXT5.
    SKIP.
    " write : / '3. Reason/ Justification for Change:',
*                                        / WA_ZDMS1-CTEXT1,
*                                        / WA_ZDMS1-CTEXT2,
*                                        / WA_ZDMS1-CTEXT3,
*                                        / WA_ZDMS1-CTEXT4,
*                                        / WA_ZDMS1-CTEXT5.
    SKIP.
    " uline.
    " write : / 'Change Initiated By', INAME,WA_ZDMS1-BUDAT,'Reviewed By',DNAME,WA_ZDMS1-ADATE.
    " write : / 'SECTION-II: RISK ASSESSMENT (By Initiating Department)'.
    SKIP.
    " write : / '1. Potential Risk:',
*                                        / WA_ZDMS1-DTEXT1,
*                                        / WA_ZDMS1-DTEXT2,
*                                        / WA_ZDMS1-DTEXT3,
*                                        / WA_ZDMS1-DTEXT4,
*                                        / WA_ZDMS1-DTEXT5.

    SKIP.
    " write : / '2. Potential Risk Mitigation Plan:',
*                                        / WA_ZDMS1-ETEXT1,
*                                        / WA_ZDMS1-ETEXT2,
*                                        / WA_ZDMS1-ETEXT3,
*                                        / WA_ZDMS1-ETEXT4,
*                                        / WA_ZDMS1-ETEXT5.
    SKIP.
    " write : / '3. Risk Control:',
*                                        / WA_ZDMS1-FTEXT1,
*                                        / WA_ZDMS1-FTEXT2,
*                                        / WA_ZDMS1-FTEXT3,
*                                        / WA_ZDMS1-FTEXT4,
*                                        / WA_ZDMS1-FTEXT5.
    SKIP.
    " uline.
    " write : / 'Risk Assement Done by Initiating Dept. Head(Sign/Date):',DNAME,WA_ZDMS1-ADATE.
    " write : / 'SECTION-III: IMPACT ASSESSMENT OF CHANGE'.
    SKIP.
    " write : / 'Applicable Department for Impact Assessment To be Decided by DGM-QA:'.
    SKIP.

*    IF WA_ZDMS1-DEPT1 NE SPACE.
*      SELECT SINGLE * FROM T001P WHERE BTRTL EQ WA_ZDMS1-DEPT1.
*      IF SY-SUBRC EQ 0.
*        " write : / T001P-BTEXT.
*      ENDIF.
*    ENDIF.
*    IF WA_ZDMS1-DEPT2 NE SPACE.
*      SELECT SINGLE * FROM T001P WHERE BTRTL EQ WA_ZDMS1-DEPT2.
*      IF SY-SUBRC EQ 0.
*        " write : / T001P-BTEXT.
*      ENDIF.
*    ENDIF.
*    IF WA_ZDMS1-DEPT3 NE SPACE.
*      SELECT SINGLE * FROM T001P WHERE BTRTL EQ WA_ZDMS1-DEPT3.
*      IF SY-SUBRC EQ 0.
*        " write : / T001P-BTEXT.
*      ENDIF.
*    ENDIF.
*    IF WA_ZDMS1-DEPT4 NE SPACE.
*      SELECT SINGLE * FROM T001P WHERE BTRTL EQ WA_ZDMS1-DEPT4.
*      IF SY-SUBRC EQ 0.
*        " write : / T001P-BTEXT.
*      ENDIF.
*    ENDIF.
*    IF WA_ZDMS1-DEPT5 NE SPACE.
*      SELECT SINGLE * FROM T001P WHERE BTRTL EQ WA_ZDMS1-DEPT5.
*      IF SY-SUBRC EQ 0.
*        " write : / T001P-BTEXT.
*      ENDIF.
*    ENDIF.
*    IF WA_ZDMS1-DEPT6 NE SPACE.
*      SELECT SINGLE * FROM T001P WHERE BTRTL EQ WA_ZDMS1-DEPT6.
*      IF SY-SUBRC EQ 0.
*        " write : / T001P-BTEXT.
*      ENDIF.
*    ENDIF.
*    IF WA_ZDMS1-DEPT7 NE SPACE.
*      SELECT SINGLE * FROM T001P WHERE BTRTL EQ WA_ZDMS1-DEPT7.
*      IF SY-SUBRC EQ 0.
*        " write : / T001P-BTEXT.
*      ENDIF.
*    ENDIF.
*    IF WA_ZDMS1-DEPT8 NE SPACE.
*      SELECT SINGLE * FROM T001P WHERE BTRTL EQ WA_ZDMS1-DEPT8.
*      IF SY-SUBRC EQ 0.
*        " write : / T001P-BTEXT.
*      ENDIF.
*    ENDIF.
*    IF WA_ZDMS1-DEPT9 NE SPACE.
*      SELECT SINGLE * FROM T001P WHERE BTRTL EQ WA_ZDMS1-DEPT9.
*      IF SY-SUBRC EQ 0.
*        " write : / T001P-BTEXT.
*      ENDIF.
*    ENDIF.
*    IF WA_ZDMS1-DEPT10 NE SPACE.
*      SELECT SINGLE * FROM T001P WHERE BTRTL EQ WA_ZDMS1-DEPT10.
*      IF SY-SUBRC EQ 0.
*        " write : / T001P-BTEXT.
*      ENDIF.
*    ENDIF.
  ENDIF.
  " uline.
*  LOOP AT IT_ZDMS2 INTO WA_ZDMS2.
*    SELECT SINGLE * FROM T001P WHERE BTRTL EQ WA_ZDMS2-DEPT.
*    IF SY-SUBRC EQ 0.
*      " write : / T001P-BTEXT.
*    ENDIF.
*    IF WA_ZDMS2-APPROVE EQ 'X'.
*      " write : 'CHANGE ACCEPTED'.
*    ELSEIF WA_ZDMS2-REJECT EQ 'X'.
*      " write : 'CHANGE REJECTED'.
*    ENDIF.
*    " write : / 'Impacted Activities / SOPs / DOCUMENTS', 'Target Date', 'Name'.
*    " write : / WA_ZDMS2-ATEXT1,WA_ZDMS2-TDATE1,WA_ZDMS2-REM1,WA_ZDMS2-CTDATE1.
*    SELECT SINGLE * FROM PA0001 WHERE PERNR EQ WA_ZDMS2-PERNR AND ENDDA GE SY-DATUM.
*    IF SY-SUBRC EQ 0.
*      " write : PA0001-ENAME.
*    ENDIF.
*    " write : / WA_ZDMS2-ATEXT2,WA_ZDMS2-TDATE2.
*    SELECT SINGLE * FROM PA0001 WHERE PERNR EQ WA_ZDMS2-PERNR AND ENDDA GE SY-DATUM.
*    IF SY-SUBRC EQ 0.
*      " write : PA0001-ENAME.
*    ENDIF.
*    " write : / WA_ZDMS2-ATEXT3,WA_ZDMS2-TDATE3.
*    SELECT SINGLE * FROM PA0001 WHERE PERNR EQ WA_ZDMS2-PERNR AND ENDDA GE SY-DATUM.
*    IF SY-SUBRC EQ 0.
*      " write : PA0001-ENAME.
*    ENDIF.
*    " write : / WA_ZDMS2-ATEXT4,WA_ZDMS2-TDATE4.
*    SELECT SINGLE * FROM PA0001 WHERE PERNR EQ WA_ZDMS2-PERNR AND ENDDA GE SY-DATUM.
*    IF SY-SUBRC EQ 0.
*      " write : PA0001-ENAME.
*    ENDIF.
*    " write : / WA_ZDMS2-ATEXT5,WA_ZDMS2-TDATE5.
*    SELECT SINGLE * FROM PA0001 WHERE PERNR EQ WA_ZDMS2-PERNR AND ENDDA GE SY-DATUM.
*    IF SY-SUBRC EQ 0.
*      " write : PA0001-ENAME.
*    ENDIF.
*
*    " uline.
*  ENDLOOP.

  " write : / 'Risk Review by QA'.
  " write : / 'Calculation for Risk Priority Number:'.
  " write : / 'RPN = Severity rating(S) X Probability rating(P) X Detection rating(D)'.
*  BREAK-POINT.
  READ TABLE IT_ZDMS4 INTO WA_ZDMS4 WITH KEY MJAHR = YEAR  MBLNR = CCNUM.
  IF SY-SUBRC EQ 0.
    SELECT SINGLE * FROM PA0001 WHERE PERNR EQ WA_ZDMS4-QHPERNR AND ENDDA GE SY-DATUM.
    IF SY-SUBRC EQ 0.
      APPRNAME = PA0001-ENAME.
    ENDIF.
    APPRDT = WA_ZDMS4-QHDATE.
  ENDIF.
  SKIP.
  " uline.
  " write : / 'SECTION-IV: ALL DEPT. IMPACTED ACTIVITIES/SOP''s / DOCUMENTS'.
  " write : / '(QA to Arrange Impacted Activities / SOP''s / Documents in sequence with target dates)'.
  " write : / 'Impacted Activities / SOP''s  / Documents, Responsibility, Target Date, Completion date'.
  SKIP.
  LOOP AT IT_ZDMS3 INTO WA_ZDMS3.
    " write : / WA_ZDMS3-ATEXT1.
    SELECT SINGLE * FROM T001P WHERE BTRTL EQ WA_ZDMS3-DEPT.
    IF SY-SUBRC EQ 0.
      " write : T001P-BTEXT.
    ENDIF.
    " write :WA_ZDMS3-TDATE1, WA_ZDMS3-REM1, WA_ZDMS3-REM1,WA_ZDMS3-CTDATE1.
    ON CHANGE OF WA_ZDMS3-DEPT.
      " uline.
    ENDON.
  ENDLOOP.
  " uline.
  SKIP.
  " write : / 'SECTION-V: APPROVAL / REJECTION OF CHANGE'.
  " write : / 'Proposed change is '.
  READ TABLE IT_ZDMS4 INTO WA_ZDMS4 WITH KEY MJAHR = YEAR MBLNR = CCNUM.
  IF SY-SUBRC EQ 0.
    IF WA_ZDMS4-QHAPPROVE EQ 'X'.
      " write : 'APPROVED'.
    ELSEIF WA_ZDMS4-QHREJECT EQ 'X'.
      " write : 'REJECTED'.
    ENDIF.
    " write :  'By DGM-QA'.
    SELECT SINGLE * FROM PA0001 WHERE PERNR EQ WA_ZDMS4-QHPERNR AND ENDDA GE SY-DATUM.
    IF SY-SUBRC EQ 0.
      " write : PA0001-ENAME.
    ENDIF.
    " write : 'On Date',WA_ZDMS4-TDDATE.
  ENDIF.
  SKIP.
  " write : / 'Proposed change is '.
  READ TABLE IT_ZDMS4 INTO WA_ZDMS4 WITH KEY MJAHR = YEAR MBLNR = CCNUM.
  IF SY-SUBRC EQ 0.
    IF WA_ZDMS4-TDAPPROVE EQ 'X'.
      " write : 'AUTHORISE'.
    ELSEIF WA_ZDMS4-TDREJECT EQ 'X'.
      " write : 'REJECTED'.
    ENDIF.
    " write :  'By Technical Director'.
    SELECT SINGLE * FROM PA0001 WHERE PERNR EQ WA_ZDMS4-TDPERNR AND ENDDA GE SY-DATUM.
    IF SY-SUBRC EQ 0.
      " write : PA0001-ENAME.
    ENDIF.
    " write : 'On Date',WA_ZDMS4-TDDATE.
  ENDIF.
  " uline.

  " write : / 'SECTION-VI: CLOSURE OF CHANGE'.


  READ TABLE IT_ZDMS4 INTO WA_ZDMS4 WITH KEY MJAHR = YEAR MBLNR = CCNUM.
  IF SY-SUBRC EQ 0.
    " write : / 'Closure of Change : '.
    IF WA_ZDMS4-CL1 EQ 'X'.
      " write : 'CLOSED'.
    ELSE.
      " write : 'OPEN'.
    ENDIF.
    " write : / 'Remark'.
    " write : / WA_ZDMS4-CL1TXT1,
*            /  WA_ZDMS4-CL1TXT2,
*            /  WA_ZDMS4-CL1TXT3.
    " write : / 'Close out Date',WA_ZDMS4-CL1DATE,'By'.
    SELECT SINGLE * FROM PA0001 WHERE PERNR EQ WA_ZDMS4-CL1PERNR AND ENDDA GE SY-DATUM.
    IF SY-SUBRC EQ 0.
      " write : PA0001-ENAME.
    ENDIF.
    " write : WA_ZDMS4-CL1DATE.
    " write : / 'Closure of Change is approved by : '.
    SELECT SINGLE * FROM PA0001 WHERE PERNR EQ WA_ZDMS4-QHCL1PERNR AND ENDDA GE SY-DATUM.
    IF SY-SUBRC EQ 0.
      " write : PA0001-ENAME.
    ENDIF.
    " write : WA_ZDMS4-QHCL1DATE.
  ENDIF.
  " uline.

  " write : / 'SECTION-VII: FOLLOW-UP ACTIVITIES (QA to arrange all dept. monitoring activities in sequence with target dates)'.
  SKIP.

  LOOP AT IT_ZDMS3 INTO WA_ZDMS3 WHERE FOLW1 EQ 'X'.
    " write : / WA_ZDMS3-ATEXT1.
    SELECT SINGLE * FROM T001P WHERE BTRTL EQ WA_ZDMS3-DEPT.
    IF SY-SUBRC EQ 0.
      " write : T001P-BTEXT.
    ENDIF.
    " write: WA_ZDMS3-TDATE1,WA_ZDMS3-REM1,WA_ZDMS3-CTDATE1.
    ON CHANGE OF WA_ZDMS3-DEPT.
      " uline.
    ENDON.
  ENDLOOP.
  PERFORM WRITE-1.
  PERFORM WRITE-2.
  PERFORM WRITE-3.
  PERFORM WRITE-4.
  PERFORM WRITE-5.
  PERFORM WRITE-6.
  PERFORM WRITE-7.
  PERFORM WRITE-43.
  PERFORM WRITE-44.
  PERFORM WRITE-45.

  CALL FUNCTION 'CONTROL_FORM'
    EXPORTING
      COMMAND = 'NEW-WINDOW'.
  PERFORM WRITE-50.
  PERFORM CLOSE-FORM.
ENDFORM.
*&---------------------------------------------------------------------*
*&      Form  OPEN-FORM
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM  OPEN-FORM.
  CALL FUNCTION 'OPEN_FORM'
    EXPORTING
*     APPLICATION                 = 'TX'
*     ARCHIVE_INDEX               =
*     ARCHIVE_PARAMS              =
*     DEVICE                      = 'PRINTER'
*     DIALOG                      = 'X'
      FORM                        = 'ZDMS1'
*     LANGUAGE                    = SY-LANGU
*     OPTIONS                     =
*     MAIL_SENDER                 =
*     MAIL_RECIPIENT              =
*     MAIL_APPL_OBJECT            =
*     RAW_DATA_INTERFACE          = '*'
*     SPONUMIV                    =
*   IMPORTING
*     LANGUAGE                    =
*     NEW_ARCHIVE_PARAMS          =
*     RESULT                      =
    EXCEPTIONS
      CANCELED                    = 1
      DEVICE                      = 2
      FORM                        = 3
      OPTIONS                     = 4
      UNCLOSED                    = 5
      MAIL_OPTIONS                = 6
      ARCHIVE_ERROR               = 7
      INVALID_FAX_NUMBER          = 8
      MORE_PARAMS_NEEDED_IN_BATCH = 9
      SPOOL_ERROR                 = 10
      CODEPAGE                    = 11
      OTHERS                      = 12.
  IF SY-SUBRC <> 0.
* MESSAGE ID SY-MSGID TYPE SY-MSGTY NUMBER SY-MSGNO
*         WITH SY-MSGV1 SY-MSGV2 SY-MSGV3 SY-MSGV4.
  ENDIF.
ENDFORM.
*&---------------------------------------------------------------------*
*&      Form  CLOSE-FORM
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM CLOSE-FORM.
  CALL FUNCTION 'CLOSE_FORM'
* IMPORTING
*   RESULT                         =
*   RDI_RESULT                     =
* TABLES
*   OTFDATA                        =
    EXCEPTIONS
      UNOPENED                 = 1
      BAD_PAGEFORMAT_FOR_PRINT = 2
      SEND_ERROR               = 3
      SPOOL_ERROR              = 4
      CODEPAGE                 = 5
      OTHERS                   = 6.
  IF SY-SUBRC <> 0.
* MESSAGE ID SY-MSGID TYPE SY-MSGTY NUMBER SY-MSGNO
*         WITH SY-MSGV1 SY-MSGV2 SY-MSGV3 SY-MSGV4.
  ENDIF.

ENDFORM.

FORM WRITE-1.
  CALL FUNCTION 'WRITE_FORM'
    EXPORTING
*     ELEMENT                  = 'TOP_LINE'
*     FUNCTION                 = 'SET'
*     TYPE                     = 'BODY'
      WINDOW                   = 'WINDOW1'
* IMPORTING
*     PENDING_LINES            =
    EXCEPTIONS
      ELEMENT                  = 1
      FUNCTION                 = 2
      TYPE                     = 3
      UNOPENED                 = 4
      UNSTARTED                = 5
      WINDOW                   = 6
      BAD_PAGEFORMAT_FOR_PRINT = 7
      SPOOL_ERROR              = 8
      CODEPAGE                 = 9
      OTHERS                   = 10.
  IF SY-SUBRC <> 0.
* MESSAGE ID SY-MSGID TYPE SY-MSGTY NUMBER SY-MSGNO
*         WITH SY-MSGV1 SY-MSGV2 SY-MSGV3 SY-MSGV4.
  ENDIF.

ENDFORM.
FORM WRITE-2.
  CALL FUNCTION 'WRITE_FORM'
    EXPORTING
*     ELEMENT                  = 'TOP_LINE'
*     FUNCTION                 = 'SET'
*     TYPE                     = 'BODY'
      WINDOW                   = 'WINDOW1'
* IMPORTING
*     PENDING_LINES            =
    EXCEPTIONS
      ELEMENT                  = 1
      FUNCTION                 = 2
      TYPE                     = 3
      UNOPENED                 = 4
      UNSTARTED                = 5
      WINDOW                   = 6
      BAD_PAGEFORMAT_FOR_PRINT = 7
      SPOOL_ERROR              = 8
      CODEPAGE                 = 9
      OTHERS                   = 10.
  IF SY-SUBRC <> 0.
* MESSAGE ID SY-MSGID TYPE SY-MSGTY NUMBER SY-MSGNO
*         WITH SY-MSGV1 SY-MSGV2 SY-MSGV3 SY-MSGV4.
  ENDIF.

ENDFORM.

FORM WRITE-3.
  CALL FUNCTION 'WRITE_FORM'
    EXPORTING
*     ELEMENT                  = 'TOP_LINE'
*     FUNCTION                 = 'SET'
*     TYPE                     = 'BODY'
      WINDOW                   = 'WINDOW3'
* IMPORTING
*     PENDING_LINES            =
    EXCEPTIONS
      ELEMENT                  = 1
      FUNCTION                 = 2
      TYPE                     = 3
      UNOPENED                 = 4
      UNSTARTED                = 5
      WINDOW                   = 6
      BAD_PAGEFORMAT_FOR_PRINT = 7
      SPOOL_ERROR              = 8
      CODEPAGE                 = 9
      OTHERS                   = 10.
  IF SY-SUBRC <> 0.
* MESSAGE ID SY-MSGID TYPE SY-MSGTY NUMBER SY-MSGNO
*         WITH SY-MSGV1 SY-MSGV2 SY-MSGV3 SY-MSGV4.
  ENDIF.

ENDFORM.



FORM WRITE-4.
  CALL FUNCTION 'WRITE_FORM'
    EXPORTING
*     ELEMENT                  = 'TOP_LINE'
*     FUNCTION                 = 'SET'
*     TYPE                     = 'BODY'
      WINDOW                   = 'WINDOW4'
* IMPORTING
*     PENDING_LINES            =
    EXCEPTIONS
      ELEMENT                  = 1
      FUNCTION                 = 2
      TYPE                     = 3
      UNOPENED                 = 4
      UNSTARTED                = 5
      WINDOW                   = 6
      BAD_PAGEFORMAT_FOR_PRINT = 7
      SPOOL_ERROR              = 8
      CODEPAGE                 = 9
      OTHERS                   = 10.
  IF SY-SUBRC <> 0.
* MESSAGE ID SY-MSGID TYPE SY-MSGTY NUMBER SY-MSGNO
*         WITH SY-MSGV1 SY-MSGV2 SY-MSGV3 SY-MSGV4.
  ENDIF.

ENDFORM.


FORM WRITE-5.
  CALL FUNCTION 'WRITE_FORM'
    EXPORTING
*     ELEMENT                  = 'TOP_LINE'
*     FUNCTION                 = 'SET'
*     TYPE                     = 'BODY'
      WINDOW                   = 'WINDOW5'
* IMPORTING
*     PENDING_LINES            =
    EXCEPTIONS
      ELEMENT                  = 1
      FUNCTION                 = 2
      TYPE                     = 3
      UNOPENED                 = 4
      UNSTARTED                = 5
      WINDOW                   = 6
      BAD_PAGEFORMAT_FOR_PRINT = 7
      SPOOL_ERROR              = 8
      CODEPAGE                 = 9
      OTHERS                   = 10.
  IF SY-SUBRC <> 0.
* MESSAGE ID SY-MSGID TYPE SY-MSGTY NUMBER SY-MSGNO
*         WITH SY-MSGV1 SY-MSGV2 SY-MSGV3 SY-MSGV4.
  ENDIF.

ENDFORM.



FORM WRITE-6.
  CALL FUNCTION 'WRITE_FORM'
    EXPORTING
*     ELEMENT                  = 'TOP_LINE'
*     FUNCTION                 = 'SET'
*     TYPE                     = 'BODY'
      WINDOW                   = 'WINDOW6'
* IMPORTING
*     PENDING_LINES            =
    EXCEPTIONS
      ELEMENT                  = 1
      FUNCTION                 = 2
      TYPE                     = 3
      UNOPENED                 = 4
      UNSTARTED                = 5
      WINDOW                   = 6
      BAD_PAGEFORMAT_FOR_PRINT = 7
      SPOOL_ERROR              = 8
      CODEPAGE                 = 9
      OTHERS                   = 10.
  IF SY-SUBRC <> 0.
* MESSAGE ID SY-MSGID TYPE SY-MSGTY NUMBER SY-MSGNO
*         WITH SY-MSGV1 SY-MSGV2 SY-MSGV3 SY-MSGV4.
  ENDIF.

ENDFORM.

FORM WRITE-7.
  CALL FUNCTION 'WRITE_FORM'
    EXPORTING
*     ELEMENT                  = 'TOP_LINE'
*     FUNCTION                 = 'SET'
*     TYPE                     = 'BODY'
      WINDOW                   = 'WINDOW7'
* IMPORTING
*     PENDING_LINES            =
    EXCEPTIONS
      ELEMENT                  = 1
      FUNCTION                 = 2
      TYPE                     = 3
      UNOPENED                 = 4
      UNSTARTED                = 5
      WINDOW                   = 6
      BAD_PAGEFORMAT_FOR_PRINT = 7
      SPOOL_ERROR              = 8
      CODEPAGE                 = 9
      OTHERS                   = 10.
  IF SY-SUBRC <> 0.
* MESSAGE ID SY-MSGID TYPE SY-MSGTY NUMBER SY-MSGNO
*         WITH SY-MSGV1 SY-MSGV2 SY-MSGV3 SY-MSGV4.
  ENDIF.

ENDFORM.


FORM WRITE-43.
  CALL FUNCTION 'WRITE_FORM'
    EXPORTING
*     ELEMENT                  = 'TOP_LINE'
*     FUNCTION                 = 'SET'
*     TYPE                     = 'BODY'
      WINDOW                   = 'WINDOW43'
* IMPORTING
*     PENDING_LINES            =
    EXCEPTIONS
      ELEMENT                  = 1
      FUNCTION                 = 2
      TYPE                     = 3
      UNOPENED                 = 4
      UNSTARTED                = 5
      WINDOW                   = 6
      BAD_PAGEFORMAT_FOR_PRINT = 7
      SPOOL_ERROR              = 8
      CODEPAGE                 = 9
      OTHERS                   = 10.
  IF SY-SUBRC <> 0.
* MESSAGE ID SY-MSGID TYPE SY-MSGTY NUMBER SY-MSGNO
*         WITH SY-MSGV1 SY-MSGV2 SY-MSGV3 SY-MSGV4.
  ENDIF.

ENDFORM.



FORM WRITE-44.
  CALL FUNCTION 'WRITE_FORM'
    EXPORTING
*     ELEMENT                  = 'TOP_LINE'
*     FUNCTION                 = 'SET'
*     TYPE                     = 'BODY'
      WINDOW                   = 'WINDOW44'
* IMPORTING
*     PENDING_LINES            =
    EXCEPTIONS
      ELEMENT                  = 1
      FUNCTION                 = 2
      TYPE                     = 3
      UNOPENED                 = 4
      UNSTARTED                = 5
      WINDOW                   = 6
      BAD_PAGEFORMAT_FOR_PRINT = 7
      SPOOL_ERROR              = 8
      CODEPAGE                 = 9
      OTHERS                   = 10.
  IF SY-SUBRC <> 0.
* MESSAGE ID SY-MSGID TYPE SY-MSGTY NUMBER SY-MSGNO
*         WITH SY-MSGV1 SY-MSGV2 SY-MSGV3 SY-MSGV4.
  ENDIF.

ENDFORM.


FORM WRITE-45.
  CALL FUNCTION 'WRITE_FORM'
    EXPORTING
*     ELEMENT                  = 'TOP_LINE'
*     FUNCTION                 = 'SET'
*     TYPE                     = 'BODY'
      WINDOW                   = 'WINDOW45'
* IMPORTING
*     PENDING_LINES            =
    EXCEPTIONS
      ELEMENT                  = 1
      FUNCTION                 = 2
      TYPE                     = 3
      UNOPENED                 = 4
      UNSTARTED                = 5
      WINDOW                   = 6
      BAD_PAGEFORMAT_FOR_PRINT = 7
      SPOOL_ERROR              = 8
      CODEPAGE                 = 9
      OTHERS                   = 10.
  IF SY-SUBRC <> 0.
* MESSAGE ID SY-MSGID TYPE SY-MSGTY NUMBER SY-MSGNO
*         WITH SY-MSGV1 SY-MSGV2 SY-MSGV3 SY-MSGV4.
  ENDIF.

ENDFORM.




FORM WRITE-50.
  CALL FUNCTION 'WRITE_FORM'
    EXPORTING
*     ELEMENT                  = 'TOP_LINE'
*     FUNCTION                 = 'SET'
*     TYPE                     = 'BODY'
      WINDOW                   = 'WINDOW50'
* IMPORTING
*     PENDING_LINES            =
    EXCEPTIONS
      ELEMENT                  = 1
      FUNCTION                 = 2
      TYPE                     = 3
      UNOPENED                 = 4
      UNSTARTED                = 5
      WINDOW                   = 6
      BAD_PAGEFORMAT_FOR_PRINT = 7
      SPOOL_ERROR              = 8
      CODEPAGE                 = 9
      OTHERS                   = 10.
  IF SY-SUBRC <> 0.
* MESSAGE ID SY-MSGID TYPE SY-MSGTY NUMBER SY-MSGNO
*         WITH SY-MSGV1 SY-MSGV2 SY-MSGV3 SY-MSGV4.
  ENDIF.

ENDFORM.
*&---------------------------------------------------------------------*
*&      Form  FOLWACT
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM FOLWACT .
  SELECT * FROM ZDMS1 INTO TABLE IT_ZDMS1 WHERE MBLNR EQ CCNUM AND MJAHR EQ YEAR.
  SELECT * FROM ZDMS2 INTO TABLE IT_ZDMS2 WHERE MBLNR EQ CCNUM AND MJAHR EQ YEAR.
  SELECT * FROM ZDMS3 INTO TABLE IT_ZDMS3 WHERE MBLNR EQ CCNUM AND MJAHR EQ YEAR.
  SELECT * FROM ZDMS4 INTO TABLE IT_ZDMS4 WHERE MBLNR EQ CCNUM AND MJAHR EQ YEAR.

  SELECT SINGLE * FROM ZDMS3 WHERE MBLNR EQ CCNUM AND MJAHR EQ YEAR AND FOLW1 NE SPACE AND CTDATE1 LE 0.
  IF SY-SUBRC EQ 4.
    MESSAGE 'NO PENDING LONG TERM ACTIVITY' TYPE 'E'.
  ENDIF.

  SELECT SINGLE * FROM ZDMS4 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM AND CL2 EQ 'X'.
  IF SY-SUBRC EQ 0.
    MESSAGE 'CLOSURE-II IS ALREDY DONE' TYPE 'E'.
  ENDIF.

  LOOP AT IT_ZDMS3 INTO WA_ZDMS3 WHERE FOLW1 EQ 'X' AND CTDATE1 LE 0.
*    WRITE : / 'FOLLOW-UP',WA_ZDMS3-MJAHR,WA_ZDMS3-MBLNR,WA_ZDMS3-DEPT,WA_ZDMS3-ZEILE,WA_ZDMS3-PERNR,WA_ZDMS3-ATEXT1,WA_ZDMS3-TDATE1,WA_ZDMS3-REM1,
*    WA_ZDMS3-CTDATE1,WA_ZDMS3-FOLW1.
    WA_TAB1-MJAHR = WA_ZDMS3-MJAHR.
    WA_TAB1-MBLNR = WA_ZDMS3-MBLNR.
    WA_TAB1-DEPT = WA_ZDMS3-DEPT.
    SELECT SINGLE * FROM T001P WHERE BTRTL EQ WA_ZDMS3-DEPT.
    IF SY-SUBRC EQ 0.
      WA_TAB1-BTEXT = T001P-BTEXT.
    ENDIF.
    WA_TAB1-ZEILE = WA_ZDMS3-ZEILE.
    WA_TAB1-BUDAT = WA_ZDMS3-BUDAT.
    WA_TAB1-PERNR = WA_ZDMS3-PERNR.
    WA_TAB1-ATEXT1 = WA_ZDMS3-ATEXT1.
    WA_TAB1-TDATE1 = WA_ZDMS3-TDATE1.
    WA_TAB1-REM1 = WA_ZDMS3-REM1.
    WA_TAB1-CTDATE1 = WA_ZDMS3-CTDATE1.
    WA_TAB1-FOLW1 = WA_ZDMS3-FOLW1.
    COLLECT WA_TAB1 INTO IT_TAB1.
    CLEAR WA_TAB1.
  ENDLOOP.

  SELECT SINGLE * FROM ZDMS4 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM AND CL1 EQ 'X' AND QHCL1 EQ 'X'.
  IF SY-SUBRC EQ 0.
*    IF zdms4-cl2 EQ 'X' OR zdms4-qhcl2 EQ 'X'.
*
**      WA_FIELDCAT-FIELDNAME = 'MJAHR'.
**      WA_FIELDCAT-SELTEXT_L = 'YEAR'.
**      APPEND WA_FIELDCAT TO FIELDCAT.
**      CLEAR WA_FIELDCAT.
**
**      WA_FIELDCAT-FIELDNAME = 'MBLNR'.
**      WA_FIELDCAT-SELTEXT_L = 'NOTIFICATION NO.'.
**      APPEND WA_FIELDCAT TO FIELDCAT.
**      CLEAR WA_FIELDCAT.
*
*      wa_fieldcat-fieldname = 'ATEXT1'.
*      wa_fieldcat-seltext_l = 'LONG TERM ACTIVITY'.
*      APPEND wa_fieldcat TO fieldcat.
*      CLEAR wa_fieldcat.
*
*      wa_fieldcat-fieldname = 'DEPT'.
*      wa_fieldcat-seltext_l = 'DEPT. CODE'.
*      APPEND wa_fieldcat TO fieldcat.
*      CLEAR wa_fieldcat.
*
*      wa_fieldcat-fieldname = 'BTEXT'.
*      wa_fieldcat-seltext_l = 'DEPARTMENT NAME'.
*      APPEND wa_fieldcat TO fieldcat.
*      CLEAR wa_fieldcat.
*
*      wa_fieldcat-fieldname = 'TDATE1'.
*      wa_fieldcat-seltext_l = 'TARGET DATE'.
*      APPEND wa_fieldcat TO fieldcat.
*      CLEAR wa_fieldcat.
*
**      WA_FIELDCAT-FIELDNAME = 'ZEILE'.
**      WA_FIELDCAT-SELTEXT_L = 'COUNT'.
**      APPEND WA_FIELDCAT TO FIELDCAT.
**      CLEAR WA_FIELDCAT.
*
**      WA_FIELDCAT-FIELDNAME = 'BUDAT'.
**      WA_FIELDCAT-SELTEXT_L = 'POSTING DATE'.
**      APPEND WA_FIELDCAT TO FIELDCAT.
**      CLEAR WA_FIELDCAT.
*
**      WA_FIELDCAT-FIELDNAME = 'PERNR'.
**      WA_FIELDCAT-SELTEXT_L = 'EMP. CODE'.
**      APPEND WA_FIELDCAT TO FIELDCAT.
**      CLEAR WA_FIELDCAT.
*
*
*
*
*
*      wa_fieldcat-fieldname = 'REM1'.
*      wa_fieldcat-seltext_l = 'REMARK'.
**  WA_FIELDCAT-EDIT = 'X'.
*      APPEND wa_fieldcat TO fieldcat.
*      CLEAR wa_fieldcat.
**
*      wa_fieldcat-fieldname = 'CTDATE1'.
*      wa_fieldcat-seltext_l = 'COMPLETION DATE'.
**  WA_FIELDCAT-EDIT = 'X'.
*      APPEND wa_fieldcat TO fieldcat.
*      CLEAR wa_fieldcat.
*      l_glay-edt_cll_cb = 'X'.
*
*      layout-zebra = 'X'.
*      layout-colwidth_optimize = 'X'.
*      layout-window_titlebar  = 'CLICK ON SAVE BUTTON TO UPDATE DATA'.
*      CALL FUNCTION 'REUSE_ALV_GRID_DISPLAY'
*        EXPORTING
**         I_INTERFACE_CHECK       = ' '
**         I_BYPASSING_BUFFER      = ' '
**         I_BUFFER_ACTIVE         = ' '
*          i_callback_program      = g_repid
**         I_CALLBACK_PF_STATUS_SET          = 'STATUS'
*          i_callback_user_command = 'USER_COMM'
*          i_callback_top_of_page  = 'TOP'
*          is_layout               = layout
*          it_fieldcat             = fieldcat
*          i_save                  = 'A'
*        TABLES
*          t_outtab                = it_tab1
*        EXCEPTIONS
*          program_error           = 1
*          OTHERS                  = 2.
*      IF sy-subrc <> 0.
** MESSAGE ID SY-MSGID TYPE SY-MSGTY NUMBER SY-MSGNO
**         WITH SY-MSGV1 SY-MSGV2 SY-MSGV3 SY-MSGV4.
*      ENDIF.
*      CLEAR : fieldcat,layout.
*
*    ELSE.

*      WA_FIELDCAT-FIELDNAME = 'MJAHR'.
*      WA_FIELDCAT-SELTEXT_L = 'YEAR'.
*      APPEND WA_FIELDCAT TO FIELDCAT.
*      CLEAR WA_FIELDCAT.
*
*      WA_FIELDCAT-FIELDNAME = 'MBLNR'.
*      WA_FIELDCAT-SELTEXT_L = 'NOTIFICATION NO.'.
*      APPEND WA_FIELDCAT TO FIELDCAT.
*      CLEAR WA_FIELDCAT.

    WA_FIELDCAT-FIELDNAME = 'ATEXT1'.
    WA_FIELDCAT-SELTEXT_L = 'LONG TERM ACTIVITY'.
    APPEND WA_FIELDCAT TO FIELDCAT.

    WA_FIELDCAT-FIELDNAME = 'DEPT'.
    WA_FIELDCAT-SELTEXT_L = 'DEPT CODE'.
    APPEND WA_FIELDCAT TO FIELDCAT.
    CLEAR WA_FIELDCAT.

    WA_FIELDCAT-FIELDNAME = 'BTEXT'.
    WA_FIELDCAT-SELTEXT_L = 'DEPARTMENT NAME'.
    APPEND WA_FIELDCAT TO FIELDCAT.
    CLEAR WA_FIELDCAT.

*      WA_FIELDCAT-FIELDNAME = 'ZEILE'.
*      WA_FIELDCAT-SELTEXT_L = 'COUNT'.
*      APPEND WA_FIELDCAT TO FIELDCAT.
*      CLEAR WA_FIELDCAT.
*
*      WA_FIELDCAT-FIELDNAME = 'BUDAT'.
*      WA_FIELDCAT-SELTEXT_L = 'POSTING DATE'.
*      APPEND WA_FIELDCAT TO FIELDCAT.
*      CLEAR WA_FIELDCAT.
*
*      WA_FIELDCAT-FIELDNAME = 'PERNR'.
*      WA_FIELDCAT-SELTEXT_L = 'EMP. CODE'.
*      APPEND WA_FIELDCAT TO FIELDCAT.
*      CLEAR WA_FIELDCAT.



    WA_FIELDCAT-FIELDNAME = 'TDATE1'.
    WA_FIELDCAT-SELTEXT_L = 'TARGET DATE'.
    APPEND WA_FIELDCAT TO FIELDCAT.
    CLEAR WA_FIELDCAT.

    WA_FIELDCAT-FIELDNAME = 'REM1'.
    WA_FIELDCAT-SELTEXT_L = 'REMARK'.
    WA_FIELDCAT-EDIT = 'X'.
    APPEND WA_FIELDCAT TO FIELDCAT.
    CLEAR WA_FIELDCAT.
*
    WA_FIELDCAT-FIELDNAME = 'CTDATE1'.
    WA_FIELDCAT-SELTEXT_L = 'COMPLETION DATE'.
    WA_FIELDCAT-EDIT = 'X'.
    APPEND WA_FIELDCAT TO FIELDCAT.
    CLEAR WA_FIELDCAT.
    L_GLAY-EDT_CLL_CB = 'X'.

    LAYOUT-ZEBRA = 'X'.
    LAYOUT-COLWIDTH_OPTIMIZE = 'X'.
    LAYOUT-WINDOW_TITLEBAR  = 'CLICK ON SAVE BUTTON TO UPDATE DATA'.
    CALL FUNCTION 'REUSE_ALV_GRID_DISPLAY'
      EXPORTING
*       I_INTERFACE_CHECK       = ' '
*       I_BYPASSING_BUFFER      = ' '
*       I_BUFFER_ACTIVE         = ' '
        I_CALLBACK_PROGRAM      = G_REPID
*       I_CALLBACK_PF_STATUS_SET          = 'STATUS'
        I_CALLBACK_USER_COMMAND = 'USER_COMM'
        I_CALLBACK_TOP_OF_PAGE  = 'TOP'
        IS_LAYOUT               = LAYOUT
        IT_FIELDCAT             = FIELDCAT
        I_SAVE                  = 'A'
      TABLES
        T_OUTTAB                = IT_TAB1
      EXCEPTIONS
        PROGRAM_ERROR           = 1
        OTHERS                  = 2.
    IF SY-SUBRC <> 0.
* MESSAGE ID SY-MSGID TYPE SY-MSGTY NUMBER SY-MSGNO
*         WITH SY-MSGV1 SY-MSGV2 SY-MSGV3 SY-MSGV4.
    ENDIF.
    CLEAR : FIELDCAT,LAYOUT.

*    ENDIF.
  ENDIF.
ENDFORM.

FORM USER_COMM USING UCOMM LIKE SY-UCOMM SELFIELD TYPE SLIS_SELFIELD.

  CASE SY-UCOMM. "SELFIELD-FIELDNAME.
    WHEN '&DATA_SAVE'.
      PERFORM FOLWUPD.
    WHEN 'BACK'.
      LEAVE TO TRANSACTION 'ZQMS'.
    WHEN OTHERS.
      LEAVE TO TRANSACTION 'ZQMS'.
  ENDCASE.
  EXIT.
ENDFORM.                    "USER_COMM

FORM USER_COMM1 USING UCOMM LIKE SY-UCOMM SELFIELD TYPE SLIS_SELFIELD.

  CASE SY-UCOMM. "SELFIELD-FIELDNAME.
*      loop at it_tab5 into wa_tab5 WHERE nsampqty ne 0 AND chk ne 'X'.
*        MESSAGE 'TICK THE CHECKBOX TO SAVE DATA' TYPE 'E'.
*      ENDLOOP.
*      BREAK-POINT.
    WHEN '&DATA_SAVE'.
      IF R7A EQ 'X'.
        PERFORM TENTATIVECLUPD.
      ELSE.
        PERFORM SETFOLWUPD.
      ENDIF.
    WHEN OTHERS.
*      LEAVE TO TRANSACTION 'ZQMS'.
      LEAVE TO SCREEN 0.
  ENDCASE.
  EXIT.
ENDFORM.                    "USER_COMM

FORM USER_COMM2 USING UCOMM LIKE SY-UCOMM SELFIELD TYPE SLIS_SELFIELD.

  CASE SY-UCOMM. "SELFIELD-FIELDNAME.
*      loop at it_tab5 into wa_tab5 WHERE nsampqty ne 0 AND chk ne 'X'.
*        MESSAGE 'TICK THE CHECKBOX TO SAVE DATA' TYPE 'E'.
*      ENDLOOP.
*      BREAK-POINT.
    WHEN '&DATA_SAVE'.
      PERFORM SETDEPTUPD.
    WHEN OTHERS.
*      LEAVE TO TRANSACTION 'ZQMS'.
      LEAVE TO SCREEN 0.
  ENDCASE.
  EXIT.
ENDFORM.                    "USER_COMM

FORM USER_COMM3 USING UCOMM LIKE SY-UCOMM SELFIELD TYPE SLIS_SELFIELD.
*  BREAK-POINT.
  CASE SY-UCOMM. "SELFIELD-FIELDNAME.
*      loop at it_tab5 into wa_tab5 WHERE nsampqty ne 0 AND chk ne 'X'.
*        MESSAGE 'TICK THE CHECKBOX TO SAVE DATA' TYPE 'E'.
*      ENDLOOP.
*      BREAK-POINT.
    WHEN '&DATA_SAVE'.
      PERFORM SENDEMAIL.
    WHEN OTHERS.
      LEAVE TO TRANSACTION 'ZQMS'.
  ENDCASE.
  EXIT.
ENDFORM.                    "USER_COMM


FORM USER_COMM4 USING UCOMM LIKE SY-UCOMM SELFIELD TYPE SLIS_SELFIELD.

  CASE SY-UCOMM. "SELFIELD-FIELDNAME.
*      loop at it_tab5 into wa_tab5 WHERE nsampqty ne 0 AND chk ne 'X'.
*        MESSAGE 'TICK THE CHECKBOX TO SAVE DATA' TYPE 'E'.
*      ENDLOOP.
*      BREAK-POINT.
    WHEN '&DATA_SAVE'.
      PERFORM QADEPTUPD.
    WHEN OTHERS.
*      LEAVE TO TRANSACTION 'ZQMS'.
      LEAVE TO SCREEN 0.
  ENDCASE.
  EXIT.
ENDFORM.

*&---------------------------------------------------------------------*
*&      Form  FOLWUPD
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM FOLWUPD .
  CLEAR ERR.

*  error checking*****************

  LOOP AT IT_TAB1 INTO WA_TAB1.
    IF STRLEN( WA_TAB1-ATEXT1 ) GT 100.
      MESSAGE 'LONG TERM ACTIVITY IS GREATER THAN 50 CHARACTER' TYPE 'E'.
      ERR = 1.
*      EXIT.
    ENDIF.

    IF STRLEN( WA_TAB1-REM1 ) GT 50.
      MESSAGE 'REMARK IS GREATER THAN 50 CHARACTER' TYPE 'E'.
      ERR = 1.
*      EXIT.
    ENDIF.
    IF WA_TAB1-CTDATE1 NE '00000000'.
      IF WA_TAB1-CTDATE1 GT SY-DATUM.
        MESSAGE 'FUTURE DATE CAN NOT BE ENTERD' TYPE 'E'.
        ERR = 1.
      ENDIF.
      SELECT SINGLE * FROM ZDMS1 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM.
      IF SY-SUBRC EQ 0.
        IF WA_TAB1-CTDATE1 LT ZDMS1-BUDAT.
          MESSAGE 'COMPLETION DATE CAN''T BE AFTER INITIATION DATE' TYPE 'E'.
          ERR = 1.
        ENDIF.
      ENDIF.
    ENDIF.
  ENDLOOP.

  IF ERR NE 1.
    CLEAR : ZDMS3_WA.
    LOOP AT IT_TAB1 INTO WA_TAB1 WHERE CTDATE1 GT 0.
      SELECT SINGLE * FROM ZDMS1 WHERE MJAHR EQ WA_TAB1-MJAHR AND MBLNR EQ WA_TAB1-MBLNR .
      IF SY-SUBRC EQ 0.
        SELECT SINGLE * FROM ZDMS3 WHERE MJAHR EQ WA_TAB1-MJAHR AND MBLNR EQ WA_TAB1-MBLNR AND DEPT EQ WA_TAB1-DEPT AND ZEILE EQ WA_TAB1-ZEILE AND CTDATE1 LE 0.
        IF SY-SUBRC EQ 0.
          MOVE-CORRESPONDING ZDMS3 TO ZDMS3_WA.
*      zdms3_wa-mjahr = wa_tab1-mjahr.
*      zdms3_wa-mblnr = wa_tab1-mblnr.
*      zdms3_wa-dept = wa_tab1-dept.
*      zdms3_wa-zeile = wa_tab1-zeile.
*      zdms3_wa-budat = wa_tab1-budat.
*      zdms3_wa-pernr = wa_tab1-pernr.
*      zdms3_wa-atext1 = wa_tab1-atext1.
*      zdms3_wa-tdate1 = wa_tab1-tdate1.
*      zdms3_wa-rem1 = wa_tab1-rem1.
          ZDMS3_WA-CTDATE1 = WA_TAB1-CTDATE1.
          ZDMS3_WA-CTUZEIT = SY-UZEIT.
          ZDMS3_WA-CTCPUDT = SY-DATUM.
          ZDMS3_WA-CTUNAME = SY-UNAME.
          ZDMS3_WA-CTPERNR = PERNR.
          UPDATE ZDMS3 FROM ZDMS3_WA.
          CLEAR ZDMS3_WA.
        ENDIF.
      ENDIF.
    ENDLOOP.
    MESSAGE 'DATA UPDATED' TYPE 'I'.

  ENDIF.

*  LEAVE TO TRANSACTION 'ZQMS'.
  LEAVE TO SCREEN 0.
ENDFORM.

FORM TOP.

*-----------> Added by Karthik on 30.09.2019

  PERFORM ACTIVATE_DMS_GOS_DISP. " To activate DMS GOS on Follow-up Activity ALV output

*-----------> End of Addition

  DATA: COMMENT    TYPE SLIS_T_LISTHEADER,
        WA_COMMENT LIKE LINE OF COMMENT.

  WA_COMMENT-TYP = 'A'.
  WA_COMMENT-INFO+0(25) = 'Notification No. & Year: '.
  WA_COMMENT-INFO+27(10) = CCNUM.
  WA_COMMENT-INFO+39(1) = ','.
  WA_COMMENT-INFO+40(4) = YEAR.
  APPEND WA_COMMENT TO COMMENT.

  WA_COMMENT-INFO+0(25) = 'Change Control No.'.
  WA_COMMENT-INFO+27(20) = CHGNUM.
  APPEND WA_COMMENT TO COMMENT.
  CLEAR WA_COMMENT.

  CALL FUNCTION 'REUSE_ALV_COMMENTARY_WRITE'
    EXPORTING
      IT_LIST_COMMENTARY = COMMENT.
*     I_LOGO                   = 'ENJOYSAP_LOGO'
*     I_END_OF_LIST_GRID       =
*     I_ALV_FORM               =
  CLEAR COMMENT.
ENDFORM.                    "TOP
*&---------------------------------------------------------------------*
*&      Form  SEARCHHELP
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM SEARCHHELP .
*  clear : authplant,cqd.
*  select single * from zpassw where pernr eq pernr .
*  if sy-subrc eq 0.
*    authplant = zpassw-werks.
*    if zpassw-cqd eq 'X'.
*      cqd = 'X'.
*    endif.
*  endif.


  SELECT * FROM ZDMS1 INTO TABLE IT_ZDMS1 WHERE MJAHR EQ SY-DATUM+0(4).
  LOOP AT IT_ZDMS1 INTO WA_ZDMS1.
    WA_TAS1-MJAHR = WA_ZDMS1-MJAHR.
    WA_TAS1-MBLNR = WA_ZDMS1-MBLNR.
    WA_TAS1-PERNR = WA_ZDMS1-PERNR.
    SELECT SINGLE * FROM PA0001 WHERE PERNR EQ WA_ZDMS1-PERNR AND ENDDA GE SY-DATUM.
    IF SY-SUBRC EQ 0.
      WA_TAS1-ENAME = PA0001-ENAME.
    ENDIF.
    WA_TAS1-DEPTAPR = WA_ZDMS1-APPROVE.
    WA_TAS1-DEPTREJ = WA_ZDMS1-REJECT.
    SELECT SINGLE * FROM ZDMS4 WHERE MJAHR EQ WA_ZDMS1-MJAHR AND MBLNR EQ WA_ZDMS1-MBLNR.
    IF SY-SUBRC EQ 0.
      WA_TAS1-CCNUMB1 = ZDMS4-CCNUMB1.
    ENDIF.
    COLLECT WA_TAS1 INTO IT_TAS1.
    CLEAR WA_TAS1.
  ENDLOOP.

  LOOP AT IT_TAS1 INTO WA_TAS1.
    ZDMSSEARCH1_WA-MJAHR = WA_TAS1-MJAHR.
    ZDMSSEARCH1_WA-MBLNR = WA_TAS1-MBLNR.
    ZDMSSEARCH1_WA-PERNR = WA_TAS1-PERNR.
    ZDMSSEARCH1_WA-ENAME = WA_TAS1-ENAME.
    ZDMSSEARCH1_WA-APPROVE = WA_TAS1-DEPTAPR.
    ZDMSSEARCH1_WA-REJECT = WA_TAS1-DEPTREJ.
    ZDMSSEARCH1_WA-CCNUMB1 = WA_TAS1-CCNUMB1.
    MODIFY ZDMSSEARCH1 FROM ZDMSSEARCH1_WA.
    CLEAR ZDMSSEARCH1_WA.
  ENDLOOP.

ENDFORM.
*&---------------------------------------------------------------------*
*&      Module  STATUS_9009  OUTPUT
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
MODULE STATUS_9009 OUTPUT.
  SET PF-STATUS 'STATUS'.
  SET TITLEBAR 'TITLE'.
*  BREAK-POINT.



*  SELECT SINGLE * FROM PA0001 WHERE PERNR EQ PERNR AND ENDDA GE SY-DATUM AND PLANS NE '99999999'.
  SELECT SINGLE * FROM ZPA0001 WHERE PERNR EQ PERNR AND ENDDA GE SY-DATUM.  " AND PLANS NE '99999999'.
  IF SY-SUBRC EQ 0.
*    IMPDEPT = PA0001-BTRTL.
    IMPDEPT = ZPA0001-BTRTL.
  ENDIF.
  YEAR = SY-DATUM+0(4).
  CLEAR : CHGNUM.
  SELECT SINGLE * FROM ZDMS4 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM.
  IF SY-SUBRC EQ 0.
    CHGNUM = ZDMS4-CCNUMB1.
  ENDIF.
  CASE OK.
*BREAK-POINT.
    WHEN 'BACK'.
      LEAVE TO SCREEN 0.
  ENDCASE.
ENDMODULE.
*&---------------------------------------------------------------------*
*&      Module  USER_COMMAND_9009  INPUT
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
MODULE USER_COMMAND_9009 INPUT.
*  BREAK-POINT.
  CASE OK.

    WHEN 'SAVE'.
      UNPACK CCNUM TO CCNUM.
******************PLANT AUTHORIZATION CHECKING**********************
*      if plant is initial.
*        message 'ENTER PLANT CODE' type 'I'.
*        exit.
*      endif.


      IF R1 EQ 'X'.

        IF PLANT EQ '1000' OR PLANT EQ '1001' OR PLANT EQ '3000' OR PLANT EQ '4000'.
        ELSE.
          MESSAGE 'ENTER VALID PLANT' TYPE 'I'.
          EXIT.
        ENDIF.

********** allow r&d 1224 & 1230 for 4000 plant***************  "15.9.20
        CLEAR : RNDDEPT.
*        SELECT SINGLE * FROM PA0001 WHERE PERNR EQ PERNR AND ENDDA GT SY-DATUM AND PLANS NE '99999999'.
        SELECT SINGLE * FROM ZPA0001 WHERE PERNR EQ PERNR AND ENDDA GT SY-DATUM. " AND PLANS NE '99999999'.
        IF SY-SUBRC EQ 0.
*          RNDDEPT = PA0001-BTRTL.
          RNDDEPT = ZPA0001-BTRTL.
        ENDIF.

        IF PLANT EQ '4000'.
          IF CQD EQ 'X'.
          ELSEIF RNDDEPT EQ '1224' OR RNDDEPT EQ '1230'.
          ELSEIF PERNR EQ '00015731' OR PERNR EQ '000012031'.  "30.1.22  "12031 added on 12.2.23
          ELSEIF PERNR EQ '00011406' OR PERNR EQ '00016805'.  "7.3.22

          ELSE.
            MESSAGE '4000 PLANT IS ALLOWED FOR CQD DEPATYMENT ONLY' TYPE 'E'.
            EXIT.
          ENDIF.
        ENDIF.

        IF AUTHPLANT NE SPACE.
          IF AUTHPLANT NE PLANT.
            MESSAGE 'YOU ARE NOT AUTHORISED TO CREATE CC FOR THIS PLANT DETAILS' TYPE 'E'.
            EXIT.
          ENDIF.
        ENDIF.
      ELSE.
*        if plant is not initial.
*          message 'REMOVE PLANT CODE' type 'I'.
*          exit.
*        endif.
        SELECT SINGLE * FROM ZDMS1 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM.
        IF SY-SUBRC EQ 0.
          CLEAR : BTRTL.
*          SELECT SINGLE * FROM PA0001 WHERE PERNR EQ PERNR AND ENDDA GE SY-DATUM.
          SELECT SINGLE * FROM ZPA0001 WHERE PERNR EQ PERNR AND ENDDA GE SY-DATUM.
          IF SY-SUBRC EQ 0.
*            BTRTL = PA0001-BTRTL.
            BTRTL = ZPA0001-BTRTL.
          ENDIF.

          IF PLANT IS INITIAL.
            PLANT = ZDMS1-WERKS.
          ENDIF.
          IF PLANT IS NOT INITIAL.
            IF ZDMS1-WERKS NE PLANT.
              MESSAGE 'CHECK PLANT CODE' TYPE 'E'.
            ENDIF.
          ENDIF.
          IF R3 NE 'X'.
*            if r13 eq 'X'.
*
*              if zdms1-werks eq '1000' and btrtl eq '1228'.
*              elseif zdms1-werks eq '1001' and btrtl eq '1328'.
*              elseif zdms1-werks eq '3000' and btrtl eq '1232'.
*              elseif zdms1-werks eq '4000' and btrtl eq '1232'.
*              else.
*                message 'YOU ARE NOT AUTHORISED TO AMEND ATTACHMENTS' type 'E'.
*                exit.
*              endif.
*            else.
            IF AUTHPLANT NE SPACE.
              IF PLANT EQ '4000'.
              ELSE.
                IF AUTHPLANT NE PLANT.
                  IF BTRTL NE '1232'.
                    SELECT SINGLE * FROM ZDMS2 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM AND DEPT EQ BTRTL.
                    IF SY-SUBRC NE 0.
                      MESSAGE 'YOU ARE NOT AUTHORISED TO VIEW THIS PLANT DETAILS' TYPE 'E'.
                      EXIT.
                    ENDIF.
                  ENDIF.
                ENDIF.
              ENDIF.
            ENDIF.
*            endif.
          ENDIF.
        ENDIF.
      ENDIF.
******************************************

      IF CC1  EQ 'X' AND R1 EQ 'X'.

        IF PERNR IS  INITIAL.
          MESSAGE 'ENTER EMPLOYEE CODE NUMBER' TYPE 'E'.
        ENDIF.
        IF CCNUM NE '0000000000'.
          MESSAGE 'REMOVE NOTIFICATION NUMBER' TYPE 'E'.
        ENDIF.
        IF PLANT EQ SPACE.
          MESSAGE 'ENTER PLANT FOR WHICH YOU WANT TO CREATE CHANGE CONTROL' TYPE 'E'.
        ENDIF.

****************************************************************
*        clear : vbeln,finv.
*        select * from zdms1 into table it_zdms1 where mjahr eq year.
*        sort it_zdms1 descending by mblnr.
*        read table it_zdms1 into wa_zdms1 with key mjahr = year werks = plant.
*        if sy-subrc eq 0.
**          break-point.
*          if plant eq '1000'.
*            if wa_zdms1-mblnr lt 10000.
*              vbeln = 10000.
*            else.
*              vbeln = wa_zdms1-mblnr.
*            endif.
*          elseif plant eq '1001'.
*            if wa_zdms1-mblnr lt 20000.
*              vbeln = 20000.
*            else.
*              vbeln = wa_zdms1-mblnr.
*            endif.
*          else.
**            if PLANT eq '3000'.
*            if wa_zdms1-mblnr lt 30000.
*              vbeln = 30000.
*            else.
*              vbeln = wa_zdms1-mblnr.
*            endif.
*          endif.
*        else.
*          if werks eq '1000'.
*            vbeln = 10000.
*          elseif werks eq '1001'.
*            vbeln = 20000.
*          elseif werks eq '3000'.
*            vbeln = 30000.
*          endif.
*        endif.
*        finv = vbeln + 1.

************************************************************

****************lock******************  28.8.2019
*        clear : ffmblnr.
*        ffmblnr = finv.
*
*        call function 'ENQUEUE_EZDMS'  "15.12.2019
*          exporting
*            mode_t001w     = 'E'
*            mandt          = sy-mandt
*            werks          = plant
**           X_WERKS        = ' '
**           _SCOPE         = '2'
**           _WAIT          = ' '
**           _COLLECT       = ' '
*          exceptions
*            foreign_lock   = 1
*            system_failure = 2
*            others         = 3.
*        if sy-subrc <> 0.
** Implement suitable error handling here
*        endif.
*
**        call function 'ENQUEUE_EZDMS1'
**          exporting
**            mode_zdms1     = 'E'
**            mandt          = sy-mandt
**            mjahr          = year
**            mblnr          = ffmblnr
***           werks          = plant
***           X_MJAHR        = ' '
***           X_MBLNR        = ' '
***           _SCOPE         = '2'
***           _WAIT          = ' '
***           _COLLECT       = ' '
**          exceptions
**            foreign_lock   = 1
**            system_failure = 2
**            others         = 3.
**        if sy-subrc <> 0.
*** Implement suitable error handling here
**        endif.
*
*        case sy-subrc.
*          when 1.
**            message e184(bctrain) with 'OTHER USER ALREADY PROCESSING, PLZ TRY AFTER SOME TIME' .
**            MESSAGE 'OTHER USER ALREADY PROCESSING, PLZ TRY AFTER SOME TIME' TYPE 'E'.
*            message e000(0u) with sy-msgv1.
*          when 2.
*            message e184(bctrain) with 'system failure'.
*          when 0.
**            message i184(bctrain) with 'success'.
*          when others.
*            message e184(bctrain) with 'others'.
*        endcase.


        SELECT SINGLE * FROM PA0001 WHERE PERNR EQ PERNR AND ENDDA GE SY-DATUM AND PLANS NE '99999999'.
             IF SY-SUBRC EQ 0.
          ENAME = PA0001-ENAME.
          endif.
        SELECT SINGLE * FROM ZPA0001 WHERE PERNR EQ PERNR AND ENDDA GE SY-DATUM . "AND PLANS NE '99999999'.
        IF SY-SUBRC EQ 0.
*          ENAME = PA0001-ENAME.
          SELECT SINGLE * FROM T001P WHERE BTRTL EQ ZPA0001-BTRTL.
          IF SY-SUBRC EQ 0.
            DEPT = T001P-BTEXT.
          ENDIF.
        ENDIF.
        IF R33 EQ 'X'.
          PERFORM PRINT.
        ENDIF.
        CALL SCREEN 9001.

**        call function 'DEQUEUE_EZDMS1'
**          exporting
**            mode_zdms1 = 'E'
**            mandt      = sy-mandt
**            mjahr      = year
**            mblnr      = ffmblnr
***           werks      = plant
***           X_MJAHR    = ' '
***           X_MBLNR    = ' '
***           _SCOPE     = '3'
***           _SYNCHRON  = ' '
***           _COLLECT   = ' '
**          .
*        call function 'DEQUEUE_EZDMS'
*          exporting
*            mode_t001w = 'E'
*            mandt      = sy-mandt
*            werks      = plant
**           X_WERKS    = ' '
**           _SCOPE     = '3'
**           _SYNCHRON  = ' '
**           _COLLECT   = ' '.
*          .

        CLEAR OK.

      ELSEIF CC1  EQ 'X' AND R2 EQ 'X' OR R1C EQ 'X' OR R21A EQ 'X' OR R21 EQ 'X' OR R4A EQ 'X'.

*********************************************

        CALL FUNCTION 'ENQUEUE_EZDMS1'
          EXPORTING
            MODE_ZDMS1     = 'E'
            MANDT          = SY-MANDT
            MJAHR          = YEAR
            MBLNR          = CCNUM
*           X_MJAHR        = ' '
*           X_MBLNR        = ' '
*           _SCOPE         = '2'
*           _WAIT          = ' '
*           _COLLECT       = ' '
          EXCEPTIONS
            FOREIGN_LOCK   = 1
            SYSTEM_FAILURE = 2
            OTHERS         = 3.
        IF SY-SUBRC <> 0.
* Implement suitable error handling here
        ENDIF.

        CASE SY-SUBRC.
          WHEN 1.
*            message e184(bctrain) with 'OTHER USER ALREADY PROCESSING, PLZ TRY AFTER SOME TIME' .
*            MESSAGE 'OTHER USER ALREADY PROCESSING, PLZ TRY AFTER SOME TIME' TYPE 'E'.
            MESSAGE E000(0U) WITH SY-MSGV1.
          WHEN 2.
            MESSAGE E184(BCTRAIN) WITH 'system failure'.
          WHEN 0.
*            message i184(bctrain) with 'success'.
          WHEN OTHERS.
            MESSAGE E184(BCTRAIN) WITH 'others'.
        ENDCASE.

***********************************************

        SELECT SINGLE * FROM ZDMS1 WHERE MBLNR EQ CCNUM AND MJAHR EQ YEAR.
        IF SY-SUBRC NE 0.
          MESSAGE 'INVALID NUMBER' TYPE 'I'.
          EXIT.
        ENDIF.
        IF PERNR IS  INITIAL.
          MESSAGE 'ENTER EMPLOYEE CODE NUMBER' TYPE 'E'.
        ENDIF.
        IF CCNUM IS  INITIAL.
          MESSAGE 'ENTER CHANGE CONTROL NUMBER' TYPE 'E'.
        ENDIF.
        IF YEAR IS  INITIAL.
          MESSAGE 'ENTER CHANGE CONTROL YEAR' TYPE 'E'.
        ENDIF.
        IF R4A EQ 'X'.
          PERFORM DEPTQA.
        ENDIF.
*    PERFORM PASSW.
        SELECT * FROM ZDMS1 INTO TABLE IT_ZDMS1 WHERE MBLNR EQ CCNUM AND MJAHR EQ YEAR.
        CALL SCREEN 9001.
        CLEAR OK.
*        if r2 eq 'X'. "15.12.2019
*          select single * from zdms2 where mjahr eq year and mblnr eq ccnum.
*          if sy-subrc ne 0.
*            zdms2_wa-mjahr = year.
*            zdms2_wa-mblnr = ccnum.
*            select single * from pa0001 where pernr eq pernr and endda ge sy-datum.
*            if sy-subrc eq 0.
*              zdms2_wa-dept = pa0001-btrtl.
*            endif.
*            zdms2_wa-ebudat = sy-datum.
*            zdms2_wa-epernr = pernr.
*            insert zdms2 from zdms2_wa.
*            clear : zdms2_wa.
*          endif.
*        endif.
************************
        CALL FUNCTION 'DEQUEUE_EZDMS1'
          EXPORTING
            MODE_ZDMS1 = 'E'
            MANDT      = SY-MANDT
            MJAHR      = YEAR
            MBLNR      = CCNUM
*           X_MJAHR    = ' '
*           X_MBLNR    = ' '
*           _SCOPE     = '3'
*           _SYNCHRON  = ' '
*           _COLLECT   = ' '
          .

**************************

      ELSEIF CC1  EQ 'X' AND R4 EQ 'X'.
        SELECT SINGLE * FROM ZDMS1 WHERE MBLNR EQ CCNUM AND MJAHR EQ YEAR.
        IF SY-SUBRC NE 0.
          MESSAGE 'INVALID NUMBER' TYPE 'I'.
          EXIT.
        ENDIF.
        IF CCNUM IS  INITIAL.
          MESSAGE 'ENTER CHANGE CONTROL NUMBER' TYPE 'E'.
        ENDIF.
        IF YEAR IS  INITIAL.
          MESSAGE 'ENTER CHANGE CONTROL YEAR' TYPE 'E'.
        ENDIF.
        SELECT SINGLE * FROM ZDMS1 WHERE MBLNR EQ CCNUM AND MJAHR EQ YEAR.
        IF SY-SUBRC EQ 0 AND ZDMS1-APPROVE NE 'X'.
          MESSAGE 'NOTIFICATION NO. IS NOT APPROVED BY DEPT. HEAD' TYPE 'E'.
        ENDIF.
        SELECT SINGLE * FROM ZDMS1 WHERE MBLNR EQ CCNUM AND MJAHR EQ YEAR.
        IF SY-SUBRC EQ 0 AND ZDMS1-QAPPROVE1 NE 'X'.
          MESSAGE 'NOTIFICATION NO. IS NOT ACCEPTED BY QA/ CQD' TYPE 'E'.
        ENDIF.
        SELECT * FROM ZDMS1 INTO TABLE IT_ZDMS1 WHERE MBLNR EQ CCNUM AND MJAHR EQ YEAR.
        SELECT * FROM ZDMS2 INTO TABLE IT_ZDMS2 WHERE MBLNR EQ CCNUM AND MJAHR EQ YEAR .
*    PERFORM REJECTION.
*        CALL SCREEN 9001.
        PERFORM CHECKAPPROVAL.
        PERFORM DEPTQA.
        PERFORM SELECTDEPT.
        CLEAR OK.

      ELSEIF CC1  EQ 'X' AND R3 EQ 'X' .
        SELECT SINGLE * FROM ZDMS1 WHERE MBLNR EQ CCNUM AND MJAHR EQ YEAR.
        IF SY-SUBRC NE 0.
          MESSAGE 'INVALID NUMBER' TYPE 'I'.
          EXIT.
        ENDIF.
        SELECT SINGLE * FROM ZDMS1 WHERE MBLNR EQ CCNUM AND MJAHR EQ YEAR .
        IF SY-SUBRC EQ 0.
          IF ZDMS1-APPROVE NE 'X'.
            MESSAGE 'CHANGE NOT YET APPROVED BY DEPT. HEAD' TYPE 'I'.
*            exit.
          ENDIF.
        ENDIF.
        IF CCNUM IS  INITIAL.
          MESSAGE 'ENTER CHANGE CONTROL NUMBER' TYPE 'E'.
        ENDIF.
        IF YEAR IS  INITIAL.
          MESSAGE 'ENTER CHANGE CONTROL YEAR' TYPE 'E'.
        ENDIF.
        SELECT * FROM ZDMS1 INTO TABLE IT_ZDMS1 WHERE MBLNR EQ CCNUM AND MJAHR EQ YEAR.
*        PERFORM DEPTCHK.
        SELECT * FROM ZDMS2 INTO TABLE IT_ZDMS2 WHERE MBLNR EQ CCNUM AND MJAHR EQ YEAR.
        SELECT SINGLE * FROM PA0001 WHERE PERNR EQ PERNR AND ENDDA GE SY-DATUM AND PLANS NE '99999999'.
        IF SY-SUBRC NE 0.
          MESSAGE 'INVALID USER' TYPE 'E'.
          EXIT.
        ENDIF.

*        PERFORM REJECTION.
        CALL SCREEN 9004.
        CLEAR OK.
      ELSEIF CC1  EQ 'X' AND ( R31 EQ 'X' OR R32 EQ 'X' OR R33 EQ 'X' ).
*        BREAK-POINT.
*        BREAK-POINT.
        CLEAR : TCL1.
        SELECT SINGLE * FROM ZDMS1 WHERE MBLNR EQ CCNUM AND MJAHR EQ YEAR.
        IF SY-SUBRC NE 0.
          MESSAGE 'INVALID NUMBER' TYPE 'I'.
          EXIT.
        ENDIF.
        SELECT SINGLE * FROM ZDMS1 WHERE MBLNR EQ CCNUM AND MJAHR EQ YEAR .  "10.8.21
        IF SY-SUBRC EQ 0.
          IF R32 EQ 'X'.
            IF ZDMS1-BUDAT GE '20210810'.  "check tentative closure date
              SELECT SINGLE * FROM ZDMS4 WHERE MBLNR EQ CCNUM AND MJAHR EQ YEAR .
              IF SY-SUBRC EQ 0.
                IF ZDMS4-TCLOSEDT EQ SPACE OR ZDMS4-TCLOSEDT EQ 0.
                  TCL1 = 1.
                ENDIF.
              ENDIF.
              IF TCL1 EQ 1.
                MESSAGE 'ENTER TENTATIVE CLOSUTE DATE' TYPE 'E'.
              ENDIF.
            ENDIF.
          ENDIF.
          IF ZDMS1-APPROVE NE 'X'.
            MESSAGE 'CHANGE NOT YET APPROVED BY DEPT. HEAD' TYPE 'I'.
            EXIT.
          ENDIF.
***************** check approval*********************************
*          SELECT SINGLE * FROM PA0001 WHERE PERNR EQ ZDMS1-PERNR AND ENDDA GT SY-DATUM.
          SELECT SINGLE * FROM ZPA0001 WHERE PERNR EQ ZDMS1-PERNR AND ENDDA GT SY-DATUM.
          IF SY-SUBRC EQ 0.
            IF ZDMS1-WERKS EQ '1000'.
              IF ZPA0001-BTRTL NE '1223'.
                IF ZPA0001-BTRTL NE '1224'.
                  IF ZPA0001-BTRTL NE '1228'.
                    IF ZPA0001-BTRTL NE '1230'.
                      IF ZPA0001-BTRTL NE '1231'.
                        IF ZPA0001-BTRTL NE '1229'.
                          IF ZPA0001-BTRTL NE '1232'.
                            IF ZDMS1-RAPPROVE1 NE 'X'.
                              MESSAGE 'CHANGE CONTROL IS NOT YET APPROVED BY APPROVER' TYPE 'E'.
                            ENDIF.
                          ENDIF.
                        ENDIF.
                      ENDIF.
                    ENDIF.
                  ENDIF.
                ENDIF.
              ENDIF.
            ELSEIF ZDMS1-WERKS EQ '1001'.
              IF ZPA0001-BTRTL NE '1323'.
                IF ZPA0001-BTRTL NE '1324'.
                  IF ZPA0001-BTRTL NE '1328'.
                    IF ZDMS1-RAPPROVE1 NE 'X'.
                      MESSAGE 'CHANGE CONTROL IS NOT YET APPROVED BY APPROVER' TYPE 'I'.  "AKB'S APPROVAL IS NOT MANDATORY 4.5.2019
                    ENDIF.
                  ENDIF.
                ENDIF.
              ENDIF.
            ENDIF.
          ENDIF.

*******************************************************
        ENDIF.
        IF CCNUM IS  INITIAL.
          MESSAGE 'ENTER CHANGE CONTROL NUMBER' TYPE 'E'.
        ENDIF.
        IF YEAR IS  INITIAL.
          MESSAGE 'ENTER CHANGE CONTROL YEAR' TYPE 'E'.
        ENDIF.
        SELECT * FROM ZDMS1 INTO TABLE IT_ZDMS1 WHERE MBLNR EQ CCNUM AND MJAHR EQ YEAR.

        SELECT * FROM ZDMS2 INTO TABLE IT_ZDMS2 WHERE MBLNR EQ CCNUM AND MJAHR EQ YEAR.
        IF R33 NE 'X'.
          PERFORM DEPTCHK1.
        ENDIF.
        IF R31 EQ 'X'.
          PERFORM DEPTQA.
        ENDIF.
*        PERFORM REJECTION.
        IF R33 EQ 'X'.
          PERFORM PRINT.
        ELSE.
          CALL SCREEN 9005.
        ENDIF.
        CLEAR OK.
      ELSEIF CC1  EQ 'X' AND  R7 EQ 'X' .
*        BREAK-POINT.
        SELECT SINGLE * FROM ZDMS4 WHERE MBLNR EQ CCNUM AND MJAHR EQ YEAR AND QHREJECT NE SPACE. "added on 23.7.23 for qa head rejection
        IF SY-SUBRC EQ 0.
          MESSAGE 'CHECK YOUR ENTRY' TYPE 'E'.
        ENDIF.
        SELECT SINGLE * FROM ZDMS1 WHERE MBLNR EQ CCNUM AND MJAHR EQ YEAR.
        IF SY-SUBRC NE 0.
          MESSAGE 'INVALID NUMBER' TYPE 'I'.
          EXIT.
        ENDIF.
        IF CCNUM IS  INITIAL.
          MESSAGE 'ENTER CHANGE CONTROL NUMBER' TYPE 'E'.
        ENDIF.
        IF YEAR IS  INITIAL.
          MESSAGE 'ENTER CHANGE CONTROL YEAR' TYPE 'E'.
        ENDIF.
*    PERFORM PASSW.
        SELECT * FROM ZDMS1 INTO TABLE IT_ZDMS1 WHERE MBLNR EQ CCNUM AND MJAHR EQ YEAR.
        SELECT * FROM ZDMS2 INTO TABLE IT_ZDMS2 WHERE MBLNR EQ CCNUM AND MJAHR EQ YEAR.
        SELECT * FROM ZDMS3 INTO TABLE IT_ZDMS3 WHERE MBLNR EQ CCNUM AND MJAHR EQ YEAR.

        SELECT SINGLE * FROM ZDMS1 WHERE MBLNR EQ CCNUM AND MJAHR EQ YEAR .
        IF SY-SUBRC EQ 0.
          IF ZDMS1-APPROVE NE 'X'.
            MESSAGE 'CHANGE NOT YET APPROVED BY DEPT. HEAD' TYPE 'I'.
            EXIT.
          ENDIF.
        ENDIF.
*        PERFORM REJECTION.
*        CALL SCREEN 9003.
        CLEAR ZEILE.
        CLEAR : CHGNUM.
        SELECT SINGLE * FROM ZDMS4 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM.
        IF SY-SUBRC EQ 0.
          CHGNUM = ZDMS4-CCNUMB1.
        ENDIF.
        PERFORM DEPTQA.
        PERFORM PROCCHK.
        PERFORM FOLWUPACT.
        CLEAR OK.
      ELSEIF CC1  EQ 'X' AND R7A EQ 'X'.
        PERFORM DEPTQA.
        PERFORM PROCCHK.
        PERFORM TENTATIVEDT.
      ELSEIF CC1 EQ 'X' AND ( RE1 EQ 'X' OR RE2 EQ 'X' OR RE3 EQ 'X').  "extension process
*        BREAK-POINT.
        CLEAR : ZDMS5,ZDMS6,IT_ZDMS6,WA_ZDMS6,IT_EXTDEPT1,WA_EXTDEPT1.
        CLEAR : INITDEPT1,INITDEPT2,EXT1.
        CLEAR : OTHREXTDEPT.
        SELECT SINGLE * FROM ZDMS4 WHERE MJAHR = YEAR AND MBLNR = CCNUM AND CL1 NE SPACE.
        IF SY-SUBRC EQ 0.
          MESSAGE 'INVALID CHANGE CONTROL NOTIFICATION NUMBER- CLOSURE IS ALREDAY DONE' TYPE 'E'.
        ENDIF.

        IF RE1 EQ 'X'.
*          BREAK-POINT .
          CLEAR :  ERR1.
          SELECT SINGLE * FROM ZDMS1 WHERE MJAHR = YEAR AND MBLNR = CCNUM .
          IF SY-SUBRC EQ 0.
*            SELECT SINGLE * FROM PA0001 WHERE PERNR EQ ZDMS1-PERNR AND ENDDA GE SY-DATUM .
            SELECT SINGLE * FROM ZPA0001 WHERE PERNR EQ ZDMS1-PERNR AND ENDDA GE SY-DATUM .
*            AND btrtl EQ impdept.
            IF SY-SUBRC EQ 0.
              INITDEPT1 = ZPA0001-BTRTL.
*              INITDEPT1 = PA0001-BTRTL.
            ENDIF.
          ENDIF.

*          SELECT SINGLE * FROM PA0001 WHERE PERNR EQ PERNR AND ENDDA GE SY-DATUM .
          SELECT SINGLE * FROM ZPA0001 WHERE PERNR EQ PERNR AND ENDDA GE SY-DATUM .
          IF SY-SUBRC EQ 0.
*            INITDEPT2 = PA0001-BTRTL.
            INITDEPT2 = ZPA0001-BTRTL.
          ENDIF.
          IF INITDEPT1 NE INITDEPT2 .
            ERR1 = 1.
*            MESSAGE 'ONLY INITIATING DEPARTMENET CAN RAISE EXTENSION REQUEST' TYPE 'E'.
          ENDIF.
*****new logic is added on 19.2.24 for single HOD for multiple dept head
          SELECT SINGLE * FROM ZDMS5 WHERE MJAHR = YEAR AND MBLNR = CCNUM AND DEPTH LE 0.
          IF SY-SUBRC EQ 0.
            SELECT SINGLE * FROM ZQMS_DEPTHEAD1 WHERE BTRTL EQ INITDEPT1 AND PERNR EQ PERNR AND TO_DT GE SY-DATUM..
            IF SY-SUBRC EQ 0.
              CLEAR :  ERR1.
            ENDIF.
            IF ERR1 EQ 1.
*              SELECT SINGLE * FROM ZQMS_DEPTHEAD1 WHERE BTRTL EQ INITDEPT1 AND PERNR1 EQ PERNR AND TO_DT GE SY-DATUM. "added on 1.12.24
*              IF SY-SUBRC EQ 0.
*                CLEAR :  ERR1.
*              ENDIF.
              SELECT SINGLE * FROM ZQMS_DEPTHEAD2 WHERE BTRTL EQ INITDEPT1 AND PERNR EQ PERNR AND FROM_DT LE SY-DATUM AND TO_DT GE SY-DATUM. "added on 1.12.24
              IF SY-SUBRC EQ 0.
                CLEAR :  ERR1.
              ENDIF.
            ENDIF.
          ENDIF.

          IF ERR1 EQ 1.
            MESSAGE 'ONLY INITIATING DEPARTMENET CAN RAISE EXTENSION REQUEST' TYPE 'E'.
          ENDIF.

          SELECT SINGLE * FROM ZDMS5 WHERE MJAHR = YEAR AND MBLNR = CCNUM AND DEPTAPR NE SPACE.
          IF SY-SUBRC EQ 0.
            MESSAGE 'EXENSION REQUEST IS ALREDAY APPROVED BY DEPARTMENT HEAD' TYPE 'E'.
          ENDIF.
          SELECT SINGLE * FROM ZDMS5 WHERE MJAHR = YEAR AND MBLNR = CCNUM AND QAPERNR GT 0.
          IF SY-SUBRC EQ 0.
            MESSAGE 'EXENSION REQUEST IS ALREDAY APPROVED BY QA/CQD HEAD' TYPE 'E'.
          ENDIF.
        ENDIF.
*        BREAK-POINT.
        IF RE2 EQ 'X'.
          SELECT SINGLE * FROM ZDMS5 WHERE MJAHR = YEAR AND MBLNR = CCNUM AND DEPTAPR EQ SPACE.
          IF SY-SUBRC EQ 0.
            MESSAGE 'EXTENSION IS NOT YET APPROVED BY INITIATING DEPT. HEAD' TYPE 'E'.
          ENDIF.
          CLEAR : INITDEPT2.
*          SELECT SINGLE * FROM PA0001 WHERE PERNR EQ PERNR AND ENDDA GE SY-DATUM .
          SELECT SINGLE * FROM ZPA0001 WHERE PERNR EQ PERNR AND ENDDA GE SY-DATUM .
          IF SY-SUBRC EQ 0.
*            INITDEPT2 = PA0001-BTRTL.
            INITDEPT2 = ZPA0001-BTRTL.
          ENDIF.
          PERFORM NEWDEPTHEAD.
*          SELECT SINGLE * FROM PA0001 WHERE PERNR EQ PERNR AND ENDDA GE SY-DATUM.
          SELECT SINGLE * FROM ZPA0001 WHERE PERNR EQ PERNR AND ENDDA GE SY-DATUM.
          IF SY-SUBRC EQ 0.
*            SELECT SINGLE * FROM ZDMS6 WHERE MJAHR = YEAR AND MBLNR = CCNUM AND BTRTL EQ PA0001-BTRTL.
            SELECT SINGLE * FROM ZDMS6 WHERE MJAHR = YEAR AND MBLNR = CCNUM AND BTRTL EQ ZPA0001-BTRTL.
            IF SY-SUBRC EQ 0.
              INITDEPT2 = ZDMS6-BTRTL.
              EXT1 = 1.
            ENDIF.
          ENDIF.
*******************CHECK FOR MULTIPLE DEPT & SINGLE HOD********************
          CLEAR : IT_ZDMS61, WA_ZDMS61.
          SELECT * FROM ZDMS6 INTO TABLE IT_ZDMS61 WHERE MJAHR = YEAR AND MBLNR = CCNUM AND APERNR LE 0.
          LOOP AT IT_ZDMS61 INTO WA_ZDMS61.
            SELECT SINGLE * FROM ZQMS_DEPTHEAD1 WHERE BTRTL EQ WA_ZDMS61-BTRTL AND PERNR EQ PERNR AND TO_DT GE SY-DATUM..
            IF SY-SUBRC EQ 0.
              EXT1 = 1.
            ENDIF.
          ENDLOOP.

***********************************************************************
          IF EXT1 NE 1.
            MESSAGE 'NOT RESPONSIBLE FOR EXTENSION REQUEST' TYPE 'E'.
          ENDIF.
        ENDIF.
        IF RE3 EQ 'X'.
          SELECT SINGLE * FROM ZDMS5 WHERE MJAHR = YEAR AND MBLNR = CCNUM AND DEPTAPR EQ SPACE.
          IF SY-SUBRC EQ 0.
            MESSAGE 'EXTENSION IS NOT YET APPROVED BY INITIATING DEPT. HEAD' TYPE 'E'.
          ENDIF.
          SELECT * FROM ZDMS6 INTO TABLE IT_ZDMS6 WHERE MJAHR = YEAR AND MBLNR = CCNUM.
          IF IT_ZDMS6 IS INITIAL.
            MESSAGE 'RESPONSIBLE DEPARTENTS ARE NOT YET SELECTED' TYPE 'E'.
          ENDIF.
          IF IT_ZDMS6 IS NOT INITIAL.
            LOOP AT IT_ZDMS6 INTO WA_ZDMS6.
              IF WA_ZDMS6-APERNR EQ 0.
                MESSAGE 'EXTENSION REQUEST IS NOT YET APPROVED BY ALL RESPONSIBLE DEPARTMENTS' TYPE 'E'.
              ENDIF.
            ENDLOOP.
          ENDIF.
          PERFORM DEPTHEADQA.
        ENDIF.


*        BREAK-POINT.
        SELECT SINGLE * FROM ZDMS1 WHERE MJAHR = YEAR AND MBLNR = CCNUM .
        IF SY-SUBRC NE 0.
          MESSAGE 'INVALID CHANGE CONTROL NOTIFICATION NUMBER' TYPE 'E'.
        ENDIF.
        SELECT SINGLE * FROM ZDMS4 WHERE MJAHR = YEAR AND MBLNR = CCNUM AND QHAPPROVE EQ 'X' AND TDAPPROVE EQ 'X'.
        IF SY-SUBRC NE 0.
          MESSAGE 'INVALID CHANGE CONTROL NOTIFICATION NUMBER- NOT YET APPROVED' TYPE 'E'.
        ENDIF.

        SELECT SINGLE * FROM ZDMS1 WHERE MJAHR = YEAR AND MBLNR = CCNUM .
        IF SY-SUBRC EQ 0.
          YEAR = ZDMS1-MJAHR.
          SELECT SINGLE * FROM PA0001 WHERE PERNR EQ ZDMS1-PERNR AND ENDDA GE SY-DATUM.
              IF SY-SUBRC EQ 0.
            ENAME = PA0001-ENAME.
            endif.
          SELECT SINGLE * FROM ZPA0001 WHERE PERNR EQ ZDMS1-PERNR AND ENDDA GE SY-DATUM.
          IF SY-SUBRC EQ 0.
*            ENAME = PA0001-ENAME.
            SELECT SINGLE * FROM T001P WHERE BTRTL EQ ZPA0001-BTRTL.
            IF SY-SUBRC EQ 0.
              DEPT = T001P-BTEXT.
            ENDIF.
          ENDIF.
        ENDIF.

        SELECT SINGLE * FROM ZDMS4  WHERE MJAHR = YEAR AND MBLNR = CCNUM.
        SELECT * FROM ZDMS2 INTO TABLE  IT_ZDMS2 WHERE MJAHR = YEAR AND MBLNR = CCNUM.
        IF RE1 EQ 'X'.
        ELSEIF RE2 EQ 'X'.
        ELSE.
          PERFORM DEPTCHK1.
        ENDIF.
        CLEAR : ZDMS5.
        PERFORM EXTDEPT.
        CLEAR : OK.
*        BREAK-POINT.
        CLEAR : DEPTHNAME,DEPTHAPR.
*        SELECT SINGLE * FROM zdms5  WHERE mjahr = year AND mblnr = ccnum.
*        IF sy-subrc NE 0.
        CLEAR : ZDMS5_WA,ZDMS5.
        ZDMS5-EIDAYS = 0.
*        ENDIF.

        CALL SCREEN '9007'.  "extension request

      ELSEIF CC1  EQ 'X' AND ( R8 EQ 'X' OR R81 EQ 'X' OR R9 EQ 'X' OR R91 EQ 'X').
        SELECT SINGLE * FROM ZDMS1 WHERE MBLNR EQ CCNUM AND MJAHR EQ YEAR.
        IF SY-SUBRC NE 0.
          MESSAGE 'INVALID NUMBER' TYPE 'I'.
          EXIT.
        ENDIF.
        IF CCNUM IS  INITIAL.
          MESSAGE 'ENTER CHANGE CONTROL NUMBER' TYPE 'E'.
        ENDIF.
        IF YEAR IS  INITIAL.
          MESSAGE 'ENTER CHANGE CONTROL YEAR' TYPE 'E'.
        ENDIF.
*    PERFORM PASSW.
        SELECT * FROM ZDMS1 INTO TABLE IT_ZDMS1 WHERE MBLNR EQ CCNUM AND MJAHR EQ YEAR.
        SELECT * FROM ZDMS2 INTO TABLE IT_ZDMS2 WHERE MBLNR EQ CCNUM AND MJAHR EQ YEAR.
        SELECT * FROM ZDMS3 INTO TABLE IT_ZDMS3 WHERE MBLNR EQ CCNUM AND MJAHR EQ YEAR.
        SELECT SINGLE * FROM ZDMS1 WHERE MBLNR EQ CCNUM AND MJAHR EQ YEAR .
        IF SY-SUBRC EQ 0.
          IF ZDMS1-APPROVE NE 'X'.
            MESSAGE 'CHANGE NOT YET APPROVED BY DEPT. HEAD' TYPE 'I'.
            EXIT.
          ENDIF.
        ENDIF.
        IF R9 EQ 'X' OR R91 EQ 'X'.
          SELECT SINGLE * FROM ZDMS4 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM AND QHCL2PERNR GT 0.
          IF SY-SUBRC EQ 0.
            MESSAGE 'CLOSURE-II IS ALREDY DONE' TYPE 'E'.
          ENDIF.
        ENDIF.
        IF R8 EQ 'X' OR R81 EQ 'X'.
          SELECT SINGLE * FROM ZDMS4 WHERE MBLNR EQ CCNUM AND MJAHR EQ YEAR AND QHCL1PERNR GT 0.
          IF SY-SUBRC EQ 0.
            MESSAGE 'CHANGE CONTROL CLOSURE-I IS ALREADY DONE' TYPE 'E'.
          ENDIF.
        ENDIF.
*        PERFORM REJECTION.
        CALL SCREEN 9006.
        CLEAR OK.
      ELSEIF CC1  EQ 'X' AND R82 EQ 'X' .
        SELECT SINGLE * FROM ZDMS1 WHERE MBLNR EQ CCNUM AND MJAHR EQ YEAR.
        IF SY-SUBRC NE 0.
          MESSAGE 'INVALID NUMBER' TYPE 'I'.
          EXIT.
        ENDIF.
        IF CCNUM IS  INITIAL.
          MESSAGE 'ENTER CHANGE CONTROL NUMBER' TYPE 'E'.
        ENDIF.
        IF YEAR IS  INITIAL.
          MESSAGE 'ENTER CHANGE CONTROL YEAR' TYPE 'E'.
        ENDIF.
        CLEAR : CHGNUM.
        SELECT SINGLE * FROM ZDMS4 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM.
        IF SY-SUBRC EQ 0.
          CHGNUM = ZDMS4-CCNUMB1.
        ENDIF.

        SELECT SINGLE * FROM ZDMS4 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM AND QHCL2PERNR GT 0.
        IF SY-SUBRC EQ 0.
          MESSAGE 'CLOSURE-II IS ALREDY DONE' TYPE 'E'.
        ENDIF.

        PERFORM DEPTQA.
        PERFORM FOLWACT.
        CLEAR OK.
      ELSEIF CC1  EQ 'X' AND R10 EQ 'X'.
        IF CCNUM1 IS NOT INITIAL.  "25.11.20
          SELECT SINGLE * FROM ZDMS4 WHERE CCNUMB1 EQ CCNUM1.
          IF SY-SUBRC EQ 0.
            IF CCNUM NE '0000000000'.
              IF CCNUM NE ZDMS4-MBLNR.
                MESSAGE 'REMOVE NOTIFICATION NUMBER' TYPE 'E'.
              ENDIF.
            ENDIF.
            CCNUM = ZDMS4-MBLNR.
            YEAR = ZDMS4-MJAHR.
          ELSE.
            MESSAGE 'INVALID CHANGE CONTROL NUMBER' TYPE 'E'.
          ENDIF.
        ENDIF.

*        IF CCNUM1 IS NOT INITIAL.
*          EQ '0000000000' AND CCNUM1 NE '00000
        SELECT SINGLE * FROM ZDMS1 WHERE MBLNR EQ CCNUM AND MJAHR EQ YEAR.
        IF SY-SUBRC NE 0.
          MESSAGE 'INVALID NUMBER' TYPE 'I'.
          EXIT.
        ENDIF.
        IF CCNUM IS  INITIAL.
          MESSAGE 'ENTER CHANGE CONTROL NUMBER' TYPE 'E'.
        ENDIF.
        IF YEAR IS  INITIAL.
          MESSAGE 'ENTER CHANGE CONTROL YEAR' TYPE 'E'.
        ENDIF.
        PERFORM PRINT.
*        LEAVE TO TRANSACTION 'ZQMS'.
        LEAVE TO SCREEN 0.

      ELSEIF CC1  EQ 'X' AND R11 EQ 'X'.

        CLEAR : CHGNUM.
        SELECT SINGLE * FROM ZDMS4 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM.
        IF SY-SUBRC EQ 0.
          CHGNUM = ZDMS4-CCNUMB1.
        ENDIF.

        SELECT SINGLE * FROM ZDMS1 WHERE MBLNR EQ CCNUM AND MJAHR EQ YEAR.
        IF SY-SUBRC NE 0.
          MESSAGE 'INVALID NUMBER' TYPE 'I'.
          EXIT.
        ENDIF.
        IF CCNUM IS  INITIAL.
          MESSAGE 'ENTER CHANGE CONTROL NUMBER' TYPE 'E'.
        ENDIF.
        IF YEAR IS  INITIAL.
          MESSAGE 'ENTER CHANGE CONTROL YEAR' TYPE 'E'.
        ENDIF.
        PERFORM DEPTQA.

        PERFORM SEND_EMAIL.
*        LEAVE TO TRANSACTION 'ZQMS'.
        LEAVE TO SCREEN 0.
      ELSEIF CC1  EQ 'X' AND R12 EQ 'X'.
*******addded on 22.11.24 for attachment - Jyotsna
        IF CCNUM LE 0 .
          IF CCNUM1 IS NOT INITIAL.
*            IF CCNUM1 IS NOT INITIAL.  "21.11.24
            SELECT SINGLE * FROM ZDMS4 WHERE CCNUMB1 EQ CCNUM1.
            IF SY-SUBRC EQ 0.
              IF CCNUM NE '0000000000'.
                IF CCNUM NE ZDMS4-MBLNR.
                  MESSAGE 'REMOVE NOTIFICATION NUMBER' TYPE 'E'.
                ENDIF.
                IF YEAR NE ZDMS4-MJAHR.
                  MESSAGE 'REMOVE NOTIFICATION YEAR' TYPE 'E'.
                ENDIF.
              ENDIF.
              CCNUM = ZDMS4-MBLNR.
              YEAR = ZDMS4-MJAHR.
            ELSE.
              MESSAGE 'INVALID CHANGE CONTROL NUMBER' TYPE 'E'.
            ENDIF.
*            ENDIF.
          ENDIF.
        ENDIF.
***********************************

        CLEAR : CHGNUM.
        SELECT SINGLE * FROM ZDMS4 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM.
        IF SY-SUBRC EQ 0.
          CHGNUM = ZDMS4-CCNUMB1.
        ENDIF.
*        BREAK-POINT.
        CLEAR : FIELDCAT,WA_FIELDCAT.

        WRITE  : / 'LIST OF ATTACH DOCUMENTS IN THIS CHANGE CONTROL'.
        SELECT * FROM ZDMS1 INTO TABLE IT_ZDMS1 WHERE MBLNR EQ CCNUM AND MJAHR EQ YEAR.
        WA_FIELDCAT-FIELDNAME = 'MBLNR'.
        WA_FIELDCAT-SELTEXT_L = 'CC NOTIFICATION NUMBER'.
        APPEND WA_FIELDCAT TO FIELDCAT.
        WA_FIELDCAT-FIELDNAME = 'MJAHR'.
        WA_FIELDCAT-SELTEXT_L = 'CC NOTIFICATION YEAR'.
        APPEND WA_FIELDCAT TO FIELDCAT.



        LAYOUT-ZEBRA = 'X'.
        LAYOUT-COLWIDTH_OPTIMIZE = 'X'.
        LAYOUT-WINDOW_TITLEBAR  = 'LIST OF ATTACH DOCUMENTS IN THIS CHANGE CONTROL'.

        CALL FUNCTION 'REUSE_ALV_GRID_DISPLAY'
          EXPORTING
            I_CALLBACK_PROGRAM      = G_REPID
*           I_CALLBACK_PF_STATUS_SET          = ' '
            I_CALLBACK_USER_COMMAND = 'USER_COMM1'
            I_CALLBACK_TOP_OF_PAGE  = 'TOP'
            IS_LAYOUT               = LAYOUT
            IT_FIELDCAT             = FIELDCAT
            I_SAVE                  = 'A'
          TABLES
            T_OUTTAB                = IT_ZDMS1
          EXCEPTIONS
            PROGRAM_ERROR           = 1
            OTHERS                  = 2.
        IF SY-SUBRC <> 0.
* MESSAGE ID SY-MSGID TYPE SY-MSGTY NUMBER SY-MSGNO
*         WITH SY-MSGV1 SY-MSGV2 SY-MSGV3 SY-MSGV4.
        ENDIF.



*        LEAVE TO SCREEN 0.

*      elseif cc1  eq 'X' and r13 eq 'X'.
*        perform deptqa.
**        BREAK-POINT.
*        clear : fieldcat,wa_fieldcat.
*
*        write  : / 'LIST OF ATTACH DOCUMENTS IN THIS CHANGE CONTROL :- CHANGE/DELETE'.
*        select * from zdms1 into table it_zdms1 where mblnr eq ccnum and mjahr eq year.
*        wa_fieldcat-fieldname = 'MBLNR'.
*        wa_fieldcat-seltext_l = 'CC NOTIFICATION NUMBER'.
*        append wa_fieldcat to fieldcat.
*        wa_fieldcat-fieldname = 'MJAHR'.
*        wa_fieldcat-seltext_l = 'CC NOTIFICATION YEAR'.
*        append wa_fieldcat to fieldcat.
*
*
*
*        layout-zebra = 'X'.
*        layout-colwidth_optimize = 'X'.
*        layout-window_titlebar  = 'LIST OF ATTACH DOCUMENTS IN THIS CHANGE CONTROL'.
*
*        call function 'REUSE_ALV_GRID_DISPLAY'
*          exporting
*            i_callback_program      = g_repid
**           I_CALLBACK_PF_STATUS_SET          = ' '
*            i_callback_user_command = 'USER_COMM1'
*            i_callback_top_of_page  = 'TOP'
*            is_layout               = layout
*            it_fieldcat             = fieldcat
*            i_save                  = 'A'
*          tables
*            t_outtab                = it_zdms1
*          exceptions
*            program_error           = 1
*            others                  = 2.
*        if sy-subrc <> 0.
** MESSAGE ID SY-MSGID TYPE SY-MSGTY NUMBER SY-MSGNO
**         WITH SY-MSGV1 SY-MSGV2 SY-MSGV3 SY-MSGV4.
*        endif.
**        LEAVE TO SCREEN 0.


      ELSEIF CC1  EQ 'X' AND R3A EQ 'X'.

        CLEAR : NWERKS.
        SELECT SINGLE * FROM ZDMS1 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM.
        IF SY-SUBRC EQ 4.
          MESSAGE 'INVALID NUMBER' TYPE 'E'.
        ENDIF.

        SELECT SINGLE * FROM ZDMS1 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM.
        IF SY-SUBRC EQ 0.
          NWERKS = ZDMS1-WERKS.
        ENDIF.
        SELECT SINGLE * FROM PA0001 WHERE PERNR EQ PERNR AND ENDDA GE SY-DATUM.
        IF SY-SUBRC EQ 4.
          MESSAGE 'INVALID EMPLOYEE CODE' TYPE 'E'.
        ENDIF.

*        SELECT SINGLE * FROM PA0001 WHERE PERNR EQ PERNR AND ENDDA GE SY-DATUM.
        SELECT SINGLE * FROM ZPA0001 WHERE PERNR EQ PERNR AND ENDDA GE SY-DATUM.
        IF SY-SUBRC EQ 0.
          IF NWERKS EQ '1000' AND ZPA0001-BTRTL EQ '1228'.
          ELSEIF  NWERKS EQ '1001' AND ZPA0001-BTRTL EQ '1328'.
          ELSEIF NWERKS EQ '3000' AND ZPA0001-BTRTL EQ '1232'.
          ELSEIF NWERKS EQ '4000' AND ZPA0001-BTRTL EQ '1232'.
          ELSE.
            MESSAGE 'NOT AUTHORIZED PERSON TO ENTER IMPACTED ACTIVITY' TYPE 'E'.
          ENDIF.
        ENDIF.



        SELECT SINGLE * FROM ZDMS2 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM AND UPERNR EQ '00000000'.
        IF SY-SUBRC EQ 4.
          MESSAGE ' ALL IMPACTED ACTIVITES ARE ALREDAY ENTERD FOR THIS CC' TYPE 'E'.
        ENDIF.

        CLEAR : ODEPT.
        CLEAR : FIELDCAT,WA_FIELDCAT.

        WRITE  : / 'LIST OF ATTACH DOCUMENTS IN THIS CHANGE CONTROL'.
        SELECT * FROM ZDMS1 INTO TABLE IT_ZDMS1 WHERE MBLNR EQ CCNUM AND MJAHR EQ YEAR.

        WA_IMP1-MJAHR = YEAR.
        WA_IMP1-MBLNR = CCNUM.
        WA_IMP1-CNT = 1.
        COLLECT WA_IMP1 INTO IT_IMP1.
        CLEAR WA_IMP1.
        WA_IMP1-MJAHR = YEAR.
        WA_IMP1-MBLNR = CCNUM.
        WA_IMP1-CNT = 2.
        COLLECT WA_IMP1 INTO IT_IMP1.
        CLEAR WA_IMP1.
        WA_IMP1-MJAHR = YEAR.
        WA_IMP1-MBLNR = CCNUM.
        WA_IMP1-CNT = 3.
        COLLECT WA_IMP1 INTO IT_IMP1.
        CLEAR WA_IMP1.
        WA_IMP1-MJAHR = YEAR.
        WA_IMP1-MBLNR = CCNUM.
        WA_IMP1-CNT = 4.
        COLLECT WA_IMP1 INTO IT_IMP1.
        CLEAR WA_IMP1.
        WA_IMP1-CNT = 5.
        WA_IMP1-MJAHR = YEAR.
        WA_IMP1-MBLNR = CCNUM.
        COLLECT WA_IMP1 INTO IT_IMP1.
        CLEAR WA_IMP1.



        WA_FIELDCAT-FIELDNAME = 'CNT'.
        WA_FIELDCAT-SELTEXT_L = 'Serial No.'.
*        WA_FIELDCAT-EDIT = 'X'.
        APPEND WA_FIELDCAT TO FIELDCAT.

        WA_FIELDCAT-FIELDNAME = 'DEPT'.
        WA_FIELDCAT-SELTEXT_L = 'DEPARTMENT'.
        WA_FIELDCAT-EDIT = 'X'.
        APPEND WA_FIELDCAT TO FIELDCAT.

        WA_FIELDCAT-FIELDNAME = 'IMP'.
        WA_FIELDCAT-SELTEXT_L = 'IMPACTED ACTIVITY'.
        WA_FIELDCAT-EDIT = 'X'.
        APPEND WA_FIELDCAT TO FIELDCAT.

        WA_FIELDCAT-FIELDNAME = 'TARDT'.
        WA_FIELDCAT-SELTEXT_L = 'TARGET DATE'.
        WA_FIELDCAT-EDIT = 'X'.
        APPEND WA_FIELDCAT TO FIELDCAT.

        WA_FIELDCAT-FIELDNAME = 'REMARK'.
        WA_FIELDCAT-SELTEXT_L = 'REMARK'.
        WA_FIELDCAT-EDIT = 'X'.
        APPEND WA_FIELDCAT TO FIELDCAT.



        LAYOUT-ZEBRA = 'X'.
        LAYOUT-COLWIDTH_OPTIMIZE = 'X'.
        LAYOUT-WINDOW_TITLEBAR  = 'ENTER IMPACTED ACTIVITY FOR OTHER DEPARTMENT'.

        CALL FUNCTION 'REUSE_ALV_GRID_DISPLAY'
          EXPORTING
            I_CALLBACK_PROGRAM      = G_REPID
*           I_CALLBACK_PF_STATUS_SET          = ' '
            I_CALLBACK_USER_COMMAND = 'USER_COMM4'
            I_CALLBACK_TOP_OF_PAGE  = 'TOP'
            IS_LAYOUT               = LAYOUT
            IT_FIELDCAT             = FIELDCAT
            I_SAVE                  = 'A'
          TABLES
            T_OUTTAB                = IT_IMP1
          EXCEPTIONS
            PROGRAM_ERROR           = 1
            OTHERS                  = 2.
        IF SY-SUBRC <> 0.
* MESSAGE ID SY-MSGID TYPE SY-MSGTY NUMBER SY-MSGNO
*         WITH SY-MSGV1 SY-MSGV2 SY-MSGV3 SY-MSGV4.
        ENDIF.





      ENDIF.

*    WHEN 'ONLI'.
*
**      SELECT SINGLE * FROM ZDMS1 WHERE MBLNR EQ CCNUM AND MJAHR EQ YEAR.
**      IF SY-SUBRC NE 0.
**        MESSAGE 'INVALID NUMBER' TYPE 'I'.
**        EXIT.
**      ENDIF.
**      IF CCNUM IS  INITIAL.
**        MESSAGE 'ENTER CHANGE CONTROL NUMBER' TYPE 'E'.
**      ENDIF.
**      IF YEAR IS  INITIAL.
**        MESSAGE 'ENTER CHANGE CONTROL YEAR' TYPE 'E'.
**      ENDIF.
*
*      IF CC1  EQ 'X' AND R10 EQ 'X'.
*        PERFORM PRINT.
*      ENDIF.

    WHEN 'BACK' OR 'EXIT'.
      CLEAR OK.
*      SET SCREEN 0.
*      call TRANSACTION 'ZQMS'.
      LEAVE TO SCREEN 0.
      EXIT.


  ENDCASE.

ENDMODULE.
*&---------------------------------------------------------------------*
*&      Form  CHECK1
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
*FORM CHECK1 .
*  IF ATEXT1 NE SPACE.
*    IF ADATE1 EQ '00000000' AND AREM1 EQ SPACE.
*      MESSAGE ' ENTER EITHER TARGET DATE OR REMARK' TYPE 'I'.
*      EXIT.
*    ENDIF.
*  ENDIF.
*ENDFORM.
*&---------------------------------------------------------------------*
*&      Form  CHECK1
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
*&---------------------------------------------------------------------*
*&      Form  FOLWUPACT
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM FOLWUPACT.
*  BREAK-POINT.
  CLEAR : IT_FOLW1,WA_FOLW1,IT_FOLW2,WA_FOLW2.
  CLEAR : IT_ZDMS3,WA_ZDMS3,IT_ZDMS2,WA_ZDMS2.
  SELECT * FROM ZDMS3 INTO TABLE IT_ZDMS3 WHERE MBLNR EQ CCNUM AND MJAHR EQ YEAR.
  IF IT_ZDMS3 IS INITIAL.
    SELECT * FROM ZDMS2 INTO TABLE IT_ZDMS2 WHERE MBLNR EQ CCNUM AND MJAHR EQ YEAR.
  ENDIF.

  IF IT_ZDMS3 IS NOT INITIAL.
*    LOOP AT it_zdms3 INTO wa_zdms3 WHERE FOLW1 EQ space.
    SELECT SINGLE * FROM ZDMS3 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM AND FOLW1 EQ SPACE AND CTDATE1 LE 0.
    IF SY-SUBRC EQ 4.
      MESSAGE 'COMPLETION DATE IS ALREDY MAINTAINED' TYPE 'E'.
    ENDIF.
*    ENDLOOP.
  ENDIF.

  CLEAR ZEILE.
  IF IT_ZDMS3 IS INITIAL.
    PERFORM FZDMS2.
  ELSE.
    PERFORM FZDMS3.
  ENDIF.
  CLEAR : FIELDCAT,LAYOUT.
  SELECT SINGLE * FROM ZDMS4 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM.
  IF SY-SUBRC EQ 0.
*    IF ZDMS4-CL1 EQ 'X' OR ZDMS4-QHCL1 EQ 'X'.
*    IF ( zdms4-tdapprove EQ 'X' OR zdms4-tdreject EQ 'X' ) AND zdms4-cl1 EQ 'X'.
    IF ZDMS4-CL1 EQ 'X'.
      MESSAGE 'CLOSURE IS ALREDY DONE' TYPE 'E'.
    ENDIF.
*      wa_fieldcat-fieldname = 'ZEILE'.
*      wa_fieldcat-seltext_l = 'NO.'.
*      APPEND wa_fieldcat TO fieldcat.
*
*      wa_fieldcat-fieldname = 'ATEXT1'.
*      wa_fieldcat-seltext_l = 'FOLLOW-UP ACTIVITIES'.
**      WA_FIELDCAT-EDIT = 'X'.
*      APPEND wa_fieldcat TO fieldcat.
*
*      wa_fieldcat-fieldname = 'BTEXT'.
*      wa_fieldcat-seltext_l = 'RESPONSIBILITY DEPT'.
*      APPEND wa_fieldcat TO fieldcat.
*
*      wa_fieldcat-fieldname = 'DEPT'.
**      WA_FIELDCAT-SELTEXT_L = 'DEPT CODE'.
*      APPEND wa_fieldcat TO fieldcat.
*
*      wa_fieldcat-fieldname = 'TDATE1'.
*      wa_fieldcat-seltext_l = 'TARGET DATE'.
**      WA_FIELDCAT-EDIT = 'X'.
*      APPEND wa_fieldcat TO fieldcat.
*
*      wa_fieldcat-fieldname = 'REM1'.
*      wa_fieldcat-seltext_l = 'REMARK'.
**      WA_FIELDCAT-EDIT = 'X'.
*      APPEND wa_fieldcat TO fieldcat.
*
*      wa_fieldcat-fieldname = 'CTDATE1'.
*      wa_fieldcat-seltext_l = 'COMPLETION DATE'.
**      WA_FIELDCAT-EDIT = 'X'.
*      APPEND wa_fieldcat TO fieldcat.
*
*      wa_fieldcat-fieldname = 'FCHK'.
*      wa_fieldcat-seltext_l = 'LONG TERM FOLLOW-UP'.
*      wa_fieldcat-checkbox = 'X'.
**      WA_FIELDCAT-EDIT = 'X'.
*      APPEND wa_fieldcat TO fieldcat.
*      CLEAR wa_fieldcat.
*
*      layout-zebra = 'X'.
*      layout-colwidth_optimize = 'X'.
*      layout-window_titlebar  = 'FOLLOW-UP ACTIVITY'.
*
*      CALL FUNCTION 'REUSE_ALV_GRID_DISPLAY'
*        EXPORTING
*          i_callback_program      = g_repid
**         I_CALLBACK_PF_STATUS_SET          = ' '
*          i_callback_user_command = 'USER_COMM1'
*          i_callback_top_of_page  = 'TOP'
*          is_layout               = layout
*          it_fieldcat             = fieldcat
*          i_save                  = 'A'
*        TABLES
*          t_outtab                = it_folw2
*        EXCEPTIONS
*          program_error           = 1
*          OTHERS                  = 2.
*      IF sy-subrc <> 0.
** MESSAGE ID SY-MSGID TYPE SY-MSGTY NUMBER SY-MSGNO
**         WITH SY-MSGV1 SY-MSGV2 SY-MSGV3 SY-MSGV4.
*      ENDIF.
*
*      CLEAR : zeile, it_folw1,wa_folw1,fieldcat,layout.
*      CLEAR : layout, fieldcat.
    IF  ZDMS4-TDAPPROVE EQ 'X' AND ZDMS4-CL1 EQ SPACE.
*  ELSEIF zdms4-tdapprove EQ 'X' OR zdms4-tdreject EQ 'X'.
*
      WA_FIELDCAT-FIELDNAME = 'ZEILE'.
      WA_FIELDCAT-SELTEXT_L = 'NO.'.
      APPEND WA_FIELDCAT TO FIELDCAT.
      CLEAR WA_FIELDCAT.

      WA_FIELDCAT-FIELDNAME = 'ATEXT1'.
      WA_FIELDCAT-SELTEXT_L = 'FOLLOW-UP ACTIVITIES'.
*      WA_FIELDCAT-EDIT = 'X'.
      APPEND WA_FIELDCAT TO FIELDCAT.
      CLEAR WA_FIELDCAT.

      WA_FIELDCAT-FIELDNAME = 'BTEXT'.
      WA_FIELDCAT-SELTEXT_L = 'RESPONSIBILITY DEPT'.
      APPEND WA_FIELDCAT TO FIELDCAT.
      CLEAR WA_FIELDCAT.

      WA_FIELDCAT-FIELDNAME = 'DEPT'.
      WA_FIELDCAT-SELTEXT_L = 'DEPT CODE'.
      APPEND WA_FIELDCAT TO FIELDCAT.
      CLEAR WA_FIELDCAT.

      WA_FIELDCAT-FIELDNAME = 'TDATE1'.
      WA_FIELDCAT-SELTEXT_L = 'TARGET DATE'.
*      WA_FIELDCAT-EDIT = 'X'.
      APPEND WA_FIELDCAT TO FIELDCAT.
      CLEAR WA_FIELDCAT.

      WA_FIELDCAT-FIELDNAME = 'REM1'.
      WA_FIELDCAT-SELTEXT_L = 'REMARK'.
      WA_FIELDCAT-EDIT = 'X'.
      APPEND WA_FIELDCAT TO FIELDCAT.
      CLEAR WA_FIELDCAT.

      WA_FIELDCAT-FIELDNAME = 'CTDATE1'.
      WA_FIELDCAT-SELTEXT_L = 'COMPLETION DATE'.
      WA_FIELDCAT-EDIT = 'X'.
      APPEND WA_FIELDCAT TO FIELDCAT.
      CLEAR WA_FIELDCAT.

      WA_FIELDCAT-FIELDNAME = 'FCHK'.
      WA_FIELDCAT-SELTEXT_L = 'LONG TERM FOLLOW-UP'.
      WA_FIELDCAT-CHECKBOX = 'X'.
*      WA_FIELDCAT-EDIT = 'X'.
      APPEND WA_FIELDCAT TO FIELDCAT.
      CLEAR WA_FIELDCAT.



      LAYOUT-ZEBRA = 'X'.
      LAYOUT-COLWIDTH_OPTIMIZE = 'X'.
      LAYOUT-WINDOW_TITLEBAR  = 'FOLLOW-UP ACTIVITY'.

      CALL FUNCTION 'REUSE_ALV_GRID_DISPLAY'
        EXPORTING
          I_CALLBACK_PROGRAM      = G_REPID
*         I_CALLBACK_PF_STATUS_SET          = ' '
          I_CALLBACK_USER_COMMAND = 'USER_COMM1'
          I_CALLBACK_TOP_OF_PAGE  = 'TOP'
          IS_LAYOUT               = LAYOUT
          IT_FIELDCAT             = FIELDCAT
          I_SAVE                  = 'A'
        TABLES
          T_OUTTAB                = IT_FOLW2
        EXCEPTIONS
          PROGRAM_ERROR           = 1
          OTHERS                  = 2.
      IF SY-SUBRC <> 0.
* MESSAGE ID SY-MSGID TYPE SY-MSGTY NUMBER SY-MSGNO
*         WITH SY-MSGV1 SY-MSGV2 SY-MSGV3 SY-MSGV4.
      ENDIF.

      CLEAR : ZEILE, IT_FOLW1,WA_FOLW1,FIELDCAT,LAYOUT.
      CLEAR : LAYOUT, FIELDCAT.

    ELSE.
      WA_FIELDCAT-FIELDNAME = 'ZEILE'.
      WA_FIELDCAT-SELTEXT_L = 'NO.'.
      APPEND WA_FIELDCAT TO FIELDCAT.

      WA_FIELDCAT-FIELDNAME = 'ATEXT1'.
      WA_FIELDCAT-SELTEXT_L = 'FOLLOW-UP ACTIVITIES'.
      WA_FIELDCAT-EDIT = 'X'.
      APPEND WA_FIELDCAT TO FIELDCAT.

      WA_FIELDCAT-FIELDNAME = 'BTEXT'.
      WA_FIELDCAT-SELTEXT_L = 'RESPONSIBILITY DEPT'.
      APPEND WA_FIELDCAT TO FIELDCAT.

      WA_FIELDCAT-FIELDNAME = 'DEPT'.
      WA_FIELDCAT-SELTEXT_L = 'DEPT CODE'.
      APPEND WA_FIELDCAT TO FIELDCAT.

      WA_FIELDCAT-FIELDNAME = 'TDATE1'.
      WA_FIELDCAT-SELTEXT_L = 'TARGET DATE'.
      WA_FIELDCAT-EDIT = 'X'.
      APPEND WA_FIELDCAT TO FIELDCAT.

      WA_FIELDCAT-FIELDNAME = 'REM1'.
      WA_FIELDCAT-SELTEXT_L = 'REMARK'.
      WA_FIELDCAT-EDIT = 'X'.
      APPEND WA_FIELDCAT TO FIELDCAT.

      WA_FIELDCAT-FIELDNAME = 'CTDATE1'.
      WA_FIELDCAT-SELTEXT_L = 'COMPLETION DATE'.
      WA_FIELDCAT-EDIT = 'X'.
      APPEND WA_FIELDCAT TO FIELDCAT.

      WA_FIELDCAT-FIELDNAME = 'FCHK'.
      WA_FIELDCAT-SELTEXT_L = 'LONG TERM FOLLOW-UP'.
      WA_FIELDCAT-CHECKBOX = 'X'.
      WA_FIELDCAT-EDIT = 'X'.
      APPEND WA_FIELDCAT TO FIELDCAT.
      CLEAR WA_FIELDCAT.

      LAYOUT-ZEBRA = 'X'.
      LAYOUT-COLWIDTH_OPTIMIZE = 'X'.
      LAYOUT-WINDOW_TITLEBAR  = 'FOLLOW-UP ACTIVITY'.

      CALL FUNCTION 'REUSE_ALV_GRID_DISPLAY'
        EXPORTING
          I_CALLBACK_PROGRAM      = G_REPID
*         I_CALLBACK_PF_STATUS_SET          = ' '
          I_CALLBACK_USER_COMMAND = 'USER_COMM1'
          I_CALLBACK_TOP_OF_PAGE  = 'TOP'
          IS_LAYOUT               = LAYOUT
          IT_FIELDCAT             = FIELDCAT
          I_SAVE                  = 'A'
        TABLES
          T_OUTTAB                = IT_FOLW2
        EXCEPTIONS
          PROGRAM_ERROR           = 1
          OTHERS                  = 2.
      IF SY-SUBRC <> 0.
* MESSAGE ID SY-MSGID TYPE SY-MSGTY NUMBER SY-MSGNO
*         WITH SY-MSGV1 SY-MSGV2 SY-MSGV3 SY-MSGV4.
      ENDIF.

      CLEAR : ZEILE, IT_FOLW1,WA_FOLW1,FIELDCAT,LAYOUT.
      CLEAR : LAYOUT, FIELDCAT.
    ENDIF.
  ENDIF.


ENDFORM.
*&---------------------------------------------------------------------*
*&      Form  SETFOLWUPD
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM SETFOLWUPD .
  CLEAR : ERR.
  SORT IT_FOLW2 BY MJAHR MBLNR DEPT ZEILE.

******************** ERROR CHECKING  ****************************************************
*  BREAK-POINT.
  LOOP AT IT_FOLW2 INTO WA_FOLW2 WHERE ATEXT1 NE SPACE.
*    BREAK-POINT.

    IF STRLEN( WA_FOLW2-ATEXT1 ) GT 100.
      MESSAGE 'REDUCE ACTIVITY LENGTH TILL 50 CHAR' TYPE 'E'.
      ERR = 1.
    ENDIF.
    IF WA_FOLW2-TDATE1 NE '00000000'.
      SELECT SINGLE * FROM ZDMS1 WHERE MJAHR EQ WA_FOLW2-MJAHR AND MBLNR = WA_FOLW2-MBLNR.
      IF SY-SUBRC EQ 0.
        IF WA_FOLW2-TDATE1 LT ZDMS1-BUDAT.
          MESSAGE 'TARGET DATE IS LOWER THAT INITIATION DATE' TYPE 'E'.
          ERR = 1.
        ENDIF.
      ENDIF.
    ENDIF.

    IF WA_FOLW2-TDATE1 EQ '00000000' AND WA_FOLW2-REM1 EQ SPACE.
      MESSAGE 'ENTER EITHER TARGET DATE OF REMARK' TYPE 'E'.
      ERR = 1.
    ENDIF.
    IF STRLEN( WA_FOLW2-REM1 ) GT 50.
      MESSAGE 'REDUCE REMARK LENGTH TILL 50 CHAR' TYPE 'E'.
      ERR = 1.
    ENDIF.
*BREAK-POINT.
    SELECT SINGLE * FROM ZDMS2 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM AND DEPT EQ WA_FOLW2-DEPT.
    IF SY-SUBRC EQ 4.
      MESSAGE 'THIS DEPARTMENT IS NOT VALID' TYPE 'E'.
      ERR = 1.
    ENDIF.

*    BREAK-POINT.
    IF WA_FOLW2-CTDATE1 NE '00000000'.
      SELECT SINGLE * FROM ZDMS1 WHERE MJAHR EQ WA_FOLW2-MJAHR AND MBLNR = WA_FOLW2-MBLNR.
      IF SY-SUBRC EQ 0.
        IF WA_FOLW2-CTDATE1 LT ZDMS1-BUDAT.
          MESSAGE 'COMPLETION DATE IS LOWER THAT INITIATION DATE' TYPE 'E'.
          ERR = 1.
        ENDIF.
      ENDIF.
      IF WA_FOLW2-CTDATE1 GT SY-DATUM.
        MESSAGE 'COMPLETION DATE CAN NOT BE FUTURE DATE' TYPE 'E'.
        ERR = 1.
      ENDIF.
    ENDIF.
    CLEAR WA_FOLW2.
  ENDLOOP.
*        BREAK-POINT.
*************************************************************
  IF ERR NE 1.

*    DELETE FROM zdms3 WHERE mjahr EQ year AND mblnr EQ ccnum.
*
*    LOOP AT it_folw2 INTO wa_folw2 WHERE atext1 NE space.
*      ON CHANGE OF wa_folw2-dept.
*        zeile1 = 1.
*      ENDON.
*      zdms3_wa-mjahr = wa_folw2-mjahr.
*      zdms3_wa-mblnr = wa_folw2-mblnr.
*      zdms3_wa-dept = wa_folw2-dept.
*      zdms3_wa-zeile = zeile1.
*      zdms3_wa-budat = sy-datum.
*      zdms3_wa-uzeit = sy-uzeit.
*      zdms3_wa-uname = sy-uname.
*      zdms3_wa-pernr = pernr.
*      zdms3_wa-atext1 = wa_folw2-atext1.
*      zdms3_wa-tdate1 = wa_folw2-tdate1.
*      zdms3_wa-rem1 = wa_folw2-rem1.
*      zdms3_wa-ctdate1 = wa_folw2-ctdate1.
*      zdms3_wa-folw1 = wa_folw2-fchk.
*      MODIFY zdms3 FROM zdms3_wa.
*      CLEAR zdms3_wa.
*      zeile1 = zeile1 + 1.
*      a = 1.
*    ENDLOOP.
*
*    IF a EQ 1.
*      MESSAGE 'DATA UPDATED' TYPE 'I'.
*    ENDIF.
*    CLEAR : it_folw1,it_folw2,wa_folw1,wa_folw2.
    CLEAR :  UPDCD.  "COMPLETION DATE.
    SELECT SINGLE * FROM ZDMS4 WHERE MJAHR EQ  YEAR AND MBLNR EQ CCNUM AND TDAPPROVE EQ 'X'.
    IF SY-SUBRC EQ 0.
      UPDCD = 1.
    ENDIF.
    IF UPDCD EQ 1.
*              BREAK-POINT.
      LOOP AT IT_FOLW2 INTO WA_FOLW2 WHERE ATEXT1 NE SPACE AND CTDATE1 GT 0.
        SELECT SINGLE * FROM ZDMS1 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM. "additional check on 6.6.24
        IF SY-SUBRC EQ 0.
          SELECT SINGLE * FROM ZDMS3 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM AND DEPT EQ WA_FOLW2-DEPT AND ZEILE EQ WA_FOLW2-ZEILE AND CTDATE1 LE 0.
          IF SY-SUBRC EQ 0.
            MOVE-CORRESPONDING ZDMS3 TO ZDMS3_WA.


            ZDMS3_WA-CTDATE1 = WA_FOLW2-CTDATE1.
            ZDMS3_WA-CTCPUDT = SY-DATUM.
            ZDMS3_WA-CTUZEIT = SY-UZEIT.
            ZDMS3_WA-CTUNAME = SY-UNAME.
            ZDMS3_WA-CTPERNR = PERNR.
            MODIFY ZDMS3 FROM ZDMS3_WA.
            CLEAR ZDMS3_WA.
            ZEILE1 = ZEILE1 + 1.
            A = 1.
          ENDIF.
        ENDIF.
      ENDLOOP.

      IF A EQ 1.
        MESSAGE 'DATA UPDATED' TYPE 'I'.
      ENDIF.
      CLEAR : IT_FOLW1,IT_FOLW2,WA_FOLW1,WA_FOLW2.

    ELSE.
      DELETE FROM ZDMS3 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM.

      LOOP AT IT_FOLW2 INTO WA_FOLW2 WHERE ATEXT1 NE SPACE.
        SELECT SINGLE * FROM ZDMS1 WHERE MJAHR EQ WA_FOLW2-MJAHR AND MBLNR EQ WA_FOLW2-MBLNR. "additional check on 6.6.24
        IF SY-SUBRC EQ 0.
          ON CHANGE OF WA_FOLW2-DEPT.
            ZEILE1 = 1.
          ENDON.
          ZDMS3_WA-MJAHR = WA_FOLW2-MJAHR.
          ZDMS3_WA-MBLNR = WA_FOLW2-MBLNR.
          ZDMS3_WA-DEPT = WA_FOLW2-DEPT.
          ZDMS3_WA-ZEILE = ZEILE1.
          ZDMS3_WA-BUDAT = SY-DATUM.
          ZDMS3_WA-UZEIT = SY-UZEIT.
          ZDMS3_WA-UNAME = SY-UNAME.
          ZDMS3_WA-PERNR = PERNR.
          ZDMS3_WA-ATEXT1 = WA_FOLW2-ATEXT1.
          ZDMS3_WA-TDATE1 = WA_FOLW2-TDATE1.
          ZDMS3_WA-REM1 = WA_FOLW2-REM1.
          ZDMS3_WA-CTDATE1 = WA_FOLW2-CTDATE1.
          ZDMS3_WA-FOLW1 = WA_FOLW2-FCHK.
          MODIFY ZDMS3 FROM ZDMS3_WA.
          CLEAR ZDMS3_WA.
          ZEILE1 = ZEILE1 + 1.
          A = 1.
        ENDIF.
      ENDLOOP.

      IF A EQ 1.
        MESSAGE 'DATA UPDATED' TYPE 'I'.
      ENDIF.
      CLEAR : IT_FOLW1,IT_FOLW2,WA_FOLW1,WA_FOLW2.
    ENDIF.

  ENDIF.

*  LEAVE TO TRANSACTION 'ZQMS'.
  LEAVE TO SCREEN 0.

ENDFORM.
*&---------------------------------------------------------------------*
*&      Form  FZDMS3
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM FZDMS2.
*  BREAK-POINT.
  ZEILE = 1.
  SORT IT_ZDMS2 BY DEPT.

  LOOP AT IT_ZDMS2 INTO WA_ZDMS2 WHERE ATEXT1 NE SPACE.
    WA_FOLW1-MJAHR = WA_ZDMS2-MJAHR.
    WA_FOLW1-MBLNR = WA_ZDMS2-MBLNR.
    WA_FOLW1-DEPT = WA_ZDMS2-DEPT.
*      WA_FOLW1-ZEILE = ZEILE.
    WA_FOLW1-UBUDAT = WA_ZDMS2-UBUDAT.
    WA_FOLW1-UPERNR = WA_ZDMS2-UPERNR.
    WA_FOLW1-ATEXT1 = WA_ZDMS2-ATEXT1.
    WA_FOLW1-TDATE1 = WA_ZDMS2-TDATE1.
    WA_FOLW1-CTDATE1 = WA_ZDMS2-CTDATE1.
    WA_FOLW1-REM1 = WA_ZDMS2-REM1.
*      ZEILE = ZEILE + 1.
    COLLECT WA_FOLW1 INTO IT_FOLW1.
    CLEAR WA_FOLW1.
  ENDLOOP.

  LOOP AT IT_ZDMS2 INTO WA_ZDMS2 WHERE ATEXT2 NE SPACE.
    WA_FOLW1-MJAHR = WA_ZDMS2-MJAHR.
    WA_FOLW1-MBLNR = WA_ZDMS2-MBLNR.
    WA_FOLW1-DEPT = WA_ZDMS2-DEPT.
*      WA_FOLW1-ZEILE = ZEILE.
    WA_FOLW1-UBUDAT = WA_ZDMS2-UBUDAT.
    WA_FOLW1-UPERNR = WA_ZDMS2-UPERNR.
    WA_FOLW1-ATEXT1 = WA_ZDMS2-ATEXT2.
    WA_FOLW1-TDATE1 = WA_ZDMS2-TDATE2.
    WA_FOLW1-CTDATE1 = WA_ZDMS2-CTDATE2.
    WA_FOLW1-REM1 = WA_ZDMS2-REM2.
*      ZEILE = ZEILE + 1.
    COLLECT WA_FOLW1 INTO IT_FOLW1.
    CLEAR WA_FOLW1.
  ENDLOOP.

  LOOP AT IT_ZDMS2 INTO WA_ZDMS2 WHERE ATEXT3 NE SPACE.
    WA_FOLW1-MJAHR = WA_ZDMS2-MJAHR.
    WA_FOLW1-MBLNR = WA_ZDMS2-MBLNR.
    WA_FOLW1-DEPT = WA_ZDMS2-DEPT.
*      WA_FOLW1-ZEILE = ZEILE.
    WA_FOLW1-UBUDAT = WA_ZDMS2-UBUDAT.
    WA_FOLW1-UPERNR = WA_ZDMS2-UPERNR.
    WA_FOLW1-ATEXT1 = WA_ZDMS2-ATEXT3.
    WA_FOLW1-TDATE1 = WA_ZDMS2-TDATE3.
    WA_FOLW1-CTDATE1 = WA_ZDMS2-CTDATE3.
    WA_FOLW1-REM1 = WA_ZDMS2-REM3.
*      ZEILE = ZEILE + 1.
    COLLECT WA_FOLW1 INTO IT_FOLW1.
    CLEAR WA_FOLW1.
  ENDLOOP.

  LOOP AT IT_ZDMS2 INTO WA_ZDMS2 WHERE ATEXT4 NE SPACE.
    WA_FOLW1-MJAHR = WA_ZDMS2-MJAHR.
    WA_FOLW1-MBLNR = WA_ZDMS2-MBLNR.
    WA_FOLW1-DEPT = WA_ZDMS2-DEPT.
*      WA_FOLW1-ZEILE = ZEILE.
    WA_FOLW1-UBUDAT = WA_ZDMS2-UBUDAT.
    WA_FOLW1-UPERNR = WA_ZDMS2-UPERNR.
    WA_FOLW1-ATEXT1 = WA_ZDMS2-ATEXT4.
    WA_FOLW1-TDATE1 = WA_ZDMS2-TDATE4.
    WA_FOLW1-CTDATE1 = WA_ZDMS2-CTDATE4.
    WA_FOLW1-REM1 = WA_ZDMS2-REM4.
*      ZEILE = ZEILE + 1.
    COLLECT WA_FOLW1 INTO IT_FOLW1.
    CLEAR WA_FOLW1.
  ENDLOOP.

  LOOP AT IT_ZDMS2 INTO WA_ZDMS2 WHERE ATEXT5 NE SPACE.
    WA_FOLW1-MJAHR = WA_ZDMS2-MJAHR.
    WA_FOLW1-MBLNR = WA_ZDMS2-MBLNR.
    WA_FOLW1-DEPT = WA_ZDMS2-DEPT.
*      WA_FOLW1-ZEILE = ZEILE.
    WA_FOLW1-UBUDAT = WA_ZDMS2-UBUDAT.
    WA_FOLW1-UPERNR = WA_ZDMS2-UPERNR.
    WA_FOLW1-ATEXT1 = WA_ZDMS2-ATEXT5.
    WA_FOLW1-TDATE1 = WA_ZDMS2-TDATE5.
    WA_FOLW1-CTDATE1 = WA_ZDMS2-CTDATE5.
    WA_FOLW1-REM1 = WA_ZDMS2-REM5.
*      ZEILE = ZEILE + 1.
    COLLECT WA_FOLW1 INTO IT_FOLW1.
    CLEAR WA_FOLW1.
  ENDLOOP.

  LOOP AT IT_ZDMS2 INTO WA_ZDMS2.
*    READ TABLE IT_FOLW1 INTO WA_FOLW1 WITH KEY DEPT = WA_ZDMS2-DEPT.
*    IF SY-SUBRC EQ 4.
    WA_FOLW1-MJAHR = WA_ZDMS2-MJAHR.
    WA_FOLW1-MBLNR = WA_ZDMS2-MBLNR.
    WA_FOLW1-DEPT = SPACE.
*      WA_FOLW1-ZEILE = ZEILE.
    WA_FOLW1-UBUDAT = '00000000'.
    WA_FOLW1-UPERNR = 0.
    WA_FOLW1-ATEXT1 = ' '.
    WA_FOLW1-CTDATE1 = '00000000'.
    WA_FOLW1-REM1 = '  '  .
*      ZEILE = ZEILE + 1.
    COLLECT WA_FOLW1 INTO IT_FOLW1.
    CLEAR WA_FOLW1.
*    ENDIF.
  ENDLOOP.
*  BREAK-POINT.

  SORT IT_FOLW1 BY DEPT.
  ZEILE = 1.
  LOOP AT IT_FOLW1 INTO WA_FOLW1.
    WA_FOLW2-MJAHR = WA_FOLW1-MJAHR.
    WA_FOLW2-MBLNR = WA_FOLW1-MBLNR.
    WA_FOLW2-DEPT = WA_FOLW1-DEPT.
    SELECT SINGLE * FROM T001P WHERE BTRTL EQ WA_FOLW1-DEPT.
    IF SY-SUBRC EQ 0.
      WA_FOLW2-BTEXT = T001P-BTEXT.
    ENDIF.
    WA_FOLW2-ZEILE = ZEILE.
    WA_FOLW2-UBUDAT = WA_FOLW1-UBUDAT.
    WA_FOLW2-UPERNR = WA_FOLW1-UPERNR.
    WA_FOLW2-ATEXT1 = WA_FOLW1-ATEXT1.
    WA_FOLW2-TDATE1 = WA_FOLW1-TDATE1.
    WA_FOLW2-CTDATE1 = WA_FOLW1-CTDATE1.
    WA_FOLW2-REM1 = WA_FOLW1-REM1.
    ZEILE = ZEILE + 1.
    COLLECT WA_FOLW2 INTO IT_FOLW2.
    CLEAR WA_FOLW2.
  ENDLOOP.
*  BREAK-POINT.
  SORT   IT_FOLW1 BY DEPT.


*  LOOP AT IT_ZDMS2 INTO WA_ZDMS2.

  DO 10 TIMES.
    WA_FOLW2-MJAHR = WA_ZDMS2-MJAHR.
    WA_FOLW2-MBLNR = WA_ZDMS2-MBLNR.
*    WA_FOLW2-DEPT = WA_ZDMS2-DEPT.
*    SELECT SINGLE * FROM T001P WHERE BTRTL EQ WA_ZDMS2-DEPT.
*    IF SY-SUBRC EQ 0.
*      WA_FOLW2-BTEXT = T001P-BTEXT.
*    ENDIF.
*    WA_FOLW2-ZEILE = CNT1.
*    CNT1 = CNT1 + 1.
    WA_FOLW2-DEPT = SPACE.

    WA_FOLW2-BTEXT = SPACE.

    WA_FOLW2-ZEILE = ZEILE.
    WA_FOLW2-UBUDAT = 0.
    WA_FOLW2-UPERNR = 0.
    WA_FOLW2-ATEXT1 = SPACE.
    WA_FOLW2-TDATE1 = 0.
    WA_FOLW2-CTDATE1 = 0.
    WA_FOLW2-REM1 = SPACE.
    COLLECT WA_FOLW2 INTO IT_FOLW2.
    CLEAR WA_FOLW2.
    ZEILE = ZEILE + 1.
  ENDDO.
*  ENDLOOP.


*  LOOP AT IT_ZDMS2 INTO WA_ZDMS2.
*    WA_FOLW2-MJAHR = WA_ZDMS2-MJAHR.
*    WA_FOLW2-MBLNR = WA_ZDMS2-MBLNR.
*    WA_FOLW2-DEPT = WA_ZDMS2-DEPT.
*    SELECT SINGLE * FROM T001P WHERE BTRTL EQ WA_ZDMS2-DEPT.
*    IF SY-SUBRC EQ 0.
*      WA_FOLW2-BTEXT = T001P-BTEXT.
*    ENDIF.
*    WA_FOLW2-ZEILE = CNT1.
*    CNT1 = CNT1 + 1.
*    COLLECT WA_FOLW2 INTO IT_FOLW2.
*    CLEAR WA_FOLW2.
*  ENDLOOP.


*  LOOP AT IT_ZDMS2 INTO WA_ZDMS2.
*    WA_FOLW2-MJAHR = WA_ZDMS2-MJAHR.
*    WA_FOLW2-MBLNR = WA_ZDMS2-MBLNR.
*    WA_FOLW2-DEPT = WA_ZDMS2-DEPT.
*    SELECT SINGLE * FROM T001P WHERE BTRTL EQ WA_ZDMS2-DEPT.
*    IF SY-SUBRC EQ 0.
*      WA_FOLW2-BTEXT = T001P-BTEXT.
*    ENDIF.
*    WA_FOLW2-ZEILE = CNT1.
*    CNT1 = CNT1 + 1.
*    COLLECT WA_FOLW2 INTO IT_FOLW2.
*    CLEAR WA_FOLW2.
*  ENDLOOP.




ENDFORM.
*&---------------------------------------------------------------------*
*&      Form  FZDMS3
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM FZDMS3.
  CLEAR : IT_FOLW2,WA_FOLW2.

  LOOP AT IT_ZDMS3 INTO WA_ZDMS3 WHERE CTDATE1 LE 0.
    WA_FOLW2-MJAHR = WA_ZDMS3-MJAHR.
    WA_FOLW2-MBLNR = WA_ZDMS3-MBLNR.
    WA_FOLW2-DEPT = WA_ZDMS3-DEPT.
    SELECT SINGLE * FROM T001P WHERE BTRTL EQ WA_ZDMS3-DEPT.
    IF SY-SUBRC EQ 0.
      WA_FOLW2-BTEXT = T001P-BTEXT.
    ENDIF.
    WA_FOLW2-ZEILE = WA_ZDMS3-ZEILE.
    WA_FOLW2-UBUDAT = WA_ZDMS3-BUDAT.
    WA_FOLW2-UPERNR = WA_ZDMS3-PERNR.
    WA_FOLW2-ATEXT1 = WA_ZDMS3-ATEXT1.
    WA_FOLW2-TDATE1 = WA_ZDMS3-TDATE1.
    WA_FOLW2-CTDATE1 = WA_ZDMS3-CTDATE1.
    WA_FOLW2-REM1 = WA_ZDMS3-REM1.
    WA_FOLW2-FCHK = WA_ZDMS3-FOLW1.
    COLLECT WA_FOLW2 INTO IT_FOLW2.
    CLEAR WA_FOLW2.
    ZEILE = WA_ZDMS3-ZEILE.
  ENDLOOP.
* FOLLWING CODE IS DEACTIVATED ON 10.5.23
*  SELECT SINGLE * FROM zdms4 WHERE mjahr EQ year AND mblnr EQ ccnum AND cl1 EQ ' ' AND cl2 EQ ' '.
*  IF sy-subrc EQ 0.
*    CLEAR zeile.
*    SORT it_zdms3 DESCENDING BY zeile.
*    LOOP AT it_zdms2 INTO wa_zdms2.
*      wa_folw2-mjahr = wa_zdms2-mjahr.
*      wa_folw2-mblnr = wa_zdms2-mblnr.
**      WA_FOLW2-DEPT = WA_ZDMS2-DEPT.
*      SELECT SINGLE * FROM t001p WHERE btrtl EQ wa_zdms2-dept.
*      IF sy-subrc EQ 0.
**        WA_FOLW2-BTEXT = T001P-BTEXT.
*      ENDIF.
*
*      READ TABLE it_zdms3 INTO  wa_zdms3 WITH KEY dept =  wa_zdms2-dept.
*      IF sy-subrc EQ 0.
*        zeile = wa_zdms3-zeile + 1.
*      ENDIF.
*      wa_folw2-zeile = zeile.
*      wa_folw2-ubudat = sy-datum.
*      wa_folw2-upernr = pernr.
**    WA_FOLW2-ATEXT1 = WA_ZDMS3-ATEXT1.
**    WA_FOLW2-TDATE1 = WA_ZDMS3-TDATE1.
**    WA_FOLW2-CTDATE1 = WA_ZDMS3-CTDATE1.
**    WA_FOLW2-REM1 = WA_ZDMS3-REM1.
**    WA_FOLW2-FCHK = WA_ZDMS3-FOLW1.
**    WA_FOLW2-CHK = 'X'.
*      COLLECT wa_folw2 INTO it_folw2.
*      CLEAR wa_folw2.
**    zeile = zeile + 1.
*    ENDLOOP.
*  ENDIF.

ENDFORM.
*&---------------------------------------------------------------------*
*&      Form  EMAIL
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM EMAIL.
*  BREAK-POINT .
  CLEAR : SUBJECT.
  CLEAR : OBJTXT. "7.6.21
  REFRESH OBJTXT. "7.6.21
  SELECT SINGLE * FROM ZDMS1 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM.
  IF SY-SUBRC EQ 0.
    CONCATENATE ZDMS1-QAREMARK1 ZDMS1-QAREMARK2  ZDMS1-QAREMARK3 INTO SUBJECT SEPARATED BY SPACE.
  ENDIF.

*  BREAK-POINT.
  CLEAR : IT_EMAIL,WA_EMAIL.
*  IF SY-HOST EQ 'SAPQLT' OR SY-HOST EQ 'SAPDEV' OR SY-HOST EQ 'SAPQLT19'.
  IF SY-HOST CS 'SAPQLT' OR SY-HOST CS 'SAPDEV' .
*  IF SY-HOST EQ 'SAPQLT'.
*  BREAK-POINT .
*  IF sy-host EQ 'SAPQLT'.
*  IF sy-host EQ 'SAPDEV'.
  ELSE.
    CLEAR : IT_EMAIL,WA_EMAIL.
    IF R1 EQ 'X'.
      PERFORM EMAIL1.
*    ELSEIF R2 EQ 'X' OR R3 EQ 'X' OR R21 EQ 'X'. "5.3.2020
*      PERFORM EMAIL2.
    ELSEIF R2 EQ 'X' .
*      OR r21 EQ 'X'.
*      BREAK-POINT.
      PERFORM EMAIL2_1.

*    ELSEIF r21 EQ 'X'.
**      BREAK-POINT.
*      PERFORM email2_2.
    ELSEIF R3 EQ 'X'.
      PERFORM EMAIL21.
      IF REJECT1 EQ 'X'.
        PERFORM EMAIL2.
      ENDIF.
    ELSEIF R4 EQ 'X'.
      IF ADDDEPT EQ 1.
        PERFORM EMAIL5.
      ELSE.
        PERFORM EMAIL4.
      ENDIF.
    ELSEIF R33 EQ 'X'.
      PERFORM EMAIL33.
    ELSEIF R32 EQ 'X'.
      PERFORM EMAIL32.
    ELSEIF R21A EQ 'X'.
      PERFORM EMAIL21A.
    ELSEIF R21 EQ 'X'.
      PERFORM EMAIL21B.
    ELSEIF RE1 EQ 'X'.
      IF DEPTEMAIL1 EQ 1.
        PERFORM EXTEMAIL1.  "EMAIL TO RESPONCIBLE DEPT & QA/CQD
      ELSE.
        PERFORM EXTEMAIL2.  "EMAIL TO INITIATING DEPT HEAD
      ENDIF.
    ELSEIF RE2 EQ 'X'.
      PERFORM EXTEMAIL3.  "SEND EMAIL TO QA IF ALL DEPARTMENTS HAVE APPROVED
    ELSEIF RE3 EQ 'X'.
      PERFORM EXTEMAIL4.  "SEND EMAIL TO ALL RESPONCIBLE DEPARTMENT
    ELSEIF R81 EQ 'X' OR R91 EQ 'X'.
      PERFORM CLOSEEMAIL.  "14.6.22
    ENDIF.

    CALL FUNCTION 'SX_TABLE_LINE_WIDTH_CHANGE'
      EXPORTING
        LINE_WIDTH_DST = '255'
      TABLES
        CONTENT_IN     = L_ASC_DATA
        CONTENT_OUT    = OBJBIN.

    IF R1 EQ 'X'.
      WRITE SY-DATUM TO WA_D1 DD/MM/YYYY.
    ELSE.
      SELECT SINGLE * FROM ZDMS1 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM.
      IF SY-SUBRC EQ 0.
        WRITE ZDMS1-BUDAT TO WA_D1 DD/MM/YYYY.
      ENDIF.
    ENDIF.

    SELECT SINGLE * FROM ZDMS1 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM.
    IF SY-SUBRC EQ 0.
      SELECT SINGLE * FROM PA0001 WHERE PERNR EQ ZDMS1-PERNR AND ENDDA GE SY-DATUM.
      IF SY-SUBRC EQ 0.
        ENAME = PA0001-ENAME.
      ENDIF.
      CLEAR : RSTAT.
      IF ZDMS1-REJECT EQ 'X'.
        RSTAT = 'REJECTED'.
      ENDIF.
    ENDIF.


*    BREAK-POINT.
    CONDENSE OBJTXT.

    DESCRIBE TABLE OBJBIN LINES RIGHE_ATTACHMENT.

    W_OBJTXT = SUBJECT.
    APPEND W_OBJTXT TO OBJTXT.
    CLEAR W_OBJTXT.

    W_OBJTXT = '    '.
    APPEND W_OBJTXT TO OBJTXT.
    CLEAR W_OBJTXT.

    W_OBJTXT+0(35) = 'New Change control is Initiated by:'.
    W_OBJTXT+37(20) = ENAME.
    APPEND W_OBJTXT TO OBJTXT.
    CLEAR W_OBJTXT.

    W_OBJTXT+0(23) = 'CC-Notification Number:'.
    IF R1 EQ 'X'.
      W_OBJTXT+26(10) = FINV.
    ELSE.
      W_OBJTXT+26(10) = CCNUM.
    ENDIF.
    W_OBJTXT+38(5) = 'Dated'.
    W_OBJTXT+45(10) = WA_D1.
    IF WERKS EQ '4000'.
      KUNNR = 'CQD'.
    ENDIF.
    W_OBJTXT+56(5) = 'Plant'.  "added on 20.5.22
    W_OBJTXT+62(10) = KUNNR.

    APPEND W_OBJTXT TO OBJTXT.
    CLEAR W_OBJTXT.
*BREAK-POINT.

    IF R1 EQ 'X'.
      W_OBJTXT+0(30) = 'You are requested to Approve'.
    ELSEIF R2 EQ 'X'.
      W_OBJTXT+0(12) = 'Dept. Head'.
      W_OBJTXT+14(25) = DEPTHNAME.
      W_OBJTXT+40(10) = RSTAT.
    ELSEIF R21 EQ 'X'.
*    BREAK-POINT.
      IF RAPPROVE1 EQ 'X'.
        W_OBJTXT+0(12) = 'Approved By'.
      ELSEIF RREJECT1 EQ 'X'.
        W_OBJTXT+0(12) = 'Rejected By'.
      ENDIF.
      W_OBJTXT+14(25) = DEPTAPPRNAME.
    ELSEIF R21A EQ 'X'.  "26.3.23
*      BREAK-POINT.
      CLEAR REVIEWER.
      SELECT SINGLE * FROM PA0001 WHERE PERNR EQ PERNR AND ENDDA GE SY-DATUM.
      IF SY-SUBRC EQ 0.
        REVIEWER = PA0001-ENAME.
      ENDIF.
*      BREAK-POINT.
      IF RAPPROVE2 EQ 'X'.
        W_OBJTXT+0(12) = 'Reviewed By'.
      ELSEIF RREJECT2 EQ 'X'.
        W_OBJTXT+0(12) = 'REJECTED BY'.
      ENDIF.
      W_OBJTXT+14(25) = REVIEWER.
    ELSEIF R4 EQ 'X'.
      W_OBJTXT+0(50) = 'You are requested to enter Impacted activities'.

    ELSEIF R3 EQ 'X'.
*    BREAK-POINT.
      IF REJECT1 EQ 'X'.
        W_OBJTXT+0(36) = 'IMPCATED ACTIVITIES ARE RESET for REJECTION'.
      ELSE.
        W_OBJTXT+0(36) = 'All Impacted activities are entered'.
      ENDIF.
    ELSEIF R32 EQ 'X'.
      W_OBJTXT+0(45) = 'You are requested to AUTHORIZE change control'.
*    W_OBJTXT+38(20) = INAME1.
    ELSEIF R33 EQ 'X'.
      W_OBJTXT+0(19) = 'Change Control is:'.
      IF TDAPPROVE EQ 'X'.
*      W_OBJTXT+21(10) = 'APPROVED'.
        W_OBJTXT+21(10) = 'AUTHORIZED'.
      ELSEIF TDREJECT EQ 'X'.
        W_OBJTXT+21(10) = 'REJECTED'.
      ENDIF.
      IF FINVNUMB NE SPACE.
        W_OBJTXT+33(20) = FINVNUMB.
      ELSEIF CCNUMB1 NE SPACE.
        W_OBJTXT+33(20) = CCNUMB1.
      ELSE.
        W_OBJTXT+33(20) = WA_ZDMS4-CCNUMB1.
      ENDIF.
    ELSEIF RE1 EQ 'X'.
*      IF deptemail1 EQ 1.
*
*      ELSE.
      W_OBJTXT+0(94) = 'You are requested to Approve Change Control Closure extension Request: Responsible Department'.
*      ENDIF.
    ELSEIF RE2 EQ 'X'.
      W_OBJTXT+0(86) = 'You are requested to Approve Change Control Closure extension Request: QA/CQD Approval'.
    ELSEIF RE3 EQ 'X'.
      CLEAR : WA_CLDT1.
      WRITE REVCLDATE TO WA_CLDT1 DD/MM/YYYY.
      W_OBJTXT+0(59) = 'QA/CQD Approved Change Control Closure Extension Date is   '.
      W_OBJTXT+59(10) = WA_CLDT1.
    ELSEIF R81 EQ 'X'.
      W_OBJTXT+0(59) = 'Approved Change Control Closure-I is done'.
    ELSEIF R91 EQ 'X'.
      W_OBJTXT+0(59) = 'Approved Change Control Closure-II is done'.
    ENDIF.
    APPEND W_OBJTXT TO OBJTXT.
    CLEAR W_OBJTXT.

    CONDENSE OBJTXT.

    CONDENSE LTX.
    CONDENSE OBJTXT.

*  BREAK-POINT.
    IF R1 EQ 'X'.
      CONCATENATE 'CC-Notificatio no.: ' FINV 'Dated' WA_D1 INTO DOC_CHNG-OBJ_DESCR SEPARATED BY SPACE.
    ELSE.
      CONCATENATE 'CC-Notificatio no.: ' CCNUM 'Dated' WA_D1 INTO DOC_CHNG-OBJ_DESCR SEPARATED BY SPACE.
    ENDIF.

    DOC_CHNG-SENSITIVTY = 'F'.
    DOC_CHNG-DOC_SIZE = RIGHE_TESTO * 255 .

    CLEAR OBJPACK-TRANSF_BIN.

    OBJPACK-HEAD_START = 1.
    OBJPACK-HEAD_NUM = 0.
    OBJPACK-BODY_START = 1.
    OBJPACK-BODY_NUM = 5.
    OBJPACK-DOC_TYPE = 'TXT'.
    APPEND OBJPACK.
*  BREAK-POINT.
    LOOP AT IT_EMAIL INTO WA_EMAIL.
      RECLIST-RECEIVER =   WA_EMAIL-USRID_LONG.
      RECLIST-EXPRESS = 'X'.
      RECLIST-REC_TYPE = 'U'.
      RECLIST-NOTIF_DEL = 'X'. " request delivery notification
      RECLIST-NOTIF_NDEL = 'X'. " request not delivered notification
      APPEND RECLIST.
      CLEAR RECLIST.
    ENDLOOP.
    DESCRIBE TABLE RECLIST LINES MCOUNT.
    IF MCOUNT > 0.
      DATA: SENDER LIKE SOEXTRECI1-RECEIVER.
***ADDED BY SATHISH.B
      TYPES: BEGIN OF T_USR21,
               BNAME      TYPE USR21-BNAME,
               PERSNUMBER TYPE USR21-PERSNUMBER,
               ADDRNUMBER TYPE USR21-ADDRNUMBER,
             END OF T_USR21.

      TYPES: BEGIN OF T_ADR6,
               ADDRNUMBER TYPE USR21-ADDRNUMBER,
               PERSNUMBER TYPE USR21-PERSNUMBER,
               SMTP_ADDR  TYPE ADR6-SMTP_ADDR,
             END OF T_ADR6.

      DATA: IT_USR21 TYPE TABLE OF T_USR21,
            WA_USR21 TYPE T_USR21,
            IT_ADR6  TYPE TABLE OF T_ADR6,
            WA_ADR6  TYPE T_ADR6.
      SELECT  BNAME PERSNUMBER ADDRNUMBER FROM USR21 INTO TABLE IT_USR21
          WHERE BNAME = SY-UNAME.
      IF SY-SUBRC = 0.
        SELECT ADDRNUMBER PERSNUMBER SMTP_ADDR FROM ADR6 INTO TABLE IT_ADR6
          FOR ALL ENTRIES IN IT_USR21 WHERE ADDRNUMBER = IT_USR21-ADDRNUMBER
                                      AND   PERSNUMBER = IT_USR21-PERSNUMBER.
      ENDIF.
      LOOP AT IT_USR21 INTO WA_USR21.
        READ TABLE IT_ADR6 INTO WA_ADR6 WITH KEY ADDRNUMBER = WA_USR21-ADDRNUMBER.
        IF SY-SUBRC = 0.
          SENDER = WA_ADR6-SMTP_ADDR.
        ENDIF.
      ENDLOOP.
      CALL FUNCTION 'SO_DOCUMENT_SEND_API1'
        EXPORTING
          DOCUMENT_DATA              = DOC_CHNG
          PUT_IN_OUTBOX              = 'X'
          SENDER_ADDRESS             = SENDER
          SENDER_ADDRESS_TYPE        = 'SMTP'
*         COMMIT_WORK                = ' '
* IMPORTING
*         SENT_TO_ALL                =
*         NEW_OBJECT_ID              =
*         SENDER_ID                  =
        TABLES
          PACKING_LIST               = OBJPACK
*         OBJECT_HEADER              =
          CONTENTS_BIN               = OBJBIN
          CONTENTS_TXT               = OBJTXT
*         CONTENTS_HEX               =
*         OBJECT_PARA                =
*         OBJECT_PARB                =
          RECEIVERS                  = RECLIST
        EXCEPTIONS
          TOO_MANY_RECEIVERS         = 1
          DOCUMENT_NOT_SENT          = 2
          DOCUMENT_TYPE_NOT_EXIST    = 3
          OPERATION_NO_AUTHORIZATION = 4
          PARAMETER_ERROR            = 5
          X_ERROR                    = 6
          ENQUEUE_ERROR              = 7
          OTHERS                     = 8.
      IF SY-SUBRC <> 0.
        MESSAGE ID SY-MSGID TYPE SY-MSGTY NUMBER SY-MSGNO
                WITH SY-MSGV1 SY-MSGV2 SY-MSGV3 SY-MSGV4.
      ENDIF.

      COMMIT WORK.

      IF SY-SUBRC EQ 0.

        WRITE : / 'EMAIL SENT ON ','id'.
      ENDIF.
      CLEAR   : OBJPACK,
               OBJHEAD,
               OBJTXT,
               OBJBIN,
               RECLIST.

      REFRESH : OBJPACK,
                OBJHEAD,
                OBJTXT,
                OBJBIN,
                RECLIST.

    ENDIF.
  ENDIF.
ENDFORM.
*&---------------------------------------------------------------------*
*&      Form  EMAIL1
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM EMAIL1 .


  CLEAR : DEPTHEAD.
*  SELECT SINGLE * FROM PA0001 WHERE PERNR = PERNR AND ENDDA GE SY-DATUM AND PLANS NE '99999999'..
  SELECT SINGLE * FROM ZPA0001 WHERE PERNR = PERNR AND ENDDA GE SY-DATUM . "AND PLANS NE '99999999'..
  IF SY-SUBRC EQ 0.

    SELECT SINGLE * FROM ZQMS_DEPTHEAD1 WHERE BTRTL EQ ZPA0001-BTRTL AND TO_DT GE SY-DATUM..  "24.7.22
    IF SY-SUBRC EQ 0.
      DEPTHEAD = ZQMS_DEPTHEAD1-PERNR.
    ENDIF.

*    SELECT SINGLE * FROM hrp1000 WHERE objid EQ pa0001-plans AND otype EQ 'O'.
*    IF sy-subrc EQ 0.
**      WRITE :  'DEPARTMENT HEAD'.
*      depthead = pa0001-pernr.
*    ELSE.
*      SELECT SINGLE * FROM hrp1001 WHERE objid EQ pa0001-plans AND endda GT sy-datum AND rsign EQ 'A' AND relat EQ '003' .
*      IF sy-subrc EQ 0.
*        SELECT SINGLE * FROM hrp1001 WHERE objid EQ hrp1001-sobid AND endda GT sy-datum AND rsign EQ 'B' AND relat EQ '012'.
*        IF sy-subrc EQ 0.
*          SELECT SINGLE * FROM pa0001 WHERE plans EQ hrp1001-sobid AND endda GT sy-datum.
*          IF sy-subrc EQ 0.
*            depthead = pa0001-pernr.
*          ENDIF.
*        ENDIF.
*      ENDIF.
*    ENDIF.
  ENDIF.

  SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ DEPTHEAD.
  IF SY-SUBRC EQ 0.
    WA_EMAIL-PERNR = DEPTHEAD.
    WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
    COLLECT WA_EMAIL INTO IT_EMAIL.
    CLEAR WA_EMAIL.

*    IF depthead EQ '00002051'.
    IF DEPTHEAD EQ '00005693'.  "13.6.22
      WA_EMAIL-PERNR = '00011171'.
      SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ '00011171'.
      IF SY-SUBRC EQ 0.
        WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
      ENDIF.
      COLLECT WA_EMAIL INTO IT_EMAIL.
      CLEAR WA_EMAIL.
    ELSEIF DEPTHEAD EQ '00013959'.  "13.6.22
      WA_EMAIL-PERNR = '00016102'.
      SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ '00016102'.
      IF SY-SUBRC EQ 0.
        WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
      ENDIF.
      COLLECT WA_EMAIL INTO IT_EMAIL.
      CLEAR WA_EMAIL.
    ELSEIF DEPTHEAD EQ '00011924'.
      WA_EMAIL-PERNR = '00012420'.
      SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ '00012420'.
      IF SY-SUBRC EQ 0.
        WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
      ENDIF.
      COLLECT WA_EMAIL INTO IT_EMAIL.
      CLEAR WA_EMAIL.

      WA_EMAIL-PERNR = '00013907'.
      SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ '00013907'.
      IF SY-SUBRC EQ 0.
        WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
      ENDIF.
      COLLECT WA_EMAIL INTO IT_EMAIL.
      CLEAR WA_EMAIL.

    ELSEIF DEPTHEAD EQ '00005300' OR DEPTHEAD EQ '00015033'. "4.2.2020
      WA_EMAIL-PERNR = '00009185'.
      SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ '00009185'.
      IF SY-SUBRC EQ 0.
        WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
      ENDIF.
      COLLECT WA_EMAIL INTO IT_EMAIL.
      CLEAR WA_EMAIL.

*      WA_EMAIL-PERNR = '00015033'.
*      SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ '00015033'.
*      IF SY-SUBRC EQ 0.
*        WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
*      ENDIF.
*      COLLECT WA_EMAIL INTO IT_EMAIL.
*      CLEAR WA_EMAIL.

      WA_EMAIL-PERNR = '00013438'.
      SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ '00013438'.
      IF SY-SUBRC EQ 0.
        WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
      ENDIF.
      COLLECT WA_EMAIL INTO IT_EMAIL.
      CLEAR WA_EMAIL.

      WA_EMAIL-PERNR = '00001074'.
      SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ '00001074'.
      IF SY-SUBRC EQ 0.
        WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
      ENDIF.
      COLLECT WA_EMAIL INTO IT_EMAIL.
      CLEAR WA_EMAIL.

    ELSEIF DEPTHEAD EQ '00010498'.                          "4.2.2020
      WA_EMAIL-PERNR = '00006977'.
      SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ '00006977'.
      IF SY-SUBRC EQ 0.
        WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
      ENDIF.
      COLLECT WA_EMAIL INTO IT_EMAIL.
      CLEAR WA_EMAIL.
    ELSEIF DEPTHEAD EQ '00014967'.                          "4.2.2020
      WA_EMAIL-PERNR = '00006977'.
      SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ '00006977'.
      IF SY-SUBRC EQ 0.
        WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
      ENDIF.
      COLLECT WA_EMAIL INTO IT_EMAIL.
      CLEAR WA_EMAIL.

    ENDIF.

  ENDIF.

*  SELECT SINGLE * FROM PA0105 WHERE PERNR EQ DEPTHEAD AND SUBTY EQ '0010'.
*  IF SY-SUBRC EQ 0.
*    WA_EMAIL-PERNR = DEPTHEAD.
*    WA_EMAIL-USRID_LONG = PA0105-USRID_LONG.
*    COLLECT WA_EMAIL INTO IT_EMAIL.
*    CLEAR WA_EMAIL.
*
*    IF DEPTHEAD EQ '00002051'.
*      WA_EMAIL-PERNR = '00010860'.
*      SELECT SINGLE * FROM PA0105 WHERE PERNR EQ '00010860' AND SUBTY EQ '0010'.
*      IF SY-SUBRC EQ 0.
*        WA_EMAIL-USRID_LONG = PA0105-USRID_LONG.
*      ENDIF.
*      COLLECT WA_EMAIL INTO IT_EMAIL.
*      CLEAR WA_EMAIL.
*    ENDIF.
*
*  ENDIF.



ENDFORM.
*&---------------------------------------------------------------------*
*&      Form  EMAIL2
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM EMAIL2 .
*BREAK-POINT.
  CLEAR : DEPTHEAD,DEPTHEAD2,BTRTL,REVPERNR.
  SELECT SINGLE * FROM ZDMS1 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM.
  IF SY-SUBRC EQ 0.
    IF ZDMS1-WERKS EQ '1001'.
      BTRTL = '1328'.
    ELSEIF ZDMS1-WERKS EQ '1000'.
      BTRTL = '1228'.
    ELSE.
      BTRTL = '1232'.
    ENDIF.
  ENDIF.

  CLEAR : DEPTHEAD.
  SELECT SINGLE * FROM ZQMS_DEPTHEAD1 WHERE BTRTL EQ BTRTL AND TO_DT GE SY-DATUM.  "24.7.22
  IF SY-SUBRC EQ 0.
    DEPTHEAD = ZQMS_DEPTHEAD1-PERNR.
  ENDIF.

*  SELECT SINGLE * FROM pa0001 WHERE btrtl EQ btrtl AND endda GE sy-datum  AND plans NE '99999999'.
*  IF sy-subrc EQ 0.
*    SELECT SINGLE * FROM hrp1000 WHERE objid EQ pa0001-plans AND otype EQ 'O'.
*    IF sy-subrc EQ 0.
**      WRITE :  'DEPARTMENT HEAD'.
*      depthead = pa0001-pernr.
*    ELSE.
*      SELECT SINGLE * FROM hrp1001 WHERE objid EQ pa0001-plans AND endda GT sy-datum AND rsign EQ 'A' AND relat EQ '003' .
*      IF sy-subrc EQ 0.
*        SELECT SINGLE * FROM hrp1001 WHERE objid EQ hrp1001-sobid AND endda GT sy-datum AND rsign EQ 'B' AND relat EQ '012'.
*        IF sy-subrc EQ 0.
*          SELECT SINGLE * FROM pa0001 WHERE plans EQ hrp1001-sobid AND endda GT sy-datum.
*          IF sy-subrc EQ 0.
*            depthead = pa0001-pernr.
*          ENDIF.
*        ENDIF.
*      ENDIF.
*    ENDIF.
*  ENDIF.



*  SELECT SINGLE * FROM PA0105 WHERE PERNR EQ DEPTHEAD AND SUBTY EQ '0010'.
*  IF SY-SUBRC EQ 0.
*    WA_EMAIL-PERNR = DEPTHEAD.
*    WA_EMAIL-USRID_LONG = PA0105-USRID_LONG.
*    COLLECT WA_EMAIL INTO IT_EMAIL.
*    CLEAR WA_EMAIL.
*    IF DEPTHEAD EQ '00002051'.
*      WA_EMAIL-PERNR = '00010860'.
*      SELECT SINGLE * FROM PA0105 WHERE PERNR EQ '00010860' AND SUBTY EQ '0010'.
*      IF SY-SUBRC EQ 0.
*        WA_EMAIL-USRID_LONG = PA0105-USRID_LONG.
*      ENDIF.
*      COLLECT WA_EMAIL INTO IT_EMAIL.
*      CLEAR WA_EMAIL.
*    ENDIF.
*  ENDIF.

  SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ DEPTHEAD .
  IF SY-SUBRC EQ 0.
    WA_EMAIL-PERNR = DEPTHEAD.
    WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
    COLLECT WA_EMAIL INTO IT_EMAIL.
    CLEAR WA_EMAIL.
    IF DEPTHEAD EQ '00002051'.
*      IF depthead EQ '00005693'.  "13.6.22
      WA_EMAIL-PERNR = '00011171'.
      SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ '00011171'.
      IF SY-SUBRC EQ 0.
        WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
      ENDIF.
      COLLECT WA_EMAIL INTO IT_EMAIL.
      CLEAR WA_EMAIL.

    ELSEIF DEPTHEAD EQ '00005693'.
      WA_EMAIL-PERNR = '00011171'.
      SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ '00011171'.
      IF SY-SUBRC EQ 0.
        WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
      ENDIF.
      COLLECT WA_EMAIL INTO IT_EMAIL.
      CLEAR WA_EMAIL.

      WA_EMAIL-PERNR = '00014135'.
      SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ '00014135'.
      IF SY-SUBRC EQ 0.
        WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
      ENDIF.
      COLLECT WA_EMAIL INTO IT_EMAIL.
      CLEAR WA_EMAIL.

    ELSEIF DEPTHEAD EQ '00013959'.
      WA_EMAIL-PERNR = '00016102'.
      SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ '00016102'.
      IF SY-SUBRC EQ 0.
        WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
      ENDIF.
      COLLECT WA_EMAIL INTO IT_EMAIL.
      CLEAR WA_EMAIL.

    ELSEIF DEPTHEAD EQ '00011924'.
      WA_EMAIL-PERNR = '00012420'.
      SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ '00012420'.
      IF SY-SUBRC EQ 0.
        WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
      ENDIF.
      COLLECT WA_EMAIL INTO IT_EMAIL.
      CLEAR WA_EMAIL.

      WA_EMAIL-PERNR = '00013907'.
      SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ '00013907'.
      IF SY-SUBRC EQ 0.
        WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
      ENDIF.
      COLLECT WA_EMAIL INTO IT_EMAIL.
      CLEAR WA_EMAIL.

    ELSEIF DEPTHEAD EQ '00005300' OR DEPTHEAD EQ '00015033'. "4.2.2020
      WA_EMAIL-PERNR = '00009185'.
      SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ '00009185'.
      IF SY-SUBRC EQ 0.
        WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
      ENDIF.
      COLLECT WA_EMAIL INTO IT_EMAIL.
      CLEAR WA_EMAIL.

*      WA_EMAIL-PERNR = '00015033'.
*      SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ '00015033'.
*      IF SY-SUBRC EQ 0.
*        WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
*      ENDIF.
*      COLLECT WA_EMAIL INTO IT_EMAIL.
*      CLEAR WA_EMAIL.

      WA_EMAIL-PERNR = '00013438'.
      SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ '00013438'.
      IF SY-SUBRC EQ 0.
        WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
      ENDIF.
      COLLECT WA_EMAIL INTO IT_EMAIL.
      CLEAR WA_EMAIL.

      WA_EMAIL-PERNR = '00001074'.
      SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ '00001074'.
      IF SY-SUBRC EQ 0.
        WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
      ENDIF.
      COLLECT WA_EMAIL INTO IT_EMAIL.
      CLEAR WA_EMAIL.

    ELSEIF DEPTHEAD EQ '00010498'.                          "4.2.2020
      WA_EMAIL-PERNR = '00006977'.
      SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ '00006977'.
      IF SY-SUBRC EQ 0.
        WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
      ENDIF.
      COLLECT WA_EMAIL INTO IT_EMAIL.
      CLEAR WA_EMAIL.
    ELSEIF DEPTHEAD EQ '00014967'.                          "4.2.2020
      WA_EMAIL-PERNR = '00006977'.
      SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ '00006977'.
      IF SY-SUBRC EQ 0.
        WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
      ENDIF.
      COLLECT WA_EMAIL INTO IT_EMAIL.
      CLEAR WA_EMAIL.

    ENDIF.
  ENDIF.

  SELECT SINGLE * FROM ZDMS1 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM.
  IF SY-SUBRC EQ 0.

    SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ ZDMS1-PERNR.
    IF SY-SUBRC EQ 0.
      WA_EMAIL-PERNR = ZDMS1-PERNR.
      WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
      COLLECT WA_EMAIL INTO IT_EMAIL.
      CLEAR WA_EMAIL.
    ENDIF.
    SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ ZDMS1-APERNR.
    IF SY-SUBRC EQ 0.
      WA_EMAIL-PERNR = ZDMS1-APERNR.
      WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
      COLLECT WA_EMAIL INTO IT_EMAIL.
      CLEAR WA_EMAIL.
    ENDIF.
************  CHECK DEPARTMENT****************
    IF ZDMS1-PERNR EQ '00002055'.
*      revpernr = '00002155'.
      REVPERNR = '00011666'.
    ELSEIF ZDMS1-PERNR EQ '00011031'.
*      revpernr = '00002155'.
      REVPERNR = '00011666'.
    ELSEIF ZDMS1-WERKS EQ '1000'.
*      REVPERNR = '00013901'.
      REVPERNR = '00015167'.
    ELSEIF ZDMS1-WERKS EQ '1001'.
*      revpernr = '00009352'.
      REVPERNR = '00015536'.
    ENDIF.
    SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ REVPERNR.
    IF SY-SUBRC EQ 0.
      WA_EMAIL-PERNR = REVPERNR.
      WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
      COLLECT WA_EMAIL INTO IT_EMAIL.
      CLEAR WA_EMAIL.
    ENDIF.
    IF REVPERNR EQ '00011666'.
      SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ '00002155'.
      IF SY-SUBRC EQ 0.
        WA_EMAIL-PERNR = REVPERNR.
        WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
        COLLECT WA_EMAIL INTO IT_EMAIL.
        CLEAR WA_EMAIL.
      ENDIF.
    ENDIF.



    IF ZDMS1-WERKS EQ '1001'.
*      SELECT SINGLE * FROM PA0001 WHERE PERNR EQ ZDMS1-PERNR AND ENDDA GE SY-DATUM.
      SELECT SINGLE * FROM ZPA0001 WHERE PERNR EQ ZDMS1-PERNR AND ENDDA GE SY-DATUM.
      IF SY-SUBRC EQ 0.
        IF ZPA0001-BTRTL NE '1323'.
          IF ZPA0001-BTRTL NE '1328'.
            SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ '00003139'.
*            SELECT SINGLE * FROM zpassw WHERE pernr EQ '00016314'.
            IF SY-SUBRC EQ 0.
              WA_EMAIL-PERNR = ZDMS1-RPERNR.
              WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
              COLLECT WA_EMAIL INTO IT_EMAIL.
              CLEAR WA_EMAIL.
            ENDIF.
            SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ REVPERNR.
            IF SY-SUBRC EQ 0.
              WA_EMAIL-PERNR = ZDMS1-RPERNR.
              WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
              COLLECT WA_EMAIL INTO IT_EMAIL.
              CLEAR WA_EMAIL.
            ENDIF.
          ENDIF.
        ENDIF.

      ENDIF.
    ELSEIF ZDMS1-WERKS EQ '1000'.
*      SELECT SINGLE * FROM PA0001 WHERE PERNR EQ ZDMS1-PERNR AND ENDDA GE SY-DATUM.
      SELECT SINGLE * FROM ZPA0001 WHERE PERNR EQ ZDMS1-PERNR AND ENDDA GE SY-DATUM.
      IF SY-SUBRC EQ 0.
        IF ZPA0001-BTRTL NE '1224'.
          IF ZPA0001-BTRTL NE '1228'.
            IF ZPA0001-BTRTL NE '1223'.
              IF ZPA0001-BTRTL NE '1229'.
                IF ZPA0001-BTRTL NE '1230'.
                  SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ '00007354'.
                  IF SY-SUBRC EQ 0.
                    WA_EMAIL-PERNR = ZDMS1-RPERNR.
                    WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
                    COLLECT WA_EMAIL INTO IT_EMAIL.
                    CLEAR WA_EMAIL.
                  ENDIF.
                  SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ REVPERNR.
                  IF SY-SUBRC EQ 0.
                    WA_EMAIL-PERNR = ZDMS1-RPERNR.
                    WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
                    COLLECT WA_EMAIL INTO IT_EMAIL.
                    CLEAR WA_EMAIL.
                  ENDIF.
                ENDIF.
              ENDIF.
            ENDIF.
          ENDIF.

        ENDIF.
**********************************
      ENDIF.
*      ***************************
    ELSE.
****************************marketing AS APPROVER*********************************
      IF R2 EQ 'X'.
*        SELECT SINGLE * FROM PA0001 WHERE PERNR EQ ZDMS1-PERNR AND ENDDA GE SY-DATUM.
        SELECT SINGLE * FROM ZPA0001 WHERE PERNR EQ ZDMS1-PERNR AND ENDDA GE SY-DATUM.
        IF SY-SUBRC EQ 0.
          IF ZPA0001-BTRTL EQ '1129' OR ZPA0001-BTRTL EQ '1130'.
            SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ '00003861'.
            IF SY-SUBRC EQ 0.
              WA_EMAIL-PERNR = ZDMS1-RPERNR.
              WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
              COLLECT WA_EMAIL INTO IT_EMAIL.
              CLEAR WA_EMAIL.
            ENDIF.
          ENDIF.
        ENDIF.
      ENDIF.
*************************
    ENDIF.
************* CHECK DEPT ENDS*************
  ENDIF.

  IF R3 EQ 'X'.
    LOOP AT IT_ZDMS2_1 INTO WA_ZDMS2_1.
*    SELECT SINGLE * FROM PA0105 WHERE PERNR EQ PERNR AND SUBTY EQ '0010'.
      SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ WA_ZDMS2_1-UPERNR.
      IF SY-SUBRC EQ 0.
        WA_EMAIL-PERNR = PERNR.
        WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
        COLLECT WA_EMAIL INTO IT_EMAIL.
        CLEAR WA_EMAIL.
      ENDIF.
*      SELECT SINGLE * FROM PA0001 WHERE PERNR EQ PERNR AND ENDDA GE SY-DATUM AND PLANS NE '99999999'.
      SELECT SINGLE * FROM ZPA0001 WHERE PERNR EQ PERNR AND ENDDA GE SY-DATUM . "AND PLANS NE '99999999'.
      IF SY-SUBRC EQ 0.
*    DEPTHNAME = PA0001-ENAME.
        CLEAR : DEPTHEAD2, DEPTHNAME.
        SELECT SINGLE * FROM ZQMS_DEPTHEAD1 WHERE BTRTL EQ ZPA0001-BTRTL AND TO_DT GE SY-DATUM..  "24.7.22
        IF SY-SUBRC EQ 0.
          DEPTHEAD2 = ZQMS_DEPTHEAD1-PERNR.
          SELECT SINGLE * FROM PA0001 WHERE PERNR EQ DEPTHEAD2 AND ENDDA GE SY-DATUM.
          IF SY-SUBRC EQ 0.
            DEPTHNAME = PA0001-ENAME.
          ENDIF.
        ENDIF.

*          SELECT SINGLE * FROM pa0001 WHERE btrtl EQ pa0001-btrtl AND endda GE sy-datum  AND plans NE '99999999'.
*          IF sy-subrc EQ 0.
*            SELECT SINGLE * FROM hrp1000 WHERE objid EQ pa0001-plans AND otype EQ 'O'.
*            IF sy-subrc EQ 0.
**      WRITE :  'DEPARTMENT HEAD'.
*              depthead2 = pa0001-pernr.
*              depthname = pa0001-ename.
*            ELSE.
*              SELECT SINGLE * FROM hrp1001 WHERE objid EQ pa0001-plans AND endda GT sy-datum AND rsign EQ 'A' AND relat EQ '003' .
*              IF sy-subrc EQ 0.
*                SELECT SINGLE * FROM hrp1001 WHERE objid EQ hrp1001-sobid AND endda GT sy-datum AND rsign EQ 'B' AND relat EQ '012'.
*                IF sy-subrc EQ 0.
*                  SELECT SINGLE * FROM pa0001 WHERE plans EQ hrp1001-sobid AND endda GT sy-datum.
*                  IF sy-subrc EQ 0.
*                    depthead2 = pa0001-pernr.
*                    depthname = pa0001-ename.
*                  ENDIF.
*                ENDIF.
*              ENDIF.
*            ENDIF.


        SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ DEPTHEAD2.
        IF SY-SUBRC EQ 0.
          WA_EMAIL-PERNR = DEPTHEAD2.
          WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
          COLLECT WA_EMAIL INTO IT_EMAIL.
          CLEAR WA_EMAIL.
        ENDIF.
*          ENDIF.
      ENDIF.
    ENDLOOP.

  ELSEIF R2 EQ 'X'.

    SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ PERNR .

    IF SY-SUBRC EQ 0.
      WA_EMAIL-PERNR = PERNR.
      WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
      COLLECT WA_EMAIL INTO IT_EMAIL.
      CLEAR WA_EMAIL.
    ENDIF.
    DEPTHEAD2 = PERNR.
    SELECT SINGLE * FROM PA0001 WHERE PERNR EQ PERNR AND ENDDA GE SY-DATUM AND PLANS NE '99999999'.
    IF SY-SUBRC EQ 0.
      DEPTHNAME = PA0001-ENAME.
    ENDIF.

*    SELECT SINGLE * FROM PA0001 WHERE PERNR EQ PERNR AND ENDDA GE SY-DATUM AND PLANS NE '99999999'.
*    IF SY-SUBRC EQ 0.
**    DEPTHNAME = PA0001-ENAME.
*
*      SELECT SINGLE * FROM PA0001 WHERE BTRTL EQ PA0001-BTRTL AND ENDDA GE SY-DATUM  AND PLANS NE '99999999'.
*      IF SY-SUBRC EQ 0.
*        SELECT SINGLE * FROM HRP1000 WHERE OBJID EQ PA0001-PLANS AND OTYPE EQ 'O'.
*        IF SY-SUBRC EQ 0.
**      WRITE :  'DEPARTMENT HEAD'.
*          DEPTHEAD2 = PA0001-PERNR.
*          DEPTHNAME = PA0001-ENAME.
*        ELSE.
*          SELECT SINGLE * FROM HRP1001 WHERE OBJID EQ PA0001-PLANS AND ENDDA GT SY-DATUM AND RSIGN EQ 'A' AND RELAT EQ '003' .
*          IF SY-SUBRC EQ 0.
*            SELECT SINGLE * FROM HRP1001 WHERE OBJID EQ HRP1001-SOBID AND ENDDA GT SY-DATUM AND RSIGN EQ 'B' AND RELAT EQ '012'.
*            IF SY-SUBRC EQ 0.
*              SELECT SINGLE * FROM PA0001 WHERE PLANS EQ HRP1001-SOBID AND ENDDA GT SY-DATUM.
*              IF SY-SUBRC EQ 0.
*                DEPTHEAD2 = PA0001-PERNR.
*                DEPTHNAME = PA0001-ENAME.
*              ENDIF.
*            ENDIF.
*          ENDIF.
*        ENDIF.
*        SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ DEPTHEAD2.
*        IF SY-SUBRC EQ 0.
*          WA_EMAIL-PERNR = DEPTHEAD2.
*          WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
*          COLLECT WA_EMAIL INTO IT_EMAIL.
*          CLEAR WA_EMAIL.
*        ENDIF.
*      ENDIF.
*    ENDIF.
  ENDIF.


ENDFORM.
*&---------------------------------------------------------------------*
*&      Form  EMAIL4
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM EMAIL4.
*  BREAK-POINT.
  LOOP AT IT_SDEPT1 INTO WA_SDEPT1 WHERE DEPT NE SPACE.


*    clear : depthead1.
    CLEAR : DEPTHEAD1.
    SELECT SINGLE * FROM ZQMS_DEPTHEAD1 WHERE BTRTL EQ WA_SDEPT1-DEPT AND TO_DT GE SY-DATUM..  "24.7.22
    IF SY-SUBRC EQ 0.
      DEPTHEAD1 = ZQMS_DEPTHEAD1-PERNR.
    ENDIF.

*    SELECT SINGLE * FROM pa0001 WHERE btrtl EQ wa_sdept1-dept AND endda GE sy-datum .  "13.7.21
*    IF sy-subrc = 0.
*      SELECT SINGLE * FROM hrp1001 WHERE objid EQ pa0001-orgeh AND  otype EQ 'O' AND  relat = '012' AND endda GE sy-datum.
*      IF sy-subrc = 0.  " 012 is the relation code ie dept head
*        SELECT SINGLE * FROM pa0001 WHERE plans = hrp1001-sobid  AND endda GE sy-datum.
*        IF sy-subrc = 0 .
*          depthead1 = pa0001-pernr.
**         WRITE :  'DEPARTMENT HEAD', pa0001-pernr.
*        ENDIF.
*      ENDIF.
*    ENDIF.

*    SELECT SINGLE * FROM pa0001 WHERE btrtl EQ wa_sdept1-dept AND endda GE sy-datum .
*    IF sy-subrc EQ 0.
*      SELECT SINGLE * FROM hrp1000 WHERE objid EQ pa0001-plans AND otype EQ 'O' AND langu EQ 'EN'.
*      IF sy-subrc EQ 0.
**      WRITE :  'DEPARTMENT HEAD'.
*        depthead1 = pa0001-pernr.
*      ELSE.
*        SELECT SINGLE * FROM hrp1001 WHERE objid EQ pa0001-plans AND endda GT sy-datum AND rsign EQ 'A' AND relat EQ '003' .
*        IF sy-subrc EQ 0.
*          SELECT SINGLE * FROM hrp1001 WHERE objid EQ hrp1001-sobid AND endda GT sy-datum AND rsign EQ 'B' AND relat EQ '012'.
*          IF sy-subrc EQ 0.
*            SELECT SINGLE * FROM pa0001 WHERE plans EQ hrp1001-sobid AND endda GT sy-datum.
*            IF sy-subrc EQ 0.
*              depthead1 = pa0001-pernr.
*            ENDIF.
*          ENDIF.
*        ELSE.
**************************************
*          SELECT SINGLE * FROM hrp1001 WHERE sobid EQ pa0001-orgeh AND sclas EQ 'O' AND endda GT sy-datum AND rsign EQ 'A' AND relat EQ '012'.
*          IF sy-subrc EQ 0.
*            SELECT SINGLE * FROM pa0001 WHERE plans EQ hrp1001-objid AND endda GT sy-datum.
*            IF sy-subrc EQ 0.
*              depthead1 = pa0001-pernr.
*            ENDIF.
*          ENDIF.
******************************************
*        ENDIF.
*      ENDIF.
*    ENDIF.

*    SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ DEPTHEAD1.
*    IF SY-SUBRC EQ 0.
*      WA_EMAIL-PERNR = DEPTHEAD1.
*      WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
*      COLLECT WA_EMAIL INTO IT_EMAIL.
*      CLEAR WA_EMAIL.
*      IF DEPTHEAD EQ '00002051'.
*        WA_EMAIL-PERNR = '00010860'.
*        SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ '00010860'.
*        IF SY-SUBRC EQ 0.
*          WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
*        ENDIF.
*        COLLECT WA_EMAIL INTO IT_EMAIL.
*        CLEAR WA_EMAIL.
*      ELSEIF DEPTHEAD EQ '00011924'.
*        WA_EMAIL-PERNR = '00012420'.
*        SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ '00012420'.
*        IF SY-SUBRC EQ 0.
*          WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
*        ENDIF.
*        COLLECT WA_EMAIL INTO IT_EMAIL.
*        CLEAR WA_EMAIL.
*      ENDIF.
*    ENDIF.

    SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ DEPTHEAD1.
    IF SY-SUBRC EQ 0.
      WA_EMAIL-PERNR = DEPTHEAD1.
      WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
      COLLECT WA_EMAIL INTO IT_EMAIL.
      CLEAR WA_EMAIL.
*      IF depthead1 EQ '00002051'.
      IF DEPTHEAD1 EQ '00005693'.  "13.6.22
        WA_EMAIL-PERNR = '00011171'.
        SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ '00011171'.
        IF SY-SUBRC EQ 0.
          WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
        ENDIF.
        COLLECT WA_EMAIL INTO IT_EMAIL.
        CLEAR WA_EMAIL.
      ELSEIF DEPTHEAD1 EQ '00011924'.
        WA_EMAIL-PERNR = '00012420'.
        SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ '00012420'.
        IF SY-SUBRC EQ 0.
          WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
        ENDIF.
        COLLECT WA_EMAIL INTO IT_EMAIL.
        CLEAR WA_EMAIL.

        WA_EMAIL-PERNR = '00013907'.
        SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ '00013907'.
        IF SY-SUBRC EQ 0.
          WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
        ENDIF.
        COLLECT WA_EMAIL INTO IT_EMAIL.
        CLEAR WA_EMAIL.

      ELSEIF DEPTHEAD1 EQ '00005300' OR DEPTHEAD1 EQ '00015033'. "4.2.2020
        WA_EMAIL-PERNR = '00009185'.
        SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ '00009185'.
        IF SY-SUBRC EQ 0.
          WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
        ENDIF.
        COLLECT WA_EMAIL INTO IT_EMAIL.
        CLEAR WA_EMAIL.

*        WA_EMAIL-PERNR = '00015033'.
*        SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ '00015033'.
*        IF SY-SUBRC EQ 0.
*          WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
*        ENDIF.
*        COLLECT WA_EMAIL INTO IT_EMAIL.
*        CLEAR WA_EMAIL.

        WA_EMAIL-PERNR = '00013438'.
        SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ '00013438'.
        IF SY-SUBRC EQ 0.
          WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
        ENDIF.
        COLLECT WA_EMAIL INTO IT_EMAIL.
        CLEAR WA_EMAIL.

        WA_EMAIL-PERNR = '00001074'.
        SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ '00001074'.
        IF SY-SUBRC EQ 0.
          WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
        ENDIF.
        COLLECT WA_EMAIL INTO IT_EMAIL.
        CLEAR WA_EMAIL.

      ELSEIF DEPTHEAD1 EQ '00010498'.                       "4.2.2020
        WA_EMAIL-PERNR = '00006977'.
        SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ '00006977'.
        IF SY-SUBRC EQ 0.
          WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
        ENDIF.
        COLLECT WA_EMAIL INTO IT_EMAIL.
        CLEAR WA_EMAIL.
      ELSEIF DEPTHEAD1 EQ '00014967'.                       "4.2.2020
        WA_EMAIL-PERNR = '00006977'.
        SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ '00006977'.
        IF SY-SUBRC EQ 0.
          WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
        ENDIF.
        COLLECT WA_EMAIL INTO IT_EMAIL.
        CLEAR WA_EMAIL.

      ENDIF.
    ENDIF.
  ENDLOOP.
ENDFORM.
*&---------------------------------------------------------------------*
*&      Form  SELECTDEPT
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM SELECTDEPT .
*  break-point.
  CLEAR : CHGNUM.
  SELECT SINGLE * FROM ZDMS4 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM.
  IF SY-SUBRC EQ 0.
    CHGNUM = ZDMS4-CCNUMB1.
  ENDIF.

*  BREAK-POINT.
  CLEAR : IT_SDEPT1,WA_SDEPT1.
  ZEILE = 1.
  SELECT SINGLE * FROM ZDMS1 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM.
  IF SY-SUBRC EQ 0.
    WERKS = ZDMS1-WERKS.
  ENDIF.
  IF WERKS EQ '1000'.
    TWERKS = '1200'.
  ELSEIF WERKS EQ '1001'.
    TWERKS = '1300'.
  ELSE.
    TWERKS = '1100'.
  ENDIF.

  CLEAR : IT_T001P,WA_T001P.
*  if it_zdms2 is initial.
  IF WERKS EQ '4000'.
    SELECT * FROM T001P INTO TABLE IT_T001P .
*      where werks eq twerks.
  ELSE.
*    if werks eq '1000'.
*      select * from t001p into table it_t001p where werks in ( '1200','1100' ).
*    elseif werks eq '1001'.
*      select * from t001p into table it_t001p where werks in ( '1300','1100' ).
*    else.
    SELECT * FROM T001P INTO TABLE IT_T001P WHERE WERKS EQ TWERKS.
*    endif.
  ENDIF.

  SELECT * FROM T001P INTO TABLE IT_T001P .  "21.12.20

  LOOP AT IT_ZDMS2 INTO WA_ZDMS2.
    WA_SDEPT1-MJAHR = WA_ZDMS2-MJAHR.
    WA_SDEPT1-MBLNR = WA_ZDMS2-MBLNR.
*    wa_sdept1-zeile = zeile.
    WA_SDEPT1-DEPT = WA_ZDMS2-DEPT.
    SELECT SINGLE * FROM T001P WHERE BTRTL EQ WA_ZDMS2-DEPT.
    IF SY-SUBRC EQ 0.
      WA_SDEPT1-BTEXT = T001P-BTEXT.
      SELECT SINGLE * FROM T500P WHERE PERSA EQ T001P-WERKS.
      IF SY-SUBRC EQ 0.
        WA_SDEPT1-NAME1 = T500P-NAME1.
      ENDIF.
    ENDIF.
    SELECT SINGLE * FROM ZDMS1 WHERE MJAHR EQ WA_ZDMS2-MJAHR AND MBLNR EQ WA_ZDMS2-MBLNR.
    IF SY-SUBRC EQ 0.
      WA_SDEPT1-WERKS = ZDMS1-WERKS.
    ENDIF.
    WA_SDEPT1-CHK = 'X'.
    COLLECT WA_SDEPT1 INTO IT_SDEPT1.
    CLEAR WA_SDEPT1.
    ZEILE = ZEILE + 1.
  ENDLOOP.

  LOOP AT IT_T001P INTO WA_T001P WHERE BTRTL GE '1100' AND BTRTL LE '1399'.
*    where werks eq twerks.
    WA_SDEPT1-MJAHR = YEAR.
    WA_SDEPT1-MBLNR = CCNUM.
*    wa_sdept1-zeile = zeile.
    SELECT SINGLE * FROM T500P WHERE PERSA EQ WA_T001P-WERKS.
    IF SY-SUBRC EQ 0.
      WA_SDEPT1-NAME1 = T500P-NAME1.
    ENDIF.
    WA_SDEPT1-DEPT = WA_T001P-BTRTL.
    WA_SDEPT1-BTEXT = WA_T001P-BTEXT.
    WA_SDEPT1-WERKS = WERKS.
    SELECT SINGLE * FROM ZDMS2 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM AND DEPT EQ WA_T001P-BTRTL.
    IF SY-SUBRC EQ 0.
      WA_SDEPT1-CHK = 'X'.
    ENDIF.
    COLLECT WA_SDEPT1 INTO IT_SDEPT1.
    CLEAR WA_SDEPT1.
    ZEILE = ZEILE + 1.
  ENDLOOP.
*  else.
*
*    loop at it_zdms2 into wa_zdms2.
*      wa_sdept1-mjahr = wa_zdms2-mjahr.
*      wa_sdept1-mblnr = wa_zdms2-mblnr.
*      wa_sdept1-dept = wa_zdms2-dept.
*      select single * from t001p where btrtl eq wa_zdms2-dept.
*      if sy-subrc eq 0.
*        wa_sdept1-btext = t001p-btext.
*        select single * from t500p where persa eq t001p-werks.
*        if sy-subrc eq 0.
*          wa_sdept1-name1 = t500p-name1.
*        endif.
*      endif.
*      select single * from zdms1 where mjahr eq wa_zdms2-mjahr and mblnr eq wa_zdms2-mblnr.
*      if sy-subrc eq 0.
*        wa_sdept1-werks = zdms1-werks.
*      endif.
*      wa_sdept1-chk = 'X'.
*      collect wa_sdept1 into it_sdept1.
*      clear wa_sdept1.
*      zeile = zeile + 1.
*    endloop.
*    do 10 times.
*      wa_sdept1-mjahr = year.
*      wa_sdept1-mblnr = ccnum.
*      wa_sdept1-zeile = zeile.
*      wa_sdept1-dept = '    '.
*      wa_sdept1-btext = '    '.
*      collect wa_sdept1 into it_sdept1.
*      clear wa_sdept1.
*      zeile = zeile + 1.
*    enddo.
*  endif.

*  *Remove unwanted departments.
  LOOP AT IT_SDEPT1 INTO WA_SDEPT1.
    DELETE IT_SDEPT1 WHERE DEPT GE '1208' AND DEPT LE '1210'.
    DELETE IT_SDEPT1 WHERE DEPT GE '1308' AND DEPT LE '1310'.
*    SELECT SINGLE * FROM PA0001 WHERE ENDDA GT SY-DATUM AND BTRTL EQ WA_SDEPT1-DEPT.
    SELECT SINGLE * FROM ZPA0001 WHERE ENDDA GT SY-DATUM AND BTRTL EQ WA_SDEPT1-DEPT.
    IF SY-SUBRC EQ 4.
      DELETE IT_SDEPT1 WHERE DEPT EQ WA_SDEPT1-DEPT.
    ENDIF.
  ENDLOOP.

  DO 10 TIMES.
    WA_SDEPT1-MJAHR = YEAR.
    WA_SDEPT1-MBLNR = CCNUM.
    WA_SDEPT1-ZEILE = ZEILE.
    WA_SDEPT1-DEPT = '    '.
    WA_SDEPT1-NAME1 = '    '.
    WA_SDEPT1-BTEXT = '    '.
    WA_SDEPT1-WERKS = '    '.
    COLLECT WA_SDEPT1 INTO IT_SDEPT1.
    CLEAR WA_SDEPT1.
    ZEILE = ZEILE + 1.
  ENDDO.


*  BREAK-POINT.
  SELECT SINGLE * FROM ZDMS4 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM.
*  IF SY-SUBRC EQ 0 AND ( ZDMS4-CL1 EQ 'X' OR ZDMS4-QHCL1 EQ 'X' ).
  IF SY-SUBRC EQ 0 AND ( ZDMS4-TDAPPROVE EQ 'X' OR ZDMS4-TDREJECT EQ 'X' ).

    WA_FIELDCAT-FIELDNAME = 'MJAHR'.
    WA_FIELDCAT-SELTEXT_L = 'YEAR'.
    APPEND WA_FIELDCAT TO FIELDCAT.
    CLEAR WA_FIELDCAT.

    WA_FIELDCAT-FIELDNAME = 'MBLNR'.
    WA_FIELDCAT-SELTEXT_L = 'NOTIFICATION NO.'.
    APPEND WA_FIELDCAT TO FIELDCAT.
    CLEAR WA_FIELDCAT.

    WA_FIELDCAT-FIELDNAME = 'NAME1'.
    WA_FIELDCAT-SELTEXT_L = 'AREA'.
    APPEND WA_FIELDCAT TO FIELDCAT.
    CLEAR WA_FIELDCAT.

    WA_FIELDCAT-FIELDNAME = 'BTEXT'.
    WA_FIELDCAT-SELTEXT_L = 'RESPONSIBILITY DEPT'.
    APPEND WA_FIELDCAT TO FIELDCAT.
    CLEAR WA_FIELDCAT.

    WA_FIELDCAT-FIELDNAME = 'DEPT'.
    WA_FIELDCAT-SELTEXT_L = 'DEPT CODE'.
*    WA_FIELDCAT-EDIT = 'X'.
    APPEND WA_FIELDCAT TO FIELDCAT.
    CLEAR WA_FIELDCAT.

    WA_FIELDCAT-FIELDNAME = 'CHK'.
    WA_FIELDCAT-SELTEXT_L = 'SELECTED'.
    WA_FIELDCAT-CHECKBOX = 'X'.
*    wa_fieldcat-edit = 'X'.
    APPEND WA_FIELDCAT TO FIELDCAT.
    CLEAR WA_FIELDCAT.

    LAYOUT-ZEBRA = 'X'.
    LAYOUT-COLWIDTH_OPTIMIZE = 'X'.
    LAYOUT-WINDOW_TITLEBAR  = 'FOLLOW-UP ACTIVITY'.

    CALL FUNCTION 'REUSE_ALV_GRID_DISPLAY'
      EXPORTING
        I_CALLBACK_PROGRAM      = G_REPID
*       I_CALLBACK_PF_STATUS_SET          = ' '
        I_CALLBACK_USER_COMMAND = 'USER_COMM2'
        I_CALLBACK_TOP_OF_PAGE  = 'TOP'
        IS_LAYOUT               = LAYOUT
        IT_FIELDCAT             = FIELDCAT
        I_SAVE                  = 'A'
      TABLES
        T_OUTTAB                = IT_SDEPT1
      EXCEPTIONS
        PROGRAM_ERROR           = 1
        OTHERS                  = 2.
    IF SY-SUBRC <> 0.
* MESSAGE ID SY-MSGID TYPE SY-MSGTY NUMBER SY-MSGNO
*         WITH SY-MSGV1 SY-MSGV2 SY-MSGV3 SY-MSGV4.
    ENDIF.

    CLEAR : FIELDCAT,LAYOUT.

  ELSE.

    SELECT SINGLE * FROM ZDMS4 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM.
*  IF SY-SUBRC EQ 0 AND ( ZDMS4-CL1 EQ 'X' OR ZDMS4-QHCL1 EQ 'X' ).
    IF SY-SUBRC EQ 0 AND ( ZDMS4-QHAPPROVE EQ 'X' OR ZDMS4-QHREJECT EQ 'X' ).

      WA_FIELDCAT-FIELDNAME = 'MJAHR'.
      WA_FIELDCAT-SELTEXT_L = 'YEAR'.
      APPEND WA_FIELDCAT TO FIELDCAT.
      CLEAR WA_FIELDCAT.

      WA_FIELDCAT-FIELDNAME = 'MBLNR'.
      WA_FIELDCAT-SELTEXT_L = 'NOTIFICATION NO.'.
      APPEND WA_FIELDCAT TO FIELDCAT.
      CLEAR WA_FIELDCAT.

      WA_FIELDCAT-FIELDNAME = 'NAME1'.
      WA_FIELDCAT-SELTEXT_L = 'AREA'.
      APPEND WA_FIELDCAT TO FIELDCAT.
      CLEAR WA_FIELDCAT.

      WA_FIELDCAT-FIELDNAME = 'BTEXT'.
      WA_FIELDCAT-SELTEXT_L = 'RESPONSIBILITY DEPT'.
      APPEND WA_FIELDCAT TO FIELDCAT.
      CLEAR WA_FIELDCAT.

      WA_FIELDCAT-FIELDNAME = 'DEPT'.
      WA_FIELDCAT-SELTEXT_L = 'DEPT CODE'.
*    WA_FIELDCAT-EDIT = 'X'.
      APPEND WA_FIELDCAT TO FIELDCAT.
      CLEAR WA_FIELDCAT.

      WA_FIELDCAT-FIELDNAME = 'CHK'.
      WA_FIELDCAT-SELTEXT_L = 'SELECTED'.
      WA_FIELDCAT-CHECKBOX = 'X'.
*    wa_fieldcat-edit = 'X'.
      APPEND WA_FIELDCAT TO FIELDCAT.
      CLEAR WA_FIELDCAT.

      LAYOUT-ZEBRA = 'X'.
      LAYOUT-COLWIDTH_OPTIMIZE = 'X'.
      LAYOUT-WINDOW_TITLEBAR  = 'FOLLOW-UP ACTIVITY'.

      CALL FUNCTION 'REUSE_ALV_GRID_DISPLAY'
        EXPORTING
          I_CALLBACK_PROGRAM      = G_REPID
*         I_CALLBACK_PF_STATUS_SET          = ' '
          I_CALLBACK_USER_COMMAND = 'USER_COMM2'
          I_CALLBACK_TOP_OF_PAGE  = 'TOP'
          IS_LAYOUT               = LAYOUT
          IT_FIELDCAT             = FIELDCAT
          I_SAVE                  = 'A'
        TABLES
          T_OUTTAB                = IT_SDEPT1
        EXCEPTIONS
          PROGRAM_ERROR           = 1
          OTHERS                  = 2.
      IF SY-SUBRC <> 0.
* MESSAGE ID SY-MSGID TYPE SY-MSGTY NUMBER SY-MSGNO
*         WITH SY-MSGV1 SY-MSGV2 SY-MSGV3 SY-MSGV4.
      ENDIF.

      CLEAR : FIELDCAT,LAYOUT.
    ELSE.

      WA_FIELDCAT-FIELDNAME = 'MJAHR'.
      WA_FIELDCAT-SELTEXT_L = 'YEAR'.
      APPEND WA_FIELDCAT TO FIELDCAT.
      CLEAR WA_FIELDCAT.

      WA_FIELDCAT-FIELDNAME = 'MBLNR'.
      WA_FIELDCAT-SELTEXT_L = 'NOTIFICATION NO.'.
      APPEND WA_FIELDCAT TO FIELDCAT.
      CLEAR WA_FIELDCAT.

      WA_FIELDCAT-FIELDNAME = 'NAME1'.
      WA_FIELDCAT-SELTEXT_L = 'AREA'.
      APPEND WA_FIELDCAT TO FIELDCAT.
      CLEAR WA_FIELDCAT.

      WA_FIELDCAT-FIELDNAME = 'BTEXT'.
      WA_FIELDCAT-SELTEXT_L = 'RESPONSIBILITY DEPT'.
      APPEND WA_FIELDCAT TO FIELDCAT.
      CLEAR WA_FIELDCAT.

      WA_FIELDCAT-FIELDNAME = 'DEPT'.
      WA_FIELDCAT-SELTEXT_L = 'DEPT CODE'.
      WA_FIELDCAT-EDIT = 'X'.
*    WA_FIELDCAT-F4AVAILABL = 'X'.
*    WA_FIELDCAT-REF_TABname = T001P.
*    WA_FIELDCAT-REF_FIELDname = T001P-BTRTL.
      APPEND WA_FIELDCAT TO FIELDCAT.
      CLEAR WA_FIELDCAT.



      WA_FIELDCAT-FIELDNAME = 'CHK'.
      WA_FIELDCAT-SELTEXT_L = 'SELECT'.
      WA_FIELDCAT-CHECKBOX = 'X'.
      WA_FIELDCAT-EDIT = 'X'.
      APPEND WA_FIELDCAT TO FIELDCAT.
      CLEAR WA_FIELDCAT.

      LAYOUT-ZEBRA = 'X'.
      LAYOUT-COLWIDTH_OPTIMIZE = 'X'.
      LAYOUT-WINDOW_TITLEBAR  = 'FOLLOW-UP ACTIVITY'.

      CALL FUNCTION 'REUSE_ALV_GRID_DISPLAY'
        EXPORTING
          I_CALLBACK_PROGRAM      = G_REPID
*         I_CALLBACK_PF_STATUS_SET          = ' '
          I_CALLBACK_USER_COMMAND = 'USER_COMM2'
          I_CALLBACK_TOP_OF_PAGE  = 'TOP'
          IS_LAYOUT               = LAYOUT
          IT_FIELDCAT             = FIELDCAT
          I_SAVE                  = 'A'
        TABLES
          T_OUTTAB                = IT_SDEPT1
        EXCEPTIONS
          PROGRAM_ERROR           = 1
          OTHERS                  = 2.
      IF SY-SUBRC <> 0.
* MESSAGE ID SY-MSGID TYPE SY-MSGTY NUMBER SY-MSGNO
*         WITH SY-MSGV1 SY-MSGV2 SY-MSGV3 SY-MSGV4.
      ENDIF.

      CLEAR : FIELDCAT,LAYOUT.

    ENDIF.
  ENDIF.
ENDFORM.
*&---------------------------------------------------------------------*
*&      Form  SETDEPTUPD
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM SETDEPTUPD .

*********************************  24.1.21
  IF R4 EQ 'X'.
*    BREAK-POINT .
    SELECT SINGLE * FROM ZDMS1 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM AND USELDEPT EQ '00000000'.
    IF SY-SUBRC EQ 0.
      MOVE-CORRESPONDING ZDMS1 TO ZDMS1_WA.
      ZDMS1_WA-USELDEPT = PERNR.
      ZDMS1_WA-DTSELDEPT = SY-DATUM.
      ZDMS1_WA-DTSELTM = SY-UZEIT.
      ZDMS1_WA-DTSELUNAME = SY-UNAME.
      UPDATE ZDMS1 FROM ZDMS1_WA.
      CLEAR : ZDMS1_WA.
    ENDIF.
  ENDIF.
*****************************
*  ********* initiator & QA should get deselect 27.5.21****
  IF R4 EQ 'X'.
    CLEAR : INITDEPT,INITDEPTSEL,QASEL.
    SELECT SINGLE * FROM ZDMS1   WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM.
    IF SY-SUBRC EQ 0.
*      SELECT SINGLE * FROM PA0001 WHERE PERNR EQ ZDMS1-PERNR AND ENDDA GE SY-DATUM.
      SELECT SINGLE * FROM ZPA0001 WHERE PERNR EQ ZDMS1-PERNR AND ENDDA GE SY-DATUM.
      IF SY-SUBRC EQ 0.
*        INITDEPT = PA0001-BTRTL.
        INITDEPT = ZPA0001-BTRTL.
      ENDIF.
    ENDIF.
    LOOP AT IT_SDEPT1 INTO WA_SDEPT1 WHERE CHK EQ 'X'.
      IF INITDEPT = WA_SDEPT1-DEPT.
        INITDEPTSEL = 'X'.
      ENDIF.
      IF WERKS EQ '1000' AND WA_SDEPT1-DEPT EQ '1228'.
        QASEL = 'X'.
      ELSEIF WERKS EQ '1001' AND WA_SDEPT1-DEPT EQ '1328'.
        QASEL = 'X'.
      ELSEIF WERKS EQ '3000' AND WA_SDEPT1-DEPT EQ '1232'.
        QASEL = 'X'.
      ELSEIF WERKS EQ '4000' AND WA_SDEPT1-DEPT EQ '1232'.
        QASEL = 'X'.
      ENDIF.
    ENDLOOP.
    IF INITDEPTSEL EQ SPACE.
      MESSAGE 'SELECT INITIATING DEPARTMENT' TYPE 'E'.
    ENDIF.
    IF QASEL EQ SPACE.
      MESSAGE 'SELECT QA / CQD DEPARTMENT' TYPE 'E'.
    ENDIF.
  ENDIF.
*****************************
************************

*  BREAK-POINT.
  CLEAR : ERR.
  SORT IT_FOLW2 BY MJAHR MBLNR DEPT ZEILE.

******************** ERROR CHECKING  ****************************************************

  LOOP AT IT_SDEPT1 INTO WA_SDEPT1 WHERE DEPT NE SPACE AND CHK EQ 'X'.
    SELECT SINGLE * FROM T001P WHERE BTRTL EQ WA_SDEPT1-DEPT.
    IF SY-SUBRC EQ 4.
      MESSAGE 'INVALID DEPERTMENT CODE' TYPE 'E'.
      ERR = 1.
    ENDIF.
    IF PLANT EQ '1001'.
      IF WA_SDEPT1-DEPT NE '1232'.
        IF WA_SDEPT1-DEPT GE '1201' AND WA_SDEPT1-DEPT LE '1299'.
*          MESSAGE 'Goa QA can not select Nasik department' TYPE 'E'.
          MESSAGE 'Goa QA should not select Nasik department' TYPE 'I'.
        ENDIF.
      ENDIF.
    ENDIF.
  ENDLOOP.
*************************************************************
*  ******** send emil only for additional.**********
  CLEAR : ADDDEPT.
  IF IT_ZDMS2 IS INITIAL.

    IF ERR NE 1.
      LOOP AT IT_SDEPT1 INTO WA_SDEPT1 WHERE DEPT NE SPACE AND CHK NE 'X'.
        DELETE FROM ZDMS2 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM AND DEPT EQ WA_SDEPT1-DEPT.
      ENDLOOP.
      LOOP AT IT_SDEPT1 INTO WA_SDEPT1 WHERE DEPT NE SPACE AND CHK EQ 'X'.
        SELECT SINGLE * FROM ZDMS2 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM AND DEPT EQ WA_SDEPT1-DEPT.
        IF SY-SUBRC EQ 0.
          MOVE-CORRESPONDING ZDMS2 TO ZDMS2_WA.
          ZDMS2_WA-MJAHR = WA_SDEPT1-MJAHR.
          ZDMS2_WA-MBLNR = WA_SDEPT1-MBLNR.
          ZDMS2_WA-DEPT = WA_SDEPT1-DEPT.
          ZDMS2_WA-EBUDAT = SY-DATUM.
          ZDMS2_WA-EUZEIT = SY-UZEIT.
          ZDMS2_WA-EUNAME = SY-UNAME.
          ZDMS2_WA-EPERNR = PERNR.
          MODIFY ZDMS2 FROM ZDMS2_WA.
          CLEAR ZDMS2_WA.
          A = 1.
        ELSE.
          ZDMS2_WA-MJAHR = WA_SDEPT1-MJAHR.
          ZDMS2_WA-MBLNR = WA_SDEPT1-MBLNR.
          ZDMS2_WA-DEPT = WA_SDEPT1-DEPT.
          ZDMS2_WA-EBUDAT = SY-DATUM.
          ZDMS2_WA-EUZEIT = SY-UZEIT.
          ZDMS2_WA-EUNAME = SY-UNAME.
          ZDMS2_WA-EPERNR = PERNR.
          MODIFY ZDMS2 FROM ZDMS2_WA.
          CLEAR ZDMS2_WA.
          A = 1.
        ENDIF.
      ENDLOOP.
      IF A EQ 1.
        MESSAGE 'DATA UPDATED' TYPE 'I'.
      ENDIF.
    ENDIF.
    DELETE IT_SDEPT1 WHERE CHK NE 'X'.
    PERFORM EMAIL.
    CLEAR : IT_SDEPT1,WA_SDEPT1.

  ELSE.
    ADDDEPT = 1.
    IF ERR NE 1.
      LOOP AT IT_SDEPT1 INTO WA_SDEPT1 WHERE DEPT NE SPACE AND CHK NE 'X'.
        DELETE FROM ZDMS2 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM AND DEPT EQ WA_SDEPT1-DEPT.
      ENDLOOP.

      PERFORM EMAIL.
      LOOP AT IT_SDEPT1 INTO WA_SDEPT1 WHERE DEPT NE SPACE AND CHK EQ 'X'.
        SELECT SINGLE * FROM ZDMS2 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM AND DEPT EQ WA_SDEPT1-DEPT.
        IF SY-SUBRC EQ 0.
          MOVE-CORRESPONDING ZDMS2 TO ZDMS2_WA.
          ZDMS2_WA-MJAHR = WA_SDEPT1-MJAHR.
          ZDMS2_WA-MBLNR = WA_SDEPT1-MBLNR.
          ZDMS2_WA-DEPT = WA_SDEPT1-DEPT.
          ZDMS2_WA-EBUDAT = SY-DATUM.
          ZDMS2_WA-EUZEIT = SY-UZEIT.
          ZDMS2_WA-EUNAME = SY-UNAME.
          ZDMS2_WA-EPERNR = PERNR.
          MODIFY ZDMS2 FROM ZDMS2_WA.
          CLEAR ZDMS2_WA.
          A = 1.
        ELSE.
          ZDMS2_WA-MJAHR = WA_SDEPT1-MJAHR.
          ZDMS2_WA-MBLNR = WA_SDEPT1-MBLNR.
          ZDMS2_WA-DEPT = WA_SDEPT1-DEPT.
          ZDMS2_WA-EBUDAT = SY-DATUM.
          ZDMS2_WA-EUZEIT = SY-UZEIT.
          ZDMS2_WA-EUNAME = SY-UNAME.
          ZDMS2_WA-EPERNR = PERNR.
          MODIFY ZDMS2 FROM ZDMS2_WA.
          CLEAR ZDMS2_WA.
          A = 1.
        ENDIF.
      ENDLOOP.
      IF A EQ 1.
        MESSAGE 'DATA UPDATED' TYPE 'I'.
      ENDIF.
    ENDIF.
    DELETE IT_SDEPT1 WHERE CHK NE 'X'.

    CLEAR : IT_SDEPT1,WA_SDEPT1.
  ENDIF.
************************************************************************************
*  LEAVE TO TRANSACTION 'ZQMS'.
  LEAVE TO SCREEN 0.

ENDFORM.
*&---------------------------------------------------------------------*
*&      Form  DEPTCHK1
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM DEPTCHK1 .
*  BREAK-POINT.
  LOOP AT IT_ZDMS2 INTO WA_ZDMS2 WHERE MJAHR = YEAR AND MBLNR = CCNUM AND DEPT = IMPDEPT.
    IF SY-SUBRC EQ 0.
      S = 1.
    ENDIF.
  ENDLOOP.

  IF PLANT EQ '3000' OR PLANT EQ '4000'."31.5.22
    IF PERNR EQ '00005693'.
      IF R32 EQ 'X'.
        S = 1.
      ENDIF.
    ENDIF.
  ENDIF.

  IF S NE 1.
    MESSAGE 'ENTER VALID EMPLOYEE CODE' TYPE 'E'.
  ENDIF.

ENDFORM.
*&---------------------------------------------------------------------*
*&      Form  EMAIL33
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM EMAIL33 .


  CLEAR : DEPTHEAD, BTRTL.
  SELECT SINGLE * FROM ZDMS1 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM.
  IF SY-SUBRC EQ 0.
    IF ZDMS1-WERKS EQ '1001'.
      BTRTL = '1328'.
    ELSE.
      BTRTL = '1228'.
    ENDIF.
  ENDIF.
  CLEAR : DEPTHEAD.
  SELECT SINGLE * FROM ZQMS_DEPTHEAD1 WHERE BTRTL EQ BTRTL AND TO_DT GE SY-DATUM..  "24.7.22
  IF SY-SUBRC EQ 0.
    DEPTHEAD = ZQMS_DEPTHEAD1-PERNR.
  ENDIF.

*  SELECT SINGLE * FROM pa0001 WHERE btrtl EQ btrtl AND endda GE sy-datum AND plans NE '99999999'.
*  IF sy-subrc EQ 0.
*    SELECT SINGLE * FROM hrp1000 WHERE objid EQ pa0001-plans AND otype EQ 'O'.
*    IF sy-subrc EQ 0.
**      WRITE :  'DEPARTMENT HEAD'.
*      depthead = pa0001-pernr.
*    ELSE.
*      SELECT SINGLE * FROM hrp1001 WHERE objid EQ pa0001-plans AND endda GT sy-datum AND rsign EQ 'A' AND relat EQ '003' .
*      IF sy-subrc EQ 0.
*        SELECT SINGLE * FROM hrp1001 WHERE objid EQ hrp1001-sobid AND endda GT sy-datum AND rsign EQ 'B' AND relat EQ '012'.
*        IF sy-subrc EQ 0.
*          SELECT SINGLE * FROM pa0001 WHERE plans EQ hrp1001-sobid AND endda GT sy-datum.
*          IF sy-subrc EQ 0.
*            depthead = pa0001-pernr.
*          ENDIF.
*        ENDIF.
*      ENDIF.
*    ENDIF.
*  ENDIF.



*  SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ DEPTHEAD.
*  IF SY-SUBRC EQ 0.
*    WA_EMAIL-PERNR = DEPTHEAD.
*    WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
*    COLLECT WA_EMAIL INTO IT_EMAIL.
*    CLEAR WA_EMAIL.
**    IF depthead EQ '00002051'.
*    IF DEPTHEAD EQ '00005693'.  "13.6.22
*      WA_EMAIL-PERNR = '00011171'.
*      SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ '00011171'.
*      IF SY-SUBRC EQ 0.
*        WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
*      ENDIF.
*      COLLECT WA_EMAIL INTO IT_EMAIL.
*      CLEAR WA_EMAIL.
*
*      WA_EMAIL-PERNR = DEPTHEAD.
*      WA_EMAIL-USRID_LONG = 'qa-nashik@bluecrosslabs.com'.  "30.1.22
*      COLLECT WA_EMAIL INTO IT_EMAIL.
*      CLEAR WA_EMAIL.
*
*    ELSEIF DEPTHEAD EQ '00013959'.
*      WA_EMAIL-PERNR = '00016102'.
*      SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ '00016102'.
*      IF SY-SUBRC EQ 0.
*        WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
*      ENDIF.
*      COLLECT WA_EMAIL INTO IT_EMAIL.
*      CLEAR WA_EMAIL.
*
*    ELSEIF DEPTHEAD EQ '00011924'.
*      WA_EMAIL-PERNR = '00012420'.
*      SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ '00012420'.
*      IF SY-SUBRC EQ 0.
*        WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
*      ENDIF.
*      COLLECT WA_EMAIL INTO IT_EMAIL.
*      CLEAR WA_EMAIL.
*
*      WA_EMAIL-PERNR = '00013907'.
*      SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ '00013907'.
*      IF SY-SUBRC EQ 0.
*        WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
*      ENDIF.
*      COLLECT WA_EMAIL INTO IT_EMAIL.
*      CLEAR WA_EMAIL.
*
*    ENDIF.
*  ENDIF.
  SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ DEPTHEAD.
  IF SY-SUBRC EQ 0.
    WA_EMAIL-PERNR = DEPTHEAD.
    WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
    COLLECT WA_EMAIL INTO IT_EMAIL.
    CLEAR WA_EMAIL.
  ENDIF.
*    IF depthead EQ '00002051'.
*    IF DEPTHEAD EQ '00005693'.  "13.6.22
  IF BTRTL EQ '1228'.
    WA_EMAIL-PERNR = '00011171'.
    SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ '00011171'.
    IF SY-SUBRC EQ 0.
      WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
    ENDIF.
    COLLECT WA_EMAIL INTO IT_EMAIL.
    CLEAR WA_EMAIL.

    WA_EMAIL-PERNR = DEPTHEAD.
    WA_EMAIL-USRID_LONG = 'qa-nashik@bluecrosslabs.com'.  "30.1.22
    COLLECT WA_EMAIL INTO IT_EMAIL.
    CLEAR WA_EMAIL.

*    ELSEIF DEPTHEAD EQ '00013959'.
    WA_EMAIL-PERNR = '00016102'.
    SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ '00016102'.
    IF SY-SUBRC EQ 0.
      WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
    ENDIF.
    COLLECT WA_EMAIL INTO IT_EMAIL.
    CLEAR WA_EMAIL.

*    ELSEIF DEPTHEAD EQ '00011924'.
  ELSEIF BTRTL EQ '1328'.
    WA_EMAIL-PERNR = '00012420'.
    SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ '00012420'.
    IF SY-SUBRC EQ 0.
      WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
    ENDIF.
    COLLECT WA_EMAIL INTO IT_EMAIL.
    CLEAR WA_EMAIL.

    WA_EMAIL-PERNR = '00013907'.
    SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ '00013907'.
    IF SY-SUBRC EQ 0.
      WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
    ENDIF.
    COLLECT WA_EMAIL INTO IT_EMAIL.
    CLEAR WA_EMAIL.

  ENDIF.
*ENDIF.
****************************************************************

  SELECT SINGLE * FROM ZDMS1 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM.
  IF SY-SUBRC EQ 0.

    SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ ZDMS1-PERNR.
    IF SY-SUBRC EQ 0.
      WA_EMAIL-PERNR = ZDMS1-PERNR.
      WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
      COLLECT WA_EMAIL INTO IT_EMAIL.
      CLEAR WA_EMAIL.
    ENDIF.

    SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ ZDMS1-APERNR.
    IF SY-SUBRC EQ 0.
      WA_EMAIL-PERNR = ZDMS1-APERNR.
      WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
      COLLECT WA_EMAIL INTO IT_EMAIL.
      CLEAR WA_EMAIL.
    ENDIF.

    IF ZDMS1-RPERNR NE '00000000'.
      SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ ZDMS1-RPERNR.
      IF SY-SUBRC EQ 0.
        WA_EMAIL-PERNR = ZDMS1-RPERNR.
        WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
        COLLECT WA_EMAIL INTO IT_EMAIL.
        CLEAR WA_EMAIL.
      ENDIF.
    ENDIF.

  ENDIF.



  SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ PERNR.
  IF SY-SUBRC EQ 0.
    WA_EMAIL-PERNR = PERNR.
    WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
    COLLECT WA_EMAIL INTO IT_EMAIL.
    CLEAR WA_EMAIL.
  ENDIF.

*******************************************************************

  LOOP AT IT_ZDMS2 INTO WA_ZDMS2 WHERE DEPT NE SPACE.
    CLEAR : DEPTHEAD1.
    SELECT SINGLE * FROM ZQMS_DEPTHEAD1 WHERE BTRTL EQ WA_ZDMS2-DEPT AND TO_DT GE SY-DATUM..  "24.7.22
    IF SY-SUBRC EQ 0.
      DEPTHEAD1 = ZQMS_DEPTHEAD1-PERNR.
    ENDIF.

*    SELECT SINGLE * FROM pa0001 WHERE btrtl EQ wa_zdms2-dept AND endda GE sy-datum AND plans NE '99999999'.  "5.7.20
*    IF sy-subrc EQ 0.
*      SELECT SINGLE * FROM hrp1000 WHERE objid EQ pa0001-plans AND otype EQ 'O'.
*      IF sy-subrc EQ 0.
**      WRITE :  'DEPARTMENT HEAD'.
*        depthead1 = pa0001-pernr.
*      ELSE.
*        SELECT SINGLE * FROM hrp1001 WHERE objid EQ pa0001-plans AND endda GT sy-datum AND rsign EQ 'A' AND relat EQ '003' .
*        IF sy-subrc EQ 0.
*          SELECT SINGLE * FROM hrp1001 WHERE objid EQ hrp1001-sobid AND endda GT sy-datum AND rsign EQ 'B' AND relat EQ '012'.
*          IF sy-subrc EQ 0.
*            SELECT SINGLE * FROM pa0001 WHERE plans EQ hrp1001-sobid AND endda GT sy-datum.
*            IF sy-subrc EQ 0.
*              depthead1 = pa0001-pernr.
*            ENDIF.
*          ENDIF.
*        ENDIF.
*      ENDIF.
*    ENDIF.

    SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ DEPTHEAD1.
    IF SY-SUBRC EQ 0.
      WA_EMAIL-PERNR = DEPTHEAD1.
      WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
      COLLECT WA_EMAIL INTO IT_EMAIL.
      CLEAR WA_EMAIL.
    ENDIF.

  ENDLOOP.

ENDFORM.
*&---------------------------------------------------------------------*
*&      Form  SEND_EMAIL
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM SEND_EMAIL .
  CLEAR : IT_EMAIL1,WA_EMAIL1.
  ZEILE = 1.
  DO 25 TIMES.
    WA_EMAIL1-MJAHR = YEAR.
    WA_EMAIL1-MBLNR = CCNUM.
    WA_EMAIL1-ZEILE = ZEILE.

    WA_EMAIL1-USRID_LONG = '  '.
    COLLECT WA_EMAIL1 INTO IT_EMAIL1.
    CLEAR WA_EMAIL1.
    ZEILE = ZEILE + 1.
  ENDDO.

  WA_FIELDCAT-FIELDNAME = 'MJAHR'.
  WA_FIELDCAT-SELTEXT_L = 'YEAR'.
  APPEND WA_FIELDCAT TO FIELDCAT.
  CLEAR WA_FIELDCAT.

  WA_FIELDCAT-FIELDNAME = 'MBLNR'.
  WA_FIELDCAT-SELTEXT_L = 'NOTIFICATION NO.'.
  APPEND WA_FIELDCAT TO FIELDCAT.
  CLEAR WA_FIELDCAT.

  WA_FIELDCAT-FIELDNAME = 'ZEILE'.
  WA_FIELDCAT-SELTEXT_L = 'COUNT'.
  APPEND WA_FIELDCAT TO FIELDCAT.
  CLEAR WA_FIELDCAT.

  WA_FIELDCAT-FIELDNAME = 'USRID_LONG'.
  WA_FIELDCAT-SELTEXT_L = 'EMAIL ID'.
  WA_FIELDCAT-EDIT = 'X'.
  APPEND WA_FIELDCAT TO FIELDCAT.
  CLEAR WA_FIELDCAT.

  LAYOUT-ZEBRA = 'X'.
  LAYOUT-COLWIDTH_OPTIMIZE = 'X'.
  LAYOUT-WINDOW_TITLEBAR  = 'FOLLOW-UP ACTIVITY'.

  CALL FUNCTION 'REUSE_ALV_GRID_DISPLAY'
    EXPORTING
      I_CALLBACK_PROGRAM      = G_REPID
*     I_CALLBACK_PF_STATUS_SET          = ' '
      I_CALLBACK_USER_COMMAND = 'USER_COMM3'
      I_CALLBACK_TOP_OF_PAGE  = 'TOP'
      IS_LAYOUT               = LAYOUT
      IT_FIELDCAT             = FIELDCAT
      I_SAVE                  = 'A'
    TABLES
      T_OUTTAB                = IT_EMAIL1
    EXCEPTIONS
      PROGRAM_ERROR           = 1
      OTHERS                  = 2.
  IF SY-SUBRC <> 0.
* MESSAGE ID SY-MSGID TYPE SY-MSGTY NUMBER SY-MSGNO
*         WITH SY-MSGV1 SY-MSGV2 SY-MSGV3 SY-MSGV4.
  ENDIF.

  CLEAR : FIELDCAT,LAYOUT.
ENDFORM.
*&---------------------------------------------------------------------*
*&      Form  SENDEMAIL
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM SENDEMAIL .
  PERFORM PRINT.
ENDFORM.
*&---------------------------------------------------------------------*
*&      Form  EMAIL32
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM EMAIL32 .

  SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ '00014022'.
  IF SY-SUBRC EQ 0.
    WA_EMAIL-PERNR = '00014022'.
    WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
    COLLECT WA_EMAIL INTO IT_EMAIL.
    CLEAR WA_EMAIL.
  ENDIF.

ENDFORM.
*&---------------------------------------------------------------------*
*&      Form  CHECK1
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
*&---------------------------------------------------------------------*
*&      Form  CHECKAPPROVAL
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM CHECKAPPROVAL .
*  BREAK-POINT.
  SELECT SINGLE * FROM ZDMS1 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM.
  IF SY-SUBRC EQ 0.
*    SELECT SINGLE * FROM PA0001 WHERE PERNR EQ ZDMS1-PERNR AND ENDDA GE SY-DATUM.
    SELECT SINGLE * FROM ZPA0001 WHERE PERNR EQ ZDMS1-PERNR AND ENDDA GE SY-DATUM.
    IF ZDMS1-WERKS EQ '1000'.
      IF ZPA0001-BTRTL NE '1224'.
        IF ZPA0001-BTRTL NE '1228'.
          IF ZPA0001-BTRTL NE '1223'.
            IF ZPA0001-BTRTL NE '1229'.
              IF ZPA0001-BTRTL NE '1230'.
                IF ZPA0001-BTRTL NE '1231'.
                  IF ZPA0001-BTRTL NE '1232'.
                    IF ZDMS1-RAPPROVE1 NE 'X'.

                      MESSAGE 'CHANGE CONTROL IS NOT YET APPROVED BY APPROVER' TYPE 'E'.
                    ENDIF.
                    IF ZDMS1-APERNR NE '00008896'.
                      IF ZDMS1-RAPPROVE2 NE 'X'.
*                      MESSAGE 'CHANGE CONTROL IS NOT YET APPROVED BY REVIEWER' TYPE 'E'.
                        MESSAGE 'CHANGE CONTROL IS NOT YET APPROVED BY REVIEWER' TYPE 'I'.
                      ENDIF.
                    ENDIF.
                  ENDIF.
                ENDIF.
              ENDIF.
            ENDIF.
          ENDIF.
        ENDIF.
      ENDIF.
    ELSEIF ZDMS1-WERKS EQ '1001'.
      IF ZPA0001-BTRTL NE '1323'.
        IF ZPA0001-BTRTL NE '1328'.
          IF ZDMS1-RAPPROVE1 NE 'X'.
            MESSAGE 'CHANGE CONTROL IS NOT YET APPROVED BY APPROVER' TYPE 'I'. "AKB NOT APPROVE CC ONLINE 4.5.2019
          ENDIF.
          IF ZDMS1-APERNR NE '00008896'.
            IF ZDMS1-RAPPROVE2 NE 'X'.
*              MESSAGE 'CHANGE CONTROL IS NOT YET APPROVED BY REVIEWER' TYPE 'E'.
              MESSAGE 'CHANGE CONTROL IS NOT YET APPROVED BY REVIEWER' TYPE 'I'.
            ENDIF.
          ENDIF.
        ENDIF.
      ENDIF.
**********************************new 6.5.22*************
    ELSE.

      IF ZPA0001-BTRTL EQ '1129' OR ZPA0001-BTRTL EQ '1130'.
*        IF PA0001-BTRTL NE '1328'.
        IF ZDMS1-RAPPROVE1 NE 'X'.
          MESSAGE 'CHANGE CONTROL IS NOT YET APPROVED BY APPROVER' TYPE 'E'. "AKB NOT APPROVE CC ONLINE 4.5.2019
        ENDIF.
*          IF ZDMS1-APERNR NE '00008896'.
*            IF ZDMS1-RAPPROVE2 NE 'X'.
**              MESSAGE 'CHANGE CONTROL IS NOT YET APPROVED BY REVIEWER' TYPE 'E'.
*              MESSAGE 'CHANGE CONTROL IS NOT YET APPROVED BY REVIEWER' TYPE 'I'.
*            ENDIF.
*          ENDIF.
*        ENDIF.
      ENDIF.

    ENDIF.
  ENDIF.

ENDFORM.
*&---------------------------------------------------------------------*
*&      Form  PROCCHK
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM PROCCHK .
  SELECT SINGLE * FROM ZDMS1 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM.
  IF SY-SUBRC EQ 0.
    SELECT * FROM ZDMS2 INTO TABLE IT_ZDMS2 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM.
    IF IT_ZDMS2 IS NOT INITIAL.
      LOOP AT IT_ZDMS2 INTO WA_ZDMS2.
        IF WA_ZDMS2-UPERNR EQ 0.
*          MESSAGE 'ENTER ALL IMPACTED ACTIVITIES' TYPE 'I'.
          MESSAGE 'ALL IMPACTED ACTIVITIES ARE NOT YET ENTERED' TYPE 'I'.
          LEAVE TO SCREEN 0.
*          call SCREEN 9009.
        ENDIF.
      ENDLOOP.
    ENDIF.
  ENDIF.
ENDFORM.
*&---------------------------------------------------------------------*
*&      Form  SEARCHHELP1
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM SEARCHHELP1 .
  SELECT * FROM ZDMS1 INTO TABLE IT_ZDMS1.
  LOOP AT IT_ZDMS1 INTO WA_ZDMS1.
    WA_TAS1-MJAHR = WA_ZDMS1-MJAHR.
    WA_TAS1-MBLNR = WA_ZDMS1-MBLNR.
    WA_TAS1-PERNR = WA_ZDMS1-PERNR.
    SELECT SINGLE * FROM PA0001 WHERE PERNR EQ WA_ZDMS1-PERNR AND ENDDA GE SY-DATUM.
    IF SY-SUBRC EQ 0.
      WA_TAS1-ENAME = PA0001-ENAME.
    ENDIF.
    WA_TAS1-DEPTAPR = WA_ZDMS1-APPROVE.
    WA_TAS1-DEPTREJ = WA_ZDMS1-REJECT.
    SELECT SINGLE * FROM ZDMS4 WHERE MJAHR EQ WA_ZDMS1-MJAHR AND MBLNR EQ WA_ZDMS1-MBLNR.
    IF SY-SUBRC EQ 0.
      WA_TAS1-CCNUMB1 = ZDMS4-CCNUMB1.
    ENDIF.
    COLLECT WA_TAS1 INTO IT_TAS1.
    CLEAR WA_TAS1.
  ENDLOOP.

  DELETE FROM ZDMSSEARCH1.
  LOOP AT IT_TAS1 INTO WA_TAS1.
    SELECT SINGLE * FROM ZDMS4 WHERE MBLNR EQ WA_TAS1-MBLNR AND MJAHR EQ WA_TAS1-MJAHR AND QHAPPROVE EQ 'X' AND QHPERNR NE '00000000' AND TDPERNR EQ '00000000'.
    IF SY-SUBRC EQ 0.
      ZDMSSEARCH1_WA-MJAHR = WA_TAS1-MJAHR.
      ZDMSSEARCH1_WA-MBLNR = WA_TAS1-MBLNR.
      ZDMSSEARCH1_WA-PERNR = WA_TAS1-PERNR.
      ZDMSSEARCH1_WA-ENAME = WA_TAS1-ENAME.
      ZDMSSEARCH1_WA-APPROVE = WA_TAS1-DEPTAPR.
      ZDMSSEARCH1_WA-REJECT = WA_TAS1-DEPTREJ.
      ZDMSSEARCH1_WA-CCNUMB1 = WA_TAS1-CCNUMB1.
      MODIFY ZDMSSEARCH1 FROM ZDMSSEARCH1_WA.
      CLEAR ZDMSSEARCH1_WA.
    ENDIF.
  ENDLOOP.
ENDFORM.
*&---------------------------------------------------------------------*
*&      Form  CCREPORT
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
*&---------------------------------------------------------------------*
*&      Form  EMAIL21A
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM EMAIL21A .

  SELECT SINGLE * FROM ZQMS_DEPTHEAD1 WHERE BTRTL EQ IBTRTL AND APPROVER NE SPACE AND TO_DT GE SY-DATUM..
  IF SY-SUBRC EQ 0.
    SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ ZQMS_DEPTHEAD1-APPROVER.
    IF SY-SUBRC EQ 0.
      SELECT SINGLE * FROM PA0001 WHERE PERNR EQ ZPASSW-PERNR AND PLANS NE '99999999' AND ENDDA GE SY-DATUM.
      IF SY-SUBRC EQ 0.
        WA_EMAIL-PERNR = ZPASSW-PERNR.
*       wa_email-pernr = '00016314'.
        WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
        COLLECT WA_EMAIL INTO IT_EMAIL.
        CLEAR WA_EMAIL.
      ENDIF.
    ENDIF.
  ENDIF.


  SELECT SINGLE * FROM ZQMS_DEPTHEAD1 WHERE BTRTL EQ IBTRTL AND APPROVER EQ SPACE AND TO_DT GE SY-DATUM..
  IF SY-SUBRC EQ 0.
    IF WERKS EQ '1000'.

      SELECT SINGLE * FROM ZQMS_DEPTHEAD1 WHERE BTRTL EQ '1228' AND TO_DT GE SY-DATUM.  "24.7.22
      IF SY-SUBRC EQ 0.
        SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ ZQMS_DEPTHEAD1-PERNR.
        IF SY-SUBRC EQ 0.
          WA_EMAIL-PERNR = ZPASSW-PERNR.
          WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
          COLLECT WA_EMAIL INTO IT_EMAIL.
          CLEAR WA_EMAIL.
        ENDIF.
      ENDIF.
    ELSEIF WERKS EQ '1001'.

      SELECT SINGLE * FROM ZQMS_DEPTHEAD1 WHERE BTRTL EQ '1328' AND TO_DT GE SY-DATUM.  "24.7.22
      IF SY-SUBRC EQ 0.
        SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ ZQMS_DEPTHEAD1-PERNR.
        IF SY-SUBRC EQ 0.
          WA_EMAIL-PERNR = ZPASSW-PERNR.
          WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
          COLLECT WA_EMAIL INTO IT_EMAIL.
          CLEAR WA_EMAIL.
        ENDIF.
      ENDIF.
    ELSE.
      SELECT SINGLE * FROM ZQMS_DEPTHEAD1 WHERE BTRTL EQ '1232' AND TO_DT GE SY-DATUM..  "24.7.22
      IF SY-SUBRC EQ 0.
        SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ ZQMS_DEPTHEAD1-PERNR.
        IF SY-SUBRC EQ 0.
          WA_EMAIL-PERNR = ZPASSW-PERNR.
          WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
          COLLECT WA_EMAIL INTO IT_EMAIL.
          CLEAR WA_EMAIL.
        ENDIF.
      ENDIF.

    ENDIF.
  ENDIF.


**  IF pernr EQ '00009352'.
*  IF pernr EQ '00015536'.
**     OR PERNR EQ '00009352'.
*    SELECT SINGLE * FROM zpassw WHERE pernr EQ '00003139'.
**      SELECT SINGLE * FROM zpassw WHERE pernr EQ '00016314'.
*    IF sy-subrc EQ 0.
*      wa_email-pernr = '00003139'.
**       wa_email-pernr = '00016314'.
*      wa_email-usrid_long = zpassw-smtp_addr.
*      COLLECT wa_email INTO it_email.
*      CLEAR wa_email.
*    ENDIF.
*    SELECT SINGLE * FROM zpassw WHERE pernr EQ '00013907'.
*    IF sy-subrc EQ 0.
*      wa_email-pernr = '00013907'.
*      wa_email-usrid_long = zpassw-smtp_addr.
*      COLLECT wa_email INTO it_email.
*      CLEAR wa_email.
*    ENDIF.
*    SELECT SINGLE * FROM zpassw WHERE pernr EQ '00012420'.
*    IF sy-subrc EQ 0.
*      wa_email-pernr = '00012420'.
*      wa_email-usrid_long = zpassw-smtp_addr.
*      COLLECT wa_email INTO it_email.
*      CLEAR wa_email.
*    ENDIF.
**  ELSEIF PERNR EQ '00013901'.
*  ELSEIF pernr EQ '00015167'.
*    SELECT SINGLE * FROM zpassw WHERE pernr EQ '00007354'.
*    IF sy-subrc EQ 0.
*      wa_email-pernr = '00007354'.
*      wa_email-usrid_long = zpassw-smtp_addr.
*      COLLECT wa_email INTO it_email.
*      CLEAR wa_email.
*    ENDIF.
*
*  ELSEIF pernr EQ '00011666'.  "26.3.23
*    SELECT SINGLE * FROM zpassw WHERE pernr EQ '00007354'.
*    IF sy-subrc EQ 0.
*      wa_email-pernr = '00007354'.
*      wa_email-usrid_long = zpassw-smtp_addr.
*      COLLECT wa_email INTO it_email.
*      CLEAR wa_email.
*    ENDIF.
*
*  ENDIF.
ENDFORM.
*&---------------------------------------------------------------------*
*&      Form  EMAIL5
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM EMAIL5 .
  LOOP AT IT_SDEPT1 INTO WA_SDEPT1 WHERE DEPT NE SPACE AND CHK EQ 'X'.
    SELECT SINGLE * FROM ZDMS2 WHERE MBLNR EQ WA_SDEPT1-MBLNR AND MJAHR = WA_SDEPT1-MJAHR AND DEPT EQ WA_SDEPT1-DEPT.
    IF SY-SUBRC EQ 4.
      CLEAR : DEPTHEAD1.
      SELECT SINGLE * FROM ZQMS_DEPTHEAD1 WHERE BTRTL EQ WA_SDEPT1-DEPT AND TO_DT GE SY-DATUM..  "24.7.22
      IF SY-SUBRC EQ 0.
        DEPTHEAD1 = ZQMS_DEPTHEAD1-PERNR.
      ENDIF.

*      SELECT SINGLE * FROM pa0001 WHERE btrtl EQ wa_sdept1-dept AND endda GE sy-datum .
*      IF sy-subrc = 0.
*        SELECT SINGLE * FROM hrp1001 WHERE objid EQ pa0001-orgeh AND  otype EQ 'O' AND  relat = '012' AND endda GE sy-datum.
*        IF sy-subrc = 0.  " 012 is the relation code ie dept head
*          SELECT SINGLE * FROM pa0001 WHERE plans = hrp1001-sobid  AND endda GE sy-datum.
*          IF sy-subrc = 0 .
*            depthead1 = pa0001-pernr.
*            WRITE :  'DEPARTMENT HEAD', pa0001-pernr.
*          ENDIF.
*        ENDIF.
*      ENDIF.

*      CLEAR : depthead1.
*      SELECT SINGLE * FROM pa0001 WHERE btrtl EQ wa_sdept1-dept AND endda GE sy-datum .
*      IF sy-subrc EQ 0.
*        SELECT SINGLE * FROM hrp1000 WHERE objid EQ pa0001-plans AND otype EQ 'O' AND langu EQ 'EN'.
*        IF sy-subrc EQ 0.
**      WRITE :  'DEPARTMENT HEAD'.
*          depthead1 = pa0001-pernr.
*        ELSE.
*          SELECT SINGLE * FROM hrp1001 WHERE objid EQ pa0001-plans AND endda GT sy-datum AND rsign EQ 'A' AND relat EQ '003' .
*          IF sy-subrc EQ 0.
*            SELECT SINGLE * FROM hrp1001 WHERE objid EQ hrp1001-sobid AND endda GT sy-datum AND rsign EQ 'B' AND relat EQ '012'.
*            IF sy-subrc EQ 0.
*              SELECT SINGLE * FROM pa0001 WHERE plans EQ hrp1001-sobid AND endda GT sy-datum.
*              IF sy-subrc EQ 0.
*                depthead1 = pa0001-pernr.
*              ENDIF.
*            ENDIF.
*          ELSE.
**************************************
*            SELECT SINGLE * FROM hrp1001 WHERE sobid EQ pa0001-orgeh AND sclas EQ 'O' AND endda GT sy-datum AND rsign EQ 'A' AND relat EQ '012'.
*            IF sy-subrc EQ 0.
*              SELECT SINGLE * FROM pa0001 WHERE plans EQ hrp1001-objid AND endda GT sy-datum.
*              IF sy-subrc EQ 0.
*                depthead1 = pa0001-pernr.
*              ENDIF.
*            ENDIF.
******************************************
*          ENDIF.
*        ENDIF.
*      ENDIF.

*    SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ DEPTHEAD1.
*    IF SY-SUBRC EQ 0.
*      WA_EMAIL-PERNR = DEPTHEAD1.
*      WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
*      COLLECT WA_EMAIL INTO IT_EMAIL.
*      CLEAR WA_EMAIL.
*      IF DEPTHEAD EQ '00002051'.
*        WA_EMAIL-PERNR = '00010860'.
*        SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ '00010860'.
*        IF SY-SUBRC EQ 0.
*          WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
*        ENDIF.
*        COLLECT WA_EMAIL INTO IT_EMAIL.
*        CLEAR WA_EMAIL.
*      ELSEIF DEPTHEAD EQ '00011924'.
*        WA_EMAIL-PERNR = '00012420'.
*        SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ '00012420'.
*        IF SY-SUBRC EQ 0.
*          WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
*        ENDIF.
*        COLLECT WA_EMAIL INTO IT_EMAIL.
*        CLEAR WA_EMAIL.
*      ENDIF.
*    ENDIF.

      SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ DEPTHEAD1.
      IF SY-SUBRC EQ 0.
        WA_EMAIL-PERNR = DEPTHEAD1.
        WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
        COLLECT WA_EMAIL INTO IT_EMAIL.
        CLEAR WA_EMAIL.
*        IF depthead1 EQ '00002051'.
        IF DEPTHEAD1 EQ '00005693'.
          WA_EMAIL-PERNR = '00011171'.
          SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ '00011171'.
          IF SY-SUBRC EQ 0.
            WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
          ENDIF.
          COLLECT WA_EMAIL INTO IT_EMAIL.
          CLEAR WA_EMAIL.
        ELSEIF DEPTHEAD1 EQ '00011924'.
          WA_EMAIL-PERNR = '00012420'.
          SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ '00012420'.
          IF SY-SUBRC EQ 0.
            WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
          ENDIF.
          COLLECT WA_EMAIL INTO IT_EMAIL.
          CLEAR WA_EMAIL.

          WA_EMAIL-PERNR = '00013907'.
          SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ '00013907'.
          IF SY-SUBRC EQ 0.
            WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
          ENDIF.
          COLLECT WA_EMAIL INTO IT_EMAIL.
          CLEAR WA_EMAIL.

        ELSEIF DEPTHEAD1 EQ '00005300' OR DEPTHEAD1 EQ '00015033'. "4.2.2020
          WA_EMAIL-PERNR = '00009185'.
          SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ '00009185'.
          IF SY-SUBRC EQ 0.
            WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
          ENDIF.
          COLLECT WA_EMAIL INTO IT_EMAIL.
          CLEAR WA_EMAIL.

*          WA_EMAIL-PERNR = '00015033'.
*          SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ '00015033'.
*          IF SY-SUBRC EQ 0.
*            WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
*          ENDIF.
*          COLLECT WA_EMAIL INTO IT_EMAIL.
*          CLEAR WA_EMAIL.

          WA_EMAIL-PERNR = '00013438'.
          SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ '00013438'.
          IF SY-SUBRC EQ 0.
            WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
          ENDIF.
          COLLECT WA_EMAIL INTO IT_EMAIL.
          CLEAR WA_EMAIL.


          WA_EMAIL-PERNR = '00001074'.
          SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ '00001074'.
          IF SY-SUBRC EQ 0.
            WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
          ENDIF.
          COLLECT WA_EMAIL INTO IT_EMAIL.
          CLEAR WA_EMAIL.

        ELSEIF DEPTHEAD1 EQ '00010498'.                     "4.2.2020
          WA_EMAIL-PERNR = '00006977'.
          SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ '00006977'.
          IF SY-SUBRC EQ 0.
            WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
          ENDIF.
          COLLECT WA_EMAIL INTO IT_EMAIL.
          CLEAR WA_EMAIL.

        ELSEIF DEPTHEAD1 EQ '00014967'.                     "4.2.2020
          WA_EMAIL-PERNR = '00006977'.
          SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ '00006977'.
          IF SY-SUBRC EQ 0.
            WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
          ENDIF.
          COLLECT WA_EMAIL INTO IT_EMAIL.
          CLEAR WA_EMAIL.

        ENDIF.
      ENDIF.
    ENDIF.
  ENDLOOP.
ENDFORM.


*&---------------------------------------------------------------------*
*&      Module  ACTIVATE_DMS_GOS  OUTPUT
*&---------------------------------------------------------------------*
*       DMS GOS Activation
*----------------------------------------------------------------------*
MODULE ACTIVATE_DMS_GOS OUTPUT.

  DATA: LV_DEL    TYPE C,
        LV_ENAME  TYPE ZEMNAM,
        LV_BTEXT  TYPE ZBTEXT,
        LV_STAGE  TYPE ZSTAGE,
        LV_PERSNO TYPE PERSNO,
        LV_WERKS  TYPE PA0001-WERKS,
        LV_BTRTL  TYPE PA0001-BTRTL.

*----------------------> Commented by Karthik on 31.12.2019

*  IF R1 = ABAP_TRUE OR R1C = ABAP_TRUE OR R2 = ABAP_TRUE
*    OR R3 = ABAP_TRUE.

*---------------------> End of Comments

  IF R1C = ABAP_TRUE OR R2 = ABAP_TRUE
    OR R3 = ABAP_TRUE.

    LV_MBLNR = ZDMS1-MBLNR.

    CALL FUNCTION 'CONVERSION_EXIT_ALPHA_OUTPUT'
      EXPORTING
        INPUT  = LV_MBLNR
      IMPORTING
        OUTPUT = LV_MBLNR.

    LS_BORIDENT-OBJKEY = LV_MBLNR.

*    CONCATENATE ls_borident-objkey '_' sy-datum+0(4)
    CONCATENATE LS_BORIDENT-OBJKEY '_' ZDMS1-MJAHR "Commented & Added by Gokulan.03.01.2021
    INTO LS_BORIDENT-OBJKEY.

    CONDENSE LS_BORIDENT-OBJKEY.

    FREE MEMORY ID 'ZDEL'.

    FREE MEMORY ID: 'ZENAME',
                    'ZBTEXT',
                    'ZSTAGE',
                    'ZPERSNO'.

    LV_PERSNO = PERNR.
*    LV_BTEXT = DEPT.
*    LV_ENAME = ENAME.
    IF LV_PERSNO NE '00000000'.
      CLEAR : LV_ENAME.
        SELECT SINGLE BTRTL INTO (LV_BTRTL) FROM ZPA0001
         WHERE PERNR EQ LV_PERSNO
         AND BEGDA <= SY-DATUM
         AND ENDDA >= SY-DATUM.

      SELECT SINGLE ENAME WERKS INTO (LV_ENAME,LV_WERKS ) FROM PA0001
         WHERE PERNR EQ LV_PERSNO
         AND BEGDA <= SY-DATUM
         AND ENDDA >= SY-DATUM.
      IF LV_WERKS IS NOT INITIAL AND
         LV_BTRTL IS NOT INITIAL.
        CLEAR : LV_BTEXT.
        SELECT SINGLE BTEXT INTO LV_BTEXT FROM T001P
          WHERE WERKS EQ LV_WERKS
          AND BTRTL EQ LV_BTRTL.
      ENDIF.
    ENDIF.

*---------------> Commented by Karthik on 31.12.2019

*    IF R1 = ABAP_TRUE.
*      LV_STAGE = 'Create (Initiator)'.
*    ELSEIF R1C = ABAP_TRUE.

*---------------> End of Comments

    IF R1C = ABAP_TRUE.
      LV_STAGE = 'Change if required (Initiator)'.
    ELSEIF R2 = ABAP_TRUE.
      LV_STAGE = 'Department Heads Approval (Initiator)'.
    ELSEIF R3 = ABAP_TRUE.
      LV_STAGE = 'Enter Impacted Activities'.
    ENDIF.

    EXPORT: LV_ENAME TO MEMORY ID 'ZENAME',
            LV_BTEXT TO MEMORY ID 'ZBTEXT',
            LV_STAGE TO MEMORY ID 'ZSTAGE',
            LV_PERSNO TO MEMORY ID 'ZPERSNO'.

*    IF R3 = ABAP_TRUE. " Commented by Karthik on 31.12.2019

    IF R1C = ABAP_TRUE OR R2 = ABAP_TRUE OR R3 = ABAP_TRUE.
      LV_DEL = ABAP_TRUE.
      EXPORT LV_DEL TO MEMORY ID 'ZDEL'. " To restrict Deletion option
    ENDIF.

    CREATE OBJECT LO_GOS_MANAGER
      EXPORTING
        IS_OBJECT      = LS_BORIDENT
        IP_NO_COMMIT   = ' '
      EXCEPTIONS
        OBJECT_INVALID = 1.

  ELSEIF R21 = ABAP_TRUE OR R21A = ABAP_TRUE. " For Reviewed by and Approved by

    PERFORM ACTIVATE_DMS_GOS_DISP. " To activate DMS GOS for Display

  ENDIF.

ENDMODULE.

*&---------------------------------------------------------------------*
*&      Module  ACTIVATE_DMS_GOS_DISP  OUTPUT
*&---------------------------------------------------------------------*
*       DMS GOS Activation for Display
*----------------------------------------------------------------------*
MODULE ACTIVATE_DMS_GOS_DISP OUTPUT.

  PERFORM ACTIVATE_DMS_GOS_DISP. " To activate DMS GOS for Display

ENDMODULE.

*&---------------------------------------------------------------------*
*&      Module  DMS_GOS_UNPUBLISH  OUTPUT
*&---------------------------------------------------------------------*
*       To unpublish DMS GOS Option
*----------------------------------------------------------------------*
MODULE DMS_GOS_UNPUBLISH OUTPUT.

* To unpublish DMS GOS

  IF LO_GOS_MANAGER IS BOUND.
    LO_GOS_MANAGER->UNPUBLISH( ). " Added by Karthik on 19.09.2019
  ENDIF.

ENDMODULE.

*&---------------------------------------------------------------------*
*&      Form  ACTIVATE_DMS_GOS_DISP
*&---------------------------------------------------------------------*
*       DMS GOS Activation for Display
*----------------------------------------------------------------------*
FORM ACTIVATE_DMS_GOS_DISP .

  DATA: LT_SEL TYPE TGOS_SELS,
        LS_SEL TYPE SGOS_SELS,
        LV_DEL TYPE C.

  CLEAR LT_SEL.

  IF ( SY-UNAME EQ 'ITBOM01'  or SY-UNAME EQ 'CTPLABAP' or SY-UNAME EQ 'CTPLNA' or SY-UNAME EQ 'CTPLGW') AND R12 EQ 'X'.  "ENABLE DELETE OPTION  21.1.21

***      ls_sel-sign = 'I'.
***  ls_sel-option = 'EQ'.
***  ls_sel-low = 'VIEW_ATTA'.
***  ls_sel-high = 'VIEW_ATTA'.
***  APPEND ls_sel TO lt_sel.
***  CLEAR ls_sel.

    FREE MEMORY ID 'ZDEL'. " Commented by Karthik on 31.12.2019

*  if r13 <> abap_true.
*  lv_del = abap_true.
*  endif.

    EXPORT LV_DEL TO MEMORY ID 'ZDEL'. " To restrict Deletion option

    LV_MBLNR = CCNUM.

    CALL FUNCTION 'CONVERSION_EXIT_ALPHA_OUTPUT'
      EXPORTING
        INPUT  = LV_MBLNR
      IMPORTING
        OUTPUT = LV_MBLNR.

    LS_BORIDENT-OBJKEY = LV_MBLNR.

*  CONCATENATE ls_borident-objkey '_' sy-datum+0(4)
    IF ZDMS1-MJAHR EQ '0000'.
      CONCATENATE LS_BORIDENT-OBJKEY '_' YEAR " added on 22.11.24 by Jyotsna
       INTO LS_BORIDENT-OBJKEY.
    ELSE.
      CONCATENATE LS_BORIDENT-OBJKEY '_' ZDMS1-MJAHR "Commented & Added by Gokulan.03.01.2021
      INTO LS_BORIDENT-OBJKEY.
    ENDIF.

    CONDENSE LS_BORIDENT-OBJKEY.

    CREATE OBJECT LO_GOS_MANAGER
      EXPORTING
        IS_OBJECT            = LS_BORIDENT
        IT_SERVICE_SELECTION = LT_SEL
        IP_NO_COMMIT         = ' '
      EXCEPTIONS
        OBJECT_INVALID       = 1.

  ELSE.

    LS_SEL-SIGN = 'I'.
    LS_SEL-OPTION = 'EQ'.
    LS_SEL-LOW = 'VIEW_ATTA'.
    LS_SEL-HIGH = 'VIEW_ATTA'.
    APPEND LS_SEL TO LT_SEL.
    CLEAR LS_SEL.

*  FREE MEMORY ID 'ZDEL'. " Commented by Karthik on 31.12.2019

*  if r13 <> abap_true.
    LV_DEL = ABAP_TRUE.
*  endif.

    EXPORT LV_DEL TO MEMORY ID 'ZDEL'. " To restrict Deletion option

    LV_MBLNR = CCNUM.

    CALL FUNCTION 'CONVERSION_EXIT_ALPHA_OUTPUT'
      EXPORTING
        INPUT  = LV_MBLNR
      IMPORTING
        OUTPUT = LV_MBLNR.

    LS_BORIDENT-OBJKEY = LV_MBLNR.

*  CONCATENATE ls_borident-objkey '_' sy-datum+0(4)
    IF ZDMS1-MJAHR EQ '0000'.
      CONCATENATE LS_BORIDENT-OBJKEY '_' YEAR  "added on 22.11.24
      INTO LS_BORIDENT-OBJKEY.
    ELSE.
      CONCATENATE LS_BORIDENT-OBJKEY '_' ZDMS1-MJAHR "Commented & Added by Gokulan.03.01.2021
      INTO LS_BORIDENT-OBJKEY.
    ENDIF.

    CONDENSE LS_BORIDENT-OBJKEY.

    CREATE OBJECT LO_GOS_MANAGER
      EXPORTING
        IS_OBJECT            = LS_BORIDENT
        IT_SERVICE_SELECTION = LT_SEL
        IP_NO_COMMIT         = ' '
      EXCEPTIONS
        OBJECT_INVALID       = 1.

  ENDIF.

ENDFORM.
*&---------------------------------------------------------------------*
*&      Form  CCNUM1
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM CCNUM1 .
*CLEAR : impdept."new
*  SELECT SINGLE * FROM zdms1 WHERE mjahr EQ year AND mblnr EQ ccnum AND ztyp EQ 'CC'.
*  IF sy-subrc EQ 0.
**    SELECT SINGLE * FROM ZDMS4 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM AND CCNUMB1 EQ SPACE.
**    IF SY-SUBRC EQ 0.
*    SELECT SINGLE * FROM pa0001 WHERE pernr EQ zdms1-pernr AND endda GE sy-datum.
*    IF sy-subrc EQ 0.
*      impdept = pa0001-btrtl.
*    ENDIF.
*    CLEAR : it_zdms4_1 .  "new
*    SELECT * FROM zdms4 INTO TABLE it_zdms4_1 WHERE mjahr EQ year AND werks EQ plant.
*    SORT it_zdms4_1 DESCENDING BY ccnumb.
*    CLEAR : vbeln1,finv1,year1, impdept1,plt,finvnumb.  "new
*    READ TABLE it_zdms4_1 INTO wa_zdms4_1 WITH KEY mjahr = year.
*    IF sy-subrc EQ 0.
*      vbeln1 = wa_zdms4_1-ccnumb.
*    ENDIF.
*    finv1 = vbeln1 + 1.
**      FINV1 = CCNUM.  " 15.12.2019
*    year1 = year+2(2).
*    impdept1 = impdept+2(2).
*    IF zdms1-werks EQ '1000'.
*      plt = 'NK'.
*    ELSEIF zdms1-werks EQ '1001'.
*      plt = 'GA'.
*    ELSEIF zdms1-werks EQ '3000'.
*      plt = 'MU'.
*    ELSE.
*      plt = 'CQ'.
*    ENDIF.
*    CONCATENATE 'CC/' year1 '/' impdept1 '/' plt '/' finv1 INTO finvnumb.
**    ENDIF.
*  ENDIF.
**new logic inserted on 7.2.22 for cc no. generateion as per current year*****************
  CLEAR : IMPDEPT.
  SELECT SINGLE * FROM ZDMS1 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM AND ZTYP EQ 'CC'.
  IF SY-SUBRC EQ 0.
*    SELECT SINGLE * FROM PA0001 WHERE PERNR EQ ZDMS1-PERNR AND ENDDA GE SY-DATUM.
    SELECT SINGLE * FROM ZPA0001 WHERE PERNR EQ ZDMS1-PERNR AND ENDDA GE SY-DATUM.
    IF SY-SUBRC EQ 0.
*      IMPDEPT = PA0001-BTRTL.
      IMPDEPT = ZPA0001-BTRTL.
    ENDIF.
*    ******** Change control no should take current year ------- 7.2.22 (As told by Pradeep- QA****
    CLEAR : YEAR2.
    YEAR2 = SY-DATUM+0(4).
    CLEAR :  IT_ZDMS4_1 .
*    SELECT * FROM ZDMS4 INTO TABLE IT_ZDMS4_1 WHERE MJAHR EQ YEAR2 AND WERKS EQ PLANT.
    SELECT * FROM ZDMS4 INTO TABLE IT_ZDMS4_1 WHERE QAMJAHR EQ YEAR2 AND WERKS EQ PLANT.
    SORT IT_ZDMS4_1 DESCENDING BY CCNUMB.
    CLEAR : VBELN1,FINV1,YEAR1,PLT,FINVNUMB.
    READ TABLE IT_ZDMS4_1 INTO WA_ZDMS4_1 WITH KEY QAMJAHR = YEAR2.
    IF SY-SUBRC EQ 0.
      VBELN1 = WA_ZDMS4_1-CCNUMB.
    ENDIF.
    FINV1 = VBELN1 + 1.
*      FINV1 = CCNUM.  " 15.12.2019
*    YEAR1 = YEAR+2(2).
    YEAR1 = YEAR2+2(2).
    IMPDEPT1 = IMPDEPT+2(2).
    IF ZDMS1-WERKS EQ '1000'.
      PLT = 'NK'.
    ELSEIF ZDMS1-WERKS EQ '1001'.
      PLT = 'GA'.
    ELSEIF ZDMS1-WERKS EQ '3000'.
      PLT = 'MU'.
    ELSE.
      PLT = 'CQ'.
    ENDIF.
    CONCATENATE 'CC/' YEAR1 '/' IMPDEPT1 '/' PLT '/' FINV1 INTO FINVNUMB.
*    ENDIF.
  ENDIF.

ENDFORM.
*&---------------------------------------------------------------------*
*&      Form  EMAIL21
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM EMAIL21 .


  CLEAR : DEPTHEAD,DEPTHEAD2,BTRTL,REVPERNR.
  SELECT SINGLE * FROM ZDMS1 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM.
  IF SY-SUBRC EQ 0.
    IF ZDMS1-WERKS EQ '1001'.
      BTRTL = '1328'.
    ELSEIF ZDMS1-WERKS EQ '1000'.
      BTRTL = '1228'.
    ELSE.
      BTRTL = '1232'.
    ENDIF.
  ENDIF.

  CLEAR : DEPTHEAD.
  SELECT SINGLE * FROM ZQMS_DEPTHEAD1 WHERE BTRTL EQ BTRTL AND TO_DT GE SY-DATUM..  "24.7.22
  IF SY-SUBRC EQ 0.
    DEPTHEAD = ZQMS_DEPTHEAD1-PERNR.
  ENDIF.

*  SELECT SINGLE * FROM pa0001 WHERE btrtl EQ btrtl AND endda GE sy-datum  AND plans NE '99999999'.
*  IF sy-subrc EQ 0.
*    SELECT SINGLE * FROM hrp1000 WHERE objid EQ pa0001-plans AND otype EQ 'O'.
*    IF sy-subrc EQ 0.
**      WRITE :  'DEPARTMENT HEAD'.
*      depthead = pa0001-pernr.
*    ELSE.
*      SELECT SINGLE * FROM hrp1001 WHERE objid EQ pa0001-plans AND endda GT sy-datum AND rsign EQ 'A' AND relat EQ '003' .
*      IF sy-subrc EQ 0.
*        SELECT SINGLE * FROM hrp1001 WHERE objid EQ hrp1001-sobid AND endda GT sy-datum AND rsign EQ 'B' AND relat EQ '012'.
*        IF sy-subrc EQ 0.
*          SELECT SINGLE * FROM pa0001 WHERE plans EQ hrp1001-sobid AND endda GT sy-datum.
*          IF sy-subrc EQ 0.
*            depthead = pa0001-pernr.
*          ENDIF.
*        ENDIF.
*      ENDIF.
*    ENDIF.
*  ENDIF.

  SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ DEPTHEAD .
  IF SY-SUBRC EQ 0.
    WA_EMAIL-PERNR = DEPTHEAD.
    WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
    COLLECT WA_EMAIL INTO IT_EMAIL.
    CLEAR WA_EMAIL.
*    IF depthead EQ '00002051'.
*      wa_email-pernr = '00011171'.
*      SELECT SINGLE * FROM zpassw WHERE pernr EQ '00011171'.
*      IF sy-subrc EQ 0.
*        wa_email-usrid_long = zpassw-smtp_addr.
*      ENDIF.
*      COLLECT wa_email INTO it_email.
*      CLEAR wa_email.
*    ELSe
*    IF  DEPTHEAD EQ '00005693'.
    IF  BTRTL EQ '1228'.
      WA_EMAIL-PERNR = '00011171'.
      SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ '00011171'.
      IF SY-SUBRC EQ 0.
        WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
      ENDIF.
      COLLECT WA_EMAIL INTO IT_EMAIL.
      CLEAR WA_EMAIL.

*    ELSEIF  DEPTHEAD EQ '00013959'.
    ELSEIF  BTRTL EQ '1232'.
      WA_EMAIL-PERNR = '00016102'.
      SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ '00016102'.
      IF SY-SUBRC EQ 0.
        WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
      ENDIF.
      COLLECT WA_EMAIL INTO IT_EMAIL.
      CLEAR WA_EMAIL.
*      wa_email-pernr = '00014135'.
*      SELECT SINGLE * FROM zpassw WHERE pernr EQ '00014135'.
*      IF sy-subrc EQ 0.
*        wa_email-usrid_long = zpassw-smtp_addr.
*      ENDIF.
*      COLLECT wa_email INTO it_email.
*      CLEAR wa_email.
*    ELSEIF DEPTHEAD EQ '00011924'.
    ELSEIF  BTRTL EQ '1328'.
      WA_EMAIL-PERNR = '00012420'.
      SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ '00012420'.
      IF SY-SUBRC EQ 0.
        WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
      ENDIF.
      COLLECT WA_EMAIL INTO IT_EMAIL.
      CLEAR WA_EMAIL.

      WA_EMAIL-PERNR = '00013907'.
      SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ '00013907'.
      IF SY-SUBRC EQ 0.
        WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
      ENDIF.
      COLLECT WA_EMAIL INTO IT_EMAIL.
      CLEAR WA_EMAIL.

    ENDIF.
  ENDIF.

*  SELECT SINGLE * FROM zdms1 WHERE mjahr EQ year AND mblnr EQ ccnum.
*  IF sy-subrc EQ 0.
*
*    SELECT SINGLE * FROM zpassw WHERE pernr EQ zdms1-pernr.
*    IF sy-subrc EQ 0.
*      wa_email-pernr = zdms1-pernr.
*      wa_email-usrid_long = zpassw-smtp_addr.
*      COLLECT wa_email INTO it_email.
*      CLEAR wa_email.
*    ENDIF.
*    SELECT SINGLE * FROM zpassw WHERE pernr EQ zdms1-apernr.
*    IF sy-subrc EQ 0.
*      wa_email-pernr = zdms1-apernr.
*      wa_email-usrid_long = zpassw-smtp_addr.
*      COLLECT wa_email INTO it_email.
*      CLEAR wa_email.
*    ENDIF.
*************  CHECK DEPARTMENT****************
*    IF zdms1-pernr EQ '00002055'.
**      revpernr = '00002155'.
*      revpernr = '00011666'.
*    ELSEIF zdms1-pernr EQ '00011031'.
**      revpernr = '00002155'.
*      revpernr = '00011666'.
*    ELSEIF zdms1-werks EQ '1000'.
**      REVPERNR = '00013901'.
*      revpernr = '00015167'.
*    ELSEIF zdms1-werks EQ '1001'.
**      revpernr = '00009352'.
*      revpernr = '00015536'.
*    ENDIF.
*
*    IF zdms1-werks EQ '1001'.
*      SELECT SINGLE * FROM pa0001 WHERE pernr EQ zdms1-pernr AND endda GE sy-datum.
*      IF sy-subrc EQ 0.
*        IF pa0001-btrtl NE '1323'.
*          IF pa0001-btrtl NE '1328'.
*            SELECT SINGLE * FROM zpassw WHERE pernr EQ '00003139'.
**              SELECT SINGLE * FROM zpassw WHERE pernr EQ '00016314'.
*            IF sy-subrc EQ 0.
*              wa_email-pernr = zdms1-rpernr.
*              wa_email-usrid_long = zpassw-smtp_addr.
*              COLLECT wa_email INTO it_email.
*              CLEAR wa_email.
*            ENDIF.
*            SELECT SINGLE * FROM zpassw WHERE pernr EQ revpernr.
*            IF sy-subrc EQ 0.
*              wa_email-pernr = zdms1-rpernr.
*              wa_email-usrid_long = zpassw-smtp_addr.
*              COLLECT wa_email INTO it_email.
*              CLEAR wa_email.
*            ENDIF.
*          ENDIF.
*        ENDIF.
*
*      ENDIF.
*    ELSEIF zdms1-werks EQ '1000'.
*      SELECT SINGLE * FROM pa0001 WHERE pernr EQ zdms1-pernr AND endda GE sy-datum.
*      IF sy-subrc EQ 0.
*        IF pa0001-btrtl NE '1224'.
*          IF pa0001-btrtl NE '1228'.
*            IF pa0001-btrtl NE '1223'.
*              IF pa0001-btrtl NE '1229'.
*                IF pa0001-btrtl NE '1230'.
*                  SELECT SINGLE * FROM zpassw WHERE pernr EQ '00007354'.
*                  IF sy-subrc EQ 0.
*                    wa_email-pernr = zdms1-rpernr.
*                    wa_email-usrid_long = zpassw-smtp_addr.
*                    COLLECT wa_email INTO it_email.
*                    CLEAR wa_email.
*                  ENDIF.
*                  SELECT SINGLE * FROM zpassw WHERE pernr EQ revpernr.
*                  IF sy-subrc EQ 0.
*                    wa_email-pernr = zdms1-rpernr.
*                    wa_email-usrid_long = zpassw-smtp_addr.
*                    COLLECT wa_email INTO it_email.
*                    CLEAR wa_email.
*                  ENDIF.
*                ENDIF.
*              ENDIF.
*            ENDIF.
*          ENDIF.
*
*        ENDIF.
***********************************
*      ENDIF.
*    ENDIF.
************** CHECK DEPT ENDS*************
*  ENDIF.

  IF R3 EQ 'X'.
*    LOOP AT it_zdms2_1 INTO wa_zdms2_1.
**    SELECT SINGLE * FROM PA0105 WHERE PERNR EQ PERNR AND SUBTY EQ '0010'.
*      SELECT SINGLE * FROM zpassw WHERE pernr EQ wa_zdms2_1-upernr.
*      IF sy-subrc EQ 0.
*        wa_email-pernr = pernr.
*        wa_email-usrid_long = zpassw-smtp_addr.
*        COLLECT wa_email INTO it_email.
*        CLEAR wa_email.
*      ENDIF.
*      SELECT SINGLE * FROM pa0001 WHERE pernr EQ pernr AND endda GE sy-datum AND plans NE '99999999'.
*      IF sy-subrc EQ 0.
**    DEPTHNAME = PA0001-ENAME.
*
*        SELECT SINGLE * FROM pa0001 WHERE btrtl EQ pa0001-btrtl AND endda GE sy-datum  AND plans NE '99999999'.
*        IF sy-subrc EQ 0.
*          CLEAR : depthead2,depthname.
*          SELECT SINGLE * FROM zqms_depthead WHERE btrtl EQ pa0001-btrtl.  "24.7.22
*          IF sy-subrc EQ 0.
*            depthead2 = zqms_depthead-pernr.
*            SELECT SINGLE * FROM pa0001 WHERE pernr EQ depthead2 AND endda GE sy-datum.
*            IF sy-subrc EQ 0.
*              depthname = pa0001-pernr.
*            ENDIF.
*          ENDIF.
**          SELECT SINGLE * FROM hrp1000 WHERE objid EQ pa0001-plans AND otype EQ 'O'.
**          IF sy-subrc EQ 0.
***      WRITE :  'DEPARTMENT HEAD'.
**            depthead2 = pa0001-pernr.
**            depthname = pa0001-ename.
**          ELSE.
**            SELECT SINGLE * FROM hrp1001 WHERE objid EQ pa0001-plans AND endda GT sy-datum AND rsign EQ 'A' AND relat EQ '003' .
**            IF sy-subrc EQ 0.
**              SELECT SINGLE * FROM hrp1001 WHERE objid EQ hrp1001-sobid AND endda GT sy-datum AND rsign EQ 'B' AND relat EQ '012'.
**              IF sy-subrc EQ 0.
**                SELECT SINGLE * FROM pa0001 WHERE plans EQ hrp1001-sobid AND endda GT sy-datum.
**                IF sy-subrc EQ 0.
**                  depthead2 = pa0001-pernr.
**                  depthname = pa0001-ename.
**                ENDIF.
**              ENDIF.
**            ENDIF.
**          ENDIF.
*          SELECT SINGLE * FROM zpassw WHERE pernr EQ depthead2.
*          IF sy-subrc EQ 0.
*            wa_email-pernr = depthead2.
*            wa_email-usrid_long = zpassw-smtp_addr.
*            COLLECT wa_email INTO it_email.
*            CLEAR wa_email.
*          ENDIF.
*        ENDIF.
*      ENDIF.
*    ENDLOOP.

  ELSEIF R2 EQ 'X'.

    SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ PERNR .

    IF SY-SUBRC EQ 0.
      WA_EMAIL-PERNR = PERNR.
      WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
      COLLECT WA_EMAIL INTO IT_EMAIL.
      CLEAR WA_EMAIL.
    ENDIF.
    DEPTHEAD2 = PERNR.
    SELECT SINGLE * FROM PA0001 WHERE PERNR EQ PERNR AND ENDDA GE SY-DATUM AND PLANS NE '99999999'.
    IF SY-SUBRC EQ 0.
      DEPTHNAME = PA0001-ENAME.
    ENDIF.

*    SELECT SINGLE * FROM PA0001 WHERE PERNR EQ PERNR AND ENDDA GE SY-DATUM AND PLANS NE '99999999'.
*    IF SY-SUBRC EQ 0.
**    DEPTHNAME = PA0001-ENAME.
*
*      SELECT SINGLE * FROM PA0001 WHERE BTRTL EQ PA0001-BTRTL AND ENDDA GE SY-DATUM  AND PLANS NE '99999999'.
*      IF SY-SUBRC EQ 0.
*        SELECT SINGLE * FROM HRP1000 WHERE OBJID EQ PA0001-PLANS AND OTYPE EQ 'O'.
*        IF SY-SUBRC EQ 0.
**      WRITE :  'DEPARTMENT HEAD'.
*          DEPTHEAD2 = PA0001-PERNR.
*          DEPTHNAME = PA0001-ENAME.
*        ELSE.
*          SELECT SINGLE * FROM HRP1001 WHERE OBJID EQ PA0001-PLANS AND ENDDA GT SY-DATUM AND RSIGN EQ 'A' AND RELAT EQ '003' .
*          IF SY-SUBRC EQ 0.
*            SELECT SINGLE * FROM HRP1001 WHERE OBJID EQ HRP1001-SOBID AND ENDDA GT SY-DATUM AND RSIGN EQ 'B' AND RELAT EQ '012'.
*            IF SY-SUBRC EQ 0.
*              SELECT SINGLE * FROM PA0001 WHERE PLANS EQ HRP1001-SOBID AND ENDDA GT SY-DATUM.
*              IF SY-SUBRC EQ 0.
*                DEPTHEAD2 = PA0001-PERNR.
*                DEPTHNAME = PA0001-ENAME.
*              ENDIF.
*            ENDIF.
*          ENDIF.
*        ENDIF.
*        SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ DEPTHEAD2.
*        IF SY-SUBRC EQ 0.
*          WA_EMAIL-PERNR = DEPTHEAD2.
*          WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
*          COLLECT WA_EMAIL INTO IT_EMAIL.
*          CLEAR WA_EMAIL.
*        ENDIF.
*      ENDIF.
*    ENDIF.
  ENDIF.


ENDFORM.
*&---------------------------------------------------------------------*
*&      Form  QADEPTUPD
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM QADEPTUPD .
  CLEAR : ODEPT.
  CLEAR : ODEPT1.
*  ODEPT2,ODEPT3,ODEPT4,ODEPT5.

  LOOP AT IT_IMP1 INTO WA_IMP1 WHERE MJAHR = YEAR AND MBLNR = CCNUM  AND DEPT NE SPACE.
    IF WA_IMP1-CNT EQ 1.
      ODEPT1 = WA_IMP1-DEPT.
    ENDIF.
    IF WA_IMP1-DEPT NE ODEPT1.
      MESSAGE 'ENTER ONLY ONE TYPE OF DEPARTMENT AT A TIME' TYPE 'E'.
    ENDIF.
  ENDLOOP.


  READ TABLE IT_IMP1 INTO WA_IMP1 WITH KEY MJAHR = YEAR MBLNR = CCNUM  CNT = 1.
  IF SY-SUBRC EQ 0.
    ODEPT = WA_IMP1-DEPT.
  ENDIF.

  SELECT SINGLE * FROM ZDMS2 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM AND DEPT EQ ODEPT.
  IF SY-SUBRC EQ 4.
    MESSAGE 'INVALID DEPARTMNT CODE' TYPE 'E'.
  ENDIF.

  SELECT SINGLE * FROM ZDMS2 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM AND DEPT EQ ODEPT AND UPERNR NE '00000000'.
  IF SY-SUBRC EQ 0.
    MESSAGE ' ACTIVITY IS ALREDAY ENTERD FOR THIS DEPARTMENT' TYPE 'E'.
  ENDIF.

  SELECT * FROM ZDMS2 INTO TABLE IMP_ZDMS2 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM AND DEPT EQ ODEPT.
  LOOP AT IMP_ZDMS2 INTO WMP_ZDMS2.
    MOVE-CORRESPONDING WMP_ZDMS2 TO WMP1_ZDMS2.
    WMP1_ZDMS2-UBUDAT = SY-DATUM.
    WMP1_ZDMS2-UPERNR = PERNR.
    WMP1_ZDMS2-APPROVE = 'X'.
    READ TABLE IT_IMP1 INTO WA_IMP1 WITH KEY MJAHR = YEAR MBLNR = CCNUM  DEPT = ODEPT CNT = 1.
    IF SY-SUBRC EQ 0.
      WMP1_ZDMS2-ATEXT1 = WA_IMP1-IMP.
      WMP1_ZDMS2-TDATE1 = WA_IMP1-TARDT.
      WMP1_ZDMS2-REM1 = WA_IMP1-REMARK.
    ENDIF.

    READ TABLE IT_IMP1 INTO WA_IMP1 WITH KEY MJAHR = YEAR MBLNR = CCNUM  DEPT = ODEPT CNT = 2.
    IF SY-SUBRC EQ 0.
      WMP1_ZDMS2-ATEXT2 = WA_IMP1-IMP.
      WMP1_ZDMS2-TDATE2 = WA_IMP1-TARDT.
      WMP1_ZDMS2-REM2 = WA_IMP1-REMARK.
    ENDIF.

    READ TABLE IT_IMP1 INTO WA_IMP1 WITH KEY MJAHR = YEAR MBLNR = CCNUM  DEPT = ODEPT CNT = 3.
    IF SY-SUBRC EQ 0.
      WMP1_ZDMS2-ATEXT3 = WA_IMP1-IMP.
      WMP1_ZDMS2-TDATE3 = WA_IMP1-TARDT.
      WMP1_ZDMS2-REM3 = WA_IMP1-REMARK.
    ENDIF.

    READ TABLE IT_IMP1 INTO WA_IMP1 WITH KEY MJAHR = YEAR MBLNR = CCNUM  DEPT = ODEPT CNT = 4.
    IF SY-SUBRC EQ 0.
      WMP1_ZDMS2-ATEXT4 = WA_IMP1-IMP.
      WMP1_ZDMS2-TDATE4 = WA_IMP1-TARDT.
      WMP1_ZDMS2-REM4 = WA_IMP1-REMARK.
    ENDIF.

    READ TABLE IT_IMP1 INTO WA_IMP1 WITH KEY MJAHR = YEAR MBLNR = CCNUM  DEPT = ODEPT CNT = 5.
    IF SY-SUBRC EQ 0.
      WMP1_ZDMS2-ATEXT5 = WA_IMP1-IMP.
      WMP1_ZDMS2-TDATE5 = WA_IMP1-TARDT.
      WMP1_ZDMS2-REM5 = WA_IMP1-REMARK.
    ENDIF.

    UPDATE ZDMS2 FROM WMP1_ZDMS2.
    CLEAR WMP1_ZDMS2.
  ENDLOOP.

  CLEAR : IT_IMP1,WA_IMP1.

  MESSAGE 'DATA UPDATED' TYPE 'I'.
  LEAVE TO SCREEN 0.
ENDFORM.
*&---------------------------------------------------------------------*
*&      Form  TENTATIVEDT
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM TENTATIVEDT .
*BREAK-POINT .
  SELECT SINGLE * FROM ZDMS3 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM.
  IF SY-SUBRC NE 0.
    MESSAGE 'IMPACTED ACTIVITIES ARE NOT YET SET' TYPE 'E'.
  ENDIF.
  SELECT SINGLE * FROM ZDMS4 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM AND QHAPPROVE EQ 'X'.  "10.7.20
  IF SY-SUBRC EQ 0.
    MESSAGE 'CHNAGE CONTROL IS ALREDAY APPROVED BY QA/CQD HEAD' TYPE 'E'.
  ENDIF.
  SELECT SINGLE * FROM ZDMS4 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM AND TDAPPROVE EQ 'X'.  "10.7.20
  IF SY-SUBRC EQ 0.
    MESSAGE 'CHNAGE CONTROL IS ALREDAY APPROVED BY TECHNICAL DIRECTOR' TYPE 'E'.
  ENDIF.
  SELECT SINGLE * FROM ZDMS4 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM AND QHAPPROVE EQ 'X'.  "10.7.20
  IF SY-SUBRC EQ 0.
    MESSAGE 'CHNAGE CONTROL IS ALREDAY APPROVED BY TECHNICAL DIRECTOR' TYPE 'E'.
  ENDIF.



  CLEAR : IT_TCLOSURE1,WA_TCLOSURE1.
  CLEAR : FIELDCAT,LAYOUT.
********************************

  WA_TCLOSURE1-MBLNR = CCNUM.
  WA_TCLOSURE1-MJAHR = YEAR.
  SELECT SINGLE * FROM ZDMS4 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM . "10.7.20
  IF SY-SUBRC EQ 0.
    WA_TCLOSURE1-TCLOSEDT = ZDMS4-TCLOSEDT.
  ENDIF.

*WA_TCLOSURE-TCLOSEDT = SPACE.
  COLLECT WA_TCLOSURE1 INTO IT_TCLOSURE1.
  CLEAR WA_TCLOSURE1.

  CLEAR : FIELDCAT,LAYOUT.

  WA_FIELDCAT-FIELDNAME = 'MBLNR'.
  WA_FIELDCAT-SELTEXT_L = 'Change Control No.'.
  APPEND WA_FIELDCAT TO FIELDCAT.
  CLEAR WA_FIELDCAT.

  WA_FIELDCAT-FIELDNAME = 'MJAHR'.
  WA_FIELDCAT-SELTEXT_L = 'Change Control Year'.
  APPEND WA_FIELDCAT TO FIELDCAT.
  CLEAR WA_FIELDCAT.

  WA_FIELDCAT-FIELDNAME = 'TCLOSEDT'.
  WA_FIELDCAT-SELTEXT_L = 'Tentative Closure Date'.
  WA_FIELDCAT-EDIT = 'X'.
  APPEND WA_FIELDCAT TO FIELDCAT.
  CLEAR WA_FIELDCAT.


  LAYOUT-ZEBRA = 'X'.
  LAYOUT-COLWIDTH_OPTIMIZE = 'X'.
  LAYOUT-WINDOW_TITLEBAR  = 'ENTER TENTATIVE CLOSURE DATE FOR CHANGE CONTROL'.

  CALL FUNCTION 'REUSE_ALV_GRID_DISPLAY'
    EXPORTING
      I_CALLBACK_PROGRAM      = G_REPID
*     I_CALLBACK_PF_STATUS_SET          = ' '
      I_CALLBACK_USER_COMMAND = 'USER_COMM1'
      I_CALLBACK_TOP_OF_PAGE  = 'TOP'
      IS_LAYOUT               = LAYOUT
      IT_FIELDCAT             = FIELDCAT
      I_SAVE                  = 'A'
    TABLES
      T_OUTTAB                = IT_TCLOSURE1
    EXCEPTIONS
      PROGRAM_ERROR           = 1
      OTHERS                  = 2.
  IF SY-SUBRC <> 0.
* MESSAGE ID SY-MSGID TYPE SY-MSGTY NUMBER SY-MSGNO
*         WITH SY-MSGV1 SY-MSGV2 SY-MSGV3 SY-MSGV4.
  ENDIF.

  CLEAR : FIELDCAT,LAYOUT.
  CLEAR : LAYOUT, FIELDCAT.

ENDFORM.
*&---------------------------------------------------------------------*
*&      Form  TENTATIVECLUPD
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM TENTATIVECLUPD .
*  BREAK-POINT.
  LOOP AT IT_TCLOSURE1 INTO WA_TCLOSURE1 WHERE TCLOSEDT NE '00000000'.
    SELECT SINGLE * FROM ZDMS4 WHERE MJAHR EQ WA_TCLOSURE1-MJAHR AND MBLNR EQ WA_TCLOSURE1-MBLNR.
    IF SY-SUBRC EQ 0.
      MOVE-CORRESPONDING ZDMS4 TO ZDMS4_WA.
      ZDMS4_WA-TCLOSEDT = WA_TCLOSURE1-TCLOSEDT.
      ZDMS4_WA-TCLOSEDTBY = PERNR.
      ZDMS4_WA-TCLOSEDTON = SY-DATUM.
      ZDMS4_WA-TCLOSETMON = SY-UZEIT.
      ZDMS4_WA-TCLOSEUNAME = SY-UNAME.
      MODIFY ZDMS4 FROM ZDMS4_WA.
      CLEAR ZDMS4_WA.
    ENDIF.
  ENDLOOP.
  IF SY-SUBRC EQ 0.
    MESSAGE 'TENTATIVE CLOSURE DATE IS UPDATED' TYPE 'I'.
  ENDIF.
  LEAVE TO SCREEN 0.
ENDFORM.
*&---------------------------------------------------------------------*
*&      Module  STATUS_9007  OUTPUT
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
MODULE STATUS_9007 OUTPUT.
*  BREAK-POINT.
  SET PF-STATUS 'STATUS'.
  SET TITLEBAR 'EXTEND'.
*  BREAK-POINT.
  CLEAR : QAHEADNAME,EXTPDNAME, EXTINITDEPT,EXTPDDT,EXTPDTM.
  SELECT SINGLE * FROM ZDMS5 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM.
  IF SY-SUBRC EQ 0.

    SELECT SINGLE * FROM ZPA0001 WHERE PERNR EQ ZDMS5-EIPERNR AND ENDDA GE SY-DATUM.
        IF SY-SUBRC EQ 0.
      EXTINITDEPT = ZPA0001-BTRTL.
      endif.
    SELECT SINGLE * FROM PA0001 WHERE PERNR EQ ZDMS5-EIPERNR AND ENDDA GE SY-DATUM.
    IF SY-SUBRC EQ 0.
*      EXTINITDEPT = PA0001-BTRTL.
      EXTPDDT = ZDMS5-DEPTHDT.
      EXTPDTM = ZDMS5-DEPTHTM.
*      SELECT SINGLE * FROM zdms6 WHERE mjahr EQ year AND mblnr EQ ccnum AND btrtl EQ extinitdept.
*      IF sy-subrc EQ 0.
*        extpddt = zdms6-acceptdt.
      SELECT SINGLE * FROM PA0001 WHERE PERNR EQ ZDMS5-DEPTH AND ENDDA GE SY-DATUM.
      IF SY-SUBRC EQ 0.
        EXTPDNAME = PA0001-ENAME.
      ENDIF.
*      ENDIF.
    ENDIF.


    SELECT SINGLE * FROM PA0001 WHERE PERNR EQ ZDMS5-QAPERNR AND ENDDA GE SY-DATUM.
    IF SY-SUBRC EQ 0.
      QAHEADNAME = PA0001-ENAME.
    ENDIF.

  ENDIF.
  CLEAR OK.
  CLEAR : SY-UCOMM.
  OK = SY-UCOMM.

  IF RE1 EQ 'X'.
    LOOP AT SCREEN.
      IF SCREEN-GROUP1 EQ '001'.
        SCREEN-INPUT = 0.
        MODIFY SCREEN.
      ELSEIF SCREEN-GROUP1 EQ '002'.
        SCREEN-INPUT = 0.
        MODIFY SCREEN.
      ENDIF.
    ENDLOOP.
  ELSEIF RE2 EQ 'X'.
    LOOP AT SCREEN.
      IF SCREEN-GROUP1 EQ '001'.
        SCREEN-INPUT = 1.
        MODIFY SCREEN.
      ELSE.
        SCREEN-INPUT = 0.
        MODIFY SCREEN.
      ENDIF.
    ENDLOOP.
  ELSEIF RE3 EQ 'X'.
    LOOP AT SCREEN.
      IF SCREEN-GROUP1 EQ '002'.
        SCREEN-INPUT = 1.
        MODIFY SCREEN.
      ELSE.
        SCREEN-INPUT = 0.
        MODIFY SCREEN.
      ENDIF.
    ENDLOOP.
  ENDIF.

  IF RE2 EQ 'X'.
*    BREAK-POINT .
    CLEAR : CHK3.
    SELECT SINGLE * FROM ZDMS6 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM AND APERNR LE 0 .
    IF SY-SUBRC EQ 0.
      SELECT SINGLE * FROM ZQMS_DEPTHEAD1 WHERE BTRTL EQ ZDMS6-BTRTL AND PERNR EQ PERNR AND TO_DT GE SY-DATUM..
      IF SY-SUBRC EQ 0.
        CHK3 = 'A'.
      ENDIF.
    ENDIF.

    SELECT SINGLE * FROM ZDMS6 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM AND BTRTL EQ INITDEPT2 AND APERNR GT 0.
    IF SY-SUBRC EQ 0.
      IF CHK3 EQ 'A'.
      ELSE.
        MESSAGE 'REQUEST IS ALREDAY ACCEPTED' TYPE 'E'.
      ENDIF.
    ENDIF.
  ENDIF.

  IF RE3 EQ 'X'.
    SELECT SINGLE * FROM ZDMS6 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM AND APERNR EQ '00000000'.
    IF SY-SUBRC EQ 0.
      MESSAGE 'EXTENSION REQUEST IS NOT YET APPROVED BY ALL' TYPE 'E'.
    ENDIF.
    SELECT SINGLE * FROM ZDMS6 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM AND APERNR EQ SPACE.
    IF SY-SUBRC EQ 0.
      MESSAGE 'EXTENSION REQUEST IS NOT YET APPROVED BY ALL' TYPE 'E'.
    ENDIF.
    SELECT SINGLE * FROM ZDMS5 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM AND QAPERNR GT 0.
    IF SY-SUBRC EQ 0.
      MESSAGE 'EXTENSION REQUEST IS ALREDAY APPROVED BY QA/CQD HEAD' TYPE 'E'.
    ENDIF.
  ENDIF.

  SELECT SINGLE * FROM ZDMS5 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM.
  IF SY-SUBRC NE 0.
*    zdms5-eidays = 1.
    ZDMS5-EIDAYS = 0.
  ENDIF.

ENDMODULE.
*&---------------------------------------------------------------------*
*&      Module  USER_COMMAND_9007  INPUT
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
MODULE USER_COMMAND_9007 INPUT.
*BREAK-POINT.
  CASE OK.

    WHEN 'SAVE'.
      IF CC1  EQ 'X' AND RE1 EQ 'X'.
        PERFORM EXTENSION.
        CLEAR : OK.
        LEAVE TO SCREEN 0.

      ELSEIF CC1  EQ 'X' AND RE2 EQ 'X'.
        PERFORM EXTENSION1.
        CLEAR : OK.
        LEAVE TO SCREEN 0.
      ELSEIF CC1  EQ 'X' AND RE3 EQ 'X'.
        PERFORM EXTENSION2.
        CLEAR : OK.
        LEAVE TO SCREEN 0.
      ENDIF.
    WHEN 'BACK'.
      LEAVE TO SCREEN 0.
    WHEN 'EXIT' OR 'CANCEL'.
      LEAVE PROGRAM.

  ENDCASE.
  CLEAR : OK.
ENDMODULE.
*&---------------------------------------------------------------------*
*&      Form  EXTENSION
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM EXTENSION .
*  BREAK-POINT .
  CLEAR : DEPTAPPR.
  CLEAR : DEPTEMAIL1.
  LOOP AT IT_EXTDEPT1 INTO WA_EXTDEPT1 WHERE APPROVE EQ 'X' .
    DEPTAPPR = 1.
  ENDLOOP.

  IF DEPTAPPR NE 1.
    MESSAGE 'SELECT RESPONSIBLE DEPARTMENT FOR EXTENSION' TYPE 'E'.
  ENDIF.
  IF ZDMS5-DEPTAPR EQ 'X'.
    PERFORM NEWDEPTHEAD.
    DEPTEMAIL1 = 1.
  ENDIF.



*BREAK-POINT.
  ZDMS5_WA-MJAHR = ZDMS1-MJAHR.
  ZDMS5_WA-MBLNR = ZDMS1-MBLNR.
*  zdms5_wa-eipernr = pernr.
*  zdms5_wa-eidate = sy-datum.
*  BREAK-POINT.
  IF ZDMS5-EIPERNR EQ 0.
    ZDMS5_WA-EIPERNR = PERNR.
    ZDMS5_WA-EIDATE = SY-DATUM.
    ZDMS5_WA-EIUZEIT = SY-UZEIT.
    ZDMS5_WA-EIUNAME = SY-UNAME.
  ELSE.
    ZDMS5_WA-EIPERNR = ZDMS5-EIPERNR.
    ZDMS5_WA-EIDATE = ZDMS5-EIDATE.
    ZDMS5_WA-EIUZEIT = ZDMS5-EIUZEIT.
    ZDMS5_WA-EIUNAME = ZDMS5-EIUNAME.
  ENDIF.
  ZDMS5_WA-EIDAYS = ZDMS5-EIDAYS.
  ZDMS5_WA-RTEXT1 = ZDMS5-RTEXT1.
  ZDMS5_WA-RTEXT2 = ZDMS5-RTEXT2.
  ZDMS5_WA-RTEXT3 = ZDMS5-RTEXT3.
  ZDMS5_WA-RTEXT4 = ZDMS5-RTEXT4.
  ZDMS5_WA-RTEXT5 = ZDMS5-RTEXT5.
  ZDMS5_WA-RTEXT6 = ZDMS5-RTEXT6.
  ZDMS5_WA-RTEXT7 = ZDMS5-RTEXT7.
  ZDMS5_WA-RTEXT8 = ZDMS5-RTEXT8.
  ZDMS5_WA-RTEXT9 = ZDMS5-RTEXT9.
  ZDMS5_WA-RTEXT10 = ZDMS5-RTEXT10.
  IF ZDMS5-DEPTAPR EQ 'X'.
    ZDMS5_WA-DEPTAPR = ZDMS5-DEPTAPR.
    ZDMS5_WA-DEPTH = PERNR.
    ZDMS5_WA-DEPTHDT = SY-DATUM.
    ZDMS5_WA-DEPTHTM = SY-UZEIT.
    ZDMS5_WA-DEPTHUNAME = SY-UNAME.
  ENDIF.
  MODIFY ZDMS5 FROM ZDMS5_WA.
  CLEAR ZDMS5_WA.
  IF SY-SUBRC EQ 0.
    MESSAGE 'Extension request is updated' TYPE 'I'.
  ENDIF.
*  BREAK-POINT.
******************UPDATE DEPARTMENT******************

  LOOP AT IT_EXTDEPT1 INTO WA_EXTDEPT1 WHERE APPROVE NE 'X' AND DEPT NE SPACE.
    DELETE FROM ZDMS6 WHERE MJAHR EQ ZDMS1-MJAHR AND MBLNR EQ ZDMS1-MBLNR AND BTRTL EQ WA_EXTDEPT1-DEPT.
  ENDLOOP.


  LOOP AT IT_EXTDEPT1 INTO WA_EXTDEPT1 WHERE APPROVE EQ 'X' AND DEPT NE SPACE.
    SELECT SINGLE * FROM ZDMS6 WHERE MJAHR EQ WA_EXTDEPT1-MJAHR AND MBLNR EQ WA_EXTDEPT1-MBLNR AND BTRTL EQ WA_EXTDEPT1-DEPT.
    IF SY-SUBRC EQ 0.
      MOVE-CORRESPONDING ZDMS6 TO ZDMS6_WA.
    ENDIF.

    ZDMS6_WA-MJAHR = WA_EXTDEPT1-MJAHR.
    ZDMS6_WA-MBLNR = WA_EXTDEPT1-MBLNR.
    ZDMS6_WA-BTRTL = WA_EXTDEPT1-DEPT.
    ZDMS6_WA-UPERNR = PERNR.
    ZDMS6_WA-CPUDT = SY-DATUM.
    ZDMS6_WA-UZEIT = SY-UZEIT.
    ZDMS6_WA-UNAME = SY-UNAME.
    MODIFY ZDMS6 FROM ZDMS6_WA.
    CLEAR ZDMS6_WA.
*    BREAK-POINT.
  ENDLOOP.

  IF SY-SUBRC EQ 0.
    MESSAGE 'Responsible departments for Extension is updated' TYPE 'I'.
  ENDIF.
*  IF deptemail1 EQ 1.
  PERFORM EMAIL.
*  ENDIF.

  CLEAR : IT_EXTDEPT1,WA_EXTDEPT1.
*  LEAVE TO SCREEN 0.
  CLEAR OK.
ENDFORM.
*&---------------------------------------------------------------------*
*&      Form  EXTDEPT
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM EXTDEPT .
  CLEAR : IT_EXTDEPT1,WA_EXTDEPT1.
  LOOP AT IT_ZDMS2 INTO WA_ZDMS2.
    WA_EXTDEPT1-MJAHR = WA_ZDMS2-MJAHR.
    WA_EXTDEPT1-MBLNR = WA_ZDMS2-MBLNR.
    WA_EXTDEPT1-DEPT = WA_ZDMS2-DEPT.
    SELECT SINGLE * FROM T001P WHERE BTRTL EQ WA_ZDMS2-DEPT.
    IF SY-SUBRC EQ 0.
      WA_EXTDEPT1-DEPTNAME = T001P-BTEXT.
    ENDIF.
    SELECT SINGLE * FROM PA0001 WHERE PERNR EQ WA_ZDMS2-UPERNR AND ENDDA GE SY-DATUM.
    IF SY-SUBRC EQ 0.
      WA_EXTDEPT1-ENAME = PA0001-ENAME.
    ENDIF.
    SELECT SINGLE * FROM ZDMS6 WHERE MJAHR EQ WA_ZDMS2-MJAHR AND MBLNR EQ WA_ZDMS2-MBLNR AND BTRTL EQ WA_ZDMS2-DEPT.
    IF SY-SUBRC EQ 0.
      WA_EXTDEPT1-APPROVE = 'X'.
      SELECT SINGLE * FROM PA0001 WHERE PERNR EQ ZDMS6-APERNR AND ENDDA GE SY-DATUM.
      IF SY-SUBRC EQ 0.
        WA_EXTDEPT1-ACCEPTNAME = PA0001-ENAME.
        WA_EXTDEPT1-ACCEPTDT = ZDMS6-ACCEPTDT.
      ELSE.
        WA_EXTDEPT1-ACCEPTNAME = SPACE.
      ENDIF.
    ELSE.
      WA_EXTDEPT1-APPROVE = SPACE.
      WA_EXTDEPT1-ACCEPTNAME = SPACE.
    ENDIF.


    COLLECT WA_EXTDEPT1 INTO IT_EXTDEPT1.
    CLEAR WA_EXTDEPT1.
  ENDLOOP.
ENDFORM.



*&---------------------------------------------------------------------*
*&      Form  EXTENSION1
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM EXTENSION1 .
*BREAK-POINT.
  ZDMS5_WA-MJAHR = ZDMS1-MJAHR.
  ZDMS5_WA-MBLNR = ZDMS1-MBLNR.
  ZDMS5_WA-EIPERNR = PERNR.
  ZDMS5_WA-EIDATE = SY-DATUM.
  ZDMS5_WA-EIDAYS = ZDMS5-EIDAYS.
  ZDMS5_WA-RTEXT1 = ZDMS5-RTEXT1.
  ZDMS5_WA-RTEXT2 = ZDMS5-RTEXT2.
  ZDMS5_WA-RTEXT3 = ZDMS5-RTEXT3.
  ZDMS5_WA-RTEXT4 = ZDMS5-RTEXT4.
  ZDMS5_WA-RTEXT5 = ZDMS5-RTEXT5.
  ZDMS5_WA-RTEXT6 = ZDMS5-RTEXT6.
  ZDMS5_WA-RTEXT7 = ZDMS5-RTEXT7.
  ZDMS5_WA-RTEXT8 = ZDMS5-RTEXT8.
  ZDMS5_WA-RTEXT9 = ZDMS5-RTEXT9.
  ZDMS5_WA-RTEXT10 = ZDMS5-RTEXT10.
  ZDMS5_WA-DEPTAPR = ZDMS5-DEPTAPR.
  ZDMS5_WA-DEPTH = ZDMS5-DEPTH.
  ZDMS5_WA-DEPTHDT = ZDMS5-DEPTHDT.
*  MODIFY zdms5 FROM zdms5_wa.
*  CLEAR zdms5_wa.
*  IF sy-subrc EQ 0.
*    MESSAGE 'Extension request is updated' TYPE 'I'.
*  ENDIF.
*  BREAK-POINT.
******************UPDATE DEPARTMENT******************
*  LOOP AT it_extdept1 INTO wa_extdept1 WHERE approve EQ 'X' AND dept NE space.
*    DELETE FROM zdms6 WHERE mjahr EQ zdms1-mjahr AND mblnr EQ zdms1-mblnr.
*    EXIT.
*  ENDLOOP.

*  LOOP AT it_extdept1 INTO wa_extdept1 WHERE approve EQ 'X' AND dept NE space.
*
*    zdms6_wa-mjahr = wa_extdept1-mjahr.
*    zdms6_wa-mblnr = wa_extdept1-mblnr.
*    zdms6_wa-btrtl = wa_extdept1-dept.
*    zdms6_wa-upernr = pernr.
*    zdms6_wa-cpudt = sy-datum.
*    MODIFY zdms6 FROM zdms6_wa.
*    CLEAR zdms6_wa.
**    BREAK-POINT.
*  ENDLOOP.
*  BREAK-POINT.
  IF EXTACCEPT EQ 'X'.
    IF OTHREXTDEPT GT 0.
      SELECT SINGLE * FROM ZDMS6 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM AND BTRTL EQ OTHREXTDEPT.
      IF SY-SUBRC EQ 0.
        READ TABLE IT_EXTDEPT1 INTO WA_EXTDEPT1 WITH KEY MJAHR = YEAR MBLNR = CCNUM DEPT = OTHREXTDEPT APPROVE = 'X' .
        IF SY-SUBRC EQ 0.
          MOVE-CORRESPONDING ZDMS6 TO ZDMS6_WA.
          ZDMS6_WA-APERNR = PERNR.
          ZDMS6_WA-ACCEPTDT = SY-DATUM.
          ZDMS6_WA-ACCEPTTM = SY-UZEIT.
          ZDMS6_WA-ACCEPTUNAME = SY-UNAME.
          MODIFY ZDMS6 FROM ZDMS6_WA.
          CLEAR ZDMS6_WA.
*    BREAK-POINT.
        ENDIF.
      ENDIF.
    ELSE.
      SELECT SINGLE * FROM ZDMS6 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM AND BTRTL EQ INITDEPT2  .
      IF SY-SUBRC EQ 0.
        READ TABLE IT_EXTDEPT1 INTO WA_EXTDEPT1 WITH KEY MJAHR = YEAR MBLNR = CCNUM DEPT = INITDEPT2 APPROVE = 'X' .
        IF SY-SUBRC EQ 0.
          MOVE-CORRESPONDING ZDMS6 TO ZDMS6_WA.
          ZDMS6_WA-APERNR = PERNR.
          ZDMS6_WA-ACCEPTDT = SY-DATUM.
          ZDMS6_WA-ACCEPTTM = SY-UZEIT.
          ZDMS6_WA-ACCEPTUNAME = SY-UNAME.
          MODIFY ZDMS6 FROM ZDMS6_WA.
          CLEAR ZDMS6_WA.
*    BREAK-POINT.
        ENDIF.
      ENDIF.
    ENDIF.

    IF SY-SUBRC EQ 0.
      MESSAGE 'Extension is Accepted' TYPE 'I'.
    ENDIF.
*  ELSEIF extaccept EQ space.
*    SELECT SINGLE * FROM zdms6 WHERE mjahr EQ year AND mblnr EQ ccnum AND btrtl EQ initdept2  .
*    IF sy-subrc EQ 0.
*      READ TABLE it_extdept1 INTO wa_extdept1 WITH KEY mjahr = year mblnr = ccnum dept = initdept2 approve = 'X' .
*      IF sy-subrc EQ 0.
*        MOVE-CORRESPONDING zdms6 TO zdms6_wa.
*        zdms6_wa-apernr = 0.
*        zdms6_wa-acceptdt = 0.
*        MODIFY zdms6 FROM zdms6_wa.
*        CLEAR zdms6_wa.
**    BREAK-POINT.
*      ENDIF.
*    ENDIF.
*
*    IF sy-subrc EQ 0.
*      MESSAGE 'Extension is Accepted' TYPE 'I'.
*    ENDIF.
  ENDIF.

  PERFORM EMAIL.
  CLEAR : IT_EXTDEPT1,WA_EXTDEPT1.
*  LEAVE TO SCREEN 0.
  CLEAR OK.
ENDFORM.
*&---------------------------------------------------------------------*
*&      Module  CHECK1  INPUT
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*

*&SPWIZARD: DECLARATION OF TABLECONTROL 'TBC_9007' ITSELF
CONTROLS: TBC_9007 TYPE TABLEVIEW USING SCREEN 9007.

*&SPWIZARD: LINES OF TABLECONTROL 'TBC_9007'
DATA:     G_TBC_9007_LINES  LIKE SY-LOOPC.

*&SPWIZARD: OUTPUT MODULE FOR TC 'TBC_9007'. DO NOT CHANGE THIS LINE!
*&SPWIZARD: UPDATE LINES FOR EQUIVALENT SCROLLBAR
MODULE TBC_9007_CHANGE_TC_ATTR OUTPUT.
  DESCRIBE TABLE IT_EXTDEPT1 LINES TBC_9007-LINES.
ENDMODULE.

*&SPWIZARD: OUTPUT MODULE FOR TC 'TBC_9007'. DO NOT CHANGE THIS LINE!
*&SPWIZARD: GET LINES OF TABLECONTROL
MODULE TBC_9007_GET_LINES OUTPUT.
  G_TBC_9007_LINES = SY-LOOPC.
ENDMODULE.

*&SPWIZARD: INPUT MODULE FOR TC 'TBC_9007'. DO NOT CHANGE THIS LINE!
*&SPWIZARD: MODIFY TABLE
MODULE TBC_9007_MODIFY INPUT.
  MODIFY IT_EXTDEPT1
    FROM WA_EXTDEPT1
    INDEX TBC_9007-CURRENT_LINE.
ENDMODULE.

*&SPWIZARD: INPUT MODUL FOR TC 'TBC_9007'. DO NOT CHANGE THIS LINE!
*&SPWIZARD: MARK TABLE
MODULE TBC_9007_MARK INPUT.
  DATA: G_TBC_9007_WA2 LIKE LINE OF IT_EXTDEPT1.
  IF TBC_9007-LINE_SEL_MODE = 1
  AND WA_EXTDEPT1-TICK = 'X'.
    LOOP AT IT_EXTDEPT1 INTO G_TBC_9007_WA2
      WHERE TICK = 'X'.
      G_TBC_9007_WA2-TICK = ''.
      MODIFY IT_EXTDEPT1
        FROM G_TBC_9007_WA2
        TRANSPORTING TICK.
    ENDLOOP.
  ENDIF.
  MODIFY IT_EXTDEPT1
    FROM WA_EXTDEPT1
    INDEX TBC_9007-CURRENT_LINE
    TRANSPORTING TICK.
ENDMODULE.

*&SPWIZARD: INPUT MODULE FOR TC 'TBC_9007'. DO NOT CHANGE THIS LINE!
*&SPWIZARD: PROCESS USER COMMAND
MODULE TBC_9007_USER_COMMAND INPUT.
  OK = SY-UCOMM.
  PERFORM USER_OK_TC USING    'TBC_9007'
                              'IT_EXTDEPT1'
                              'TICK'
                     CHANGING OK.
  SY-UCOMM = OK.
ENDMODULE.

*----------------------------------------------------------------------*
*   INCLUDE TABLECONTROL_FORMS                                         *
*----------------------------------------------------------------------*

*&---------------------------------------------------------------------*
*&      Form  USER_OK_TC                                               *
*&---------------------------------------------------------------------*
FORM USER_OK_TC USING    P_TC_NAME TYPE DYNFNAM
                         P_TABLE_NAME
                         P_MARK_NAME
                CHANGING P_OK      LIKE SY-UCOMM.

*&SPWIZARD: BEGIN OF LOCAL DATA----------------------------------------*
  DATA: L_OK     TYPE SY-UCOMM,
        L_OFFSET TYPE I.
*&SPWIZARD: END OF LOCAL DATA------------------------------------------*

*&SPWIZARD: Table control specific operations                          *
*&SPWIZARD: evaluate TC name and operations                            *
  SEARCH P_OK FOR P_TC_NAME.
  IF SY-SUBRC <> 0.
    EXIT.
  ENDIF.
  L_OFFSET = STRLEN( P_TC_NAME ) + 1.
  L_OK = P_OK+L_OFFSET.
*&SPWIZARD: execute general and TC specific operations                 *
  CASE L_OK.
    WHEN 'INSR'.                      "insert row
      PERFORM FCODE_INSERT_ROW USING    P_TC_NAME
                                        P_TABLE_NAME.
      CLEAR P_OK.

    WHEN 'DELE'.                      "delete row
      PERFORM FCODE_DELETE_ROW USING    P_TC_NAME
                                        P_TABLE_NAME
                                        P_MARK_NAME.
      CLEAR P_OK.

    WHEN 'P--' OR                     "top of list
         'P-'  OR                     "previous page
         'P+'  OR                     "next page
         'P++'.                       "bottom of list
      PERFORM COMPUTE_SCROLLING_IN_TC USING P_TC_NAME
                                            L_OK.
      CLEAR P_OK.
*     WHEN 'L--'.                       "total left
*       PERFORM FCODE_TOTAL_LEFT USING P_TC_NAME.
*
*     WHEN 'L-'.                        "column left
*       PERFORM FCODE_COLUMN_LEFT USING P_TC_NAME.
*
*     WHEN 'R+'.                        "column right
*       PERFORM FCODE_COLUMN_RIGHT USING P_TC_NAME.
*
*     WHEN 'R++'.                       "total right
*       PERFORM FCODE_TOTAL_RIGHT USING P_TC_NAME.
*
    WHEN 'MARK'.                      "mark all filled lines
      PERFORM FCODE_TC_MARK_LINES USING P_TC_NAME
                                        P_TABLE_NAME
                                        P_MARK_NAME   .
      CLEAR P_OK.

    WHEN 'DMRK'.                      "demark all filled lines
      PERFORM FCODE_TC_DEMARK_LINES USING P_TC_NAME
                                          P_TABLE_NAME
                                          P_MARK_NAME .
      CLEAR P_OK.

*     WHEN 'SASCEND'   OR
*          'SDESCEND'.                  "sort column
*       PERFORM FCODE_SORT_TC USING P_TC_NAME
*                                   l_ok.

  ENDCASE.

ENDFORM.                              " USER_OK_TC

*&---------------------------------------------------------------------*
*&      Form  FCODE_INSERT_ROW                                         *
*&---------------------------------------------------------------------*
FORM FCODE_INSERT_ROW
              USING    P_TC_NAME           TYPE DYNFNAM
                       P_TABLE_NAME             .

*&SPWIZARD: BEGIN OF LOCAL DATA----------------------------------------*
  DATA L_LINES_NAME       LIKE FELD-NAME.
  DATA L_SELLINE          LIKE SY-STEPL.
  DATA L_LASTLINE         TYPE I.
  DATA L_LINE             TYPE I.
  DATA L_TABLE_NAME       LIKE FELD-NAME.
  FIELD-SYMBOLS <TC>                 TYPE CXTAB_CONTROL.
  FIELD-SYMBOLS <TABLE>              TYPE STANDARD TABLE.
  FIELD-SYMBOLS <LINES>              TYPE I.
*&SPWIZARD: END OF LOCAL DATA------------------------------------------*

  ASSIGN (P_TC_NAME) TO <TC>.

*&SPWIZARD: get the table, which belongs to the tc                     *
  CONCATENATE P_TABLE_NAME '[]' INTO L_TABLE_NAME. "table body
  ASSIGN (L_TABLE_NAME) TO <TABLE>.                "not headerline

*&SPWIZARD: get looplines of TableControl                              *
  CONCATENATE 'G_' P_TC_NAME '_LINES' INTO L_LINES_NAME.
  ASSIGN (L_LINES_NAME) TO <LINES>.

*&SPWIZARD: get current line                                           *
  GET CURSOR LINE L_SELLINE.
  IF SY-SUBRC <> 0.                   " append line to table
    L_SELLINE = <TC>-LINES + 1.
*&SPWIZARD: set top line                                               *
    IF L_SELLINE > <LINES>.
      <TC>-TOP_LINE = L_SELLINE - <LINES> + 1 .
    ELSE.
      <TC>-TOP_LINE = 1.
    ENDIF.
  ELSE.                               " insert line into table
    L_SELLINE = <TC>-TOP_LINE + L_SELLINE - 1.
    L_LASTLINE = <TC>-TOP_LINE + <LINES> - 1.
  ENDIF.
*&SPWIZARD: set new cursor line                                        *
  L_LINE = L_SELLINE - <TC>-TOP_LINE + 1.

*&SPWIZARD: insert initial line                                        *
  INSERT INITIAL LINE INTO <TABLE> INDEX L_SELLINE.
  <TC>-LINES = <TC>-LINES + 1.
*&SPWIZARD: set cursor                                                 *
  SET CURSOR LINE L_LINE.

ENDFORM.                              " FCODE_INSERT_ROW

*&---------------------------------------------------------------------*
*&      Form  FCODE_DELETE_ROW                                         *
*&---------------------------------------------------------------------*
FORM FCODE_DELETE_ROW
              USING    P_TC_NAME           TYPE DYNFNAM
                       P_TABLE_NAME
                       P_MARK_NAME   .

*&SPWIZARD: BEGIN OF LOCAL DATA----------------------------------------*
  DATA L_TABLE_NAME       LIKE FELD-NAME.

  FIELD-SYMBOLS <TC>         TYPE CXTAB_CONTROL.
  FIELD-SYMBOLS <TABLE>      TYPE STANDARD TABLE.
  FIELD-SYMBOLS <WA>.
  FIELD-SYMBOLS <MARK_FIELD>.
*&SPWIZARD: END OF LOCAL DATA------------------------------------------*

  ASSIGN (P_TC_NAME) TO <TC>.

*&SPWIZARD: get the table, which belongs to the tc                     *
  CONCATENATE P_TABLE_NAME '[]' INTO L_TABLE_NAME. "table body
  ASSIGN (L_TABLE_NAME) TO <TABLE>.                "not headerline

*&SPWIZARD: delete marked lines                                        *
  DESCRIBE TABLE <TABLE> LINES <TC>-LINES.

  LOOP AT <TABLE> ASSIGNING <WA>.

*&SPWIZARD: access to the component 'FLAG' of the table header         *
    ASSIGN COMPONENT P_MARK_NAME OF STRUCTURE <WA> TO <MARK_FIELD>.

    IF <MARK_FIELD> = 'X'.
      DELETE <TABLE> INDEX SYST-TABIX.
      IF SY-SUBRC = 0.
        <TC>-LINES = <TC>-LINES - 1.
      ENDIF.
    ENDIF.
  ENDLOOP.

ENDFORM.                              " FCODE_DELETE_ROW

*&---------------------------------------------------------------------*
*&      Form  COMPUTE_SCROLLING_IN_TC
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*      -->P_TC_NAME  name of tablecontrol
*      -->P_OK       ok code
*----------------------------------------------------------------------*
FORM COMPUTE_SCROLLING_IN_TC USING    P_TC_NAME
                                      P_OK.
*&SPWIZARD: BEGIN OF LOCAL DATA----------------------------------------*
  DATA L_TC_NEW_TOP_LINE     TYPE I.
  DATA L_TC_NAME             LIKE FELD-NAME.
  DATA L_TC_LINES_NAME       LIKE FELD-NAME.
  DATA L_TC_FIELD_NAME       LIKE FELD-NAME.

  FIELD-SYMBOLS <TC>         TYPE CXTAB_CONTROL.
  FIELD-SYMBOLS <LINES>      TYPE I.
*&SPWIZARD: END OF LOCAL DATA------------------------------------------*

  ASSIGN (P_TC_NAME) TO <TC>.
*&SPWIZARD: get looplines of TableControl                              *
  CONCATENATE 'G_' P_TC_NAME '_LINES' INTO L_TC_LINES_NAME.
  ASSIGN (L_TC_LINES_NAME) TO <LINES>.


*&SPWIZARD: is no line filled?                                         *
  IF <TC>-LINES = 0.
*&SPWIZARD: yes, ...                                                   *
    L_TC_NEW_TOP_LINE = 1.
  ELSE.
*&SPWIZARD: no, ...                                                    *
    CALL FUNCTION 'SCROLLING_IN_TABLE'
      EXPORTING
        ENTRY_ACT      = <TC>-TOP_LINE
        ENTRY_FROM     = 1
        ENTRY_TO       = <TC>-LINES
        LAST_PAGE_FULL = 'X'
        LOOPS          = <LINES>
        OK_CODE        = P_OK
        OVERLAPPING    = 'X'
      IMPORTING
        ENTRY_NEW      = L_TC_NEW_TOP_LINE
      EXCEPTIONS
*       NO_ENTRY_OR_PAGE_ACT  = 01
*       NO_ENTRY_TO    = 02
*       NO_OK_CODE_OR_PAGE_GO = 03
        OTHERS         = 0.
  ENDIF.

*&SPWIZARD: get actual tc and column                                   *
  GET CURSOR FIELD L_TC_FIELD_NAME
             AREA  L_TC_NAME.

  IF SYST-SUBRC = 0.
    IF L_TC_NAME = P_TC_NAME.
*&SPWIZARD: et actual column                                           *
      SET CURSOR FIELD L_TC_FIELD_NAME LINE 1.
    ENDIF.
  ENDIF.

*&SPWIZARD: set the new top line                                       *
  <TC>-TOP_LINE = L_TC_NEW_TOP_LINE.


ENDFORM.                              " COMPUTE_SCROLLING_IN_TC

*&---------------------------------------------------------------------*
*&      Form  FCODE_TC_MARK_LINES
*&---------------------------------------------------------------------*
*       marks all TableControl lines
*----------------------------------------------------------------------*
*      -->P_TC_NAME  name of tablecontrol
*----------------------------------------------------------------------*
FORM FCODE_TC_MARK_LINES USING P_TC_NAME
                               P_TABLE_NAME
                               P_MARK_NAME.
*&SPWIZARD: EGIN OF LOCAL DATA-----------------------------------------*
  DATA L_TABLE_NAME       LIKE FELD-NAME.

  FIELD-SYMBOLS <TC>         TYPE CXTAB_CONTROL.
  FIELD-SYMBOLS <TABLE>      TYPE STANDARD TABLE.
  FIELD-SYMBOLS <WA>.
  FIELD-SYMBOLS <MARK_FIELD>.
*&SPWIZARD: END OF LOCAL DATA------------------------------------------*

  ASSIGN (P_TC_NAME) TO <TC>.

*&SPWIZARD: get the table, which belongs to the tc                     *
  CONCATENATE P_TABLE_NAME '[]' INTO L_TABLE_NAME. "table body
  ASSIGN (L_TABLE_NAME) TO <TABLE>.                "not headerline

*&SPWIZARD: mark all filled lines                                      *
  LOOP AT <TABLE> ASSIGNING <WA>.

*&SPWIZARD: access to the component 'FLAG' of the table header         *
    ASSIGN COMPONENT P_MARK_NAME OF STRUCTURE <WA> TO <MARK_FIELD>.

    <MARK_FIELD> = 'X'.
  ENDLOOP.
ENDFORM.                                          "fcode_tc_mark_lines

*&---------------------------------------------------------------------*
*&      Form  FCODE_TC_DEMARK_LINES
*&---------------------------------------------------------------------*
*       demarks all TableControl lines
*----------------------------------------------------------------------*
*      -->P_TC_NAME  name of tablecontrol
*----------------------------------------------------------------------*
FORM FCODE_TC_DEMARK_LINES USING P_TC_NAME
                                 P_TABLE_NAME
                                 P_MARK_NAME .
*&SPWIZARD: BEGIN OF LOCAL DATA----------------------------------------*
  DATA L_TABLE_NAME       LIKE FELD-NAME.

  FIELD-SYMBOLS <TC>         TYPE CXTAB_CONTROL.
  FIELD-SYMBOLS <TABLE>      TYPE STANDARD TABLE.
  FIELD-SYMBOLS <WA>.
  FIELD-SYMBOLS <MARK_FIELD>.
*&SPWIZARD: END OF LOCAL DATA------------------------------------------*

  ASSIGN (P_TC_NAME) TO <TC>.

*&SPWIZARD: get the table, which belongs to the tc                     *
  CONCATENATE P_TABLE_NAME '[]' INTO L_TABLE_NAME. "table body
  ASSIGN (L_TABLE_NAME) TO <TABLE>.                "not headerline

*&SPWIZARD: demark all filled lines                                    *
  LOOP AT <TABLE> ASSIGNING <WA>.

*&SPWIZARD: access to the component 'FLAG' of the table header         *
    ASSIGN COMPONENT P_MARK_NAME OF STRUCTURE <WA> TO <MARK_FIELD>.

    <MARK_FIELD> = SPACE.
  ENDLOOP.
ENDFORM.                                          "fcode_tc_mark_lines
*&---------------------------------------------------------------------*
*&      Form  EXTENSION2
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM EXTENSION2 .
*  BREAK-POINT.
  CLEAR : REVCLDT,REVCLDATE.
  REVCLDT = SY-DATUM + ZDMS5-QADAYS.
  IF QAAPPROVE EQ 'X'.
    IF ZDMS5-QADAYS IS INITIAL.
      MESSAGE 'ENTER EXTENSION PERMITTED DAYS' TYPE 'E'.
    ENDIF.
    IF ZDMS5-QAREVDT LT REVCLDT.
      MESSAGE 'CHECK REVISION CLOSE OUT DATE' TYPE 'E'.
    ENDIF.
    IF ZDMS5-QAREVDT IS INITIAL OR ZDMS5-QAREVDT EQ '00000000'.
      MESSAGE 'CHECK REVISION CLOSE OUT DATE' TYPE 'E'.
    ENDIF.

    REVCLDATE = ZDMS5-QAREVDT .  "REV CLOSURE DATE

    ZDMS5_WA-MJAHR  = YEAR.
    ZDMS5_WA-MBLNR = CCNUM.
    ZDMS5_WA-QAPERNR = PERNR.
    ZDMS5_WA-QAPPRDT = SY-DATUM.
    ZDMS5_WA-QAPPRTM = SY-UZEIT.
    ZDMS5_WA-QAPPRUNAME = SY-UNAME.
    ZDMS5_WA-QADAYS = ZDMS5-QADAYS.
    ZDMS5_WA-QAREVDT = ZDMS5-QAREVDT.
    ZDMS5_WA-QAREVTM = ZDMS5-QAREVTM.
    ZDMS5_WA-QATEXT1 = ZDMS5-QATEXT1.
    ZDMS5_WA-QATEXT2 = ZDMS5-QATEXT2.
    ZDMS5_WA-QATEXT3 = ZDMS5-QATEXT3.
    ZDMS5_WA-QATEXT4 = ZDMS5-QATEXT4.
    ZDMS5_WA-QATEXT5 = ZDMS5-QATEXT5.
    SELECT SINGLE * FROM ZDMS5 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM .
    IF SY-SUBRC EQ 0.
      ZDMS5_WA-EIPERNR = ZDMS5-EIPERNR.
      ZDMS5_WA-EIDATE = ZDMS5-EIDATE.
      ZDMS5_WA-EIUZEIT = ZDMS5-EIUZEIT.
      ZDMS5_WA-EIUNAME = ZDMS5-EIUNAME.
      ZDMS5_WA-EIDAYS = ZDMS5-EIDAYS.
      ZDMS5_WA-RTEXT1 = ZDMS5-RTEXT1.
      ZDMS5_WA-RTEXT2 = ZDMS5-RTEXT2.
      ZDMS5_WA-RTEXT3 = ZDMS5-RTEXT3.
      ZDMS5_WA-RTEXT4 = ZDMS5-RTEXT4.
      ZDMS5_WA-RTEXT5 = ZDMS5-RTEXT5.
      ZDMS5_WA-RTEXT6 = ZDMS5-RTEXT6.
      ZDMS5_WA-RTEXT7 = ZDMS5-RTEXT7.
      ZDMS5_WA-RTEXT8 = ZDMS5-RTEXT8.
      ZDMS5_WA-RTEXT9 = ZDMS5-RTEXT9.
      ZDMS5_WA-RTEXT10 = ZDMS5-RTEXT10.
      ZDMS5_WA-DEPTAPR = ZDMS5-DEPTAPR.
      ZDMS5_WA-DEPTH = ZDMS5-DEPTH.
      ZDMS5_WA-DEPTHDT = ZDMS5-DEPTHDT.
      ZDMS5_WA-DEPTHTM = ZDMS5-DEPTHTM.
      ZDMS5_WA-DEPTHUNAME = ZDMS5-DEPTHUNAME.
    ENDIF.
    MODIFY ZDMS5 FROM ZDMS5_WA.
    CLEAR ZDMS5_WA.
*    BREAK-POINT.



    IF SY-SUBRC EQ 0.
      MESSAGE 'Extension is Approved by QA / CQD ' TYPE 'I'.
    ENDIF.
  ELSE.
    MESSAGE 'PLEASE TICK TO SAVE THE DATA' TYPE 'E'.

  ENDIF.

  PERFORM EMAIL.

  CLEAR OK.

ENDFORM.
*&---------------------------------------------------------------------*
*&      Form  NEWDEPTHEAD
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM NEWDEPTHEAD .
*BREAK-POINT.
*  New check for department head.
  CLEAR : DEPTHEAD1,NDEPTHEAD.
  SELECT SINGLE * FROM ZQMS_DEPTHEAD1 WHERE BTRTL EQ INITDEPT2 AND TO_DT GE SY-DATUM..  "24.7.22
  IF SY-SUBRC EQ 0.
    DEPTHEAD1 = ZQMS_DEPTHEAD1-PERNR.
  ENDIF.
  SELECT SINGLE * FROM ZQMS_DEPTHEAD2 WHERE BTRTL EQ INITDEPT2 AND FROM_DT LE SY-DATUM AND TO_DT GE SY-DATUM..  "1.12.24
  IF SY-SUBRC EQ 0.
    NDEPTHEAD = ZQMS_DEPTHEAD2-PERNR.
  ENDIF.

*  CLEAR : depthead1.
*  SELECT SINGLE * FROM pa0001 WHERE btrtl EQ initdept2 AND endda GE sy-datum AND plans NE '99999999'.
*  IF sy-subrc = 0.
*    SELECT SINGLE * FROM hrp1001 WHERE objid EQ pa0001-orgeh AND  otype EQ 'O' AND  relat = '012' AND endda GE sy-datum.
*    IF sy-subrc = 0.  " 012 is the relation code ie dept head
*      SELECT SINGLE * FROM pa0001 WHERE plans = hrp1001-sobid  AND endda GE sy-datum.
*      IF sy-subrc = 0 .
*        depthead1 = pa0001-pernr.
**        WRITE :  'DEPARTMENT HEAD', pa0001-pernr.
*      ENDIF.
*    ENDIF.
*  ENDIF.
*  IF pernr EQ '00002055'. "30.9.20  "deactivated on 5.1.22
*    depthead1 = '00010498'.
*  ENDIF.

  IF PERNR EQ '00014285'.
    DEPTHEAD1 = '00003861'.
  ENDIF.

*  IF PERNR NE DEPTHEAD1 .
*    IF PERNR EQ '00010231'.  "5.4.22
*    ELSE.
*      MESSAGE'NOT DEPARTMENT HEAD' TYPE 'E'.
*    ENDIF.
*  ENDIF.
  IF PERNR NE DEPTHEAD1 .
    IF PERNR NE NDEPTHEAD.
      IF PERNR EQ '00010231'.  "5.4.22
      ELSE.
        MESSAGE'NOT DEPARTMENT HEAD' TYPE 'E'.
      ENDIF.
    ENDIF.
  ENDIF.
ENDFORM.
*&---------------------------------------------------------------------*
*&      Form  EXTEMAIL1
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM EXTEMAIL1 .
*  BREAK-POINT.
  LOOP AT IT_EXTDEPT1 INTO WA_EXTDEPT1 WHERE APPROVE EQ 'X' AND DEPT NE SPACE.
*    BREAK-POINT.
    CLEAR : DEPTHEAD1.
    SELECT SINGLE * FROM ZQMS_DEPTHEAD1 WHERE BTRTL EQ WA_EXTDEPT1-DEPT AND TO_DT GE SY-DATUM..  "24.7.22
    IF SY-SUBRC EQ 0.
      DEPTHEAD1 = ZQMS_DEPTHEAD1-PERNR.
    ENDIF.

*    CLEAR : depthead1.
*    SELECT SINGLE * FROM pa0001 WHERE btrtl EQ wa_extdept1-dept AND endda GE sy-datum .
*    IF sy-subrc = 0.
*      SELECT SINGLE * FROM hrp1001 WHERE objid EQ pa0001-orgeh AND  otype EQ 'O' AND  relat = '012' AND endda GE sy-datum.
*      IF sy-subrc = 0.  " 012 is the relation code ie dept head
*        SELECT SINGLE * FROM pa0001 WHERE plans = hrp1001-sobid  AND endda GE sy-datum.
*        IF sy-subrc = 0 .
*          depthead1 = pa0001-pernr.
**        WRITE :  'DEPARTMENT HEAD', pa0001-pernr.
*        ENDIF.
*      ENDIF.
*    ENDIF.
    IF DEPTHEAD1 GT 0.
      SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ DEPTHEAD1.
      IF SY-SUBRC EQ 0.
        WA_EMAIL-PERNR = DEPTHEAD1.
        WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
        COLLECT WA_EMAIL INTO IT_EMAIL.
        CLEAR WA_EMAIL.
      ENDIF.
    ENDIF.
  ENDLOOP.
  IF ZDMS1-WERKS EQ '1000'.
    CLEAR : DEPTHEAD1.
    SELECT SINGLE * FROM ZQMS_DEPTHEAD1 WHERE BTRTL EQ '1228' AND TO_DT GE SY-DATUM..  "24.7.22
    IF SY-SUBRC EQ 0.
      DEPTHEAD1 = ZQMS_DEPTHEAD1-PERNR.
    ENDIF.

*    SELECT SINGLE * FROM pa0001 WHERE btrtl EQ '1228' AND endda GE sy-datum .
*    IF sy-subrc = 0.
*      SELECT SINGLE * FROM hrp1001 WHERE objid EQ pa0001-orgeh AND  otype EQ 'O' AND  relat = '012' AND endda GE sy-datum.
*      IF sy-subrc = 0.  " 012 is the relation code ie dept head
*        SELECT SINGLE * FROM pa0001 WHERE plans = hrp1001-sobid  AND endda GE sy-datum.
*        IF sy-subrc = 0 .
*          depthead1 = pa0001-pernr.
**        WRITE :  'DEPARTMENT HEAD', pa0001-pernr.
*        ENDIF.
*      ENDIF.
*    ENDIF.
    IF DEPTHEAD1 GT 0.
      SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ DEPTHEAD1.
      IF SY-SUBRC EQ 0.
        WA_EMAIL-PERNR = DEPTHEAD1.
        WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
        COLLECT WA_EMAIL INTO IT_EMAIL.
        CLEAR WA_EMAIL.
      ENDIF.

      SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ '00011171'.
      IF SY-SUBRC EQ 0.
        WA_EMAIL-PERNR = DEPTHEAD1.
        WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
        COLLECT WA_EMAIL INTO IT_EMAIL.
        CLEAR WA_EMAIL.
      ENDIF.

    ENDIF.
  ELSEIF ZDMS1-WERKS EQ '1001'.
    CLEAR : DEPTHEAD1.
    SELECT SINGLE * FROM ZQMS_DEPTHEAD1 WHERE BTRTL EQ '1328' AND TO_DT GE SY-DATUM..  "24.7.22
    IF SY-SUBRC EQ 0.
      DEPTHEAD1 = ZQMS_DEPTHEAD1-PERNR.
    ENDIF.

*    CLEAR : depthead1.
*    SELECT SINGLE * FROM pa0001 WHERE btrtl EQ '1328' AND endda GE sy-datum .
*    IF sy-subrc = 0.
*      SELECT SINGLE * FROM hrp1001 WHERE objid EQ pa0001-orgeh AND  otype EQ 'O' AND  relat = '012' AND endda GE sy-datum.
*      IF sy-subrc = 0.  " 012 is the relation code ie dept head
*        SELECT SINGLE * FROM pa0001 WHERE plans = hrp1001-sobid  AND endda GE sy-datum.
*        IF sy-subrc = 0 .
*          depthead1 = pa0001-pernr.
**        WRITE :  'DEPARTMENT HEAD', pa0001-pernr.
*        ENDIF.
*      ENDIF.
*    ENDIF.
    IF DEPTHEAD1 GT 0.
      SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ DEPTHEAD1.
      IF SY-SUBRC EQ 0.
        WA_EMAIL-PERNR = DEPTHEAD1.
        WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
        COLLECT WA_EMAIL INTO IT_EMAIL.
        CLEAR WA_EMAIL.
      ENDIF.

      SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ '00013907'.
      IF SY-SUBRC EQ 0.
        WA_EMAIL-PERNR = DEPTHEAD1.
        WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
        COLLECT WA_EMAIL INTO IT_EMAIL.
        CLEAR WA_EMAIL.
      ENDIF.

    ENDIF.

  ELSE.

    CLEAR : DEPTHEAD1.
    SELECT SINGLE * FROM ZQMS_DEPTHEAD1 WHERE BTRTL EQ '1232' AND TO_DT GE SY-DATUM..  "24.7.22
    IF SY-SUBRC EQ 0.
      DEPTHEAD1 = ZQMS_DEPTHEAD1-PERNR.
    ENDIF.

    IF DEPTHEAD1 GT 0.
      SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ DEPTHEAD1.
      IF SY-SUBRC EQ 0.
        WA_EMAIL-PERNR = DEPTHEAD1.
        WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
        COLLECT WA_EMAIL INTO IT_EMAIL.
        CLEAR WA_EMAIL.
      ENDIF.

      SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ '00016102'.
      IF SY-SUBRC EQ 0.
        WA_EMAIL-PERNR = DEPTHEAD1.
        WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
        COLLECT WA_EMAIL INTO IT_EMAIL.
        CLEAR WA_EMAIL.
      ENDIF.

    ENDIF.

*    CLEAR : depthead1.
*    SELECT SINGLE * FROM pa0001 WHERE btrtl EQ '1229' AND endda GE sy-datum .
*    IF sy-subrc = 0.
*      SELECT SINGLE * FROM hrp1001 WHERE objid EQ pa0001-orgeh AND  otype EQ 'O' AND  relat = '012' AND endda GE sy-datum.
*      IF sy-subrc = 0.  " 012 is the relation code ie dept head
*        SELECT SINGLE * FROM pa0001 WHERE plans = hrp1001-sobid  AND endda GE sy-datum.
*        IF sy-subrc = 0 .
*          depthead1 = pa0001-pernr.
**        WRITE :  'DEPARTMENT HEAD', pa0001-pernr.
*        ENDIF.
*      ENDIF.
*    ENDIF.
    IF DEPTHEAD1 GT 0.
      SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ DEPTHEAD1.
      IF SY-SUBRC EQ 0.
        WA_EMAIL-PERNR = DEPTHEAD1.
        WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
        COLLECT WA_EMAIL INTO IT_EMAIL.
        CLEAR WA_EMAIL.
      ENDIF.
    ENDIF.

  ENDIF.
ENDFORM.
*&---------------------------------------------------------------------*
*&      Form  EXTEMAIL2
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM EXTEMAIL2 .
*  BREAK-POINT.
  CLEAR : DEPTHEAD1.
  SELECT SINGLE * FROM ZQMS_DEPTHEAD1 WHERE BTRTL EQ INITDEPT2 AND TO_DT GE SY-DATUM..  "24.7.22
  IF SY-SUBRC EQ 0.
    DEPTHEAD1 = ZQMS_DEPTHEAD1-PERNR.
  ENDIF.

*  CLEAR : depthead1.
*  SELECT SINGLE * FROM pa0001 WHERE btrtl EQ initdept2 AND endda GE sy-datum .
*  IF sy-subrc = 0.
*    SELECT SINGLE * FROM hrp1001 WHERE objid EQ pa0001-orgeh AND  otype EQ 'O' AND  relat = '012' AND endda GE sy-datum.
*    IF sy-subrc = 0.  " 012 is the relation code ie dept head
*      SELECT SINGLE * FROM pa0001 WHERE plans = hrp1001-sobid  AND endda GE sy-datum.
*      IF sy-subrc = 0 .
*        depthead1 = pa0001-pernr.
**        WRITE :  'DEPARTMENT HEAD', pa0001-pernr.
*      ENDIF.
*    ENDIF.
*  ENDIF.
*  IF pernr EQ '00002055'. "30.9.20  "deacivated on 5.1.22
*    depthead1 = '00010498'.
*  ENDIF.
  IF PERNR EQ '00014285'.
    DEPTHEAD1 = '00003861'.
  ENDIF.

  IF DEPTHEAD1 EQ '00000000'.
    DEPTHEAD1 = PERNR.
  ENDIF.

  SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ DEPTHEAD1.
  IF SY-SUBRC EQ 0.
    WA_EMAIL-PERNR = DEPTHEAD1.
    WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
    COLLECT WA_EMAIL INTO IT_EMAIL.
    CLEAR WA_EMAIL.
  ENDIF.
ENDFORM.
*&---------------------------------------------------------------------*
*&      Form  EXTEMAIL3
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM EXTEMAIL3 .
*  BREAK-POINT.
  CLEAR : DEPTIND1.
  SELECT * FROM ZDMS6 INTO TABLE IT_ZDMS6_1 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM.
  IF IT_ZDMS6_1 IS NOT INITIAL.
    LOOP AT IT_ZDMS6_1 INTO WA_ZDMS6_1.
      IF WA_ZDMS6_1-APERNR EQ 0.
        DEPTIND1 = 1.
      ENDIF.
    ENDLOOP.
  ENDIF.
  IF DEPTIND1 NE 1.
    IF ZDMS1-WERKS EQ '1000'.
      CLEAR : DEPTHEAD1.
      SELECT SINGLE * FROM ZQMS_DEPTHEAD1 WHERE BTRTL EQ '1228' AND TO_DT GE SY-DATUM..  "24.7.22
      IF SY-SUBRC EQ 0.
        DEPTHEAD1 = ZQMS_DEPTHEAD1-PERNR.
      ENDIF.

*      CLEAR : depthead1.
*      SELECT SINGLE * FROM pa0001 WHERE btrtl EQ '1228' AND endda GE sy-datum .
*      IF sy-subrc = 0.
*        SELECT SINGLE * FROM hrp1001 WHERE objid EQ pa0001-orgeh AND  otype EQ 'O' AND  relat = '012' AND endda GE sy-datum.
*        IF sy-subrc = 0.  " 012 is the relation code ie dept head
*          SELECT SINGLE * FROM pa0001 WHERE plans = hrp1001-sobid  AND endda GE sy-datum.
*          IF sy-subrc = 0 .
*            depthead1 = pa0001-pernr.
**        WRITE :  'DEPARTMENT HEAD', pa0001-pernr.
*          ENDIF.
*        ENDIF.
*      ENDIF.
      IF DEPTHEAD1 GT 0.
        SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ DEPTHEAD1.
        IF SY-SUBRC EQ 0.
          WA_EMAIL-PERNR = DEPTHEAD1.
          WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
          COLLECT WA_EMAIL INTO IT_EMAIL.
          CLEAR WA_EMAIL.
        ENDIF.

        SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ '00011171'.
        IF SY-SUBRC EQ 0.
          WA_EMAIL-PERNR = DEPTHEAD1.
          WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
          COLLECT WA_EMAIL INTO IT_EMAIL.
          CLEAR WA_EMAIL.
        ENDIF.
      ENDIF.

*******************

    ELSEIF ZDMS1-WERKS EQ '1001'.
      CLEAR : DEPTHEAD1.
      SELECT SINGLE * FROM ZQMS_DEPTHEAD1 WHERE BTRTL EQ '1328' AND TO_DT GE SY-DATUM..  "24.7.22
      IF SY-SUBRC EQ 0.
        DEPTHEAD1 = ZQMS_DEPTHEAD1-PERNR.
      ENDIF.

*      CLEAR : depthead1.
*      SELECT SINGLE * FROM pa0001 WHERE btrtl EQ '1328' AND endda GE sy-datum .
*      IF sy-subrc = 0.
*        SELECT SINGLE * FROM hrp1001 WHERE objid EQ pa0001-orgeh AND  otype EQ 'O' AND  relat = '012' AND endda GE sy-datum.
*        IF sy-subrc = 0.  " 012 is the relation code ie dept head
*          SELECT SINGLE * FROM pa0001 WHERE plans = hrp1001-sobid  AND endda GE sy-datum.
*          IF sy-subrc = 0 .
*            depthead1 = pa0001-pernr.
**        WRITE :  'DEPARTMENT HEAD', pa0001-pernr.
*          ENDIF.
*        ENDIF.
*      ENDIF.
      IF DEPTHEAD1 GT 0.
        SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ DEPTHEAD1.
        IF SY-SUBRC EQ 0.
          WA_EMAIL-PERNR = DEPTHEAD1.
          WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
          COLLECT WA_EMAIL INTO IT_EMAIL.
          CLEAR WA_EMAIL.
        ENDIF.

        SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ '00013907'.
        IF SY-SUBRC EQ 0.
          WA_EMAIL-PERNR = DEPTHEAD1.
          WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
          COLLECT WA_EMAIL INTO IT_EMAIL.
          CLEAR WA_EMAIL.
        ENDIF.
      ENDIF.

    ELSE.

      CLEAR : DEPTHEAD1.
      SELECT SINGLE * FROM ZQMS_DEPTHEAD1 WHERE BTRTL EQ '1229' AND TO_DT GE SY-DATUM..  "24.7.22
      IF SY-SUBRC EQ 0.
        DEPTHEAD1 = ZQMS_DEPTHEAD1-PERNR.
      ENDIF.


*      CLEAR : depthead1.
*      SELECT SINGLE * FROM pa0001 WHERE btrtl EQ '1229' AND endda GE sy-datum .
*      IF sy-subrc = 0.
*        SELECT SINGLE * FROM hrp1001 WHERE objid EQ pa0001-orgeh AND  otype EQ 'O' AND  relat = '012' AND endda GE sy-datum.
*        IF sy-subrc = 0.  " 012 is the relation code ie dept head
*          SELECT SINGLE * FROM pa0001 WHERE plans = hrp1001-sobid  AND endda GE sy-datum.
*          IF sy-subrc = 0 .
*            depthead1 = pa0001-pernr.
**        WRITE :  'DEPARTMENT HEAD', pa0001-pernr.
*          ENDIF.
*        ENDIF.
*      ENDIF.
      IF DEPTHEAD1 GT 0.
        SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ DEPTHEAD1.
        IF SY-SUBRC EQ 0.
          WA_EMAIL-PERNR = DEPTHEAD1.
          WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
          COLLECT WA_EMAIL INTO IT_EMAIL.
          CLEAR WA_EMAIL.
        ENDIF.
      ENDIF.

    ENDIF.
  ENDIF.
ENDFORM.
*&---------------------------------------------------------------------*
*&      Form  EXTEMAIL4
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM EXTEMAIL4 .

*  BREAK-POINT.
  CLEAR : DEPTIND1.
  CLEAR : IT_ZDMS6_1.
  SELECT * FROM ZDMS6 INTO TABLE IT_ZDMS6_1 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM.
  IF IT_ZDMS6_1 IS NOT INITIAL.
    LOOP AT IT_ZDMS6_1 INTO WA_ZDMS6_1.
      SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ WA_ZDMS6_1-APERNR.
      IF SY-SUBRC EQ 0.
        WA_EMAIL-PERNR = WA_ZDMS6_1-APERNR.
        WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
        COLLECT WA_EMAIL INTO IT_EMAIL.
        CLEAR WA_EMAIL.
      ENDIF.
    ENDLOOP.
  ENDIF.

*INITIATOR DEPT HEAD


  SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ ZDMS5-DEPTH.
  IF SY-SUBRC EQ 0.
    WA_EMAIL-PERNR = ZDMS5-DEPTH.
    WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
    COLLECT WA_EMAIL INTO IT_EMAIL.
    CLEAR WA_EMAIL.
  ENDIF.

ENDFORM.
*&---------------------------------------------------------------------*
*&      Form  CLOSEEMAIL
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM CLOSEEMAIL .
  CLEAR : DEPTHEAD,BTRTL.
  SELECT SINGLE * FROM ZDMS1 WHERE MJAHR EQ YEAR AND MBLNR EQ CCNUM.
  IF SY-SUBRC EQ 0.
*    SELECT SINGLE * FROM PA0001 WHERE PERNR EQ ZDMS1-PERNR AND ENDDA GE SY-DATUM.
    SELECT SINGLE * FROM ZPA0001 WHERE PERNR EQ ZDMS1-PERNR AND ENDDA GE SY-DATUM.
    IF SY-SUBRC EQ 0.
*      BTRTL = PA0001-BTRTL.
      BTRTL = ZPA0001-BTRTL.
    ENDIF.
    CLEAR : DEPTHEAD.
    SELECT SINGLE * FROM ZQMS_DEPTHEAD1 WHERE BTRTL EQ BTRTL AND TO_DT GE SY-DATUM..  "24.7.22
    IF SY-SUBRC EQ 0.
      DEPTHEAD = ZQMS_DEPTHEAD1-PERNR.
    ENDIF.

*    SELECT SINGLE * FROM pa0001 WHERE btrtl EQ btrtl AND endda GE sy-datum  AND plans NE '99999999'.
*    IF sy-subrc EQ 0.
*      SELECT SINGLE * FROM hrp1000 WHERE objid EQ pa0001-plans AND otype EQ 'O'.
*      IF sy-subrc EQ 0.
**      WRITE :  'DEPARTMENT HEAD'.
*        depthead = pa0001-pernr.
*      ELSE.
*        SELECT SINGLE * FROM hrp1001 WHERE objid EQ pa0001-plans AND endda GT sy-datum AND rsign EQ 'A' AND relat EQ '003' .
*        IF sy-subrc EQ 0.
*          SELECT SINGLE * FROM hrp1001 WHERE objid EQ hrp1001-sobid AND endda GT sy-datum AND rsign EQ 'B' AND relat EQ '012'.
*          IF sy-subrc EQ 0.
*            SELECT SINGLE * FROM pa0001 WHERE plans EQ hrp1001-sobid AND endda GT sy-datum.
*            IF sy-subrc EQ 0.
*              depthead = pa0001-pernr.
*            ENDIF.
*          ENDIF.
*        ENDIF.
*      ENDIF.
*    ENDIF.


    SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ DEPTHEAD.
    IF SY-SUBRC EQ 0.
      WA_EMAIL-PERNR = DEPTHEAD.
      WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
      COLLECT WA_EMAIL INTO IT_EMAIL.
      CLEAR WA_EMAIL.
      IF DEPTHEAD EQ '00005693'.
        SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ '00011171'.
        IF SY-SUBRC EQ 0.
          WA_EMAIL-PERNR = '00011171'.
          WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
          COLLECT WA_EMAIL INTO IT_EMAIL.
          CLEAR WA_EMAIL.
        ENDIF.
      ELSEIF DEPTHEAD EQ '00013959'.
        SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ '00016102'.
        IF SY-SUBRC EQ 0.
          WA_EMAIL-PERNR = '00016102'.
          WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
          COLLECT WA_EMAIL INTO IT_EMAIL.
          CLEAR WA_EMAIL.
        ENDIF.
      ELSEIF DEPTHEAD EQ '00011924'.
        SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ '00012420'.
        IF SY-SUBRC EQ 0.
          WA_EMAIL-PERNR = '00012420'.
          WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
          COLLECT WA_EMAIL INTO IT_EMAIL.
          CLEAR WA_EMAIL.
        ENDIF.
        SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ '00012420'.
        IF SY-SUBRC EQ 0.
          WA_EMAIL-PERNR = '00013907'.
          WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
          COLLECT WA_EMAIL INTO IT_EMAIL.
          CLEAR WA_EMAIL.
        ENDIF.
      ENDIF.
    ENDIF.
  ENDIF.
ENDFORM.
*&---------------------------------------------------------------------*
*&      Form  EMAIL21B
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM EMAIL21B .
  IF WERKS EQ '1000'.
    SELECT SINGLE * FROM ZQMS_DEPTHEAD1 WHERE BTRTL EQ '1228' AND TO_DT GE SY-DATUM..
    IF SY-SUBRC EQ 0.
      SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ ZQMS_DEPTHEAD1-PERNR.
      IF SY-SUBRC EQ 0.
        SELECT SINGLE * FROM PA0001 WHERE PERNR EQ ZPASSW-PERNR AND PLANS NE '99999999' AND ENDDA GE SY-DATUM.
        IF SY-SUBRC EQ 0.
          WA_EMAIL-PERNR = ZPASSW-PERNR.
*       wa_email-pernr = '00016314'.
          WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
          COLLECT WA_EMAIL INTO IT_EMAIL.
          CLEAR WA_EMAIL.
        ENDIF.
      ENDIF.
      SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ ZQMS_DEPTHEAD1-PERNR.
      IF SY-SUBRC EQ 0.
        WA_EMAIL-PERNR = ZPASSW-PERNR.
        WA_EMAIL-USRID_LONG = 'qa-nashik@bluecrosslabs.com'.
        COLLECT WA_EMAIL INTO IT_EMAIL.
        CLEAR WA_EMAIL.
      ENDIF.
    ENDIF.

    SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ '00011171'.  "ADDED ON 30.6.23
    IF SY-SUBRC EQ 0.
      SELECT SINGLE * FROM PA0001 WHERE PERNR EQ ZPASSW-PERNR AND PLANS NE '99999999' AND ENDDA GE SY-DATUM.
      IF SY-SUBRC EQ 0.
        WA_EMAIL-PERNR = ZPASSW-PERNR.
*       wa_email-pernr = '00016314'.
        WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
        COLLECT WA_EMAIL INTO IT_EMAIL.
        CLEAR WA_EMAIL.
      ENDIF.
    ENDIF.



  ELSEIF WERKS EQ '1001'.
    SELECT SINGLE * FROM ZQMS_DEPTHEAD1 WHERE BTRTL EQ '1328' AND TO_DT GE SY-DATUM..
    IF SY-SUBRC EQ 0.
      SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ ZQMS_DEPTHEAD1-PERNR.
      IF SY-SUBRC EQ 0.
        SELECT SINGLE * FROM PA0001 WHERE PERNR EQ ZPASSW-PERNR AND PLANS NE '99999999' AND ENDDA GE SY-DATUM.
        IF SY-SUBRC EQ 0.
          WA_EMAIL-PERNR = ZPASSW-PERNR.
*       wa_email-pernr = '00016314'.
          WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
          COLLECT WA_EMAIL INTO IT_EMAIL.
          CLEAR WA_EMAIL.
        ENDIF.
      ENDIF.
    ENDIF.
  ELSE.
    SELECT SINGLE * FROM ZQMS_DEPTHEAD1 WHERE BTRTL EQ '1232' AND TO_DT GE SY-DATUM..
    IF SY-SUBRC EQ 0.
      SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ ZQMS_DEPTHEAD1-PERNR.
      IF SY-SUBRC EQ 0.
        SELECT SINGLE * FROM PA0001 WHERE PERNR EQ ZPASSW-PERNR AND PLANS NE '99999999' AND ENDDA GE SY-DATUM.
        IF SY-SUBRC EQ 0.
          WA_EMAIL-PERNR = ZPASSW-PERNR.
*       wa_email-pernr = '00016314'.
          WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
          COLLECT WA_EMAIL INTO IT_EMAIL.
          CLEAR WA_EMAIL.
        ENDIF.
      ENDIF.
    ENDIF.
    SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ '00013959'.  "ADDED ON 30.6.23
    IF SY-SUBRC EQ 0.
      SELECT SINGLE * FROM PA0001 WHERE PERNR EQ ZPASSW-PERNR AND PLANS NE '99999999' AND ENDDA GE SY-DATUM.
      IF SY-SUBRC EQ 0.
        WA_EMAIL-PERNR = ZPASSW-PERNR.
*       wa_email-pernr = '00016314'.
        WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
        COLLECT WA_EMAIL INTO IT_EMAIL.
        CLEAR WA_EMAIL.
      ENDIF.
    ENDIF.

  ENDIF.
ENDFORM.
*&---------------------------------------------------------------------*
*&      Form  EMAIL2_1
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM EMAIL2_1 .


  CLEAR : DEPTHEAD.

  SELECT SINGLE * FROM ZQMS_DEPTHEAD1 WHERE BTRTL EQ IBTRTL AND TO_DT GE SY-DATUM..  "24.7.22
  IF SY-SUBRC EQ 0.
    DEPTHEAD = ZQMS_DEPTHEAD1-PERNR.
    SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ DEPTHEAD.
    IF SY-SUBRC EQ 0.
      WA_EMAIL-PERNR = DEPTHEAD.
      WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
      COLLECT WA_EMAIL INTO IT_EMAIL.
      CLEAR WA_EMAIL.
    ENDIF.
  ENDIF.

  SELECT SINGLE * FROM ZQMS_DEPTHEAD1 WHERE BTRTL EQ IBTRTL AND REVIEWER NE SPACE AND TO_DT GE SY-DATUM..  "24.7.22
  IF SY-SUBRC EQ 0.
    SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ ZQMS_DEPTHEAD1-REVIEWER.
    IF SY-SUBRC EQ 0.
      WA_EMAIL-PERNR = ZQMS_DEPTHEAD1-REVIEWER.
      WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
      COLLECT WA_EMAIL INTO IT_EMAIL.
      CLEAR WA_EMAIL.
    ENDIF.
  ENDIF.
  IF R2 EQ 'X'.
    SELECT SINGLE * FROM ZQMS_DEPTHEAD1 WHERE BTRTL EQ IBTRTL AND REVIEWER EQ SPACE AND TO_DT GE SY-DATUM..  "24.7.22
    IF SY-SUBRC EQ 0.
      IF WERKS EQ '1000'.
        SELECT SINGLE * FROM ZQMS_DEPTHEAD1 WHERE BTRTL EQ '1228' AND TO_DT GE SY-DATUM..  "24.7.22
        IF SY-SUBRC EQ 0.
          SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ ZQMS_DEPTHEAD1-PERNR.
          IF SY-SUBRC EQ 0.
            WA_EMAIL-PERNR = ZPASSW-PERNR.
            WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
            COLLECT WA_EMAIL INTO IT_EMAIL.
            CLEAR WA_EMAIL.
          ENDIF.
        ENDIF.
      ELSEIF WERKS EQ '1001'.

        SELECT SINGLE * FROM ZQMS_DEPTHEAD1 WHERE BTRTL EQ '1328' AND TO_DT GE SY-DATUM..  "24.7.22
        IF SY-SUBRC EQ 0.
          SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ ZQMS_DEPTHEAD1-PERNR.
          IF SY-SUBRC EQ 0.
            WA_EMAIL-PERNR = ZPASSW-PERNR.
            WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
            COLLECT WA_EMAIL INTO IT_EMAIL.
            CLEAR WA_EMAIL.
          ENDIF.
        ENDIF.

      ELSE.

        SELECT SINGLE * FROM ZQMS_DEPTHEAD1 WHERE BTRTL EQ '1232' AND TO_DT GE SY-DATUM..  "24.7.22
        IF SY-SUBRC EQ 0.
          SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ ZQMS_DEPTHEAD1-PERNR.
          IF SY-SUBRC EQ 0.
            WA_EMAIL-PERNR = ZPASSW-PERNR.
            WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
            COLLECT WA_EMAIL INTO IT_EMAIL.
            CLEAR WA_EMAIL.
          ENDIF.
        ENDIF.

      ENDIF.
    ENDIF.
*  ELSEIF r21 EQ 'X'.
*    SELECT SINGLE * FROM zqms_depthead WHERE btrtl EQ ibtrtl AND approver NE space.  "24.7.22
*    IF sy-subrc EQ 0.
*      SELECT SINGLE * FROM zpassw WHERE pernr EQ zqms_depthead-approver.
*      IF sy-subrc EQ 0.
*        wa_email-pernr = zqms_depthead-approver.
*        wa_email-usrid_long = zpassw-smtp_addr.
*        COLLECT wa_email INTO it_email.
*        CLEAR wa_email.
*      ENDIF.
*    ENDIF.
*
*    SELECT SINGLE * FROM zqms_depthead WHERE btrtl EQ ibtrtl AND approver EQ space.  "24.7.22
*    IF sy-subrc EQ 0.
*      IF werks EQ '1000'.
*        SELECT SINGLE * FROM zqms_depthead WHERE btrtl EQ '1228'.  "24.7.22
*        IF sy-subrc EQ 0.
*          SELECT SINGLE * FROM zpassw WHERE pernr EQ zqms_depthead-pernr.
*          IF sy-subrc EQ 0.
*            wa_email-pernr = zpassw-pernr.
*            wa_email-usrid_long = zpassw-smtp_addr.
*            COLLECT wa_email INTO it_email.
*            CLEAR wa_email.
*          ENDIF.
*        ENDIF.
*      ELSEIF werks EQ '1001'.
*
*        SELECT SINGLE * FROM zqms_depthead WHERE btrtl EQ '1328'.  "24.7.22
*        IF sy-subrc EQ 0.
*          SELECT SINGLE * FROM zpassw WHERE pernr EQ zqms_depthead-pernr.
*          IF sy-subrc EQ 0.
*            wa_email-pernr = zpassw-pernr.
*            wa_email-usrid_long = zpassw-smtp_addr.
*            COLLECT wa_email INTO it_email.
*            CLEAR wa_email.
*          ENDIF.
*        ENDIF.
*
*      ELSE.
*
*        SELECT SINGLE * FROM zqms_depthead WHERE btrtl EQ '1232'.  "24.7.22
*        IF sy-subrc EQ 0.
*          SELECT SINGLE * FROM zpassw WHERE pernr EQ zqms_depthead-pernr.
*          IF sy-subrc EQ 0.
*            wa_email-pernr = zpassw-pernr.
*            wa_email-usrid_long = zpassw-smtp_addr.
*            COLLECT wa_email INTO it_email.
*            CLEAR wa_email.
*          ENDIF.
*        ENDIF.
*
*      ENDIF.
*    ENDIF.

  ENDIF.

ENDFORM.
*&---------------------------------------------------------------------*
*&      Form  EMAIL2_2
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM EMAIL2_2 .


  CLEAR : DEPTHEAD,DEPTHNAME.

  SELECT SINGLE * FROM ZQMS_DEPTHEAD1 WHERE BTRTL EQ IBTRTL AND TO_DT GE SY-DATUM..  "24.7.22
  IF SY-SUBRC EQ 0.
    DEPTHEAD = ZQMS_DEPTHEAD1-PERNR.
    SELECT SINGLE * FROM PA0001 WHERE PERNR EQ DEPTHEAD AND ENDDA GE SY-DATUM.
    IF SY-SUBRC EQ 0.
      DEPTHNAME  = PA0001-ENAME.
    ENDIF.
    SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ DEPTHEAD.
    IF SY-SUBRC EQ 0.
      WA_EMAIL-PERNR = DEPTHEAD.
      WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
      COLLECT WA_EMAIL INTO IT_EMAIL.
      CLEAR WA_EMAIL.
    ENDIF.
  ENDIF.



  SELECT SINGLE * FROM ZQMS_DEPTHEAD1 WHERE BTRTL EQ IBTRTL AND APPROVER NE SPACE AND TO_DT GE SY-DATUM..  "24.7.22
  IF SY-SUBRC EQ 0.
    SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ ZQMS_DEPTHEAD1-APPROVER.
    IF SY-SUBRC EQ 0.
      WA_EMAIL-PERNR = ZQMS_DEPTHEAD1-APPROVER.
      WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
      COLLECT WA_EMAIL INTO IT_EMAIL.
      CLEAR WA_EMAIL.
    ENDIF.
  ENDIF.

  SELECT SINGLE * FROM ZQMS_DEPTHEAD1 WHERE BTRTL EQ IBTRTL AND APPROVER EQ SPACE AND TO_DT GE SY-DATUM..  "24.7.22
  IF SY-SUBRC EQ 0.
    IF WERKS EQ '1000'.
      SELECT SINGLE * FROM ZQMS_DEPTHEAD1 WHERE BTRTL EQ '1228' AND TO_DT GE SY-DATUM..  "24.7.22
      IF SY-SUBRC EQ 0.
        SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ ZQMS_DEPTHEAD1-PERNR.
        IF SY-SUBRC EQ 0.
          WA_EMAIL-PERNR = ZPASSW-PERNR.
          WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
          COLLECT WA_EMAIL INTO IT_EMAIL.
          CLEAR WA_EMAIL.
        ENDIF.
      ENDIF.
    ELSEIF WERKS EQ '1001'.

      SELECT SINGLE * FROM ZQMS_DEPTHEAD1 WHERE BTRTL EQ '1328' AND TO_DT GE SY-DATUM..  "24.7.22
      IF SY-SUBRC EQ 0.
        SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ ZQMS_DEPTHEAD1-PERNR.
        IF SY-SUBRC EQ 0.
          WA_EMAIL-PERNR = ZPASSW-PERNR.
          WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
          COLLECT WA_EMAIL INTO IT_EMAIL.
          CLEAR WA_EMAIL.
        ENDIF.
      ENDIF.

    ELSE.

      SELECT SINGLE * FROM ZQMS_DEPTHEAD1 WHERE BTRTL EQ '1232' AND TO_DT GE SY-DATUM..  "24.7.22
      IF SY-SUBRC EQ 0.
        SELECT SINGLE * FROM ZPASSW WHERE PERNR EQ ZQMS_DEPTHEAD1-PERNR.
        IF SY-SUBRC EQ 0.
          WA_EMAIL-PERNR = ZPASSW-PERNR.
          WA_EMAIL-USRID_LONG = ZPASSW-SMTP_ADDR.
          COLLECT WA_EMAIL INTO IT_EMAIL.
          CLEAR WA_EMAIL.
        ENDIF.
      ENDIF.

    ENDIF.
  ENDIF.

ENDFORM.
