*&---------------------------------------------------------------------*
*& Report ZSAMP_PROCESS_MARAPR
*&---------------------------------------------------------------------*
*&
*&---------------------------------------------------------------------*
REPORT ZSAMP_PROCESS_MARAPR.
*&---------------------------------------------------------------------*
*& Report  ZSAMP_PROCESS1
*& DEVELOPED BY JYOTSNA..
*&---------------------------------------------------------------------*
*& THIS PROGRAM WILL UPDATE DATA IN TABLE - ZSAMPPROCESS.
*& SAMPLE ALLOCATION QUANTITY IS DEPEND ON DATA IN TABLE ZSAMPPOLICY.
* AS PER DATA IN ZSAMPPOLICY, ITS DIVISION & DRP DATA WILL GET PROCESSED & STORE IN ZSAMPPROCESS
*  TABLE REFERED - ZSAMPPROCESS, ZSAMPPOLICY.
*&---------------------------------------------------------------------*

*REPORT  ZSAMP_PROCESS8.

TABLES : ZSAMPPOLICY,
         VBRK,
         ZDSMTER,
         ZSAMPPRDGRP,
         ZSAMPPROCESS,
         YTERRALLC,
         MARA,
         PA0302,
         ZSAMPNEPREG,
         ZSAMP_PRD.

DATA : IT_ZDSMTER      TYPE TABLE OF ZDSMTER,
       WA_ZDSMTER      TYPE ZDSMTER,
       IT_ZSAMPPOLICY  TYPE TABLE OF ZSAMPPOLICY,
       WA_ZSAMPPOLICY  TYPE ZSAMPPOLICY,
       IT_ZSAMPPRDGRP  TYPE TABLE OF ZSAMPPRDGRP,
       WA_ZSAMPPRDGRP  TYPE ZSAMPPRDGRP,
       IT_ZRCUMPSO1    TYPE TABLE OF ZRCUMPSO,
       WA_ZRCUMPSO1    TYPE ZRCUMPSO,
       IT_ZRCUMPSO2    TYPE TABLE OF ZRCUMPSO,
       WA_ZRCUMPSO2    TYPE ZRCUMPSO,
       IT_ZRCUMPSO3    TYPE TABLE OF ZRCUMPSO,
       WA_ZRCUMPSO3    TYPE ZRCUMPSO,
       IT_ZRCUMPSO4    TYPE TABLE OF ZRCUMPSO,
       WA_ZRCUMPSO4    TYPE ZRCUMPSO,
       IT_ZRCUMPSO     TYPE TABLE OF ZRCUMPSO,
       WA_ZRCUMPSO     TYPE ZRCUMPSO,
*       IT_ZRPQV1       TYPE TABLE OF ZRPQV,
*       WA_ZRPQV1       TYPE ZRPQV,
*       IT_ZRPQV2       TYPE TABLE OF ZRPQV,
*       WA_ZRPQV2       TYPE ZRPQV,
*       IT_ZRPQV3       TYPE TABLE OF ZRPQV,
*       WA_ZRPQV3       TYPE ZRPQV,
*       IT_ZRPQV4       TYPE TABLE OF ZRPQV,
*       WA_ZRPQV4       TYPE ZRPQV,
*       IT_ZRPQV        TYPE TABLE OF ZRPQV,
*       WA_ZRPQV        TYPE ZRPQV,
       IT_ZRPQV1       TYPE TABLE OF ZSAMP_PQV1,
       WA_ZRPQV1       TYPE ZSAMP_PQV1,
       IT_ZRPQV2       TYPE TABLE OF ZSAMP_PQV1,
       WA_ZRPQV2       TYPE ZSAMP_PQV1,
       IT_ZRPQV3       TYPE TABLE OF ZSAMP_PQV1,
       WA_ZRPQV3       TYPE ZSAMP_PQV1,
       IT_ZRPQV4       TYPE TABLE OF ZSAMP_PQV1,
       WA_ZRPQV4       TYPE ZSAMP_PQV1,
       IT_ZRPQV        TYPE TABLE OF ZSAMP_PQV1,
       WA_ZRPQV        TYPE ZSAMP_PQV1,
       IT_YTERRALLC    TYPE TABLE OF YTERRALLC,
       WA_YTERRALLC    TYPE YTERRALLC,
       IT_YTERRALLC1   TYPE TABLE OF YTERRALLC,
       WA_YTERRALLC1   TYPE YTERRALLC,
       IT_YTERRALLC2   TYPE TABLE OF YTERRALLC,
       WA_YTERRALLC2   TYPE YTERRALLC,
       IT_YTERRALLC3   TYPE TABLE OF YTERRALLC,
       WA_YTERRALLC3   TYPE YTERRALLC,
       IT_PA0001       TYPE TABLE OF PA0001,
       WA_PA0001       TYPE PA0001,
       IT_PA0302       TYPE TABLE OF PA0302,
       WA_PA0302       TYPE PA0302,
       IT_ZSAMPEXCLUDE TYPE TABLE OF ZSAMPEXCLUDE,
       WA_ZSAMPEXCLUDE TYPE ZSAMPEXCLUDE,
       IT_ZSAMPINVH    TYPE TABLE OF ZSAMPINVH,
       WA_ZSAMPINVH    TYPE ZSAMPINVH.

DATA : OK LIKE SY-UCOMM.



TYPES : BEGIN OF ITAB1,
          REG TYPE ZDSMTER-ZDSM,
          ZM  TYPE ZDSMTER-ZDSM,
          RM  TYPE ZDSMTER-ZDSM,
        END OF ITAB1.

TYPES : BEGIN OF ITAB2,
          REG   TYPE ZDSMTER-ZDSM,
          ZM    TYPE ZDSMTER-ZDSM,
          RM    TYPE ZDSMTER-ZDSM,
          BZIRK TYPE ZDSMTER-BZIRK,
        END OF ITAB2.

TYPES : BEGIN OF IDIV1,
          REG   TYPE ZDSMTER-ZDSM,
          ZM    TYPE ZDSMTER-ZDSM,
          RM    TYPE ZDSMTER-ZDSM,
          BZIRK TYPE ZDSMTER-BZIRK,
          SPART TYPE ZDSMTER-SPART,
        END OF IDIV1.

TYPES : BEGIN OF ITAG1,
          ZMONTH    TYPE ZSAMPPOLICY-ZMONTH,
          ZYEAR     TYPE ZSAMPPOLICY-ZYEAR,
          SAMP_PRD  TYPE ZSAMPPOLICY-SAMP_PRD,
          DIV       TYPE ZSAMPPOLICY-DIV,
          COUNTRY   TYPE ZSAMPPOLICY-COUNTRY,
          DRP       TYPE ZSAMPPOLICY-DRP,
          SALE_TYPE TYPE ZSAMPPOLICY-SALE_TYPE,
          SNO       TYPE ZSAMPPOLICY-SNO,
          FROM_DT   TYPE ZSAMPPOLICY-FROM_DT,
          ZGROUP    TYPE ZSAMPPOLICY-ZGROUP,
          TOP1      TYPE ZSAMPPOLICY-TOP1,
          TOP2      TYPE ZSAMPPOLICY-TOP2,
          SQTY      TYPE ZSAMPPOLICY-SQTY,
          USE_MONTH TYPE ZSAMPPOLICY-USE_MONTH,
          PRD_CODE  TYPE ZSAMPPRDGRP-PRD_CODE,
        END OF ITAG1.

TYPES : BEGIN OF ITAS1,
          REG      TYPE ZDSMTER-ZDSM,
          ZM       TYPE ZDSMTER-ZDSM,
          RM       TYPE ZDSMTER-ZDSM,
          BZIRK    TYPE ZRCUMPSO-BZIRK,
          NETVAL   TYPE ZRCUMPSO-NETVAL,
          DIV(3)   TYPE C,
          MATNR    TYPE ZRPQV-MATNR,
          PERNR    TYPE PA0001-PERNR,
          SAMP_PRD TYPE MARA-MATNR,
          DOJ      TYPE PA0302-BEGDA,
        END OF ITAS1.



TYPES : BEGIN OF ITAS3,
          RM     TYPE ZRCUMPSO-BZIRK,
          BZIRK  TYPE ZRCUMPSO-BZIRK,
          NETVAL TYPE ZRCUMPSO-NETVAL,
        END OF ITAS3.

TYPES : BEGIN OF ITAS4,
          RM     TYPE ZRCUMPSO-BZIRK,
          NETVAL TYPE ZRCUMPSO-NETVAL,
          COUNT  TYPE I,
        END OF ITAS4.

TYPES : BEGIN OF ITAS5,
          DZM    TYPE ZRCUMPSO-BZIRK,
          NETVAL TYPE ZRCUMPSO-NETVAL,
          COUNT  TYPE I,
        END OF ITAS5.

TYPES : BEGIN OF ITAS6,
          DZM    TYPE ZRCUMPSO-BZIRK,
          NETVAL TYPE ZRCUMPSO-NETVAL,
          COUNT  TYPE I,
        END OF ITAS6.

TYPES : BEGIN OF ITAS7,
          REG    TYPE ZRCUMPSO-BZIRK,
          NETVAL TYPE ZRCUMPSO-NETVAL,
          COUNT  TYPE I,
        END OF ITAS7.

TYPES : BEGIN OF ITAP1,
          PRD_CODE TYPE ZRPQV-MATNR,
          BZIRK    TYPE ZRCUMPSO-BZIRK,
          GROSSPTS TYPE ZRCUMPSO-NETVAL,
          COUNT    TYPE I,
        END OF ITAP1.

TYPES : BEGIN OF ITAP3,
          PRD_CODE TYPE ZRPQV-MATNR,
          RM       TYPE ZRCUMPSO-BZIRK,
          GROSSPTS TYPE ZRCUMPSO-NETVAL,
          COUNT    TYPE I,
        END OF ITAP3.

TYPES : BEGIN OF ITAP5,
          PRD_CODE TYPE ZRPQV-MATNR,
          DZM      TYPE ZRCUMPSO-BZIRK,
          GROSSPTS TYPE ZRCUMPSO-NETVAL,
          COUNT    TYPE I,
        END OF ITAP5.

TYPES : BEGIN OF ITAP7,
          PRD_CODE TYPE ZRPQV-MATNR,
          REG      TYPE ZRCUMPSO-BZIRK,
          GROSSPTS TYPE ZRCUMPSO-NETVAL,
          COUNT    TYPE I,
        END OF ITAP7.

TYPES : BEGIN OF TOP1,
          BZIRK    TYPE ZDSMTER-BZIRK,
          NETVAL   TYPE P,
          COUNT    TYPE INT4,
          SAMP_PRD TYPE MARA-MATNR,
        END OF TOP1.

TYPES : BEGIN OF EX1,
          BZIRK  TYPE ZSAMPEXCLUDE-BZIRK,
          MATNR  TYPE ZSAMPEXCLUDE-MATNR,
          DRP    TYPE ZSAMPEXCLUDE-DRP,
          INDALL TYPE ZSAMPEXCLUDE-INDALL,
        END OF EX1.

TYPES : BEGIN OF IPRD1,
          SAMP_PRD TYPE ZSAMPPOLICY-SAMP_PRD,
        END OF IPRD1.

DATA : IT_TAB1  TYPE TABLE OF ITAB1,
       WA_TAB1  TYPE ITAB1,
       IT_TAB2  TYPE TABLE OF ITAB2,
       WA_TAB2  TYPE ITAB2,
       IT_TAB3  TYPE TABLE OF ITAB2,
       WA_TAB3  TYPE ITAB2,
       IT_DIV1  TYPE TABLE OF IDIV1,
       WA_DIV1  TYPE IDIV1,
       IT_DIV2  TYPE TABLE OF IDIV1,
       WA_DIV2  TYPE IDIV1,
       IT_TAB4  TYPE TABLE OF ITAB2,
       WA_TAB4  TYPE ITAB2,
*       it_tab5 TYPE TABLE OF itab5,
*       wa_tab5 TYPE itab5,
       IT_TAG1  TYPE TABLE OF ITAG1,
       WA_TAG1  TYPE ITAG1,
       IT_TAD1  TYPE TABLE OF ITAG1,
       WA_TAD1  TYPE ITAG1,
       IT_TAS1  TYPE TABLE OF ITAS1,
       WA_TAS1  TYPE ITAS1,
*       IT_TAP1 TYPE TABLE OF ITAS1,
*       WA_TAP1 TYPE ITAS1,
*       IT_TAP2 TYPE TABLE OF ITAS1,
*       WA_TAP2 TYPE ITAS1,


       IT_PSO1  TYPE TABLE OF ITAS1,
       WA_PSO1  TYPE ITAS1,
       IT_RM1   TYPE TABLE OF ITAS1,
       WA_RM1   TYPE ITAS1,
       IT_ZM1   TYPE TABLE OF ITAS1,
       WA_ZM1   TYPE ITAS1,
       IT_REG1  TYPE TABLE OF ITAS1,
       WA_REG1  TYPE ITAS1,

       IT_PPSO1 TYPE TABLE OF ITAS1,
       WA_PPSO1 TYPE ITAS1,

       IT_PRM1  TYPE TABLE OF ITAS1,
       WA_PRM1  TYPE ITAS1,
       IT_PZM1  TYPE TABLE OF ITAS1,
       WA_PZM1  TYPE ITAS1,
       IT_PREG1 TYPE TABLE OF ITAS1,
       WA_PREG1 TYPE ITAS1,

       IT_TAS2  TYPE TABLE OF ITAS1,
       WA_TAS2  TYPE ITAS1,
       IT_TAS3  TYPE TABLE OF ITAS3,
       WA_TAS3  TYPE ITAS3,
       IT_TAS4  TYPE TABLE OF ITAS4,
       WA_TAS4  TYPE ITAS4,
       IT_TAS5  TYPE TABLE OF ITAS5,
       WA_TAS5  TYPE ITAS5,
       IT_TAS6  TYPE TABLE OF ITAS6,
       WA_TAS6  TYPE ITAS6,
       IT_TAS7  TYPE TABLE OF ITAS7,
       WA_TAS7  TYPE ITAS7,
       IT_TAS8  TYPE TABLE OF ITAS7,
       WA_TAS8  TYPE ITAS7,

       IT_TOP1  TYPE TABLE OF TOP1,
       WA_TOP1  TYPE TOP1,
       IT_TOP2  TYPE TABLE OF TOP1,
       WA_TOP2  TYPE TOP1,
       IT_EX1   TYPE TABLE OF EX1,
       WA_EX1   TYPE EX1,
       IT_EX2   TYPE TABLE OF EX1,
       WA_EX2   TYPE EX1,

       IT_TAP1  TYPE TABLE OF ITAS1,
       WA_TAP1  TYPE ITAS1,
       IT_TAP2  TYPE TABLE OF ITAS1,
       WA_TAP2  TYPE ITAS1,
       IT_TAP3  TYPE TABLE OF ITAS1,
       WA_TAP3  TYPE ITAS1,

       IT_PRD1  TYPE TABLE OF IPRD1,
       WA_PRD1  TYPE IPRD1.

DATA : COUNTT TYPE I.


FIELD-SYMBOLS : <FS_TAS1> TYPE ITAS1,
                <FS_TOP1> TYPE TOP1.

FIELD-SYMBOLS : <ITAB>   TYPE ANY TABLE,
                <FS_TAB> TYPE ZRCUMPSO,
                <FIELD>  TYPE ANY,
                <FS_TAP> TYPE ZRPQV,
                <FS_T>   TYPE ANY,
                <FS_T1>  TYPE ANY.


*       it_DZM1 TYPE TABLE OF DZM1,
*       wa_DZM1 TYPE DZM1,
*       it_REG1 TYPE TABLE OF REG1,
*       wa_REG1 TYPE REG1.

DATA : A        TYPE I,
       B        TYPE I,
       C        TYPE I,
       COUNT    TYPE INT4,
       RCOUNT   TYPE I VALUE 1,
       DZMCOUNT TYPE I VALUE 1,
       REGCOUNT TYPE I VALUE 1,
       COUNT1   TYPE I,
       COUNT2   TYPE I,
       M1(2)    TYPE C,
       M2(2)    TYPE C,
       M3(2)    TYPE C,
       M4(2)    TYPE C,
       Y1(4)    TYPE C,
       Y2(4)    TYPE C,
       Y3(4)    TYPE C,
       Y4(4)    TYPE C,
       LM1(2)   TYPE C,
       LM2(2)   TYPE C,
       LM3(2)   TYPE C,
       LM4(2)   TYPE C,
       LY1(4)   TYPE C,
       LY2(4)   TYPE C,
       LY3(4)   TYPE C,
       LY4(4)   TYPE C,
       M11(2)   TYPE C,
       M12(2)   TYPE C,
       Y11(4)   TYPE C.

DATA : YES(1) TYPE C,
       NO(1)  TYPE C,
       x(1)   TYPE C,
       y(1)   TYPE C,
       DIV(3) TYPE C,
       DIV1   TYPE MARA-SPART,
       DCOUNT TYPE I.

TYPE-POOLS:  SLIS.

DATA: G_REPID     LIKE SY-REPID,
      FIELDCAT    TYPE SLIS_T_FIELDCAT_ALV,
      WA_FIELDCAT LIKE LINE OF FIELDCAT,
      SORT        TYPE SLIS_T_SORTINFO_ALV,
      WA_SORT     LIKE LINE OF SORT,
      LAYOUT      TYPE SLIS_LAYOUT_ALV.


DATA : ZSAMPPROCESS_WA TYPE ZSAMPPROCESS.
DATA: IT_ZSAMPPROCESS_WA LIKE ZSAMPPROCESS OCCURS 0.

DATA : WF_QUES(5) TYPE C,
       SDATE1     TYPE SY-DATUM,
       SDATE2     TYPE SY-DATUM.

DATA : 1DATE1 TYPE SY-DATUM,
       2DATE1 TYPE SY-DATUM,
       3DATE1 TYPE SY-DATUM,
       LDATE1 TYPE SY-DATUM,
       1DATE2 TYPE SY-DATUM,
       2DATE2 TYPE SY-DATUM,
       3DATE2 TYPE SY-DATUM,
       LDATE2 TYPE SY-DATUM.

SELECTION-SCREEN BEGIN OF BLOCK MERKMALE1 WITH FRAME TITLE TEXT-001.
PARAMETERS : MONTH(2) TYPE C,
             YEAR(4)  TYPE C.
SELECT-OPTIONS : DATE1 FOR VBRK-FKDAT,
                 DATE2 FOR VBRK-FKDAT.

PARAMETERS : R1 RADIOBUTTON GROUP R1,
             R2 RADIOBUTTON GROUP R1,
             R3 RADIOBUTTON GROUP R1.
SELECT-OPTIONS : MATERIAL FOR ZSAMPPROCESS-SAMPCODE .
*no intervals.
PARAMETERS : DOJ TYPE SY-DATUM OBLIGATORY DEFAULT SY-DATUM.
SELECTION-SCREEN END OF BLOCK MERKMALE1 .

START-OF-SELECTION.
  SDATE1+6(2) = '01'.
  SDATE1+4(2) = MONTH.
  SDATE1+0(4) = YEAR.

  CALL FUNCTION 'HR_JP_MONTH_BEGIN_END_DATE'
    EXPORTING
      IV_DATE           = SDATE1
    IMPORTING
*     EV_MONTH_BEGIN_DATE       =
      EV_MONTH_END_DATE = SDATE2.

*  WRITE : / 'STAT DATE & END DATE',SDATE1,SDATE2.

  IF R1 EQ 'X'.

    SELECT SINGLE * FROM ZSAMPPROCESS WHERE ZMONTH EQ MONTH AND ZYEAR EQ YEAR.
    IF SY-SUBRC EQ 0.
      CALL FUNCTION 'POPUP_TO_CONFIRM'
        EXPORTING
          TITLEBAR       = 'DATA ALREADY EXIST FOR THIS PERIOD. DO YOU WANT TO REPROCESS ?'
*         DIAGNOSE_OBJECT             = ' '
          TEXT_QUESTION  = WF_QUES
          TEXT_BUTTON_1  = 'YES'
          ICON_BUTTON_1  = 'ICON_OKAY'
*         TEXT_BUTTON_2  = 'Nein'(002)
*         ICON_BUTTON_2  = ' '
*         DEFAULT_BUTTON = '1'
*         DISPLAY_CANCEL_BUTTON       = 'X'
*         USERDEFINED_F1_HELP         = ' '
*         START_COLUMN   = 25
*         START_ROW      = 6
*         POPUP_TYPE     =
*         IV_QUICKINFO_BUTTON_1       = ' '
*         IV_QUICKINFO_BUTTON_2       = ' '
        IMPORTING
          ANSWER         = WF_QUES
*     TABLES
*         PARAMETER      =
        EXCEPTIONS
          TEXT_NOT_FOUND = 1
          OTHERS         = 2.
      IF SY-SUBRC <> 0.
* MESSAGE ID SY-MSGID TYPE SY-MSGTY NUMBER SY-MSGNO
*         WITH SY-MSGV1 SY-MSGV2 SY-MSGV3 SY-MSGV4.
      ENDIF.

*    WRITE : / 'ANS',WF_QUES.
      IF WF_QUES EQ '1'.
        SELECT SINGLE * FROM ZSAMPPROCESS WHERE ZMONTH EQ MONTH AND ZYEAR EQ YEAR AND INVQTY GT 0.
        IF SY-SUBRC EQ 0.
          MESSAGE 'DATA FOR THIS MONTH & YEAR IS ALREADY PROCESSED & INVOICED' TYPE 'E'.
          EXIT.
        ENDIF.

        DELETE FROM ZSAMPPROCESS WHERE ZMONTH EQ MONTH AND ZYEAR EQ YEAR.
        COMMIT WORK AND WAIT .
        PERFORM DATA.
      ENDIF.
    ELSE.
      PERFORM DATA.
    ENDIF.

  ELSE.
    PERFORM DATA1.
  ENDIF.
*&---------------------------------------------------------------------*
*&      Form  DATA
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
FORM DATA.  " VALUE BASED
****************if data already exist in zsampinvh the do not process********
*  select * FROM zsampinvh INTO TABLE it_zsampinvh WHERE zmonth eq month AND zyear eq year.
*  if it_zsampinvh IS NOT INITIAL.
  SELECT SINGLE * FROM ZSAMPPROCESS WHERE ZMONTH EQ MONTH AND ZYEAR EQ YEAR AND INVQTY GT 0.
  IF SY-SUBRC EQ 0.
    MESSAGE 'DATA FOR THIS MONTH & YEAR IS ALREADY PROCESSED & INVOICED' TYPE 'E'.
    EXIT.
  ENDIF.
  SELECT * FROM ZSAMPPOLICY INTO TABLE IT_ZSAMPPOLICY WHERE ZMONTH EQ MONTH AND ZYEAR EQ YEAR.
  IF SY-SUBRC NE 0.
    MESSAGE 'NO POLICY DATA FOUND IN ZSAMPPOLICY FOR THIS MONTH' TYPE 'E'.
    EXIT.
  ENDIF.

  SELECT * FROM ZDSMTER INTO TABLE IT_ZDSMTER WHERE ZMONTH EQ MONTH AND ZYEAR EQ YEAR.
  IF SY-SUBRC NE 0.
    MESSAGE 'NO DATA FOUND IN ZDSMTER FOR THIS MONTH' TYPE 'E'.
    EXIT.
  ENDIF.


  LOOP AT IT_ZDSMTER INTO WA_ZDSMTER WHERE ZDSM+0(2) CS 'D-'.
    WA_TAB1-REG = WA_ZDSMTER-ZDSM.
    COLLECT WA_TAB1 INTO IT_TAB1.
    CLEAR WA_TAB1.
  ENDLOOP.


  LOOP AT IT_TAB1 INTO WA_TAB1.
*    WRITE : / WA_TAB1-REG.
    LOOP AT IT_ZDSMTER INTO WA_ZDSMTER WHERE ZDSM EQ WA_TAB1-REG AND BZIRK+0(2) = 'R-'.
*      WRITE : / 'RM',wa_zdsmter-BZIRK.
      WA_TAB2-REG = WA_TAB1-REG.
      WA_TAB2-RM = WA_ZDSMTER-BZIRK.
      COLLECT WA_TAB2 INTO IT_TAB2.
      CLEAR WA_TAB2.
    ENDLOOP.
  ENDLOOP.

  LOOP AT IT_TAB2 INTO WA_TAB2.
    SELECT * FROM ZDSMTER WHERE ZDSM EQ WA_TAB2-RM AND ZMONTH EQ MONTH AND ZYEAR EQ YEAR.
      IF SY-SUBRC EQ 0.
        WA_TAB3-REG = WA_TAB2-REG.
        WA_TAB3-RM = WA_TAB2-RM.
        WA_TAB3-BZIRK = ZDSMTER-BZIRK.
        COLLECT WA_TAB3 INTO IT_TAB3.
        CLEAR WA_TAB3.
************* DIVISION ***************
        WA_DIV1-REG = WA_TAB2-REG.
        WA_DIV1-RM = WA_TAB2-RM.
        WA_DIV1-BZIRK = ZDSMTER-BZIRK.
        WA_DIV1-SPART = ZDSMTER-SPART.
        COLLECT WA_DIV1 INTO IT_DIV1.
        CLEAR WA_DIV1.
      ENDIF.
    ENDSELECT.
  ENDLOOP.

  LOOP AT IT_DIV1 INTO WA_DIV1.
    WA_DIV2-REG = WA_DIV1-REG.
    WA_DIV2-RM = WA_DIV1-RM.
    WA_DIV2-BZIRK = WA_DIV1-BZIRK.
    WA_DIV2-SPART = WA_DIV1-SPART.
    READ TABLE IT_ZDSMTER INTO WA_ZDSMTER WITH KEY BZIRK = WA_DIV1-RM ZDSM+0(2) = 'Z-'.
    IF SY-SUBRC EQ 0.
*      WRITE : 'ZM',WA_ZDSMTER-ZDSM.
      WA_DIV2-ZM = WA_ZDSMTER-ZDSM.
    ENDIF.
    COLLECT WA_DIV2 INTO IT_DIV2.
    CLEAR WA_DIV2.
  ENDLOOP.
  SORT IT_DIV2 BY REG RM BZIRK .

  LOOP AT IT_TAB3 INTO WA_TAB3.
*    WRITE : / '**',wa_TAB3-reg,wa_TAB3-rm,wa_TAB3-bzirk.
    WA_TAB4-REG = WA_TAB3-REG.
    WA_TAB4-RM = WA_TAB3-RM.
    WA_TAB4-BZIRK = WA_TAB3-BZIRK.
    READ TABLE IT_ZDSMTER INTO WA_ZDSMTER WITH KEY BZIRK = WA_TAB3-RM ZDSM+0(2) = 'Z-'.
    IF SY-SUBRC EQ 0.
*      WRITE : 'ZM',WA_ZDSMTER-ZDSM.
      WA_TAB4-ZM = WA_ZDSMTER-ZDSM.
    ENDIF.
    COLLECT WA_TAB4 INTO IT_TAB4.
    CLEAR WA_TAB4.
  ENDLOOP.
  SORT IT_TAB4 BY REG RM BZIRK.
********************

**************************

  DELETE ADJACENT DUPLICATES FROM IT_TAB4 COMPARING REG RM BZIRK.

  SELECT * FROM ZSAMPPRDGRP INTO TABLE IT_ZSAMPPRDGRP FOR ALL ENTRIES IN IT_ZSAMPPOLICY WHERE ZMONTH EQ MONTH
    AND ZYEAR EQ YEAR AND ZGROUP EQ IT_ZSAMPPOLICY-ZGROUP.


  LOOP AT IT_ZSAMPPOLICY INTO WA_ZSAMPPOLICY.

    IF WA_ZSAMPPOLICY-COUNTRY EQ 'NP'.
      SELECT SINGLE * FROM ZSAMPNEPREG WHERE LAND1 EQ 'NP' AND MATNR EQ WA_ZSAMPPOLICY-SAMP_PRD AND T_DATE GE SY-DATUM.
      IF SY-SUBRC EQ 0.
        WA_TAG1-SAMP_PRD = WA_ZSAMPPOLICY-SAMP_PRD.
        WA_TAG1-DIV = WA_ZSAMPPOLICY-DIV.
        WA_TAG1-COUNTRY = WA_ZSAMPPOLICY-COUNTRY.
        WA_TAG1-DRP = WA_ZSAMPPOLICY-DRP.
        WA_TAG1-SALE_TYPE = WA_ZSAMPPOLICY-SALE_TYPE.
        WA_TAG1-SNO = WA_ZSAMPPOLICY-SNO.
        WA_TAG1-FROM_DT = WA_ZSAMPPOLICY-FROM_DT.
        WA_TAG1-ZGROUP = WA_ZSAMPPOLICY-ZGROUP.
        WA_TAG1-TOP1 = WA_ZSAMPPOLICY-TOP1.
        WA_TAG1-TOP2 = WA_ZSAMPPOLICY-TOP2.
        WA_TAG1-SQTY = WA_ZSAMPPOLICY-SQTY.
        WA_TAG1-USE_MONTH = WA_ZSAMPPOLICY-USE_MONTH.
        COLLECT WA_TAG1 INTO IT_TAG1.
        CLEAR WA_TAG1.
      ENDIF.
    ELSE.
      WA_TAG1-SAMP_PRD = WA_ZSAMPPOLICY-SAMP_PRD.
      WA_TAG1-DIV = WA_ZSAMPPOLICY-DIV.
      WA_TAG1-COUNTRY = WA_ZSAMPPOLICY-COUNTRY.
      WA_TAG1-DRP = WA_ZSAMPPOLICY-DRP.
      WA_TAG1-SALE_TYPE = WA_ZSAMPPOLICY-SALE_TYPE.
      WA_TAG1-SNO = WA_ZSAMPPOLICY-SNO.
      WA_TAG1-FROM_DT = WA_ZSAMPPOLICY-FROM_DT.
      WA_TAG1-ZGROUP = WA_ZSAMPPOLICY-ZGROUP.
      WA_TAG1-TOP1 = WA_ZSAMPPOLICY-TOP1.
      WA_TAG1-TOP2 = WA_ZSAMPPOLICY-TOP2.
      WA_TAG1-SQTY = WA_ZSAMPPOLICY-SQTY.
      WA_TAG1-USE_MONTH = WA_ZSAMPPOLICY-USE_MONTH.
      COLLECT WA_TAG1 INTO IT_TAG1.
      CLEAR WA_TAG1.
    ENDIF.

  ENDLOOP.

  LOOP AT IT_ZSAMPPRDGRP INTO WA_ZSAMPPRDGRP.
    READ TABLE IT_ZSAMPPOLICY INTO WA_ZSAMPPOLICY WITH KEY ZGROUP = WA_ZSAMPPRDGRP-ZGROUP.
    IF SY-SUBRC EQ 0.
      WA_TAD1-SAMP_PRD = WA_ZSAMPPOLICY-SAMP_PRD.
      WA_TAD1-DIV = WA_ZSAMPPOLICY-DIV.
      WA_TAD1-COUNTRY = WA_ZSAMPPOLICY-COUNTRY.
      WA_TAD1-DRP = WA_ZSAMPPOLICY-DRP.
      WA_TAD1-SALE_TYPE = WA_ZSAMPPOLICY-SALE_TYPE.
      WA_TAD1-SNO = WA_ZSAMPPOLICY-SNO.
      WA_TAD1-FROM_DT = WA_ZSAMPPOLICY-FROM_DT.
      WA_TAD1-ZGROUP = WA_ZSAMPPOLICY-ZGROUP.
      WA_TAD1-TOP1 = WA_ZSAMPPOLICY-TOP1.
      WA_TAD1-TOP2 = WA_ZSAMPPOLICY-TOP2.
      WA_TAD1-SQTY = WA_ZSAMPPOLICY-SQTY.
      WA_TAD1-USE_MONTH = WA_ZSAMPPOLICY-USE_MONTH.
      WA_TAD1-PRD_CODE = WA_ZSAMPPRDGRP-PRD_CODE.
      COLLECT WA_TAD1 INTO IT_TAD1.
      CLEAR WA_TAD1.
    ENDIF.
  ENDLOOP.


*  LOOP AT IT_TAD1 INTO WA_TAD1.
*    WRITE : / WA_TAD1-SAMP_PRD,WA_TAD1-DIV,WA_TAD1-COUNTRY,WA_TAD1-DRP,WA_TAD1-SALE_TYPE,WA_TAD1-SNO,WA_TAD1-ZGROUP,WA_TAD1-TOP1,WA_TAD1-TOP2,
*    WA_TAD1-SQTY,WA_TAD1-USE_MONTH,WA_TAD1-PRD_CODE.
*  ENDLOOP.
*  uline.
  IF IT_TAB4 IS NOT INITIAL.
    SELECT * FROM YTERRALLC INTO TABLE IT_YTERRALLC FOR ALL ENTRIES IN IT_TAB4 WHERE BZIRK EQ IT_TAB4-BZIRK AND ENDDA GE SY-DATUM.
    SELECT * FROM YTERRALLC INTO TABLE IT_YTERRALLC1 FOR ALL ENTRIES IN IT_TAB4 WHERE BZIRK EQ IT_TAB4-RM AND ENDDA GE SY-DATUM.
    SELECT * FROM YTERRALLC INTO TABLE IT_YTERRALLC2 FOR ALL ENTRIES IN IT_TAB4 WHERE BZIRK EQ IT_TAB4-ZM AND ENDDA GE SY-DATUM.
    SELECT * FROM YTERRALLC INTO TABLE IT_YTERRALLC3 FOR ALL ENTRIES IN IT_TAB4 WHERE BZIRK EQ IT_TAB4-REG AND ENDDA GE SY-DATUM.
    SELECT * FROM PA0001 INTO TABLE IT_PA0001 WHERE ENDDA GE SY-DATUM AND PLANS NE '99999999' AND ABKRS EQ '12'.
    IF SY-SUBRC EQ 0.
      SELECT * FROM PA0302 INTO TABLE IT_PA0302 FOR ALL ENTRIES IN IT_PA0001 WHERE PERNR = IT_PA0001-PERNR AND MASSN EQ '01' AND BEGDA LE DOJ.
    ENDIF.
  ENDIF.
  PERFORM EXCLUDE.
  PERFORM SALEV.  " vacant territories retained
  PERFORM PROC.
  EXIT.
ENDFORM.                    "DATA

*&---------------------------------------------------------------------*
*&      Form  data1
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
FORM DATA1.
  CLEAR : IT_ZSAMPPOLICY, IT_ZDSMTER,IT_ZSAMPPRDGRP.

****************if data already exist in zsampinvh the do not process********
*  select * FROM zsampinvh INTO TABLE it_zsampinvh WHERE zmonth eq month AND zyear eq year.
*  if it_zsampinvh IS NOT INITIAL.
  SELECT SINGLE * FROM ZSAMPPROCESS WHERE ZMONTH EQ MONTH AND ZYEAR EQ YEAR AND INVQTY GT 0.
*  if sy-subrc eq 0.
*    message 'DATA FOR THIS MONTH & YEAR IS ALREADY PROCESSED & INVOICED' type 'E'.
*    exit.
*  endif.
  SELECT * FROM ZSAMPPOLICY INTO TABLE IT_ZSAMPPOLICY WHERE ZMONTH EQ MONTH AND ZYEAR EQ YEAR AND SAMP_PRD IN MATERIAL.
  IF SY-SUBRC NE 0.
    MESSAGE 'NO POLICY DATA FOUND IN ZSAMPPOLICY FOR THIS MONTH' TYPE 'E'.
    EXIT.
  ENDIF.

  SELECT * FROM ZDSMTER INTO TABLE IT_ZDSMTER WHERE ZMONTH EQ MONTH AND ZYEAR EQ YEAR.
  IF SY-SUBRC NE 0.
    MESSAGE 'NO DATA FOUND IN ZDSMTER FOR THIS MONTH' TYPE 'E'.
    EXIT.
  ENDIF.


  LOOP AT IT_ZDSMTER INTO WA_ZDSMTER WHERE ZDSM+0(2) CS 'D-'.
    WA_TAB1-REG = WA_ZDSMTER-ZDSM.
    COLLECT WA_TAB1 INTO IT_TAB1.
    CLEAR WA_TAB1.
  ENDLOOP.


  LOOP AT IT_TAB1 INTO WA_TAB1.
*    WRITE : / WA_TAB1-REG.
    LOOP AT IT_ZDSMTER INTO WA_ZDSMTER WHERE ZDSM EQ WA_TAB1-REG AND BZIRK+0(2) = 'R-'..
*      WRITE : / 'RM',wa_zdsmter-BZIRK.
      WA_TAB2-REG = WA_TAB1-REG.
      WA_TAB2-RM = WA_ZDSMTER-BZIRK.
      COLLECT WA_TAB2 INTO IT_TAB2.
      CLEAR WA_TAB2.
    ENDLOOP.
  ENDLOOP.

  LOOP AT IT_TAB2 INTO WA_TAB2.
    SELECT * FROM ZDSMTER WHERE ZDSM EQ WA_TAB2-RM AND ZMONTH EQ MONTH AND ZYEAR EQ YEAR.
      IF SY-SUBRC EQ 0.
        WA_TAB3-REG = WA_TAB2-REG.
        WA_TAB3-RM = WA_TAB2-RM.
        WA_TAB3-BZIRK = ZDSMTER-BZIRK.
        COLLECT WA_TAB3 INTO IT_TAB3.
        CLEAR WA_TAB3.

        WA_DIV1-REG = WA_TAB2-REG.
        WA_DIV1-RM = WA_TAB2-RM.
        WA_DIV1-BZIRK = ZDSMTER-BZIRK.
        WA_DIV1-SPART = ZDSMTER-SPART.
        COLLECT WA_DIV1 INTO IT_DIV1.
        CLEAR WA_DIV1.
      ENDIF.
    ENDSELECT.
  ENDLOOP.

  LOOP AT IT_DIV1 INTO WA_DIV1.
*    WRITE : / '**',wa_div1-reg,wa_div1-rm,wa_div1-bzirk.
    WA_DIV2-REG = WA_DIV1-REG.
    WA_DIV2-RM = WA_DIV1-RM.
    WA_DIV2-BZIRK = WA_DIV1-BZIRK.
    WA_DIV2-SPART = WA_DIV1-SPART.
    READ TABLE IT_ZDSMTER INTO WA_ZDSMTER WITH KEY BZIRK = WA_DIV1-RM ZDSM+0(2) = 'Z-'.
    IF SY-SUBRC EQ 0.
*      WRITE : 'ZM',WA_ZDSMTER-ZDSM.
      WA_DIV2-ZM = WA_ZDSMTER-ZDSM.
    ENDIF.
    COLLECT WA_DIV2 INTO IT_DIV2.
    CLEAR WA_DIV2.
  ENDLOOP.

  LOOP AT IT_TAB3 INTO WA_TAB3.
*    WRITE : / '**',wa_TAB3-reg,wa_TAB3-rm,wa_TAB3-bzirk.
    WA_TAB4-REG = WA_TAB3-REG.
    WA_TAB4-RM = WA_TAB3-RM.
    WA_TAB4-BZIRK = WA_TAB3-BZIRK.
    READ TABLE IT_ZDSMTER INTO WA_ZDSMTER WITH KEY BZIRK = WA_TAB3-RM ZDSM+0(2) = 'Z-'.
    IF SY-SUBRC EQ 0.
*      WRITE : 'ZM',WA_ZDSMTER-ZDSM.
      WA_TAB4-ZM = WA_ZDSMTER-ZDSM.
    ENDIF.
    COLLECT WA_TAB4 INTO IT_TAB4.
    CLEAR WA_TAB4.
  ENDLOOP.

  LOOP AT IT_ZSAMPPOLICY INTO WA_ZSAMPPOLICY.
    IF WA_ZSAMPPOLICY-COUNTRY EQ 'NP'.
      SELECT SINGLE * FROM ZSAMPNEPREG WHERE LAND1 EQ 'NP' AND MATNR EQ WA_ZSAMPPOLICY-SAMP_PRD AND T_DATE GE SY-DATUM.
      IF SY-SUBRC EQ 0.
        WA_TAG1-ZMONTH = WA_ZSAMPPOLICY-ZMONTH.
        WA_TAG1-ZYEAR = WA_ZSAMPPOLICY-ZYEAR.
        WA_TAG1-SAMP_PRD = WA_ZSAMPPOLICY-SAMP_PRD.
        WA_TAG1-DIV = WA_ZSAMPPOLICY-DIV.
        WA_TAG1-COUNTRY = WA_ZSAMPPOLICY-COUNTRY.
        WA_TAG1-DRP = WA_ZSAMPPOLICY-DRP.
        WA_TAG1-SALE_TYPE = WA_ZSAMPPOLICY-SALE_TYPE.
        WA_TAG1-SNO = WA_ZSAMPPOLICY-SNO.
        WA_TAG1-FROM_DT = WA_ZSAMPPOLICY-FROM_DT.
        WA_TAG1-ZGROUP = WA_ZSAMPPOLICY-ZGROUP.
        WA_TAG1-TOP1 = WA_ZSAMPPOLICY-TOP1.
        WA_TAG1-TOP2 = WA_ZSAMPPOLICY-TOP2.
        WA_TAG1-SQTY = WA_ZSAMPPOLICY-SQTY.
        WA_TAG1-USE_MONTH = WA_ZSAMPPOLICY-USE_MONTH.
        COLLECT WA_TAG1 INTO IT_TAG1.
        CLEAR WA_TAG1.
        WA_PRD1-SAMP_PRD = WA_ZSAMPPOLICY-SAMP_PRD.
        COLLECT WA_PRD1 INTO IT_PRD1.
        CLEAR WA_PRD1.
      ENDIF.
    ELSE.
      WA_TAG1-ZMONTH = WA_ZSAMPPOLICY-ZMONTH.
      WA_TAG1-ZYEAR = WA_ZSAMPPOLICY-ZYEAR.
      WA_TAG1-SAMP_PRD = WA_ZSAMPPOLICY-SAMP_PRD.
      WA_TAG1-DIV = WA_ZSAMPPOLICY-DIV.
      WA_TAG1-COUNTRY = WA_ZSAMPPOLICY-COUNTRY.
      WA_TAG1-DRP = WA_ZSAMPPOLICY-DRP.
      WA_TAG1-SALE_TYPE = WA_ZSAMPPOLICY-SALE_TYPE.
      WA_TAG1-SNO = WA_ZSAMPPOLICY-SNO.
      WA_TAG1-FROM_DT = WA_ZSAMPPOLICY-FROM_DT.
      WA_TAG1-ZGROUP = WA_ZSAMPPOLICY-ZGROUP.
      WA_TAG1-TOP1 = WA_ZSAMPPOLICY-TOP1.
      WA_TAG1-TOP2 = WA_ZSAMPPOLICY-TOP2.
      WA_TAG1-SQTY = WA_ZSAMPPOLICY-SQTY.
      WA_TAG1-USE_MONTH = WA_ZSAMPPOLICY-USE_MONTH.
      COLLECT WA_TAG1 INTO IT_TAG1.
      CLEAR WA_TAG1.
      WA_PRD1-SAMP_PRD = WA_ZSAMPPOLICY-SAMP_PRD.
      COLLECT WA_PRD1 INTO IT_PRD1.
      CLEAR WA_PRD1.
    ENDIF.
  ENDLOOP.
  SORT IT_PRD1 BY SAMP_PRD.
  DELETE ADJACENT DUPLICATES FROM IT_PRD1 COMPARING SAMP_PRD.

  IF IT_ZSAMPPOLICY IS NOT INITIAL.
    SELECT * FROM ZSAMPPRDGRP INTO TABLE IT_ZSAMPPRDGRP FOR ALL ENTRIES IN IT_ZSAMPPOLICY WHERE ZMONTH EQ MONTH
      AND ZYEAR EQ YEAR AND ZGROUP EQ IT_ZSAMPPOLICY-ZGROUP.
  ENDIF.

  LOOP AT IT_ZSAMPPRDGRP INTO WA_ZSAMPPRDGRP .
    READ TABLE IT_ZSAMPPOLICY INTO WA_ZSAMPPOLICY WITH KEY ZGROUP = WA_ZSAMPPRDGRP-ZGROUP.
    IF SY-SUBRC EQ 0.
      WA_TAD1-ZMONTH = WA_ZSAMPPOLICY-ZMONTH.
      WA_TAD1-ZYEAR = WA_ZSAMPPOLICY-ZYEAR.
      WA_TAD1-SAMP_PRD = WA_ZSAMPPOLICY-SAMP_PRD.
      WA_TAD1-DIV = WA_ZSAMPPOLICY-DIV.
      WA_TAD1-COUNTRY = WA_ZSAMPPOLICY-COUNTRY.
      WA_TAD1-DRP = WA_ZSAMPPOLICY-DRP.
      WA_TAD1-SALE_TYPE = WA_ZSAMPPOLICY-SALE_TYPE.
      WA_TAD1-SNO = WA_ZSAMPPOLICY-SNO.
      WA_TAD1-FROM_DT = WA_ZSAMPPOLICY-FROM_DT.
      WA_TAD1-ZGROUP = WA_ZSAMPPOLICY-ZGROUP.
      WA_TAD1-TOP1 = WA_ZSAMPPOLICY-TOP1.
      WA_TAD1-TOP2 = WA_ZSAMPPOLICY-TOP2.
      WA_TAD1-SQTY = WA_ZSAMPPOLICY-SQTY.
      WA_TAD1-USE_MONTH = WA_ZSAMPPOLICY-USE_MONTH.
      WA_TAD1-PRD_CODE = WA_ZSAMPPRDGRP-PRD_CODE.
      COLLECT WA_TAD1 INTO IT_TAD1.
      CLEAR WA_TAD1.
    ENDIF.
  ENDLOOP.


*  LOOP AT IT_TAD1 INTO WA_TAD1.
*    WRITE : / WA_TAD1-SAMP_PRD,WA_TAD1-DIV,WA_TAD1-COUNTRY,WA_TAD1-DRP,WA_TAD1-SALE_TYPE,WA_TAD1-SNO,WA_TAD1-ZGROUP,WA_TAD1-TOP1,WA_TAD1-TOP2,
*    WA_TAD1-SQTY,WA_TAD1-USE_MONTH,WA_TAD1-PRD_CODE.
*  ENDLOOP.
*  uline.
  IF IT_TAB4 IS NOT INITIAL.
    SELECT * FROM YTERRALLC INTO TABLE IT_YTERRALLC FOR ALL ENTRIES IN IT_TAB4 WHERE BZIRK EQ IT_TAB4-BZIRK AND ENDDA GE SY-DATUM.
    SELECT * FROM YTERRALLC INTO TABLE IT_YTERRALLC1 FOR ALL ENTRIES IN IT_TAB4 WHERE BZIRK EQ IT_TAB4-RM AND ENDDA GE SY-DATUM.
    SELECT * FROM YTERRALLC INTO TABLE IT_YTERRALLC2 FOR ALL ENTRIES IN IT_TAB4 WHERE BZIRK EQ IT_TAB4-ZM AND ENDDA GE SY-DATUM.
    SELECT * FROM YTERRALLC INTO TABLE IT_YTERRALLC3 FOR ALL ENTRIES IN IT_TAB4 WHERE BZIRK EQ IT_TAB4-REG AND ENDDA GE SY-DATUM.
    SELECT * FROM PA0001 INTO TABLE IT_PA0001 WHERE ENDDA GE SY-DATUM AND PLANS NE '99999999' AND ABKRS EQ '12'.
    IF SY-SUBRC EQ 0.
      SELECT * FROM PA0302 INTO TABLE IT_PA0302 FOR ALL ENTRIES IN IT_PA0001 WHERE PERNR = IT_PA0001-PERNR AND MASSN EQ '01' AND BEGDA LE DOJ.
    ENDIF.
  ENDIF.


  PERFORM EXCLUDE.
  PERFORM SALEP.
  PERFORM PROC1.
  EXIT.
ENDFORM.                    "DATA1

*&---------------------------------------------------------------------*
*&      Form  PROC1
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
FORM PROC1.
  SORT  IT_YTERRALLC BY BZIRK SPART.
  SORT  IT_YTERRALLC1 BY BZIRK SPART.
  SORT  IT_YTERRALLC2 BY BZIRK SPART.
  SORT  IT_YTERRALLC3 BY BZIRK SPART.
  SORT IT_REG1 BY BZIRK DIV.
  SORT IT_RM1 BY BZIRK DIV.
  SORT IT_ZM1 BY BZIRK DIV.
  SORT IT_PPSO1 BY REG BZIRK DIV.
*  break-point .
  SORT IT_TAG1 BY ZMONTH ZYEAR SAMP_PRD SNO.
  LOOP AT IT_TAG1 INTO WA_TAG1 WHERE SAMP_PRD GE '000000000000800001'.
    IF R2 EQ 'X'.
      IF WA_TAG1-DRP EQ 'P' AND WA_TAG1-SALE_TYPE EQ 'P'.
        PERFORM PP.
      ENDIF.
    ELSEIF R3 EQ 'X'.
      IF WA_TAG1-DRP EQ 'R' AND WA_TAG1-SALE_TYPE EQ 'P' .
        PERFORM RP.
      ELSEIF WA_TAG1-DRP EQ 'Z' AND WA_TAG1-SALE_TYPE EQ 'P'.
        PERFORM ZP.
      ELSEIF WA_TAG1-DRP EQ 'D' AND WA_TAG1-SALE_TYPE EQ 'P' .
        PERFORM DP.
      ENDIF.
    ENDIF.
  ENDLOOP.

*  BREAK-POINT.
  MESSAGE 'DATA UPDATED IN ZSAMPPROCESS' TYPE 'I'.
  LEAVE TO TRANSACTION 'ZSAMPPROCESS'.
  EXIT.

ENDFORM.                    "DATA



*&---------------------------------------------------------------------*
*&      Form  proc
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
FORM PROC.
  SORT  IT_YTERRALLC BY BZIRK SPART.
  SORT  IT_YTERRALLC1 BY BZIRK SPART.
  SORT  IT_YTERRALLC2 BY BZIRK SPART.
  SORT  IT_YTERRALLC3 BY BZIRK SPART.
  SORT IT_REG1 BY BZIRK DIV.
  SORT IT_RM1 BY BZIRK DIV.
  SORT IT_ZM1 BY BZIRK DIV.

  SORT IT_PSO1 BY REG BZIRK DIV.
  SORT IT_TAG1 BY ZMONTH ZYEAR SAMP_PRD SNO.

  LOOP AT IT_TAG1 INTO WA_TAG1 WHERE SAMP_PRD GE '000000000000800001'.
    IF WA_TAG1-DRP EQ 'P' AND WA_TAG1-SALE_TYPE EQ 'V' .
      PERFORM PV.
    ELSEIF WA_TAG1-DRP EQ 'R' AND WA_TAG1-SALE_TYPE EQ 'V' .
      PERFORM RV.
    ELSEIF WA_TAG1-DRP EQ 'Z' AND WA_TAG1-SALE_TYPE EQ 'V' .
      PERFORM ZV.
    ELSEIF WA_TAG1-DRP EQ 'D' AND WA_TAG1-SALE_TYPE EQ 'V' .
      PERFORM DV.
    ELSEIF WA_TAG1-DRP EQ 'P' AND WA_TAG1-SALE_TYPE EQ 'A' .
      PERFORM PA.
    ELSEIF WA_TAG1-DRP EQ 'R' AND WA_TAG1-SALE_TYPE EQ 'A' .
      PERFORM RA.
    ELSEIF WA_TAG1-DRP EQ 'Z' AND WA_TAG1-SALE_TYPE EQ 'A' .
      PERFORM ZA.
    ELSEIF WA_TAG1-DRP EQ 'D' AND WA_TAG1-SALE_TYPE EQ 'A' .
      PERFORM DA.
*      elseif wa_tag1-drp eq 'A' .
*      PERFORM AA.
    ENDIF.
  ENDLOOP.

*  break-point.
  MESSAGE 'DATA UPDATED IN ZSAMPPROCESS' TYPE 'I'.
  LEAVE TO TRANSACTION 'ZSAMPPROCESS'.
  EXIT.

ENDFORM.                    "DATA1

*&---------------------------------------------------------------------*
*&      Form  PP
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
FORM PP.
  CLEAR DIV.

  COUNT1 = COUNT1 + 1.
  COUNT = 1.
  IF WA_TAG1-DIV EQ '00'.
*    SELECT SINGLE * FROM MARA WHERE MATNR EQ WA_TAG1-SAMP_PRD.
*    IF SY-SUBRC EQ 0.
*      IF MARA-SPART EQ '50'.
*        DIV = 'BC'.
*      ELSEIF MARA-SPART EQ '60'.
*        DIV = 'XL'.
*      ELSEIF MARA-SPART EQ '70'.
*        DIV = 'LS'.
*      ENDIF.
*    ENDIF.
    SELECT SINGLE * FROM ZSAMP_PRD WHERE PRD_CODE EQ WA_TAG1-SAMP_PRD.
    IF SY-SUBRC EQ 0.
      IF ZSAMP_PRD-GRP_DIV EQ '50'.
        DIV = 'BC'.
      ELSEIF ZSAMP_PRD-GRP_DIV EQ '60'.
        DIV = 'XL'.
      ELSEIF ZSAMP_PRD-GRP_DIV EQ '70'.
        DIV = 'LS'.
      ENDIF.
    ENDIF.
    LOOP AT IT_PPSO1 ASSIGNING <FS_TAS1> WHERE SAMP_PRD EQ WA_TAG1-SAMP_PRD AND ( ( DIV EQ DIV ) OR ( DIV EQ 'BCL' ) ).
      IF WA_TAG1-FROM_DT EQ 0.
        IF WA_TAG1-COUNTRY EQ 'NP'.
          IF <FS_TAS1>-REG EQ 'D-KHAT'.
            WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
            WA_TOP1-BZIRK = <FS_TAS1>-BZIRK.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
          IF <FS_TAS1>-REG NE 'D-KHAT'.
            WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
            WA_TOP1-BZIRK = <FS_TAS1>-BZIRK.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
          WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
          WA_TOP1-BZIRK = <FS_TAS1>-BZIRK.
          WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
          COLLECT WA_TOP1 INTO IT_TOP1.
          CLEAR WA_TOP1.
        ENDIF.
      ELSE.
        IF WA_TAG1-FROM_DT LE <FS_TAS1>-DOJ.
          IF WA_TAG1-COUNTRY EQ 'NP'.
            IF <FS_TAS1>-REG EQ 'D-KHAT'.
              WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
              WA_TOP1-BZIRK = <FS_TAS1>-BZIRK.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
            IF <FS_TAS1>-REG NE 'D-KHAT'.
              WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
              WA_TOP1-BZIRK = <FS_TAS1>-BZIRK.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
            WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
            WA_TOP1-BZIRK = <FS_TAS1>-BZIRK.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ENDIF.
      ENDIF.
    ENDLOOP.
  ELSEIF WA_TAG1-DIV EQ '50'.
    LOOP AT IT_PPSO1 ASSIGNING <FS_TAS1> WHERE SAMP_PRD EQ WA_TAG1-SAMP_PRD AND DIV EQ 'BC'.
      IF WA_TAG1-FROM_DT EQ 0.
        IF WA_TAG1-COUNTRY EQ 'NP'.
          IF <FS_TAS1>-REG EQ 'D-KHAT'.
            WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
            WA_TOP1-BZIRK = <FS_TAS1>-BZIRK.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
          IF <FS_TAS1>-REG NE 'D-KHAT'.
            WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
            WA_TOP1-BZIRK = <FS_TAS1>-BZIRK.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
          WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
          WA_TOP1-BZIRK = <FS_TAS1>-BZIRK.
          WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
          COLLECT WA_TOP1 INTO IT_TOP1.
          CLEAR WA_TOP1.
        ENDIF.
      ELSE.
        IF WA_TAG1-FROM_DT LE <FS_TAS1>-DOJ.
          IF WA_TAG1-COUNTRY EQ 'NP'.
            IF <FS_TAS1>-REG EQ 'D-KHAT'.
              WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
              WA_TOP1-BZIRK = <FS_TAS1>-BZIRK.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
            IF <FS_TAS1>-REG NE 'D-KHAT'.
              WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
              WA_TOP1-BZIRK = <FS_TAS1>-BZIRK.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
            WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
            WA_TOP1-BZIRK = <FS_TAS1>-BZIRK.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ENDIF.
      ENDIF.
    ENDLOOP.
****************************************
  ELSEIF WA_TAG1-DIV EQ '60'.
    LOOP AT IT_PPSO1 ASSIGNING <FS_TAS1> WHERE SAMP_PRD EQ WA_TAG1-SAMP_PRD AND DIV EQ 'XL'.
      IF WA_TAG1-FROM_DT EQ 0.
        IF WA_TAG1-COUNTRY EQ 'NP'.
          IF <FS_TAS1>-REG EQ 'D-KHAT'.
            WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
            WA_TOP1-BZIRK = <FS_TAS1>-BZIRK.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
          IF <FS_TAS1>-REG NE 'D-KHAT'.
            WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
            WA_TOP1-BZIRK = <FS_TAS1>-BZIRK.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
          WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
          WA_TOP1-BZIRK = <FS_TAS1>-BZIRK.
          WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
          COLLECT WA_TOP1 INTO IT_TOP1.
          CLEAR WA_TOP1.
        ENDIF.
      ELSE.
        IF WA_TAG1-FROM_DT LE <FS_TAS1>-DOJ.
          IF WA_TAG1-COUNTRY EQ 'NP'.
            IF <FS_TAS1>-REG EQ 'D-KHAT'.
              WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
              WA_TOP1-BZIRK = <FS_TAS1>-BZIRK.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
            IF <FS_TAS1>-REG NE 'D-KHAT'.
              WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
              WA_TOP1-BZIRK = <FS_TAS1>-BZIRK.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
            WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
            WA_TOP1-BZIRK = <FS_TAS1>-BZIRK.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ENDIF.
      ENDIF.
    ENDLOOP.

**************************
  ELSEIF WA_TAG1-DIV EQ '70'.
    LOOP AT IT_PPSO1 ASSIGNING <FS_TAS1> WHERE SAMP_PRD EQ WA_TAG1-SAMP_PRD AND DIV EQ 'LS'.
      IF WA_TAG1-FROM_DT EQ 0.
        IF WA_TAG1-COUNTRY EQ 'NP'.
          IF <FS_TAS1>-REG EQ 'D-KHAT'.
            WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
            WA_TOP1-BZIRK = <FS_TAS1>-BZIRK.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
          IF <FS_TAS1>-REG NE 'D-KHAT'.
            WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
            WA_TOP1-BZIRK = <FS_TAS1>-BZIRK.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
          WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
          WA_TOP1-BZIRK = <FS_TAS1>-BZIRK.
          WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
          COLLECT WA_TOP1 INTO IT_TOP1.
          CLEAR WA_TOP1.
        ENDIF.
      ELSE.
        IF WA_TAG1-FROM_DT LE <FS_TAS1>-DOJ.
          IF WA_TAG1-COUNTRY EQ 'NP'.
            IF <FS_TAS1>-REG EQ 'D-KHAT'.
              WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
              WA_TOP1-BZIRK = <FS_TAS1>-BZIRK.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
            IF <FS_TAS1>-REG NE 'D-KHAT'.
              WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
              WA_TOP1-BZIRK = <FS_TAS1>-BZIRK.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
            WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
            WA_TOP1-BZIRK = <FS_TAS1>-BZIRK.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ENDIF.
      ENDIF.
    ENDLOOP.
******************************
****************************************************************
  ELSEIF WA_TAG1-DIV EQ '99'.
    LOOP AT IT_PPSO1 ASSIGNING <FS_TAS1> WHERE SAMP_PRD EQ WA_TAG1-SAMP_PRD AND DIV EQ 'BCL'.
      IF WA_TAG1-FROM_DT EQ 0.
        IF WA_TAG1-COUNTRY EQ 'NP'.
          IF <FS_TAS1>-REG EQ 'D-KHAT'.
            WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
            WA_TOP1-BZIRK = <FS_TAS1>-BZIRK.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
          IF <FS_TAS1>-REG NE 'D-KHAT'.
            WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
            WA_TOP1-BZIRK = <FS_TAS1>-BZIRK.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
          WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
          WA_TOP1-BZIRK = <FS_TAS1>-BZIRK.
          WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
          COLLECT WA_TOP1 INTO IT_TOP1.
          CLEAR WA_TOP1.
        ENDIF.
      ELSE.
        IF WA_TAG1-FROM_DT LE <FS_TAS1>-DOJ.
          IF WA_TAG1-COUNTRY EQ 'NP'.
            IF <FS_TAS1>-REG EQ 'D-KHAT'.
              WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
              WA_TOP1-BZIRK = <FS_TAS1>-BZIRK.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
            IF <FS_TAS1>-REG NE 'D-KHAT'.
              WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
              WA_TOP1-BZIRK = <FS_TAS1>-BZIRK.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
            WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
            WA_TOP1-BZIRK = <FS_TAS1>-BZIRK.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ENDIF.
      ENDIF.
    ENDLOOP.
  ENDIF.

  SORT IT_TOP1 DESCENDING BY NETVAL.
  LOOP AT IT_TOP1 ASSIGNING <FS_TOP1> WHERE SAMP_PRD EQ WA_TAG1-SAMP_PRD.
    READ TABLE IT_EX1 INTO WA_EX1 WITH KEY BZIRK = <FS_TOP1>-BZIRK MATNR = <FS_TOP1>-SAMP_PRD.
    IF SY-SUBRC NE 0.
*    WRITE : / 'P-PSO',<FS_TOP1>-BZIRK,<FS_TOP1>-NETVAL,COUNT.
      WA_TOP2-SAMP_PRD = <FS_TOP1>-SAMP_PRD.
      WA_TOP2-BZIRK = <FS_TOP1>-BZIRK.
      WA_TOP2-NETVAL = <FS_TOP1>-NETVAL.
      WA_TOP2-COUNT = COUNT.
      COLLECT WA_TOP2 INTO IT_TOP2.
      CLEAR WA_TOP2.
      COUNT = COUNT + 1.
    ENDIF.
  ENDLOOP.

  LOOP AT IT_TOP2 INTO WA_TOP2 WHERE SAMP_PRD EQ WA_TAG1-SAMP_PRD AND COUNT GE WA_TAG1-TOP1 AND COUNT LE WA_TAG1-TOP2 AND BZIRK NE '      '.
    CLEAR : DIV1,DCOUNT.
*    WRITE : / '****P-PSO',<FS_TOP1>-BZIRK,<FS_TOP1>-NETVAL,<FS_TOP1>-COUNT.
*    wa_tag1-top1,wa_tag1-top2.
*    READ TABLE IT_DIV2 INTO WA_DIV2 WITH KEY BZIRK = WA_TOP2-BZIRK SPART = '50'.
*    IF SY-SUBRC EQ 0.
*      READ TABLE IT_DIV2 INTO WA_DIV2 WITH KEY BZIRK = WA_TOP2-BZIRK SPART = '60'.
*      IF SY-SUBRC EQ 0.
*        DIV1 = '99'.
*      ELSE.
*        DIV1 = '50'.
*      ENDIF.
*    ELSE.
*      DIV1 = '60'.
*    ENDIF.
    READ TABLE IT_DIV2 INTO WA_DIV2 WITH KEY BZIRK = WA_TOP2-BZIRK SPART = '50'.
    IF SY-SUBRC EQ 0.
      DIV1 = '50'.
      DCOUNT = DCOUNT + 1.
    ENDIF.
    READ TABLE IT_DIV2 INTO WA_DIV2 WITH KEY BZIRK = WA_TOP2-BZIRK SPART = '60'.
    IF SY-SUBRC EQ 0.
      DIV1 = '60'.
      DCOUNT = DCOUNT + 1.
    ENDIF.
    READ TABLE IT_DIV2 INTO WA_DIV2 WITH KEY BZIRK = WA_TOP2-BZIRK SPART = '70'.
    IF SY-SUBRC EQ 0.
      DIV1 = '70'.
      DCOUNT = DCOUNT + 1.
    ENDIF.
    IF DCOUNT GT 1.
      DIV1 = '99'.
    ENDIF.

    ZSAMPPROCESS_WA-ZMONTH = WA_TAG1-ZMONTH.
    ZSAMPPROCESS_WA-ZYEAR = WA_TAG1-ZYEAR.
    ZSAMPPROCESS_WA-BZIRK = WA_TOP2-BZIRK.
    ZSAMPPROCESS_WA-SAMPCODE = WA_TAG1-SAMP_PRD.
    ZSAMPPROCESS_WA-DIV = DIV1.
    ZSAMPPROCESS_WA-SAMPQTY = WA_TAG1-SQTY.
    MODIFY ZSAMPPROCESS FROM ZSAMPPROCESS_WA.
    CLEAR : ZSAMPPROCESS_WA.
*    collect zsampprocess_wa into it_zsampprocess_wa.
*    clear : zsampprocess_wa.
  ENDLOOP.
*  modify zsampprocess from table it_zsampprocess_wa.
*  commit work and wait .
  CLEAR : IT_ZSAMPPROCESS_WA.
  CLEAR : IT_TOP2,IT_TOP1.

ENDFORM.                    "PP
*&---------------------------------------------------------------------*
*&      Form  RP
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
FORM RP.
  CLEAR DIV.
  FORMAT COLOR 3.
*  WRITE : / 'A',WA_TAG1-SAMP_PRD,WA_TAG1-DIV,WA_TAG1-COUNTRY,WA_TAG1-DRP,WA_TAG1-SALE_TYPE,WA_TAG1-ZGROUP,WA_TAG1-TOP1,
*  WA_TAG1-TOP2,WA_TAG1-SQTY,WA_TAG1-USE_MONTH,WA_TAG1-PRD_CODE,count1.
  COUNT1 = COUNT1 + 1.
*  if wa_tag1-sno eq '1'.
  COUNT = 1.
*  ENDIF.
  IF WA_TAG1-DIV EQ '00'.
*    SELECT SINGLE * FROM MARA WHERE MATNR EQ WA_TAG1-SAMP_PRD.
*    IF SY-SUBRC EQ 0.
*      IF MARA-SPART EQ '50'.
*        DIV = 'BC'.
*      ELSEIF MARA-SPART EQ '60'.
*        DIV = 'XL'.
*      ELSEIF MARA-SPART EQ '70'.
*        DIV = 'LS'.
*      ENDIF.
*    ENDIF.
    SELECT SINGLE * FROM ZSAMP_PRD WHERE PRD_CODE EQ WA_TAG1-SAMP_PRD.
    IF SY-SUBRC EQ 0.
      IF ZSAMP_PRD-GRP_DIV EQ '50'.
        DIV = 'BC'.
      ELSEIF ZSAMP_PRD-GRP_DIV EQ '60'.
        DIV = 'XL'.
      ELSEIF ZSAMP_PRD-GRP_DIV EQ '70'.
        DIV = 'LS'.
      ENDIF.
    ENDIF.


    FORMAT COLOR 4.
    LOOP AT IT_PRM1 ASSIGNING <FS_TAS1> WHERE SAMP_PRD EQ WA_TAG1-SAMP_PRD AND ( ( DIV EQ DIV ) OR ( DIV EQ 'BCL' ) ).
      IF WA_TAG1-FROM_DT EQ 0.
        IF WA_TAG1-COUNTRY EQ 'NP'.
          IF <FS_TAS1>-REG EQ 'D-KHAT'.
            WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
            WA_TOP1-BZIRK = <FS_TAS1>-RM.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
          IF <FS_TAS1>-REG NE 'D-KHAT'.
            WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
            WA_TOP1-BZIRK = <FS_TAS1>-RM.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
          WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
          WA_TOP1-BZIRK = <FS_TAS1>-RM.
          WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
          COLLECT WA_TOP1 INTO IT_TOP1.
          CLEAR WA_TOP1.
        ENDIF.
      ELSE.
        IF WA_TAG1-FROM_DT LE <FS_TAS1>-DOJ.
          IF WA_TAG1-COUNTRY EQ 'NP'.
            IF <FS_TAS1>-REG EQ 'D-KHAT'.
              WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
              WA_TOP1-BZIRK = <FS_TAS1>-RM.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
            IF <FS_TAS1>-REG NE 'D-KHAT'.
              WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
              WA_TOP1-BZIRK = <FS_TAS1>-RM.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
            WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
            WA_TOP1-BZIRK = <FS_TAS1>-RM.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ENDIF.
      ENDIF.
    ENDLOOP.
  ELSEIF WA_TAG1-DIV EQ '50'.
    LOOP AT IT_PRM1 ASSIGNING <FS_TAS1> WHERE SAMP_PRD EQ WA_TAG1-SAMP_PRD AND DIV EQ 'BC'.
      IF WA_TAG1-FROM_DT EQ 0.
        IF WA_TAG1-COUNTRY EQ 'NP'.
          IF <FS_TAS1>-REG EQ 'D-KHAT'.
            WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
            WA_TOP1-BZIRK = <FS_TAS1>-RM.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
          IF <FS_TAS1>-REG NE 'D-KHAT'.
            WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
            WA_TOP1-BZIRK = <FS_TAS1>-RM.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
          WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
          WA_TOP1-BZIRK = <FS_TAS1>-RM.
          WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
          COLLECT WA_TOP1 INTO IT_TOP1.
          CLEAR WA_TOP1.
        ENDIF.
      ELSE.
        IF WA_TAG1-FROM_DT LE <FS_TAS1>-DOJ.
          IF WA_TAG1-COUNTRY EQ 'NP'.
            IF <FS_TAS1>-REG EQ 'D-KHAT'.
              WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
              WA_TOP1-BZIRK = <FS_TAS1>-RM.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
            IF <FS_TAS1>-REG NE 'D-KHAT'.
              WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
              WA_TOP1-BZIRK = <FS_TAS1>-RM.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
            WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
            WA_TOP1-BZIRK = <FS_TAS1>-RM.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ENDIF.
      ENDIF.
    ENDLOOP.
************************************************
  ELSEIF WA_TAG1-DIV EQ '60'.
    LOOP AT IT_PRM1 ASSIGNING <FS_TAS1> WHERE SAMP_PRD EQ WA_TAG1-SAMP_PRD AND DIV EQ 'XL'.
      IF WA_TAG1-FROM_DT EQ 0.
        IF WA_TAG1-COUNTRY EQ 'NP'.
          IF <FS_TAS1>-REG EQ 'D-KHAT'.
            WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
            WA_TOP1-BZIRK = <FS_TAS1>-RM.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
          IF <FS_TAS1>-REG NE 'D-KHAT'.
            WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
            WA_TOP1-BZIRK = <FS_TAS1>-RM.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
          WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
          WA_TOP1-BZIRK = <FS_TAS1>-RM.
          WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
          COLLECT WA_TOP1 INTO IT_TOP1.
          CLEAR WA_TOP1.
        ENDIF.
      ELSE.
        IF WA_TAG1-FROM_DT LE <FS_TAS1>-DOJ.
          IF WA_TAG1-COUNTRY EQ 'NP'.
            IF <FS_TAS1>-REG EQ 'D-KHAT'.
              WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
              WA_TOP1-BZIRK = <FS_TAS1>-RM.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
            IF <FS_TAS1>-REG NE 'D-KHAT'.
              WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
              WA_TOP1-BZIRK = <FS_TAS1>-RM.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
            WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
            WA_TOP1-BZIRK = <FS_TAS1>-RM.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ENDIF.
      ENDIF.
    ENDLOOP.
*****************************************************
  ELSEIF WA_TAG1-DIV EQ '70'.
    LOOP AT IT_PRM1 ASSIGNING <FS_TAS1> WHERE SAMP_PRD EQ WA_TAG1-SAMP_PRD AND DIV EQ 'LS'.
      IF WA_TAG1-FROM_DT EQ 0.
        IF WA_TAG1-COUNTRY EQ 'NP'.
          IF <FS_TAS1>-REG EQ 'D-KHAT'.
            WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
            WA_TOP1-BZIRK = <FS_TAS1>-RM.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
          IF <FS_TAS1>-REG NE 'D-KHAT'.
            WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
            WA_TOP1-BZIRK = <FS_TAS1>-RM.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
          WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
          WA_TOP1-BZIRK = <FS_TAS1>-RM.
          WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
          COLLECT WA_TOP1 INTO IT_TOP1.
          CLEAR WA_TOP1.
        ENDIF.
      ELSE.
        IF WA_TAG1-FROM_DT LE <FS_TAS1>-DOJ.
          IF WA_TAG1-COUNTRY EQ 'NP'.
            IF <FS_TAS1>-REG EQ 'D-KHAT'.
              WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
              WA_TOP1-BZIRK = <FS_TAS1>-RM.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
            IF <FS_TAS1>-REG NE 'D-KHAT'.
              WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
              WA_TOP1-BZIRK = <FS_TAS1>-RM.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
            WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
            WA_TOP1-BZIRK = <FS_TAS1>-RM.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ENDIF.
      ENDIF.
    ENDLOOP.
**************************************************
  ELSEIF WA_TAG1-DIV EQ '99'.
    LOOP AT IT_PRM1 ASSIGNING <FS_TAS1> WHERE SAMP_PRD EQ WA_TAG1-SAMP_PRD AND DIV EQ 'BCL'.
      IF WA_TAG1-FROM_DT EQ 0.
        IF WA_TAG1-COUNTRY EQ 'NP'.
          IF <FS_TAS1>-REG EQ 'D-KHAT'.
            WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
            WA_TOP1-BZIRK = <FS_TAS1>-RM.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
          IF <FS_TAS1>-REG NE 'D-KHAT'.
            WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
            WA_TOP1-BZIRK = <FS_TAS1>-RM.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
          WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
          WA_TOP1-BZIRK = <FS_TAS1>-RM.
          WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
          COLLECT WA_TOP1 INTO IT_TOP1.
          CLEAR WA_TOP1.
        ENDIF.
      ELSE.
        IF WA_TAG1-FROM_DT LE <FS_TAS1>-DOJ.
          IF WA_TAG1-COUNTRY EQ 'NP'.
            IF <FS_TAS1>-REG EQ 'D-KHAT'.
              WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
              WA_TOP1-BZIRK = <FS_TAS1>-RM.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
            IF <FS_TAS1>-REG NE 'D-KHAT'.
              WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
              WA_TOP1-BZIRK = <FS_TAS1>-RM.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
            WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
            WA_TOP1-BZIRK = <FS_TAS1>-RM.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ENDIF.
      ENDIF.
    ENDLOOP.
  ENDIF.

  SORT IT_TOP1 DESCENDING BY NETVAL.
  LOOP AT IT_TOP1 ASSIGNING <FS_TOP1> WHERE SAMP_PRD EQ WA_TAG1-SAMP_PRD.
    READ TABLE IT_EX1 INTO WA_EX1 WITH KEY BZIRK = <FS_TOP1>-BZIRK MATNR = <FS_TOP1>-SAMP_PRD.
    IF SY-SUBRC NE 0.
*    WRITE : / 'P-PSO',<FS_TOP1>-BZIRK,<FS_TOP1>-NETVAL,COUNT.
      WA_TOP2-SAMP_PRD = <FS_TOP1>-SAMP_PRD.
      WA_TOP2-BZIRK = <FS_TOP1>-BZIRK.
      WA_TOP2-NETVAL = <FS_TOP1>-NETVAL.
      WA_TOP2-COUNT = COUNT.
      COLLECT WA_TOP2 INTO IT_TOP2.
      CLEAR WA_TOP2.
      COUNT = COUNT + 1.
    ENDIF.
  ENDLOOP.

  LOOP AT IT_TOP2 INTO WA_TOP2 WHERE SAMP_PRD EQ WA_TAG1-SAMP_PRD AND COUNT GE WA_TAG1-TOP1 AND COUNT LE WA_TAG1-TOP2 AND BZIRK NE '      '.
*    WRITE : / '****P-RM',<FS_TOP1>-BZIRK,<FS_TOP1>-NETVAL,<FS_TOP1>-COUNT.
*    wa_tag1-top1,wa_tag1-top2.
    CLEAR :  DIV1,DCOUNT.
*    READ TABLE IT_DIV2 INTO WA_DIV2 WITH KEY RM = WA_TOP2-BZIRK SPART = '50'.
*    IF SY-SUBRC EQ 0.
*      READ TABLE IT_DIV2 INTO WA_DIV2 WITH KEY RM = WA_TOP2-BZIRK SPART = '60'.
*      IF SY-SUBRC EQ 0.
*        DIV1 = '99'.
*      ELSE.
*        DIV1 = '50'.
*      ENDIF.
*    ELSE.
*      DIV1 = '60'.
*    ENDIF.

    READ TABLE IT_DIV2 INTO WA_DIV2 WITH KEY RM = WA_TOP2-BZIRK SPART = '50'.
    IF SY-SUBRC EQ 0.
      DIV1 = '50'.
      DCOUNT = DCOUNT + 1.
    ENDIF.
    READ TABLE IT_DIV2 INTO WA_DIV2 WITH KEY RM = WA_TOP2-BZIRK SPART = '60'.
    IF SY-SUBRC EQ 0.
      DIV1 = '60'.
      DCOUNT = DCOUNT + 1.
    ENDIF.
    READ TABLE IT_DIV2 INTO WA_DIV2 WITH KEY RM = WA_TOP2-BZIRK SPART = '70'.
    IF SY-SUBRC EQ 0.
      DIV1 = '70'.
      DCOUNT = DCOUNT + 1.
    ENDIF.
    IF DCOUNT GT 1.
      DIV1 = '99'.
    ENDIF.

    ZSAMPPROCESS_WA-ZMONTH = MONTH.
    ZSAMPPROCESS_WA-ZYEAR = YEAR.
    ZSAMPPROCESS_WA-BZIRK = WA_TOP2-BZIRK.
    ZSAMPPROCESS_WA-SAMPCODE = WA_TAG1-SAMP_PRD.
    ZSAMPPROCESS_WA-DIV = DIV1.
    ZSAMPPROCESS_WA-SAMPQTY = WA_TAG1-SQTY.
    MODIFY ZSAMPPROCESS FROM ZSAMPPROCESS_WA.
    CLEAR : ZSAMPPROCESS_WA.
*    collect zsampprocess_wa into it_zsampprocess_wa.
*    clear : zsampprocess_wa.
  ENDLOOP.
*  modify zsampprocess from table it_zsampprocess_wa.
*  commit work and wait .
  CLEAR : IT_ZSAMPPROCESS_WA.
  CLEAR : IT_TOP2,IT_TOP1.

ENDFORM.                    "RP

*&---------------------------------------------------------------------*
*&      Form  ZP
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
FORM ZP.

  CLEAR DIV.
  FORMAT COLOR 3.
*  WRITE : / 'A',WA_TAG1-SAMP_PRD,WA_TAG1-DIV,WA_TAG1-COUNTRY,WA_TAG1-DRP,WA_TAG1-SALE_TYPE,WA_TAG1-ZGROUP,WA_TAG1-TOP1,
*  WA_TAG1-TOP2,WA_TAG1-SQTY,WA_TAG1-USE_MONTH,WA_TAG1-PRD_CODE,count1.
  COUNT1 = COUNT1 + 1.
*  if wa_tag1-sno eq '1'.
  COUNT = 1.
*  ENDIF.
  IF WA_TAG1-DIV EQ '00'.
*    SELECT SINGLE * FROM MARA WHERE MATNR EQ WA_TAG1-SAMP_PRD.
*    IF SY-SUBRC EQ 0.
*      IF MARA-SPART EQ '50'.
*        DIV = 'BC'.
*      ELSEIF MARA-SPART EQ '60'.
*        DIV = 'XL'.
*      ELSEIF MARA-SPART EQ '70'.
*        DIV = 'LS'.
*      ENDIF.
*    ENDIF.

    SELECT SINGLE * FROM ZSAMP_PRD WHERE PRD_CODE EQ WA_TAG1-SAMP_PRD.
    IF SY-SUBRC EQ 0.
      IF ZSAMP_PRD-GRP_DIV EQ '50'.
        DIV = 'BC'.
      ELSEIF ZSAMP_PRD-GRP_DIV EQ '60'.
        DIV = 'XL'.
      ELSEIF ZSAMP_PRD-GRP_DIV EQ '70'.
        DIV = 'LS'.
      ENDIF.
    ENDIF.


    FORMAT COLOR 4.
    LOOP AT IT_PZM1 ASSIGNING <FS_TAS1> WHERE SAMP_PRD EQ WA_TAG1-SAMP_PRD AND ( ( DIV EQ DIV ) OR ( DIV EQ 'BCL' ) ).
      IF WA_TAG1-FROM_DT EQ 0.
        IF WA_TAG1-COUNTRY EQ 'NP'.
          IF <FS_TAS1>-REG EQ 'D-KHAT'.
            WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
            WA_TOP1-BZIRK = <FS_TAS1>-ZM.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
          IF <FS_TAS1>-REG NE 'D-KHAT'.
            WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
            WA_TOP1-BZIRK = <FS_TAS1>-ZM.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
          WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
          WA_TOP1-BZIRK = <FS_TAS1>-ZM.
          WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
          COLLECT WA_TOP1 INTO IT_TOP1.
          CLEAR WA_TOP1.
        ENDIF.
      ELSE.
        IF WA_TAG1-FROM_DT LE <FS_TAS1>-DOJ.
          IF WA_TAG1-COUNTRY EQ 'NP'.
            IF <FS_TAS1>-REG EQ 'D-KHAT'.
              WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
              WA_TOP1-BZIRK = <FS_TAS1>-ZM.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
            IF <FS_TAS1>-REG NE 'D-KHAT'.
              WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
              WA_TOP1-BZIRK = <FS_TAS1>-ZM.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
            WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
            WA_TOP1-BZIRK = <FS_TAS1>-ZM.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ENDIF.
      ENDIF.
    ENDLOOP.
  ELSEIF WA_TAG1-DIV EQ '50'.
    LOOP AT IT_PZM1 ASSIGNING <FS_TAS1> WHERE SAMP_PRD EQ WA_TAG1-SAMP_PRD AND DIV EQ 'BC'.
      IF WA_TAG1-FROM_DT EQ 0.
        IF WA_TAG1-COUNTRY EQ 'NP'.
          IF <FS_TAS1>-REG EQ 'D-KHAT'.
            WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
            WA_TOP1-BZIRK = <FS_TAS1>-ZM.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
          IF <FS_TAS1>-REG NE 'D-KHAT'.
            WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
            WA_TOP1-BZIRK = <FS_TAS1>-ZM.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
          WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
          WA_TOP1-BZIRK = <FS_TAS1>-ZM.
          WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
          COLLECT WA_TOP1 INTO IT_TOP1.
          CLEAR WA_TOP1.
        ENDIF.
      ELSE.
        IF WA_TAG1-FROM_DT LE <FS_TAS1>-DOJ.
          IF WA_TAG1-COUNTRY EQ 'NP'.
            IF <FS_TAS1>-REG EQ 'D-KHAT'.
              WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
              WA_TOP1-BZIRK = <FS_TAS1>-ZM.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
            IF <FS_TAS1>-REG NE 'D-KHAT'.
              WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
              WA_TOP1-BZIRK = <FS_TAS1>-ZM.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
            WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
            WA_TOP1-BZIRK = <FS_TAS1>-ZM.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ENDIF.
      ENDIF.
    ENDLOOP.
******************************************
  ELSEIF WA_TAG1-DIV EQ '60'.
    LOOP AT IT_PZM1 ASSIGNING <FS_TAS1> WHERE SAMP_PRD EQ WA_TAG1-SAMP_PRD AND DIV EQ 'XL'.
      IF WA_TAG1-FROM_DT EQ 0.
        IF WA_TAG1-COUNTRY EQ 'NP'.
          IF <FS_TAS1>-REG EQ 'D-KHAT'.
            WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
            WA_TOP1-BZIRK = <FS_TAS1>-ZM.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
          IF <FS_TAS1>-REG NE 'D-KHAT'.
            WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
            WA_TOP1-BZIRK = <FS_TAS1>-ZM.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
          WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
          WA_TOP1-BZIRK = <FS_TAS1>-ZM.
          WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
          COLLECT WA_TOP1 INTO IT_TOP1.
          CLEAR WA_TOP1.
        ENDIF.
      ELSE.
        IF WA_TAG1-FROM_DT LE <FS_TAS1>-DOJ.
          IF WA_TAG1-COUNTRY EQ 'NP'.
            IF <FS_TAS1>-REG EQ 'D-KHAT'.
              WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
              WA_TOP1-BZIRK = <FS_TAS1>-ZM.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
            IF <FS_TAS1>-REG NE 'D-KHAT'.
              WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
              WA_TOP1-BZIRK = <FS_TAS1>-ZM.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
            WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
            WA_TOP1-BZIRK = <FS_TAS1>-ZM.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ENDIF.
      ENDIF.
    ENDLOOP.

****************************************************************
  ELSEIF WA_TAG1-DIV EQ '70'.
    LOOP AT IT_PZM1 ASSIGNING <FS_TAS1> WHERE SAMP_PRD EQ WA_TAG1-SAMP_PRD AND DIV EQ 'LS'.
      IF WA_TAG1-FROM_DT EQ 0.
        IF WA_TAG1-COUNTRY EQ 'NP'.
          IF <FS_TAS1>-REG EQ 'D-KHAT'.
            WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
            WA_TOP1-BZIRK = <FS_TAS1>-ZM.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
          IF <FS_TAS1>-REG NE 'D-KHAT'.
            WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
            WA_TOP1-BZIRK = <FS_TAS1>-ZM.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
          WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
          WA_TOP1-BZIRK = <FS_TAS1>-ZM.
          WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
          COLLECT WA_TOP1 INTO IT_TOP1.
          CLEAR WA_TOP1.
        ENDIF.
      ELSE.
        IF WA_TAG1-FROM_DT LE <FS_TAS1>-DOJ.
          IF WA_TAG1-COUNTRY EQ 'NP'.
            IF <FS_TAS1>-REG EQ 'D-KHAT'.
              WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
              WA_TOP1-BZIRK = <FS_TAS1>-ZM.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
            IF <FS_TAS1>-REG NE 'D-KHAT'.
              WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
              WA_TOP1-BZIRK = <FS_TAS1>-ZM.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
            WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
            WA_TOP1-BZIRK = <FS_TAS1>-ZM.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ENDIF.
      ENDIF.
    ENDLOOP.
*************************************************************
  ELSEIF WA_TAG1-DIV EQ '99'.
    LOOP AT IT_PZM1 ASSIGNING <FS_TAS1> WHERE SAMP_PRD EQ WA_TAG1-SAMP_PRD AND DIV EQ 'BCL'.
      IF WA_TAG1-FROM_DT EQ 0.
        IF WA_TAG1-COUNTRY EQ 'NP'.
          IF <FS_TAS1>-REG EQ 'D-KHAT'.
            WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
            WA_TOP1-BZIRK = <FS_TAS1>-ZM.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
          IF <FS_TAS1>-REG NE 'D-KHAT'.
            WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
            WA_TOP1-BZIRK = <FS_TAS1>-ZM.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
          WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
          WA_TOP1-BZIRK = <FS_TAS1>-ZM.
          WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
          COLLECT WA_TOP1 INTO IT_TOP1.
          CLEAR WA_TOP1.
        ENDIF.
      ELSE.
        IF WA_TAG1-FROM_DT LE <FS_TAS1>-DOJ.
          IF WA_TAG1-COUNTRY EQ 'NP'.
            IF <FS_TAS1>-REG EQ 'D-KHAT'.
              WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
              WA_TOP1-BZIRK = <FS_TAS1>-ZM.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
            IF <FS_TAS1>-REG NE 'D-KHAT'.
              WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
              WA_TOP1-BZIRK = <FS_TAS1>-ZM.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
            WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
            WA_TOP1-BZIRK = <FS_TAS1>-ZM.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ENDIF.
      ENDIF.
    ENDLOOP.
  ENDIF.



  SORT IT_TOP1 DESCENDING BY NETVAL.
  LOOP AT IT_TOP1 ASSIGNING <FS_TOP1> WHERE SAMP_PRD EQ WA_TAG1.
    READ TABLE IT_EX1 INTO WA_EX1 WITH KEY BZIRK = <FS_TOP1>-BZIRK MATNR = <FS_TOP1>-SAMP_PRD.
    IF SY-SUBRC NE 0.
*    WRITE : / 'P-PSO',<FS_TOP1>-BZIRK,<FS_TOP1>-NETVAL,COUNT.
      WA_TOP2-SAMP_PRD = <FS_TOP1>-SAMP_PRD.
      WA_TOP2-BZIRK = <FS_TOP1>-BZIRK.
      WA_TOP2-NETVAL = <FS_TOP1>-NETVAL.
      WA_TOP2-COUNT = COUNT.
      COLLECT WA_TOP2 INTO IT_TOP2.
      CLEAR WA_TOP2.
      COUNT = COUNT + 1.
    ENDIF.
  ENDLOOP.

  LOOP AT IT_TOP2 INTO WA_TOP2 WHERE SAMP_PRD EQ WA_TAG1 AND COUNT GE WA_TAG1-TOP1 AND COUNT LE WA_TAG1-TOP2 AND BZIRK NE '      '.
*    WRITE : / '****P-DZM',<FS_TOP1>-BZIRK,<FS_TOP1>-NETVAL,<FS_TOP1>-COUNT.
*    wa_tag1-top1,wa_tag1-top2.
    CLEAR :  DIV1,DCOUNT.
*    READ TABLE IT_DIV2 INTO WA_DIV2 WITH KEY ZM = WA_TOP2-BZIRK SPART = '50'.
*    IF SY-SUBRC EQ 0.
*      READ TABLE IT_DIV2 INTO WA_DIV2 WITH KEY ZM = WA_TOP2-BZIRK SPART = '60'.
*      IF SY-SUBRC EQ 0.
*        DIV1 = '99'.
*      ELSE.
*        DIV1 = '50'.
*      ENDIF.
*    ELSE.
*      DIV1 = '60'.
*    ENDIF.
    READ TABLE IT_DIV2 INTO WA_DIV2 WITH KEY ZM = WA_TOP2-BZIRK SPART = '50'.
    IF SY-SUBRC EQ 0.
      DIV1 = '50'.
      DCOUNT = DCOUNT + 1.
    ENDIF.
    READ TABLE IT_DIV2 INTO WA_DIV2 WITH KEY ZM = WA_TOP2-BZIRK SPART = '60'.
    IF SY-SUBRC EQ 0.
      DIV1 = '60'.
      DCOUNT = DCOUNT + 1.
    ENDIF.
    READ TABLE IT_DIV2 INTO WA_DIV2 WITH KEY ZM = WA_TOP2-BZIRK SPART = '70'.
    IF SY-SUBRC EQ 0.
      DIV1 = '70'.
      DCOUNT = DCOUNT + 1.
    ENDIF.
    IF DCOUNT GT 1.
      DIV1   = '99'.
    ENDIF.

    ZSAMPPROCESS_WA-ZMONTH = MONTH.
    ZSAMPPROCESS_WA-ZYEAR = YEAR.
    ZSAMPPROCESS_WA-BZIRK = WA_TOP2-BZIRK.
    ZSAMPPROCESS_WA-SAMPCODE = WA_TAG1-SAMP_PRD.
    ZSAMPPROCESS_WA-DIV = DIV1.
    ZSAMPPROCESS_WA-SAMPQTY = WA_TAG1-SQTY.
*    collect zsampprocess_wa into it_zsampprocess_wa.
    MODIFY ZSAMPPROCESS FROM ZSAMPPROCESS_WA.
    CLEAR : ZSAMPPROCESS_WA.
  ENDLOOP.

*  modify zsampprocess from table it_zsampprocess_wa.
*  commit work and wait .
  CLEAR : IT_ZSAMPPROCESS_WA,IT_TOP2,IT_TOP1.
ENDFORM.                    "ZP

*&---------------------------------------------------------------------*
*&      Form  DP
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
FORM DP.


  CLEAR DIV.
  FORMAT COLOR 3.
*  WRITE : / 'A',WA_TAG1-SAMP_PRD,WA_TAG1-DIV,WA_TAG1-COUNTRY,WA_TAG1-DRP,WA_TAG1-SALE_TYPE,WA_TAG1-ZGROUP,WA_TAG1-TOP1,
*  WA_TAG1-TOP2,WA_TAG1-SQTY,WA_TAG1-USE_MONTH,WA_TAG1-PRD_CODE,count1.
  COUNT1 = COUNT1 + 1.
*  if wa_tag1-sno eq '1'.
  COUNT = 1.
*  ENDIF.
  IF WA_TAG1-DIV EQ '00'.
*    SELECT SINGLE * FROM MARA WHERE MATNR EQ WA_TAG1-SAMP_PRD.
*    IF SY-SUBRC EQ 0.
*      IF MARA-SPART EQ '50'.
*        DIV = 'BC'.
*      ELSEIF MARA-SPART EQ '60'.
*        DIV = 'XL'.
*      ELSEIF MARA-SPART EQ '70'.
*        DIV = 'LS'.
*      ENDIF.
*    ENDIF.
    SELECT SINGLE * FROM ZSAMP_PRD WHERE PRD_CODE EQ WA_TAG1-SAMP_PRD.
    IF SY-SUBRC EQ 0.
      IF ZSAMP_PRD-GRP_DIV EQ '50'.
        DIV = 'BC'.
      ELSEIF ZSAMP_PRD-GRP_DIV EQ '60'.
        DIV = 'XL'.
      ELSEIF ZSAMP_PRD-GRP_DIV EQ '70'.
        DIV = 'LS'.
      ENDIF.
    ENDIF.


    FORMAT COLOR 4.
    LOOP AT IT_PREG1 ASSIGNING <FS_TAS1> WHERE SAMP_PRD EQ WA_TAG1-SAMP_PRD AND ( ( DIV EQ DIV ) OR ( DIV EQ 'BCL' ) ).
      IF WA_TAG1-FROM_DT EQ 0.
        IF WA_TAG1-COUNTRY EQ 'NP'.
          IF <FS_TAS1>-REG EQ 'D-KHAT'.
            WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
            WA_TOP1-BZIRK = <FS_TAS1>-REG.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
          IF <FS_TAS1>-REG NE 'D-KHAT'.
            WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
            WA_TOP1-BZIRK = <FS_TAS1>-REG.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
          WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
          WA_TOP1-BZIRK = <FS_TAS1>-REG.
          WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
          COLLECT WA_TOP1 INTO IT_TOP1.
          CLEAR WA_TOP1.
        ENDIF.
      ELSE.
        IF WA_TAG1-FROM_DT LE <FS_TAS1>-DOJ.
          IF WA_TAG1-COUNTRY EQ 'NP'.
            IF <FS_TAS1>-REG EQ 'D-KHAT'.
              WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
              WA_TOP1-BZIRK = <FS_TAS1>-REG.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
            IF <FS_TAS1>-REG NE 'D-KHAT'.
              WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
              WA_TOP1-BZIRK = <FS_TAS1>-REG.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
            WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
            WA_TOP1-BZIRK = <FS_TAS1>-REG.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ENDIF.
      ENDIF.
    ENDLOOP.
  ELSEIF WA_TAG1-DIV EQ '50'.
    LOOP AT IT_PREG1 ASSIGNING <FS_TAS1> WHERE SAMP_PRD EQ WA_TAG1-SAMP_PRD AND DIV EQ 'BC'.
      IF WA_TAG1-FROM_DT EQ 0.
        IF WA_TAG1-COUNTRY EQ 'NP'.
          IF <FS_TAS1>-REG EQ 'D-KHAT'.
            WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
            WA_TOP1-BZIRK = <FS_TAS1>-REG.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
          IF <FS_TAS1>-REG NE 'D-KHAT'.
            WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
            WA_TOP1-BZIRK = <FS_TAS1>-REG.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
          WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
          WA_TOP1-BZIRK = <FS_TAS1>-REG.
          WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
          COLLECT WA_TOP1 INTO IT_TOP1.
          CLEAR WA_TOP1.
        ENDIF.
      ELSE.
        IF WA_TAG1-FROM_DT LE <FS_TAS1>-DOJ.
          IF WA_TAG1-COUNTRY EQ 'NP'.
            IF <FS_TAS1>-REG EQ 'D-KHAT'.
              WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
              WA_TOP1-BZIRK = <FS_TAS1>-REG.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
            IF <FS_TAS1>-REG NE 'D-KHAT'.
              WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
              WA_TOP1-BZIRK = <FS_TAS1>-REG.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
            WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
            WA_TOP1-BZIRK = <FS_TAS1>-REG.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ENDIF.
      ENDIF.
    ENDLOOP.
***********************************************************
  ELSEIF WA_TAG1-DIV EQ '60'.
    LOOP AT IT_PREG1 ASSIGNING <FS_TAS1> WHERE SAMP_PRD EQ WA_TAG1-SAMP_PRD AND DIV EQ 'XL'.
      IF WA_TAG1-FROM_DT EQ 0.
        IF WA_TAG1-COUNTRY EQ 'NP'.
          IF <FS_TAS1>-REG EQ 'D-KHAT'.
            WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
            WA_TOP1-BZIRK = <FS_TAS1>-REG.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
          IF <FS_TAS1>-REG NE 'D-KHAT'.
            WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
            WA_TOP1-BZIRK = <FS_TAS1>-REG.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
          WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
          WA_TOP1-BZIRK = <FS_TAS1>-REG.
          WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
          COLLECT WA_TOP1 INTO IT_TOP1.
          CLEAR WA_TOP1.
        ENDIF.
      ELSE.
        IF WA_TAG1-FROM_DT LE <FS_TAS1>-DOJ.
          IF WA_TAG1-COUNTRY EQ 'NP'.
            IF <FS_TAS1>-REG EQ 'D-KHAT'.
              WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
              WA_TOP1-BZIRK = <FS_TAS1>-REG.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
            IF <FS_TAS1>-REG NE 'D-KHAT'.
              WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
              WA_TOP1-BZIRK = <FS_TAS1>-REG.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
            WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
            WA_TOP1-BZIRK = <FS_TAS1>-REG.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ENDIF.
      ENDIF.
    ENDLOOP.

*********************************************************************
  ELSEIF WA_TAG1-DIV EQ '70'.
    LOOP AT IT_PREG1 ASSIGNING <FS_TAS1> WHERE SAMP_PRD EQ WA_TAG1-SAMP_PRD AND DIV EQ 'LS'.
      IF WA_TAG1-FROM_DT EQ 0.
        IF WA_TAG1-COUNTRY EQ 'NP'.
          IF <FS_TAS1>-REG EQ 'D-KHAT'.
            WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
            WA_TOP1-BZIRK = <FS_TAS1>-REG.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
          IF <FS_TAS1>-REG NE 'D-KHAT'.
            WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
            WA_TOP1-BZIRK = <FS_TAS1>-REG.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
          WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
          WA_TOP1-BZIRK = <FS_TAS1>-REG.
          WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
          COLLECT WA_TOP1 INTO IT_TOP1.
          CLEAR WA_TOP1.
        ENDIF.
      ELSE.
        IF WA_TAG1-FROM_DT LE <FS_TAS1>-DOJ.
          IF WA_TAG1-COUNTRY EQ 'NP'.
            IF <FS_TAS1>-REG EQ 'D-KHAT'.
              WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
              WA_TOP1-BZIRK = <FS_TAS1>-REG.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
            IF <FS_TAS1>-REG NE 'D-KHAT'.
              WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
              WA_TOP1-BZIRK = <FS_TAS1>-REG.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
            WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
            WA_TOP1-BZIRK = <FS_TAS1>-REG.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ENDIF.
      ENDIF.
    ENDLOOP.
********************************************************************
  ELSEIF WA_TAG1-DIV EQ '99'.
    LOOP AT IT_PREG1 ASSIGNING <FS_TAS1> WHERE SAMP_PRD EQ WA_TAG1-SAMP_PRD AND DIV EQ 'BCL'.
      IF WA_TAG1-FROM_DT EQ 0.
        IF WA_TAG1-COUNTRY EQ 'NP'.
          IF <FS_TAS1>-REG EQ 'D-KHAT'.
            WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
            WA_TOP1-BZIRK = <FS_TAS1>-REG.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
          IF <FS_TAS1>-REG NE 'D-KHAT'.
            WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
            WA_TOP1-BZIRK = <FS_TAS1>-REG.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
          WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
          WA_TOP1-BZIRK = <FS_TAS1>-REG.
          WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
          COLLECT WA_TOP1 INTO IT_TOP1.
          CLEAR WA_TOP1.
        ENDIF.
      ELSE.
        IF WA_TAG1-FROM_DT LE <FS_TAS1>-DOJ.
          IF WA_TAG1-COUNTRY EQ 'NP'.
            IF <FS_TAS1>-REG EQ 'D-KHAT'.
              WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
              WA_TOP1-BZIRK = <FS_TAS1>-REG.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
            IF <FS_TAS1>-REG NE 'D-KHAT'.
              WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
              WA_TOP1-BZIRK = <FS_TAS1>-REG.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
            WA_TOP1-SAMP_PRD = <FS_TAS1>-SAMP_PRD.
            WA_TOP1-BZIRK = <FS_TAS1>-REG.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ENDIF.
      ENDIF.
    ENDLOOP.
  ENDIF.



  SORT IT_TOP1 DESCENDING BY NETVAL.
  LOOP AT IT_TOP1 ASSIGNING <FS_TOP1> WHERE SAMP_PRD EQ WA_TAG1-SAMP_PRD .
    READ TABLE IT_EX1 INTO WA_EX1 WITH KEY BZIRK = <FS_TOP1>-BZIRK MATNR = <FS_TOP1>-SAMP_PRD.
    IF SY-SUBRC NE 0.
*    WRITE : / 'P-REG',<FS_TOP1>-BZIRK,<FS_TOP1>-NETVAL,COUNT.
      WA_TOP2-SAMP_PRD = <FS_TOP1>-SAMP_PRD.
      WA_TOP2-BZIRK = <FS_TOP1>-BZIRK.
      WA_TOP2-NETVAL = <FS_TOP1>-NETVAL.
      WA_TOP2-COUNT = COUNT.
      COLLECT WA_TOP2 INTO IT_TOP2.
      CLEAR WA_TOP2.
      COUNT = COUNT + 1.
    ENDIF.
  ENDLOOP.

  LOOP AT IT_TOP2 INTO WA_TOP2 WHERE SAMP_PRD EQ WA_TAG1-SAMP_PRD AND COUNT GE WA_TAG1-TOP1 AND COUNT LE WA_TAG1-TOP2 AND BZIRK NE '      '.
*    WRITE : / '****P-REG',<FS_TOP1>-BZIRK,<FS_TOP1>-NETVAL,<FS_TOP1>-COUNT.
*    wa_tag1-top1,wa_tag1-top2.

    CLEAR :  DIV1,DCOUNT.
*    READ TABLE IT_DIV2 INTO WA_DIV2 WITH KEY REG = WA_TOP2-BZIRK SPART = '50'.
*    IF SY-SUBRC EQ 0.
*      READ TABLE IT_DIV2 INTO WA_DIV2 WITH KEY REG = WA_TOP2-BZIRK SPART = '60'.
*      IF SY-SUBRC EQ 0.
*        DIV1 = '99'.
*      ELSE.
*        DIV1 = '50'.
*      ENDIF.
*    ELSE.
*      DIV1 = '60'.
*    ENDIF.

    READ TABLE IT_DIV2 INTO WA_DIV2 WITH KEY REG = WA_TOP2-BZIRK SPART = '50'.
    IF SY-SUBRC EQ 0.
      DIV1 = '50'.
      DCOUNT = DCOUNT + 1.
    ENDIF.
    READ TABLE IT_DIV2 INTO WA_DIV2 WITH KEY REG = WA_TOP2-BZIRK SPART = '60'.
    IF SY-SUBRC EQ 0.
      DIV1 = '60'.
      DCOUNT = DCOUNT + 1.
    ENDIF.
    READ TABLE IT_DIV2 INTO WA_DIV2 WITH KEY REG = WA_TOP2-BZIRK SPART = '70'.
    IF SY-SUBRC EQ 0.
      DIV1 = '70'.
      DCOUNT = DCOUNT + 1.
    ENDIF.
    IF DCOUNT GT 1.
      DIV1 = '99'.
    ENDIF.

    ZSAMPPROCESS_WA-ZMONTH = MONTH.
    ZSAMPPROCESS_WA-ZYEAR = YEAR.
    ZSAMPPROCESS_WA-BZIRK = WA_TOP2-BZIRK.
    ZSAMPPROCESS_WA-SAMPCODE = WA_TAG1-SAMP_PRD.
    ZSAMPPROCESS_WA-DIV = DIV1.
    ZSAMPPROCESS_WA-SAMPQTY = WA_TAG1-SQTY.
*    collect zsampprocess_wa into it_zsampprocess_wa.
    MODIFY ZSAMPPROCESS FROM ZSAMPPROCESS_WA.
    CLEAR : ZSAMPPROCESS_WA.
  ENDLOOP.
*  modify zsampprocess from table it_zsampprocess_wa.
*  commit work and wait .
  CLEAR : IT_ZSAMPPROCESS_WA.
  CLEAR : IT_TOP2,IT_TOP1.

ENDFORM.                    "DP

*&---------------------------------------------------------------------*
*&      Form  PV
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
FORM PV.

  CLEAR DIV.
  FORMAT COLOR 3.
*  WRITE : / 'A',WA_TAG1-SAMP_PRD,WA_TAG1-DIV,WA_TAG1-COUNTRY,WA_TAG1-DRP,WA_TAG1-SALE_TYPE,WA_TAG1-ZGROUP,WA_TAG1-TOP1,
*  WA_TAG1-TOP2,WA_TAG1-SQTY,WA_TAG1-USE_MONTH,WA_TAG1-PRD_CODE,count1.
  COUNT1 = COUNT1 + 1.
*  if wa_tag1-sno eq '1'.
  COUNT = 1.
*  ENDIF.
  IF WA_TAG1-DIV EQ '00'.
*    SELECT SINGLE * FROM MARA WHERE MATNR EQ WA_TAG1-SAMP_PRD.
*    IF SY-SUBRC EQ 0.
*      IF MARA-SPART EQ '50'.
*        DIV = 'BC'.
*      ELSEIF MARA-SPART EQ '60'.
*        DIV = 'XL'.
*      ELSEIF MARA-SPART EQ '70'.
*        DIV = 'LS'.
*      ENDIF.
*    ENDIF.
    SELECT SINGLE * FROM ZSAMP_PRD  WHERE PRD_CODE EQ WA_TAG1-SAMP_PRD.  " product group take from table ZSAMP_PRD : JYOTSNA 27.2.24
    IF SY-SUBRC EQ 0.
      IF ZSAMP_PRD-GRP_DIV EQ '50'.
        DIV = 'BC'.
      ELSEIF ZSAMP_PRD-GRP_DIV EQ '60'.
        DIV = 'XL'.
      ELSEIF ZSAMP_PRD-GRP_DIV EQ '70'.
        DIV = 'LS'.
      ENDIF.
    ENDIF.

    FORMAT COLOR 4.
    LOOP AT IT_PSO1 ASSIGNING <FS_TAS1> WHERE ( DIV EQ DIV ) OR ( DIV EQ 'BCL' ).
      IF WA_TAG1-FROM_DT EQ 0.
        IF WA_TAG1-COUNTRY EQ 'NP'.
          IF <FS_TAS1>-REG EQ 'D-KHAT'.
            WA_TOP1-BZIRK = <FS_TAS1>-BZIRK.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
          IF <FS_TAS1>-REG NE 'D-KHAT'.
            WA_TOP1-BZIRK = <FS_TAS1>-BZIRK.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
          WA_TOP1-BZIRK = <FS_TAS1>-BZIRK.
          WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
          COLLECT WA_TOP1 INTO IT_TOP1.
          CLEAR WA_TOP1.
        ENDIF.
      ELSE.
        IF WA_TAG1-FROM_DT LE <FS_TAS1>-DOJ.
          IF WA_TAG1-COUNTRY EQ 'NP'.
            IF <FS_TAS1>-REG EQ 'D-KHAT'.
              WA_TOP1-BZIRK = <FS_TAS1>-BZIRK.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
            IF <FS_TAS1>-REG NE 'D-KHAT'.
              WA_TOP1-BZIRK = <FS_TAS1>-BZIRK.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
            WA_TOP1-BZIRK = <FS_TAS1>-BZIRK.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ENDIF.
      ENDIF.
    ENDLOOP.
  ELSEIF WA_TAG1-DIV EQ '50'.
    LOOP AT IT_PSO1 ASSIGNING <FS_TAS1> WHERE DIV EQ 'BC'.
      IF WA_TAG1-FROM_DT EQ 0.
        IF WA_TAG1-COUNTRY EQ 'NP'.
          IF <FS_TAS1>-REG EQ 'D-KHAT'.
            WA_TOP1-BZIRK = <FS_TAS1>-BZIRK.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
          IF <FS_TAS1>-REG NE 'D-KHAT'.
            WA_TOP1-BZIRK = <FS_TAS1>-BZIRK.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
          WA_TOP1-BZIRK = <FS_TAS1>-BZIRK.
          WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
          COLLECT WA_TOP1 INTO IT_TOP1.
          CLEAR WA_TOP1.
        ENDIF.
      ELSE.
        IF WA_TAG1-FROM_DT LE <FS_TAS1>-DOJ.
          IF WA_TAG1-COUNTRY EQ 'NP'.
            IF <FS_TAS1>-REG EQ 'D-KHAT'.
              WA_TOP1-BZIRK = <FS_TAS1>-BZIRK.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
            IF <FS_TAS1>-REG NE 'D-KHAT'.
              WA_TOP1-BZIRK = <FS_TAS1>-BZIRK.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
            WA_TOP1-BZIRK = <FS_TAS1>-BZIRK.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ENDIF.
      ENDIF.
    ENDLOOP.
********************************************************************************
  ELSEIF WA_TAG1-DIV EQ '60'.
    LOOP AT IT_PSO1 ASSIGNING <FS_TAS1> WHERE DIV EQ 'XL'.
      IF WA_TAG1-FROM_DT EQ 0.
        IF WA_TAG1-COUNTRY EQ 'NP'.
          IF <FS_TAS1>-REG EQ 'D-KHAT'.
            WA_TOP1-BZIRK = <FS_TAS1>-BZIRK.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
          IF <FS_TAS1>-REG NE 'D-KHAT'.
            WA_TOP1-BZIRK = <FS_TAS1>-BZIRK.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
          WA_TOP1-BZIRK = <FS_TAS1>-BZIRK.
          WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
          COLLECT WA_TOP1 INTO IT_TOP1.
          CLEAR WA_TOP1.
        ENDIF.
      ELSE.
        IF WA_TAG1-FROM_DT LE <FS_TAS1>-DOJ.
          IF WA_TAG1-COUNTRY EQ 'NP'.
            IF <FS_TAS1>-REG EQ 'D-KHAT'.
              WA_TOP1-BZIRK = <FS_TAS1>-BZIRK.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
            IF <FS_TAS1>-REG NE 'D-KHAT'.
              WA_TOP1-BZIRK = <FS_TAS1>-BZIRK.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
            WA_TOP1-BZIRK = <FS_TAS1>-BZIRK.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ENDIF.
      ENDIF.
    ENDLOOP.

*****************************
  ELSEIF WA_TAG1-DIV EQ '70'.
    LOOP AT IT_PSO1 ASSIGNING <FS_TAS1> WHERE DIV EQ 'LS'.
      IF WA_TAG1-FROM_DT EQ 0.
        IF WA_TAG1-COUNTRY EQ 'NP'.
          IF <FS_TAS1>-REG EQ 'D-KHAT'.
            WA_TOP1-BZIRK = <FS_TAS1>-BZIRK.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
          IF <FS_TAS1>-REG NE 'D-KHAT'.
            WA_TOP1-BZIRK = <FS_TAS1>-BZIRK.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
          WA_TOP1-BZIRK = <FS_TAS1>-BZIRK.
          WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
          COLLECT WA_TOP1 INTO IT_TOP1.
          CLEAR WA_TOP1.
        ENDIF.
      ELSE.
        IF WA_TAG1-FROM_DT LE <FS_TAS1>-DOJ.
          IF WA_TAG1-COUNTRY EQ 'NP'.
            IF <FS_TAS1>-REG EQ 'D-KHAT'.
              WA_TOP1-BZIRK = <FS_TAS1>-BZIRK.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
            IF <FS_TAS1>-REG NE 'D-KHAT'.
              WA_TOP1-BZIRK = <FS_TAS1>-BZIRK.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
            WA_TOP1-BZIRK = <FS_TAS1>-BZIRK.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ENDIF.
      ENDIF.
    ENDLOOP.
***************************************************************
  ELSEIF WA_TAG1-DIV EQ '99'.
    LOOP AT IT_PSO1 ASSIGNING <FS_TAS1> WHERE DIV EQ 'BCL'.
      IF WA_TAG1-FROM_DT EQ 0.
        IF WA_TAG1-COUNTRY EQ 'NP'.
          IF <FS_TAS1>-REG EQ 'D-KHAT'.
            WA_TOP1-BZIRK = <FS_TAS1>-BZIRK.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
          IF <FS_TAS1>-REG NE 'D-KHAT'.
            WA_TOP1-BZIRK = <FS_TAS1>-BZIRK.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
          WA_TOP1-BZIRK = <FS_TAS1>-BZIRK.
          WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
          COLLECT WA_TOP1 INTO IT_TOP1.
          CLEAR WA_TOP1.
        ENDIF.
      ELSE.
        IF WA_TAG1-FROM_DT LE <FS_TAS1>-DOJ.
          IF WA_TAG1-COUNTRY EQ 'NP'.
            IF <FS_TAS1>-REG EQ 'D-KHAT'.
              WA_TOP1-BZIRK = <FS_TAS1>-BZIRK.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
            IF <FS_TAS1>-REG NE 'D-KHAT'.
              WA_TOP1-BZIRK = <FS_TAS1>-BZIRK.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
            WA_TOP1-BZIRK = <FS_TAS1>-BZIRK.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ENDIF.
      ENDIF.
    ENDLOOP.
  ENDIF.

  SORT IT_TOP1 DESCENDING BY NETVAL.
  LOOP AT IT_TOP1 ASSIGNING <FS_TOP1>.
    READ TABLE IT_EX1 INTO WA_EX1 WITH KEY BZIRK = <FS_TOP1>-BZIRK MATNR = WA_TAG1-SAMP_PRD.
    IF SY-SUBRC NE 0.
*    WRITE : / 'P-PSO',<FS_TOP1>-BZIRK,<FS_TOP1>-NETVAL,COUNT.
      WA_TOP2-BZIRK = <FS_TOP1>-BZIRK.
      WA_TOP2-NETVAL = <FS_TOP1>-NETVAL.
      WA_TOP2-COUNT = COUNT.
      COLLECT WA_TOP2 INTO IT_TOP2.
      CLEAR WA_TOP2.
      COUNT = COUNT + 1.
    ENDIF.
  ENDLOOP.
  IF IT_TOP2 IS NOT INITIAL.
    LOOP AT IT_TOP2 INTO WA_TOP2 WHERE COUNT GE WA_TAG1-TOP1 AND COUNT LE WA_TAG1-TOP2 .
*    WRITE : / '****PSO',<FS_TOP1>-BZIRK,<FS_TOP1>-NETVAL,<FS_TOP1>-COUNT.
*    wa_tag1-top1,wa_tag1-top2.
      CLEAR : DIV1,DCOUNT.
*      READ TABLE IT_DIV2 INTO WA_DIV2 WITH KEY BZIRK = WA_TOP2-BZIRK SPART = '50'.
*      IF SY-SUBRC EQ 0.
*        READ TABLE IT_DIV2 INTO WA_DIV2 WITH KEY BZIRK = WA_TOP2-BZIRK SPART = '60'.
*        IF SY-SUBRC EQ 0.
*          DIV1 = '99'.
*        ELSE.
*          DIV1 = '50'.
*        ENDIF.
*      ELSE.
*        DIV1 = '60'.
*      ENDIF.

      READ TABLE IT_DIV2 INTO WA_DIV2 WITH KEY BZIRK = WA_TOP2-BZIRK SPART = '50'.
      IF SY-SUBRC EQ 0.
        DIV1 = '50'.
        DCOUNT = DCOUNT + 1.
      ENDIF.
      READ TABLE IT_DIV2 INTO WA_DIV2 WITH KEY BZIRK = WA_TOP2-BZIRK SPART = '60'.
      IF SY-SUBRC EQ 0.
        DIV1 = '60'.
        DCOUNT = DCOUNT + 1.
      ENDIF.
      READ TABLE IT_DIV2 INTO WA_DIV2 WITH KEY BZIRK = WA_TOP2-BZIRK SPART = '70'.
      IF SY-SUBRC EQ 0.
        DIV1 = '70'.
        DCOUNT = DCOUNT + 1.
      ENDIF.
      IF DCOUNT GT 1.
        DIV1 = '99'.
      ENDIF.

      ZSAMPPROCESS_WA-ZMONTH = MONTH.
      ZSAMPPROCESS_WA-ZYEAR = YEAR.
      ZSAMPPROCESS_WA-BZIRK = WA_TOP2-BZIRK.
      ZSAMPPROCESS_WA-SAMPCODE = WA_TAG1-SAMP_PRD.
      ZSAMPPROCESS_WA-DIV = DIV1.
      ZSAMPPROCESS_WA-SAMPQTY = WA_TAG1-SQTY.
*      collect zsampprocess_wa into it_zsampprocess_wa.
      MODIFY ZSAMPPROCESS FROM ZSAMPPROCESS_WA.
      CLEAR : ZSAMPPROCESS_WA.
    ENDLOOP.
  ENDIF.

*  modify zsampprocess from table it_zsampprocess_wa.
*  commit work and wait .
  CLEAR : IT_ZSAMPPROCESS_WA.
  CLEAR : IT_TOP2,IT_TOP1.


ENDFORM.                    "PV

*&---------------------------------------------------------------------*
*&      Form  RV
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
FORM RV.

  CLEAR DIV.
  FORMAT COLOR 3.
*  WRITE : / 'A',WA_TAG1-SAMP_PRD,WA_TAG1-DIV,WA_TAG1-COUNTRY,WA_TAG1-DRP,WA_TAG1-SALE_TYPE,WA_TAG1-ZGROUP,WA_TAG1-TOP1,
*  WA_TAG1-TOP2,WA_TAG1-SQTY,WA_TAG1-USE_MONTH,WA_TAG1-PRD_CODE,count1.
  COUNT1 = COUNT1 + 1.
*  if wa_tag1-sno eq '1'.
  COUNT = 1.
*  ENDIF.
  IF WA_TAG1-DIV EQ '00'.
*    SELECT SINGLE * FROM MARA WHERE MATNR EQ WA_TAG1-SAMP_PRD.
*    IF SY-SUBRC EQ 0.
*      IF MARA-SPART EQ '50'.
*        DIV = 'BC'.
*      ELSEIF MARA-SPART EQ '60'.
*        DIV = 'XL'.
*      ELSEIF MARA-SPART EQ '70'.
*        DIV = 'LS'.
*      ENDIF.
*    ENDIF.
    SELECT SINGLE * FROM ZSAMP_PRD  WHERE PRD_CODE EQ WA_TAG1-SAMP_PRD.  " product group take from table ZSAMP_PRD : JYOTSNA 27.2.24
    IF SY-SUBRC EQ 0.
      IF ZSAMP_PRD-GRP_DIV EQ '50'.
        DIV = 'BC'.
      ELSEIF ZSAMP_PRD-GRP_DIV EQ '60'.
        DIV = 'XL'.
      ELSEIF ZSAMP_PRD-GRP_DIV EQ '70'.
        DIV = 'LS'.
      ENDIF.
    ENDIF.

    FORMAT COLOR 4.
    LOOP AT IT_RM1 ASSIGNING <FS_TAS1> WHERE ( DIV EQ DIV ) OR ( DIV EQ 'BCL' ).
      IF WA_TAG1-FROM_DT EQ 0.
        IF WA_TAG1-COUNTRY EQ 'NP'.
          IF <FS_TAS1>-REG EQ 'D-KHAT'.
            WA_TOP1-BZIRK = <FS_TAS1>-RM.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
          IF <FS_TAS1>-REG NE 'D-KHAT'.
            WA_TOP1-BZIRK = <FS_TAS1>-RM.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
          WA_TOP1-BZIRK = <FS_TAS1>-RM.
          WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
          COLLECT WA_TOP1 INTO IT_TOP1.
          CLEAR WA_TOP1.
        ENDIF.
      ELSE.
        IF WA_TAG1-FROM_DT LE <FS_TAS1>-DOJ.
          IF WA_TAG1-COUNTRY EQ 'NP'.
            IF <FS_TAS1>-REG EQ 'D-KHAT'.
              WA_TOP1-BZIRK = <FS_TAS1>-RM.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
            IF <FS_TAS1>-REG NE 'D-KHAT'.
              WA_TOP1-BZIRK = <FS_TAS1>-RM.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
            WA_TOP1-BZIRK = <FS_TAS1>-RM.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ENDIF.
      ENDIF.
    ENDLOOP.
  ELSEIF WA_TAG1-DIV EQ '50'.
    LOOP AT IT_RM1 ASSIGNING <FS_TAS1> WHERE DIV EQ 'BC'.
      IF WA_TAG1-FROM_DT EQ 0.
        IF WA_TAG1-COUNTRY EQ 'NP'.
          IF <FS_TAS1>-REG EQ 'D-KHAT'.
            WA_TOP1-BZIRK = <FS_TAS1>-RM.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
          IF <FS_TAS1>-REG NE 'D-KHAT'.
            WA_TOP1-BZIRK = <FS_TAS1>-RM.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
          WA_TOP1-BZIRK = <FS_TAS1>-RM.
          WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
          COLLECT WA_TOP1 INTO IT_TOP1.
          CLEAR WA_TOP1.
        ENDIF.
      ELSE.
        IF WA_TAG1-FROM_DT LE <FS_TAS1>-DOJ.
          IF WA_TAG1-COUNTRY EQ 'NP'.
            IF <FS_TAS1>-REG EQ 'D-KHAT'.
              WA_TOP1-BZIRK = <FS_TAS1>-RM.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
            IF <FS_TAS1>-REG NE 'D-KHAT'.
              WA_TOP1-BZIRK = <FS_TAS1>-RM.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
            WA_TOP1-BZIRK = <FS_TAS1>-RM.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ENDIF.
      ENDIF.
    ENDLOOP.
************************************************************
  ELSEIF WA_TAG1-DIV EQ '60'.
    LOOP AT IT_RM1 ASSIGNING <FS_TAS1> WHERE DIV EQ 'XL'.
      IF WA_TAG1-FROM_DT EQ 0.
        IF WA_TAG1-COUNTRY EQ 'NP'.
          IF <FS_TAS1>-REG EQ 'D-KHAT'.
            WA_TOP1-BZIRK = <FS_TAS1>-RM.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
          IF <FS_TAS1>-REG NE 'D-KHAT'.
            WA_TOP1-BZIRK = <FS_TAS1>-RM.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
          WA_TOP1-BZIRK = <FS_TAS1>-RM.
          WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
          COLLECT WA_TOP1 INTO IT_TOP1.
          CLEAR WA_TOP1.
        ENDIF.
      ELSE.
        IF WA_TAG1-FROM_DT LE <FS_TAS1>-DOJ.
          IF WA_TAG1-COUNTRY EQ 'NP'.
            IF <FS_TAS1>-REG EQ 'D-KHAT'.
              WA_TOP1-BZIRK = <FS_TAS1>-RM.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
            IF <FS_TAS1>-REG NE 'D-KHAT'.
              WA_TOP1-BZIRK = <FS_TAS1>-RM.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
            WA_TOP1-BZIRK = <FS_TAS1>-RM.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ENDIF.
      ENDIF.
    ENDLOOP.
**********************************************
************************************************************
  ELSEIF WA_TAG1-DIV EQ '70'.
    LOOP AT IT_RM1 ASSIGNING <FS_TAS1> WHERE DIV EQ 'LS'.
      IF WA_TAG1-FROM_DT EQ 0.
        IF WA_TAG1-COUNTRY EQ 'NP'.
          IF <FS_TAS1>-REG EQ 'D-KHAT'.
            WA_TOP1-BZIRK = <FS_TAS1>-RM.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
          IF <FS_TAS1>-REG NE 'D-KHAT'.
            WA_TOP1-BZIRK = <FS_TAS1>-RM.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
          WA_TOP1-BZIRK = <FS_TAS1>-RM.
          WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
          COLLECT WA_TOP1 INTO IT_TOP1.
          CLEAR WA_TOP1.
        ENDIF.
      ELSE.
        IF WA_TAG1-FROM_DT LE <FS_TAS1>-DOJ.
          IF WA_TAG1-COUNTRY EQ 'NP'.
            IF <FS_TAS1>-REG EQ 'D-KHAT'.
              WA_TOP1-BZIRK = <FS_TAS1>-RM.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
            IF <FS_TAS1>-REG NE 'D-KHAT'.
              WA_TOP1-BZIRK = <FS_TAS1>-RM.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
            WA_TOP1-BZIRK = <FS_TAS1>-RM.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ENDIF.
      ENDIF.
    ENDLOOP.
*************************************************
  ELSEIF WA_TAG1-DIV EQ '99'.
    LOOP AT IT_RM1 ASSIGNING <FS_TAS1> WHERE DIV EQ 'BCL'.
      IF WA_TAG1-FROM_DT EQ 0.
        IF WA_TAG1-COUNTRY EQ 'NP'.
          IF <FS_TAS1>-REG EQ 'D-KHAT'.
            WA_TOP1-BZIRK = <FS_TAS1>-RM.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
          IF <FS_TAS1>-REG NE 'D-KHAT'.
            WA_TOP1-BZIRK = <FS_TAS1>-RM.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
          WA_TOP1-BZIRK = <FS_TAS1>-RM.
          WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
          COLLECT WA_TOP1 INTO IT_TOP1.
          CLEAR WA_TOP1.
        ENDIF.
      ELSE.
        IF WA_TAG1-FROM_DT LE <FS_TAS1>-DOJ.
          IF WA_TAG1-COUNTRY EQ 'NP'.
            IF <FS_TAS1>-REG EQ 'D-KHAT'.
              WA_TOP1-BZIRK = <FS_TAS1>-RM.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
            IF <FS_TAS1>-REG NE 'D-KHAT'.
              WA_TOP1-BZIRK = <FS_TAS1>-RM.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
            WA_TOP1-BZIRK = <FS_TAS1>-RM.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ENDIF.
      ENDIF.
    ENDLOOP.
*  ENDFORM.                    "rv
  ENDIF.
*endloop.
*endif.



  SORT IT_TOP1 DESCENDING BY NETVAL.
  LOOP AT IT_TOP1 ASSIGNING <FS_TOP1>.
    READ TABLE IT_EX1 INTO WA_EX1 WITH KEY BZIRK = <FS_TOP1>-BZIRK MATNR = WA_TAG1-SAMP_PRD.
    IF SY-SUBRC NE 0.
*    WRITE : / 'P-PSO',<FS_TOP1>-BZIRK,<FS_TOP1>-NETVAL,COUNT.
      WA_TOP2-BZIRK = <FS_TOP1>-BZIRK.
      WA_TOP2-NETVAL = <FS_TOP1>-NETVAL.
      WA_TOP2-COUNT = COUNT.
      COLLECT WA_TOP2 INTO IT_TOP2.
      CLEAR WA_TOP2.
      COUNT = COUNT + 1.
    ENDIF.
  ENDLOOP.

  IF IT_TOP2 IS NOT INITIAL.
    LOOP AT IT_TOP2 INTO WA_TOP2 WHERE COUNT GE WA_TAG1-TOP1 AND COUNT LE WA_TAG1-TOP2.
      CLEAR :  DIV1,DCOUNT.
*      READ TABLE IT_DIV2 INTO WA_DIV2 WITH KEY RM = WA_TOP2-BZIRK SPART = '50'.
*      IF SY-SUBRC EQ 0.
*        READ TABLE IT_DIV2 INTO WA_DIV2 WITH KEY RM = WA_TOP2-BZIRK SPART = '60'.
*        IF SY-SUBRC EQ 0.
*          DIV1 = '99'.
*        ELSE.
*          DIV1 = '50'.
*        ENDIF.
*      ELSE.
*        DIV1 = '60'.
*      ENDIF.

      READ TABLE IT_DIV2 INTO WA_DIV2 WITH KEY RM = WA_TOP2-BZIRK SPART = '50'.
      IF SY-SUBRC EQ 0.
        DIV1 = '50'.
        DCOUNT = DCOUNT + 1.
      ENDIF.
      READ TABLE IT_DIV2 INTO WA_DIV2 WITH KEY RM = WA_TOP2-BZIRK SPART = '60'.
      IF SY-SUBRC EQ 0.
        DIV1 = 'XL'.
        DCOUNT = DCOUNT + 1.
      ENDIF.
      READ TABLE IT_DIV2 INTO WA_DIV2 WITH KEY RM = WA_TOP2-BZIRK SPART = '70'.
      IF SY-SUBRC EQ 0.
        DIV1 = '70'.
        DCOUNT = DCOUNT + 1.
      ENDIF.
      IF DCOUNT GT 1.
        DIV1 = '99'.
      ENDIF.

      ZSAMPPROCESS_WA-ZMONTH = MONTH.
      ZSAMPPROCESS_WA-ZYEAR = YEAR.
      ZSAMPPROCESS_WA-BZIRK = WA_TOP2-BZIRK.
      ZSAMPPROCESS_WA-SAMPCODE = WA_TAG1-SAMP_PRD.
      ZSAMPPROCESS_WA-DIV = DIV1.
      ZSAMPPROCESS_WA-SAMPQTY = WA_TAG1-SQTY.
*      collect zsampprocess_wa into it_zsampprocess_wa.
      MODIFY ZSAMPPROCESS FROM ZSAMPPROCESS_WA.
      CLEAR : ZSAMPPROCESS_WA.
    ENDLOOP.
  ENDIF.
*  modify zsampprocess from table it_zsampprocess_wa.
*  commit work and wait .
  CLEAR : IT_ZSAMPPROCESS_WA.
  CLEAR : IT_TOP2,IT_TOP1.

ENDFORM.                    "RV

*&---------------------------------------------------------------------*
*&      Form  ZV
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
FORM ZV.

  CLEAR DIV.
  FORMAT COLOR 3.
*  WRITE : / 'A',WA_TAG1-SAMP_PRD,WA_TAG1-DIV,WA_TAG1-COUNTRY,WA_TAG1-DRP,WA_TAG1-SALE_TYPE,WA_TAG1-ZGROUP,WA_TAG1-TOP1,
*  WA_TAG1-TOP2,WA_TAG1-SQTY,WA_TAG1-USE_MONTH,WA_TAG1-PRD_CODE,count1.
  COUNT1 = COUNT1 + 1.
*  if wa_tag1-sno eq '1'.
  COUNT = 1.
*  ENDIF.
  IF WA_TAG1-DIV EQ '00'.
*    SELECT SINGLE * FROM MARA WHERE MATNR EQ WA_TAG1-SAMP_PRD.
*    IF SY-SUBRC EQ 0.
*      IF MARA-SPART EQ '50'.
*        DIV = 'BC'.
*      ELSEIF MARA-SPART EQ '60'.
*        DIV = 'XL'.
*      ELSEIF MARA-SPART EQ '70'.
*        DIV = 'LS'.
*      ENDIF.
*    ENDIF.

    SELECT SINGLE * FROM ZSAMP_PRD  WHERE PRD_CODE EQ WA_TAG1-SAMP_PRD.  " product group take from table ZSAMP_PRD : JYOTSNA 27.2.24
    IF SY-SUBRC EQ 0.
      IF ZSAMP_PRD-GRP_DIV EQ '50'.
        DIV = 'BC'.
      ELSEIF ZSAMP_PRD-GRP_DIV EQ '60'.
        DIV = 'XL'.
      ELSEIF ZSAMP_PRD-GRP_DIV EQ '70'.
        DIV = 'LS'.
      ENDIF.
    ENDIF.

    FORMAT COLOR 4.
    LOOP AT IT_ZM1 ASSIGNING <FS_TAS1> WHERE ( DIV EQ DIV ) OR ( DIV EQ 'BCL' ).
      IF WA_TAG1-FROM_DT EQ 0.
        IF WA_TAG1-COUNTRY EQ 'NP'.
          IF <FS_TAS1>-REG EQ 'D-KHAT'.
            WA_TOP1-BZIRK = <FS_TAS1>-ZM.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
          IF <FS_TAS1>-REG NE 'D-KHAT'.
            WA_TOP1-BZIRK = <FS_TAS1>-ZM.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
          WA_TOP1-BZIRK = <FS_TAS1>-ZM.
          WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
          COLLECT WA_TOP1 INTO IT_TOP1.
          CLEAR WA_TOP1.
        ENDIF.
      ELSE.
        IF WA_TAG1-FROM_DT LE <FS_TAS1>-DOJ.
          IF WA_TAG1-COUNTRY EQ 'NP'.
            IF <FS_TAS1>-REG EQ 'D-KHAT'.
              WA_TOP1-BZIRK = <FS_TAS1>-ZM.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
            IF <FS_TAS1>-REG NE 'D-KHAT'.
              WA_TOP1-BZIRK = <FS_TAS1>-ZM.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
            WA_TOP1-BZIRK = <FS_TAS1>-ZM.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ENDIF.
      ENDIF.
    ENDLOOP.
  ELSEIF WA_TAG1-DIV EQ '50'.
    LOOP AT IT_ZM1 ASSIGNING <FS_TAS1> WHERE DIV EQ 'BC'.
      IF WA_TAG1-FROM_DT EQ 0.
        IF WA_TAG1-COUNTRY EQ 'NP'.
          IF <FS_TAS1>-REG EQ 'D-KHAT'.
            WA_TOP1-BZIRK = <FS_TAS1>-ZM.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
          IF <FS_TAS1>-REG NE 'D-KHAT'.
            WA_TOP1-BZIRK = <FS_TAS1>-ZM.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
          WA_TOP1-BZIRK = <FS_TAS1>-ZM.
          WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
          COLLECT WA_TOP1 INTO IT_TOP1.
          CLEAR WA_TOP1.
        ENDIF.
      ELSE.
        IF WA_TAG1-FROM_DT LE <FS_TAS1>-DOJ.
          IF WA_TAG1-COUNTRY EQ 'NP'.
            IF <FS_TAS1>-REG EQ 'D-KHAT'.
              WA_TOP1-BZIRK = <FS_TAS1>-ZM.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
            IF <FS_TAS1>-REG NE 'D-KHAT'.
              WA_TOP1-BZIRK = <FS_TAS1>-ZM.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
            WA_TOP1-BZIRK = <FS_TAS1>-ZM.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ENDIF.
      ENDIF.
    ENDLOOP.
**********************************************
  ELSEIF WA_TAG1-DIV EQ '60'.
    LOOP AT IT_ZM1 ASSIGNING <FS_TAS1> WHERE DIV EQ 'XL'.
      IF WA_TAG1-FROM_DT EQ 0.
        IF WA_TAG1-COUNTRY EQ 'NP'.
          IF <FS_TAS1>-REG EQ 'D-KHAT'.
            WA_TOP1-BZIRK = <FS_TAS1>-ZM.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
          IF <FS_TAS1>-REG NE 'D-KHAT'.
            WA_TOP1-BZIRK = <FS_TAS1>-ZM.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
          WA_TOP1-BZIRK = <FS_TAS1>-ZM.
          WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
          COLLECT WA_TOP1 INTO IT_TOP1.
          CLEAR WA_TOP1.
        ENDIF.
      ELSE.
        IF WA_TAG1-FROM_DT LE <FS_TAS1>-DOJ.
          IF WA_TAG1-COUNTRY EQ 'NP'.
            IF <FS_TAS1>-REG EQ 'D-KHAT'.
              WA_TOP1-BZIRK = <FS_TAS1>-ZM.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
            IF <FS_TAS1>-REG NE 'D-KHAT'.
              WA_TOP1-BZIRK = <FS_TAS1>-ZM.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
            WA_TOP1-BZIRK = <FS_TAS1>-ZM.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ENDIF.
      ENDIF.
    ENDLOOP.

*****************************************************
**********************************************
  ELSEIF WA_TAG1-DIV EQ '70'.
    LOOP AT IT_ZM1 ASSIGNING <FS_TAS1> WHERE DIV EQ 'LS'.
      IF WA_TAG1-FROM_DT EQ 0.
        IF WA_TAG1-COUNTRY EQ 'NP'.
          IF <FS_TAS1>-REG EQ 'D-KHAT'.
            WA_TOP1-BZIRK = <FS_TAS1>-ZM.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
          IF <FS_TAS1>-REG NE 'D-KHAT'.
            WA_TOP1-BZIRK = <FS_TAS1>-ZM.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
          WA_TOP1-BZIRK = <FS_TAS1>-ZM.
          WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
          COLLECT WA_TOP1 INTO IT_TOP1.
          CLEAR WA_TOP1.
        ENDIF.
      ELSE.
        IF WA_TAG1-FROM_DT LE <FS_TAS1>-DOJ.
          IF WA_TAG1-COUNTRY EQ 'NP'.
            IF <FS_TAS1>-REG EQ 'D-KHAT'.
              WA_TOP1-BZIRK = <FS_TAS1>-ZM.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
            IF <FS_TAS1>-REG NE 'D-KHAT'.
              WA_TOP1-BZIRK = <FS_TAS1>-ZM.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
            WA_TOP1-BZIRK = <FS_TAS1>-ZM.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ENDIF.
      ENDIF.
    ENDLOOP.
*******************************************************
  ELSEIF WA_TAG1-DIV EQ '99'.
    LOOP AT IT_ZM1 ASSIGNING <FS_TAS1> WHERE DIV EQ 'BCL'.
      IF WA_TAG1-FROM_DT EQ 0.
        IF WA_TAG1-COUNTRY EQ 'NP'.
          IF <FS_TAS1>-REG EQ 'D-KHAT'.
            WA_TOP1-BZIRK = <FS_TAS1>-ZM.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
          IF <FS_TAS1>-REG NE 'D-KHAT'.
            WA_TOP1-BZIRK = <FS_TAS1>-ZM.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
          WA_TOP1-BZIRK = <FS_TAS1>-ZM.
          WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
          COLLECT WA_TOP1 INTO IT_TOP1.
          CLEAR WA_TOP1.
        ENDIF.
      ELSE.
        IF WA_TAG1-FROM_DT LE <FS_TAS1>-DOJ.
          IF WA_TAG1-COUNTRY EQ 'NP'.
            IF <FS_TAS1>-REG EQ 'D-KHAT'.
              WA_TOP1-BZIRK = <FS_TAS1>-ZM.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
            IF <FS_TAS1>-REG NE 'D-KHAT'.
              WA_TOP1-BZIRK = <FS_TAS1>-ZM.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
            WA_TOP1-BZIRK = <FS_TAS1>-ZM.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ENDIF.
      ENDIF.
    ENDLOOP.
  ENDIF.

  SORT IT_TOP1 DESCENDING BY NETVAL.
  LOOP AT IT_TOP1 ASSIGNING <FS_TOP1>.
    READ TABLE IT_EX1 INTO WA_EX1 WITH KEY BZIRK = <FS_TOP1>-BZIRK MATNR = WA_TAG1-SAMP_PRD.
    IF SY-SUBRC NE 0.
*    WRITE : / 'P-PSO',<FS_TOP1>-BZIRK,<FS_TOP1>-NETVAL,COUNT.
      WA_TOP2-BZIRK = <FS_TOP1>-BZIRK.
      WA_TOP2-NETVAL = <FS_TOP1>-NETVAL.
      WA_TOP2-COUNT = COUNT.
      COLLECT WA_TOP2 INTO IT_TOP2.
      CLEAR WA_TOP2.
      COUNT = COUNT + 1.
    ENDIF.
  ENDLOOP.

  IF IT_TOP2 IS NOT INITIAL.
    LOOP AT IT_TOP2 INTO WA_TOP2 WHERE COUNT GE WA_TAG1-TOP1 AND COUNT LE WA_TAG1-TOP2.
      CLEAR :  DIV1,DCOUNT.
*      READ TABLE IT_DIV2 INTO WA_DIV2 WITH KEY ZM = WA_TOP2-BZIRK SPART = '50'.
*      IF SY-SUBRC EQ 0.
*        READ TABLE IT_DIV2 INTO WA_DIV2 WITH KEY ZM = WA_TOP2-BZIRK SPART = '60'.
*        IF SY-SUBRC EQ 0.
*          DIV1 = '99'.
*        ELSE.
*          DIV1 = '50'.
*        ENDIF.
*      ELSE.
*        DIV1 = '60'.
*      ENDIF.
      READ TABLE IT_DIV2 INTO WA_DIV2 WITH KEY ZM = WA_TOP2-BZIRK SPART = '50'.
      IF SY-SUBRC EQ 0.
        DIV1 = '50'.
        DCOUNT = DCOUNT + 1.
      ENDIF.
      READ TABLE IT_DIV2 INTO WA_DIV2 WITH KEY ZM = WA_TOP2-BZIRK SPART = '60'.
      IF SY-SUBRC EQ 0.
        DIV1 = '60'.
        DCOUNT = DCOUNT + 1.
      ENDIF.
      READ TABLE IT_DIV2 INTO WA_DIV2 WITH KEY ZM = WA_TOP2-BZIRK SPART = '70'.
      IF SY-SUBRC EQ 0.
        DIV1 = '70'.
        DCOUNT = DCOUNT + 1.
      ENDIF.
      IF DCOUNT GT 1.
        DIV1 = '99'.
      ENDIF.

      ZSAMPPROCESS_WA-ZMONTH = MONTH.
      ZSAMPPROCESS_WA-ZYEAR = YEAR.
      ZSAMPPROCESS_WA-BZIRK = WA_TOP2-BZIRK.
      ZSAMPPROCESS_WA-SAMPCODE = WA_TAG1-SAMP_PRD.
      ZSAMPPROCESS_WA-DIV = DIV1.
      ZSAMPPROCESS_WA-SAMPQTY = WA_TAG1-SQTY.
*      collect zsampprocess_wa into it_zsampprocess_wa.
      MODIFY ZSAMPPROCESS FROM ZSAMPPROCESS_WA.
      CLEAR : ZSAMPPROCESS_WA.
    ENDLOOP.
  ENDIF.
*  modify zsampprocess from table it_zsampprocess_wa.
*  commit work and wait .
  CLEAR : IT_ZSAMPPROCESS_WA.
  CLEAR : IT_TOP2,IT_TOP1.
ENDFORM.                    "ZV

*&---------------------------------------------------------------------*
*&      Form  DV
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
FORM DV.
  CLEAR DIV.
  FORMAT COLOR 3.
*  WRITE : / 'A',WA_TAG1-SAMP_PRD,WA_TAG1-DIV,WA_TAG1-COUNTRY,WA_TAG1-DRP,WA_TAG1-SALE_TYPE,WA_TAG1-ZGROUP,WA_TAG1-TOP1,
*  WA_TAG1-TOP2,WA_TAG1-SQTY,WA_TAG1-USE_MONTH,WA_TAG1-PRD_CODE,count1.
  COUNT1 = COUNT1 + 1.
*  if wa_tag1-sno eq '1'.
  COUNT = 1.
*  ENDIF.
  IF WA_TAG1-DIV EQ '00'.
*    SELECT SINGLE * FROM MARA WHERE MATNR EQ WA_TAG1-SAMP_PRD.
*    IF SY-SUBRC EQ 0.
*      IF MARA-SPART EQ '50'.
*        DIV = 'BC'.
*      ELSEIF MARA-SPART EQ '60'.
*        DIV = 'XL'.
*      ELSEIF MARA-SPART EQ '70'.
*        DIV = 'LS'.
*      ENDIF.
*    ENDIF.
    SELECT SINGLE * FROM ZSAMP_PRD  WHERE PRD_CODE EQ WA_TAG1-SAMP_PRD.  " product group take from table ZSAMP_PRD : JYOTSNA 27.2.24
    IF SY-SUBRC EQ 0.
      IF ZSAMP_PRD-GRP_DIV EQ '50'.
        DIV = 'BC'.
      ELSEIF ZSAMP_PRD-GRP_DIV EQ '60'.
        DIV = 'XL'.
      ELSEIF ZSAMP_PRD-GRP_DIV EQ '70'.
        DIV = 'LS'.
      ENDIF.
    ENDIF.

    FORMAT COLOR 4.
    LOOP AT IT_REG1 ASSIGNING <FS_TAS1> WHERE ( DIV EQ DIV ) OR ( DIV EQ 'BCL' ).
      IF WA_TAG1-FROM_DT EQ 0.
        IF WA_TAG1-COUNTRY EQ 'NP'.
          IF <FS_TAS1>-REG EQ 'D-KHAT'.
            WA_TOP1-BZIRK = <FS_TAS1>-REG.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
          IF <FS_TAS1>-REG NE 'D-KHAT'.
            WA_TOP1-BZIRK = <FS_TAS1>-REG.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
          WA_TOP1-BZIRK = <FS_TAS1>-REG.
          WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
          COLLECT WA_TOP1 INTO IT_TOP1.
          CLEAR WA_TOP1.
        ENDIF.
      ELSE.
        IF WA_TAG1-FROM_DT LE <FS_TAS1>-DOJ.
          IF WA_TAG1-COUNTRY EQ 'NP'.
            IF <FS_TAS1>-REG EQ 'D-KHAT'.
              WA_TOP1-BZIRK = <FS_TAS1>-REG.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
            IF <FS_TAS1>-REG NE 'D-KHAT'.
              WA_TOP1-BZIRK = <FS_TAS1>-REG.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
            WA_TOP1-BZIRK = <FS_TAS1>-REG.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ENDIF.
      ENDIF.
    ENDLOOP.
  ELSEIF WA_TAG1-DIV EQ '50'.
    LOOP AT IT_REG1 ASSIGNING <FS_TAS1> WHERE DIV EQ 'BC'.
      IF WA_TAG1-FROM_DT EQ 0.
        IF WA_TAG1-COUNTRY EQ 'NP'.
          IF <FS_TAS1>-REG EQ 'D-KHAT'.
            WA_TOP1-BZIRK = <FS_TAS1>-REG.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
          IF <FS_TAS1>-REG NE 'D-KHAT'.
            WA_TOP1-BZIRK = <FS_TAS1>-REG.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
          WA_TOP1-BZIRK = <FS_TAS1>-REG.
          WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
          COLLECT WA_TOP1 INTO IT_TOP1.
          CLEAR WA_TOP1.
        ENDIF.
      ELSE.
        IF WA_TAG1-FROM_DT LE <FS_TAS1>-DOJ.
          IF WA_TAG1-COUNTRY EQ 'NP'.
            IF <FS_TAS1>-REG EQ 'D-KHAT'.
              WA_TOP1-BZIRK = <FS_TAS1>-REG.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
            IF <FS_TAS1>-REG NE 'D-KHAT'.
              WA_TOP1-BZIRK = <FS_TAS1>-REG.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
            WA_TOP1-BZIRK = <FS_TAS1>-REG.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ENDIF.
      ENDIF.
    ENDLOOP.
**************************************************
  ELSEIF WA_TAG1-DIV EQ '60'.
    LOOP AT IT_REG1 ASSIGNING <FS_TAS1> WHERE DIV EQ 'XL'.
      IF WA_TAG1-FROM_DT EQ 0.
        IF WA_TAG1-COUNTRY EQ 'NP'.
          IF <FS_TAS1>-REG EQ 'D-KHAT'.
            WA_TOP1-BZIRK = <FS_TAS1>-REG.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
          IF <FS_TAS1>-REG NE 'D-KHAT'.
            WA_TOP1-BZIRK = <FS_TAS1>-REG.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
          WA_TOP1-BZIRK = <FS_TAS1>-REG.
          WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
          COLLECT WA_TOP1 INTO IT_TOP1.
          CLEAR WA_TOP1.
        ENDIF.
      ELSE.
        IF WA_TAG1-FROM_DT LE <FS_TAS1>-DOJ.
          IF WA_TAG1-COUNTRY EQ 'NP'.
            IF <FS_TAS1>-REG EQ 'D-KHAT'.
              WA_TOP1-BZIRK = <FS_TAS1>-REG.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
            IF <FS_TAS1>-REG NE 'D-KHAT'.
              WA_TOP1-BZIRK = <FS_TAS1>-REG.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
            WA_TOP1-BZIRK = <FS_TAS1>-REG.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ENDIF.
      ENDIF.
    ENDLOOP.
********************************************************************
*    **************************************************
  ELSEIF WA_TAG1-DIV EQ '70'.
    LOOP AT IT_REG1 ASSIGNING <FS_TAS1> WHERE DIV EQ 'LS'.
      IF WA_TAG1-FROM_DT EQ 0.
        IF WA_TAG1-COUNTRY EQ 'NP'.
          IF <FS_TAS1>-REG EQ 'D-KHAT'.
            WA_TOP1-BZIRK = <FS_TAS1>-REG.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
          IF <FS_TAS1>-REG NE 'D-KHAT'.
            WA_TOP1-BZIRK = <FS_TAS1>-REG.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
          WA_TOP1-BZIRK = <FS_TAS1>-REG.
          WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
          COLLECT WA_TOP1 INTO IT_TOP1.
          CLEAR WA_TOP1.
        ENDIF.
      ELSE.
        IF WA_TAG1-FROM_DT LE <FS_TAS1>-DOJ.
          IF WA_TAG1-COUNTRY EQ 'NP'.
            IF <FS_TAS1>-REG EQ 'D-KHAT'.
              WA_TOP1-BZIRK = <FS_TAS1>-REG.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
            IF <FS_TAS1>-REG NE 'D-KHAT'.
              WA_TOP1-BZIRK = <FS_TAS1>-REG.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
            WA_TOP1-BZIRK = <FS_TAS1>-REG.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ENDIF.
      ENDIF.
    ENDLOOP.
********************************************************************
***********************************************
  ELSEIF WA_TAG1-DIV EQ '99'.
    LOOP AT IT_REG1 ASSIGNING <FS_TAS1> WHERE DIV EQ 'BCL'.
      IF WA_TAG1-FROM_DT EQ 0.
        IF WA_TAG1-COUNTRY EQ 'NP'.
          IF <FS_TAS1>-REG EQ 'D-KHAT'.
            WA_TOP1-BZIRK = <FS_TAS1>-REG.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
          IF <FS_TAS1>-REG NE 'D-KHAT'.
            WA_TOP1-BZIRK = <FS_TAS1>-REG.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
          WA_TOP1-BZIRK = <FS_TAS1>-REG.
          WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
          COLLECT WA_TOP1 INTO IT_TOP1.
          CLEAR WA_TOP1.
        ENDIF.
      ELSE.
        IF WA_TAG1-FROM_DT LE <FS_TAS1>-DOJ.
          IF WA_TAG1-COUNTRY EQ 'NP'.
            IF <FS_TAS1>-REG EQ 'D-KHAT'.
              WA_TOP1-BZIRK = <FS_TAS1>-REG.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
            IF <FS_TAS1>-REG NE 'D-KHAT'.
              WA_TOP1-BZIRK = <FS_TAS1>-REG.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
            WA_TOP1-BZIRK = <FS_TAS1>-REG.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ENDIF.
      ENDIF.
    ENDLOOP.
  ENDIF.

  SORT IT_TOP1 DESCENDING BY NETVAL.
  LOOP AT IT_TOP1 ASSIGNING <FS_TOP1>.
    READ TABLE IT_EX1 INTO WA_EX1 WITH KEY BZIRK = <FS_TOP1>-BZIRK MATNR = WA_TAG1-SAMP_PRD.
    IF SY-SUBRC NE 0.
*    WRITE : / 'P-PSO',<FS_TOP1>-BZIRK,<FS_TOP1>-NETVAL,COUNT.
      WA_TOP2-BZIRK = <FS_TOP1>-BZIRK.
      WA_TOP2-NETVAL = <FS_TOP1>-NETVAL.
      WA_TOP2-COUNT = COUNT.
      COLLECT WA_TOP2 INTO IT_TOP2.
      CLEAR WA_TOP2.
      COUNT = COUNT + 1.
    ENDIF.
  ENDLOOP.
  IF IT_TOP2 IS NOT INITIAL.
    LOOP AT IT_TOP2 INTO WA_TOP2 WHERE COUNT GE WA_TAG1-TOP1 AND COUNT LE WA_TAG1-TOP2.
*    WRITE : / '****P-PSO',<FS_TOP1>-BZIRK,<FS_TOP1>-NETVAL,<FS_TOP1>-COUNT.
*    wa_tag1-top1,wa_tag1-top2.
      CLEAR :  DIV1,DCOUNT.

*      READ TABLE IT_DIV2 INTO WA_DIV2 WITH KEY REG = WA_TOP2-BZIRK SPART = '50'.
*      IF SY-SUBRC EQ 0.
*        READ TABLE IT_DIV2 INTO WA_DIV2 WITH KEY REG = WA_TOP2-BZIRK SPART = '60'.
*        IF SY-SUBRC EQ 0.
*          DIV1 = '99'.
*        ELSE.
*          DIV1 = '50'.
*        ENDIF.
*      ELSE.
*        DIV1 = '60'.
*      ENDIF.
      READ TABLE IT_DIV2 INTO WA_DIV2 WITH KEY REG = WA_TOP2-BZIRK SPART = '50'.
      IF SY-SUBRC EQ 0.
        DIV1 = '50'.
        DCOUNT = DCOUNT + 1.
      ENDIF.
      READ TABLE IT_DIV2 INTO WA_DIV2 WITH KEY REG = WA_TOP2-BZIRK SPART = '60'.
      IF SY-SUBRC EQ 0.
        DIV1 = '60'.
        DCOUNT = DCOUNT + 1.
      ENDIF.
      READ TABLE IT_DIV2 INTO WA_DIV2 WITH KEY REG = WA_TOP2-BZIRK SPART = '70'.
      IF SY-SUBRC EQ 0.
        DIV1 = '70'.
        DCOUNT = DCOUNT + 1.
      ENDIF.
      IF DCOUNT GT 1.
        DIV1 = '99'.
      ENDIF.


      ZSAMPPROCESS_WA-ZMONTH = MONTH.
      ZSAMPPROCESS_WA-ZYEAR = YEAR.
      ZSAMPPROCESS_WA-BZIRK = WA_TOP2-BZIRK.
      ZSAMPPROCESS_WA-SAMPCODE = WA_TAG1-SAMP_PRD.
      ZSAMPPROCESS_WA-DIV = DIV1.
      ZSAMPPROCESS_WA-SAMPQTY = WA_TAG1-SQTY.
*      collect zsampprocess_wa into it_zsampprocess_wa.
      MODIFY ZSAMPPROCESS FROM ZSAMPPROCESS_WA.
      CLEAR : ZSAMPPROCESS_WA.
    ENDLOOP.
  ENDIF.
*  modify zsampprocess from table it_zsampprocess_wa.
*  commit work and wait .
  CLEAR : IT_ZSAMPPROCESS_WA.
  CLEAR : IT_TOP2,IT_TOP1.

ENDFORM.                    "DV

*&---------------------------------------------------------------------*
*&      Form  PA
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
FORM PA.

  CLEAR DIV.
  FORMAT COLOR 3.
*  WRITE : / 'A',WA_TAG1-SAMP_PRD,WA_TAG1-DIV,WA_TAG1-COUNTRY,WA_TAG1-DRP,WA_TAG1-SALE_TYPE,WA_TAG1-ZGROUP,WA_TAG1-TOP1,
*  WA_TAG1-TOP2,WA_TAG1-SQTY,WA_TAG1-USE_MONTH,WA_TAG1-PRD_CODE,count1.
  COUNT1 = COUNT1 + 1.
*  if wa_tag1-sno eq '1'.
  COUNT = 1.
*  ENDIF.
  IF WA_TAG1-DIV EQ '00'.
*    SELECT SINGLE * FROM MARA WHERE MATNR EQ WA_TAG1-SAMP_PRD.
*    IF SY-SUBRC EQ 0.
*      IF MARA-SPART EQ '50'.
*        DIV = 'BC'.
*      ELSEIF MARA-SPART EQ '60'.
*        DIV = 'XL'.
*      ELSEIF MARA-SPART EQ '70'.
*        DIV = 'LS'.
*      ENDIF.
*    ENDIF.
    SELECT SINGLE * FROM ZSAMP_PRD  WHERE PRD_CODE EQ WA_TAG1-SAMP_PRD.  " product group take from table ZSAMP_PRD : JYOTSNA 27.2.24
    IF SY-SUBRC EQ 0.
      IF ZSAMP_PRD-GRP_DIV EQ '50'.
        DIV = 'BC'.
      ELSEIF ZSAMP_PRD-GRP_DIV EQ '60'.
        DIV = 'XL'.
      ELSEIF ZSAMP_PRD-GRP_DIV EQ '70'.
        DIV = 'LS'.
      ENDIF.
    ENDIF.

    FORMAT COLOR 4.
    LOOP AT IT_PSO1 ASSIGNING <FS_TAS1> WHERE ( DIV EQ DIV ) OR ( DIV EQ 'BCL' ).
      IF WA_TAG1-FROM_DT EQ 0.
        IF WA_TAG1-COUNTRY EQ 'NP'.
          IF <FS_TAS1>-REG EQ 'D-KHAT'.
            WA_TOP1-BZIRK = <FS_TAS1>-BZIRK.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
          IF <FS_TAS1>-REG NE 'D-KHAT'.
            WA_TOP1-BZIRK = <FS_TAS1>-BZIRK.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
          WA_TOP1-BZIRK = <FS_TAS1>-BZIRK.
          WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
          COLLECT WA_TOP1 INTO IT_TOP1.
          CLEAR WA_TOP1.
        ENDIF.
      ELSE.
        IF WA_TAG1-FROM_DT LE <FS_TAS1>-DOJ.
          IF WA_TAG1-COUNTRY EQ 'NP'.
            IF <FS_TAS1>-REG EQ 'D-KHAT'.
              WA_TOP1-BZIRK = <FS_TAS1>-BZIRK.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
            IF <FS_TAS1>-REG NE 'D-KHAT'.
              WA_TOP1-BZIRK = <FS_TAS1>-BZIRK.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
            WA_TOP1-BZIRK = <FS_TAS1>-BZIRK.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ENDIF.
      ENDIF.
    ENDLOOP.
  ELSEIF WA_TAG1-DIV EQ '50'.
    LOOP AT IT_PSO1 ASSIGNING <FS_TAS1> WHERE DIV EQ 'BC'.
      IF WA_TAG1-FROM_DT EQ 0.
        IF WA_TAG1-COUNTRY EQ 'NP'.
          IF <FS_TAS1>-REG EQ 'D-KHAT'.
            WA_TOP1-BZIRK = <FS_TAS1>-BZIRK.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
          IF <FS_TAS1>-REG NE 'D-KHAT'.
            WA_TOP1-BZIRK = <FS_TAS1>-BZIRK.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
          WA_TOP1-BZIRK = <FS_TAS1>-BZIRK.
          WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
          COLLECT WA_TOP1 INTO IT_TOP1.
          CLEAR WA_TOP1.
        ENDIF.
      ELSE.
        IF WA_TAG1-FROM_DT LE <FS_TAS1>-DOJ.
          IF WA_TAG1-COUNTRY EQ 'NP'.
            IF <FS_TAS1>-REG EQ 'D-KHAT'.
              WA_TOP1-BZIRK = <FS_TAS1>-BZIRK.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
            IF <FS_TAS1>-REG NE 'D-KHAT'.
              WA_TOP1-BZIRK = <FS_TAS1>-BZIRK.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
            WA_TOP1-BZIRK = <FS_TAS1>-BZIRK.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ENDIF.
      ENDIF.
    ENDLOOP.
******************************************************************************
  ELSEIF WA_TAG1-DIV EQ '60'.
    LOOP AT IT_PSO1 ASSIGNING <FS_TAS1> WHERE DIV EQ 'XL'.
      IF WA_TAG1-FROM_DT EQ 0.
        IF WA_TAG1-COUNTRY EQ 'NP'.
          IF <FS_TAS1>-REG EQ 'D-KHAT'.
            WA_TOP1-BZIRK = <FS_TAS1>-BZIRK.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
          IF <FS_TAS1>-REG NE 'D-KHAT'.
            WA_TOP1-BZIRK = <FS_TAS1>-BZIRK.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
          WA_TOP1-BZIRK = <FS_TAS1>-BZIRK.
          WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
          COLLECT WA_TOP1 INTO IT_TOP1.
          CLEAR WA_TOP1.
        ENDIF.
      ELSE.
        IF WA_TAG1-FROM_DT LE <FS_TAS1>-DOJ.
          IF WA_TAG1-COUNTRY EQ 'NP'.
            IF <FS_TAS1>-REG EQ 'D-KHAT'.
              WA_TOP1-BZIRK = <FS_TAS1>-BZIRK.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
            IF <FS_TAS1>-REG NE 'D-KHAT'.
              WA_TOP1-BZIRK = <FS_TAS1>-BZIRK.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
            WA_TOP1-BZIRK = <FS_TAS1>-BZIRK.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ENDIF.
      ENDIF.
    ENDLOOP.
**************************************
*    ******************************************************************************
  ELSEIF WA_TAG1-DIV EQ '70'.
    LOOP AT IT_PSO1 ASSIGNING <FS_TAS1> WHERE DIV EQ 'LS'.
      IF WA_TAG1-FROM_DT EQ 0.
        IF WA_TAG1-COUNTRY EQ 'NP'.
          IF <FS_TAS1>-REG EQ 'D-KHAT'.
            WA_TOP1-BZIRK = <FS_TAS1>-BZIRK.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
          IF <FS_TAS1>-REG NE 'D-KHAT'.
            WA_TOP1-BZIRK = <FS_TAS1>-BZIRK.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
          WA_TOP1-BZIRK = <FS_TAS1>-BZIRK.
          WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
          COLLECT WA_TOP1 INTO IT_TOP1.
          CLEAR WA_TOP1.
        ENDIF.
      ELSE.
        IF WA_TAG1-FROM_DT LE <FS_TAS1>-DOJ.
          IF WA_TAG1-COUNTRY EQ 'NP'.
            IF <FS_TAS1>-REG EQ 'D-KHAT'.
              WA_TOP1-BZIRK = <FS_TAS1>-BZIRK.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
            IF <FS_TAS1>-REG NE 'D-KHAT'.
              WA_TOP1-BZIRK = <FS_TAS1>-BZIRK.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
            WA_TOP1-BZIRK = <FS_TAS1>-BZIRK.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ENDIF.
      ENDIF.
    ENDLOOP.
*******************************************************************
  ELSEIF WA_TAG1-DIV EQ '99'.
    LOOP AT IT_PSO1 ASSIGNING <FS_TAS1> WHERE DIV EQ 'BCL'.
      IF WA_TAG1-FROM_DT EQ 0.
        IF WA_TAG1-COUNTRY EQ 'NP'.
          IF <FS_TAS1>-REG EQ 'D-KHAT'.
            WA_TOP1-BZIRK = <FS_TAS1>-BZIRK.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
          IF <FS_TAS1>-REG NE 'D-KHAT'.
            WA_TOP1-BZIRK = <FS_TAS1>-BZIRK.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
          WA_TOP1-BZIRK = <FS_TAS1>-BZIRK.
          WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
          COLLECT WA_TOP1 INTO IT_TOP1.
          CLEAR WA_TOP1.
        ENDIF.
      ELSE.
        IF WA_TAG1-FROM_DT LE <FS_TAS1>-DOJ.
          IF WA_TAG1-COUNTRY EQ 'NP'.
            IF <FS_TAS1>-REG EQ 'D-KHAT'.
              WA_TOP1-BZIRK = <FS_TAS1>-BZIRK.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
            IF <FS_TAS1>-REG NE 'D-KHAT'.
              WA_TOP1-BZIRK = <FS_TAS1>-BZIRK.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
            WA_TOP1-BZIRK = <FS_TAS1>-BZIRK.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ENDIF.
      ENDIF.
    ENDLOOP.
  ENDIF.



  SORT IT_TOP1 DESCENDING BY NETVAL.
  LOOP AT IT_TOP1 ASSIGNING <FS_TOP1>.
    READ TABLE IT_EX1 INTO WA_EX1 WITH KEY BZIRK = <FS_TOP1>-BZIRK MATNR = WA_TAG1-SAMP_PRD.
    IF SY-SUBRC NE 0.
*    WRITE : / 'P-PSO',<FS_TOP1>-BZIRK,<FS_TOP1>-NETVAL,COUNT.
      WA_TOP2-BZIRK = <FS_TOP1>-BZIRK.
      WA_TOP2-NETVAL = <FS_TOP1>-NETVAL.
      WA_TOP2-COUNT = COUNT.
      COLLECT WA_TOP2 INTO IT_TOP2.
      CLEAR WA_TOP2.
      COUNT = COUNT + 1.
    ENDIF.
  ENDLOOP.
  IF IT_TOP2 IS NOT INITIAL.
    LOOP AT IT_TOP2 INTO WA_TOP2 WHERE BZIRK NE '      '.
*     WHERE COUNT ge wa_tag1-top1 AND count le wa_tag1-top2.
*    WRITE : / '****P-PSO',<FS_TOP1>-BZIRK,<FS_TOP1>-NETVAL,<FS_TOP1>-COUNT.
*    wa_tag1-top1,wa_tag1-top2.
      CLEAR : DIV1,DCOUNT.
*      READ TABLE IT_DIV2 INTO WA_DIV2 WITH KEY BZIRK = WA_TOP2-BZIRK SPART = '50'.
*      IF SY-SUBRC EQ 0.
*        READ TABLE IT_DIV2 INTO WA_DIV2 WITH KEY BZIRK = WA_TOP2-BZIRK SPART = '60'.
*        IF SY-SUBRC EQ 0.
*          DIV1 = '99'.
*        ELSE.
*          DIV1 = '50'.
*        ENDIF.
*      ELSE.
*        DIV1 = '60'.
*      ENDIF.
      READ TABLE IT_DIV2 INTO WA_DIV2 WITH KEY BZIRK = WA_TOP2-BZIRK SPART = '50'.
      IF SY-SUBRC EQ 0.
        DIV1 = '50'.
        DCOUNT = DCOUNT + 1.
      ENDIF.
      READ TABLE IT_DIV2 INTO WA_DIV2 WITH KEY BZIRK = WA_TOP2-BZIRK SPART = '60'.
      IF SY-SUBRC EQ 0.
        DIV1 = '60'.
        DCOUNT = DCOUNT + 1.
      ENDIF.
      READ TABLE IT_DIV2 INTO WA_DIV2 WITH KEY BZIRK = WA_TOP2-BZIRK SPART = '70'.
      IF SY-SUBRC EQ 0.
        DIV1 = '70'.
        DCOUNT = DCOUNT + 1.
      ENDIF.
      IF DCOUNT GT 1.
        DIV1 = '99'.
      ENDIF.

      ZSAMPPROCESS_WA-ZMONTH = MONTH.
      ZSAMPPROCESS_WA-ZYEAR = YEAR.
      ZSAMPPROCESS_WA-BZIRK = WA_TOP2-BZIRK.
      ZSAMPPROCESS_WA-SAMPCODE = WA_TAG1-SAMP_PRD.
*      zsampprocess_wa-div = wa_tag1-div.
      ZSAMPPROCESS_WA-DIV = DIV1.
      ZSAMPPROCESS_WA-SAMPQTY = WA_TAG1-SQTY.

      MODIFY ZSAMPPROCESS FROM ZSAMPPROCESS_WA.
*      collect zsampprocess_wa into it_zsampprocess_wa.
      CLEAR : ZSAMPPROCESS_WA.
    ENDLOOP.
  ENDIF.
*  modify zsampprocess from table it_zsampprocess_wa.
*  commit work and wait .
  CLEAR : IT_ZSAMPPROCESS_WA.
  CLEAR : IT_TOP2,IT_TOP1.

ENDFORM.                    "PA

*&---------------------------------------------------------------------*
*&      Form  RA
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
FORM RA.

  CLEAR DIV.
  FORMAT COLOR 3.
*  WRITE : / 'A',WA_TAG1-SAMP_PRD,WA_TAG1-DIV,WA_TAG1-COUNTRY,WA_TAG1-DRP,WA_TAG1-SALE_TYPE,WA_TAG1-ZGROUP,WA_TAG1-TOP1,
*  WA_TAG1-TOP2,WA_TAG1-SQTY,WA_TAG1-USE_MONTH,WA_TAG1-PRD_CODE,count1.
  COUNT1 = COUNT1 + 1.
*  if wa_tag1-sno eq '1'.
  COUNT = 1.
*  ENDIF.
  IF WA_TAG1-DIV EQ '00'.
*    SELECT SINGLE * FROM MARA WHERE MATNR EQ WA_TAG1-SAMP_PRD.
*    IF SY-SUBRC EQ 0.
*      IF MARA-SPART EQ '50'.
*        DIV = 'BC'.
*      ELSEIF MARA-SPART EQ '60'.
*        DIV = 'XL'.
*      ELSEIF MARA-SPART EQ '70'.
*        DIV = 'LS'.
*      ENDIF.
*    ENDIF.

    SELECT SINGLE * FROM ZSAMP_PRD  WHERE PRD_CODE EQ WA_TAG1-SAMP_PRD.  " product group take from table ZSAMP_PRD : JYOTSNA 27.2.24
    IF SY-SUBRC EQ 0.
      IF ZSAMP_PRD-GRP_DIV EQ '50'.
        DIV = 'BC'.
      ELSEIF ZSAMP_PRD-GRP_DIV EQ '60'.
        DIV = 'XL'.
      ELSEIF ZSAMP_PRD-GRP_DIV EQ '70'.
        DIV = 'LS'.
      ENDIF.
    ENDIF.

    FORMAT COLOR 4.
    LOOP AT IT_RM1 ASSIGNING <FS_TAS1> WHERE ( DIV EQ DIV ) OR ( DIV EQ 'BCL' ).
      IF WA_TAG1-FROM_DT EQ 0.
        IF WA_TAG1-COUNTRY EQ 'NP'.
          IF <FS_TAS1>-REG EQ 'D-KHAT'.
            WA_TOP1-BZIRK = <FS_TAS1>-RM.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
          IF <FS_TAS1>-REG NE 'D-KHAT'.
            WA_TOP1-BZIRK = <FS_TAS1>-RM.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
          WA_TOP1-BZIRK = <FS_TAS1>-RM.
          WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
          COLLECT WA_TOP1 INTO IT_TOP1.
          CLEAR WA_TOP1.
        ENDIF.
      ELSE.
        IF WA_TAG1-FROM_DT LE <FS_TAS1>-DOJ.
          IF WA_TAG1-COUNTRY EQ 'NP'.
            IF <FS_TAS1>-REG EQ 'D-KHAT'.
              WA_TOP1-BZIRK = <FS_TAS1>-RM.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
            IF <FS_TAS1>-REG NE 'D-KHAT'.
              WA_TOP1-BZIRK = <FS_TAS1>-RM.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
            WA_TOP1-BZIRK = <FS_TAS1>-RM.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ENDIF.
      ENDIF.
    ENDLOOP.
  ELSEIF WA_TAG1-DIV EQ '50'.
    LOOP AT IT_RM1 ASSIGNING <FS_TAS1> WHERE DIV EQ 'BC'.
      IF WA_TAG1-FROM_DT EQ 0.
        IF WA_TAG1-COUNTRY EQ 'NP'.
          IF <FS_TAS1>-REG EQ 'D-KHAT'.
            WA_TOP1-BZIRK = <FS_TAS1>-RM.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
          IF <FS_TAS1>-REG NE 'D-KHAT'.
            WA_TOP1-BZIRK = <FS_TAS1>-RM.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
          WA_TOP1-BZIRK = <FS_TAS1>-RM.
          WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
          COLLECT WA_TOP1 INTO IT_TOP1.
          CLEAR WA_TOP1.
        ENDIF.
      ELSE.
        IF WA_TAG1-FROM_DT LE <FS_TAS1>-DOJ.
          IF WA_TAG1-COUNTRY EQ 'NP'.
            IF <FS_TAS1>-REG EQ 'D-KHAT'.
              WA_TOP1-BZIRK = <FS_TAS1>-RM.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
            IF <FS_TAS1>-REG NE 'D-KHAT'.
              WA_TOP1-BZIRK = <FS_TAS1>-RM.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
            WA_TOP1-BZIRK = <FS_TAS1>-RM.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ENDIF.
      ENDIF.
    ENDLOOP.
****************************************
  ELSEIF WA_TAG1-DIV EQ '60'.
    LOOP AT IT_RM1 ASSIGNING <FS_TAS1> WHERE DIV EQ 'XL'.
      IF WA_TAG1-FROM_DT EQ 0.
        IF WA_TAG1-COUNTRY EQ 'NP'.
          IF <FS_TAS1>-REG EQ 'D-KHAT'.
            WA_TOP1-BZIRK = <FS_TAS1>-RM.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
          IF <FS_TAS1>-REG NE 'D-KHAT'.
            WA_TOP1-BZIRK = <FS_TAS1>-RM.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
          WA_TOP1-BZIRK = <FS_TAS1>-RM.
          WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
          COLLECT WA_TOP1 INTO IT_TOP1.
          CLEAR WA_TOP1.
        ENDIF.
      ELSE.
        IF WA_TAG1-FROM_DT LE <FS_TAS1>-DOJ.
          IF WA_TAG1-COUNTRY EQ 'NP'.
            IF <FS_TAS1>-REG EQ 'D-KHAT'.
              WA_TOP1-BZIRK = <FS_TAS1>-ZM.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
            IF <FS_TAS1>-REG NE 'D-KHAT'.
              WA_TOP1-BZIRK = <FS_TAS1>-RM.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
            WA_TOP1-BZIRK = <FS_TAS1>-RM.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ENDIF.
      ENDIF.
    ENDLOOP.
****************************************************************
  ELSEIF WA_TAG1-DIV EQ '70'.
    LOOP AT IT_RM1 ASSIGNING <FS_TAS1> WHERE DIV EQ 'LS'.
      IF WA_TAG1-FROM_DT EQ 0.
        IF WA_TAG1-COUNTRY EQ 'NP'.
          IF <FS_TAS1>-REG EQ 'D-KHAT'.
            WA_TOP1-BZIRK = <FS_TAS1>-RM.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
          IF <FS_TAS1>-REG NE 'D-KHAT'.
            WA_TOP1-BZIRK = <FS_TAS1>-RM.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
          WA_TOP1-BZIRK = <FS_TAS1>-RM.
          WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
          COLLECT WA_TOP1 INTO IT_TOP1.
          CLEAR WA_TOP1.
        ENDIF.
      ELSE.
        IF WA_TAG1-FROM_DT LE <FS_TAS1>-DOJ.
          IF WA_TAG1-COUNTRY EQ 'NP'.
            IF <FS_TAS1>-REG EQ 'D-KHAT'.
              WA_TOP1-BZIRK = <FS_TAS1>-ZM.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
            IF <FS_TAS1>-REG NE 'D-KHAT'.
              WA_TOP1-BZIRK = <FS_TAS1>-RM.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
            WA_TOP1-BZIRK = <FS_TAS1>-RM.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ENDIF.
      ENDIF.
    ENDLOOP.
****************************************************************
  ELSEIF WA_TAG1-DIV EQ '99'.
    LOOP AT IT_RM1 ASSIGNING <FS_TAS1> WHERE DIV EQ 'BCL'.
      IF WA_TAG1-FROM_DT EQ 0.
        IF WA_TAG1-COUNTRY EQ 'NP'.
          IF <FS_TAS1>-REG EQ 'D-KHAT'.
            WA_TOP1-BZIRK = <FS_TAS1>-RM.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
          IF <FS_TAS1>-REG NE 'D-KHAT'.
            WA_TOP1-BZIRK = <FS_TAS1>-RM.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
          WA_TOP1-BZIRK = <FS_TAS1>-RM.
          WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
          COLLECT WA_TOP1 INTO IT_TOP1.
          CLEAR WA_TOP1.
        ENDIF.
      ELSE.
        IF WA_TAG1-FROM_DT LE <FS_TAS1>-DOJ.
          IF WA_TAG1-COUNTRY EQ 'NP'.
            IF <FS_TAS1>-REG EQ 'D-KHAT'.
              WA_TOP1-BZIRK = <FS_TAS1>-RM.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
            IF <FS_TAS1>-REG NE 'D-KHAT'.
              WA_TOP1-BZIRK = <FS_TAS1>-RM.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
            WA_TOP1-BZIRK = <FS_TAS1>-RM.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ENDIF.
      ENDIF.
    ENDLOOP.
  ENDIF.

  SORT IT_TOP1 DESCENDING BY NETVAL.
  LOOP AT IT_TOP1 ASSIGNING <FS_TOP1>.
    READ TABLE IT_EX1 INTO WA_EX1 WITH KEY BZIRK = <FS_TOP1>-BZIRK MATNR = WA_TAG1-SAMP_PRD.
    IF SY-SUBRC NE 0.
*    WRITE : / 'P-RM',<FS_TOP1>-BZIRK,<FS_TOP1>-NETVAL,COUNT.
      WA_TOP2-BZIRK = <FS_TOP1>-BZIRK.
      WA_TOP2-NETVAL = <FS_TOP1>-NETVAL.
      WA_TOP2-COUNT = COUNT.
      COLLECT WA_TOP2 INTO IT_TOP2.
      CLEAR WA_TOP2.
      COUNT = COUNT + 1.
    ENDIF.
  ENDLOOP.
  IF IT_TOP2 IS NOT INITIAL.
    LOOP AT IT_TOP2 INTO WA_TOP2 WHERE BZIRK NE '      '.
*     WHERE COUNT ge wa_tag1-top1 AND count le wa_tag1-top2.
*    WRITE : / '*RM ALL',<FS_TOP1>-BZIRK,<FS_TOP1>-NETVAL,<FS_TOP1>-COUNT.
*    wa_tag1-top1,wa_tag1-top2.
      CLEAR :  DIV1,DCOUNT.
*      READ TABLE IT_DIV2 INTO WA_DIV2 WITH KEY RM = WA_TOP2-BZIRK SPART = '50'.
*      IF SY-SUBRC EQ 0.
*        READ TABLE IT_DIV2 INTO WA_DIV2 WITH KEY RM = WA_TOP2-BZIRK SPART = '60'.
*        IF SY-SUBRC EQ 0.
*          DIV1 = '99'.
*        ELSE.
*          DIV1 = '50'.
*        ENDIF.
*      ELSE.
*        DIV1 = '60'.
*      ENDIF.

      READ TABLE IT_DIV2 INTO WA_DIV2 WITH KEY RM = WA_TOP2-BZIRK SPART = '50'.
      IF SY-SUBRC EQ 0.
        DIV1 = '50'.
        DCOUNT = DCOUNT + 1.
      ENDIF.
      READ TABLE IT_DIV2 INTO WA_DIV2 WITH KEY RM = WA_TOP2-BZIRK SPART = '60'.
      IF SY-SUBRC EQ 0.
        DIV1 = '60'.
        DCOUNT = DCOUNT + 1.
      ENDIF.
      READ TABLE IT_DIV2 INTO WA_DIV2 WITH KEY RM = WA_TOP2-BZIRK SPART = '70'.
      IF SY-SUBRC EQ 0.
        DIV1 = '70'.
        DCOUNT = DCOUNT + 1.
      ENDIF.
      IF DCOUNT GT 1.
        DIV1 = '99'.
      ENDIF.

      ZSAMPPROCESS_WA-ZMONTH = MONTH.
      ZSAMPPROCESS_WA-ZYEAR = YEAR.
      ZSAMPPROCESS_WA-BZIRK = WA_TOP2-BZIRK.
      ZSAMPPROCESS_WA-SAMPCODE = WA_TAG1-SAMP_PRD.
      ZSAMPPROCESS_WA-DIV = DIV1.
      ZSAMPPROCESS_WA-SAMPQTY = WA_TAG1-SQTY.
*      collect zsampprocess_wa into it_zsampprocess_wa.
      MODIFY ZSAMPPROCESS FROM ZSAMPPROCESS_WA.
      CLEAR : ZSAMPPROCESS_WA.
    ENDLOOP.
  ENDIF.
*  modify zsampprocess from table it_zsampprocess_wa.
*  commit work and wait .
  CLEAR : IT_ZSAMPPROCESS_WA.
  CLEAR : IT_TOP2,IT_TOP1.

ENDFORM.                    "RA

*&---------------------------------------------------------------------*
*&      Form  ZA
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
FORM ZA.

  CLEAR DIV.
  FORMAT COLOR 3.
*  WRITE : / 'A',WA_TAG1-SAMP_PRD,WA_TAG1-DIV,WA_TAG1-COUNTRY,WA_TAG1-DRP,WA_TAG1-SALE_TYPE,WA_TAG1-ZGROUP,WA_TAG1-TOP1,
*  WA_TAG1-TOP2,WA_TAG1-SQTY,WA_TAG1-USE_MONTH,WA_TAG1-PRD_CODE,count1.
  COUNT1 = COUNT1 + 1.
*  if wa_tag1-sno eq '1'.
  COUNT = 1.
*  ENDIF.
  IF WA_TAG1-DIV EQ '00'.
*    SELECT SINGLE * FROM MARA WHERE MATNR EQ WA_TAG1-SAMP_PRD.
*    IF SY-SUBRC EQ 0.
*      IF MARA-SPART EQ '50'.
*        DIV = 'BC'.
*      ELSEIF MARA-SPART EQ '60'.
*        DIV = 'XL'.
*      ELSEIF MARA-SPART EQ '70'.
*        DIV = 'LS'.
*      ENDIF.
*    ENDIF.

    SELECT SINGLE * FROM ZSAMP_PRD  WHERE PRD_CODE EQ WA_TAG1-SAMP_PRD.  " product group take from table ZSAMP_PRD : JYOTSNA 27.2.24
    IF SY-SUBRC EQ 0.
      IF ZSAMP_PRD-GRP_DIV EQ '50'.
        DIV = 'BC'.
      ELSEIF ZSAMP_PRD-GRP_DIV EQ '60'.
        DIV = 'XL'.
      ELSEIF ZSAMP_PRD-GRP_DIV EQ '70'.
        DIV = 'LS'.
      ENDIF.
    ENDIF.

    FORMAT COLOR 4.
    LOOP AT IT_ZM1 ASSIGNING <FS_TAS1> WHERE ( DIV EQ DIV ) OR ( DIV EQ 'BCL' ).
      IF WA_TAG1-FROM_DT EQ 0.
        IF WA_TAG1-COUNTRY EQ 'NP'.
          IF <FS_TAS1>-REG EQ 'D-KHAT'.
            WA_TOP1-BZIRK = <FS_TAS1>-ZM.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
          IF <FS_TAS1>-REG NE 'D-KHAT'.
            WA_TOP1-BZIRK = <FS_TAS1>-ZM.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
          WA_TOP1-BZIRK = <FS_TAS1>-ZM.
          WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
          COLLECT WA_TOP1 INTO IT_TOP1.
          CLEAR WA_TOP1.
        ENDIF.
      ELSE.
        IF WA_TAG1-FROM_DT LE <FS_TAS1>-DOJ.
          IF WA_TAG1-COUNTRY EQ 'NP'.
            IF <FS_TAS1>-REG EQ 'D-KHAT'.
              WA_TOP1-BZIRK = <FS_TAS1>-ZM.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
            IF <FS_TAS1>-REG NE 'D-KHAT'.
              WA_TOP1-BZIRK = <FS_TAS1>-ZM.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
            WA_TOP1-BZIRK = <FS_TAS1>-ZM.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ENDIF.
      ENDIF.
    ENDLOOP.
  ELSEIF WA_TAG1-DIV EQ '50'.
    LOOP AT IT_ZM1 ASSIGNING <FS_TAS1> WHERE DIV EQ 'BC'.
      IF WA_TAG1-FROM_DT EQ 0.
        IF WA_TAG1-COUNTRY EQ 'NP'.
          IF <FS_TAS1>-REG EQ 'D-KHAT'.
            WA_TOP1-BZIRK = <FS_TAS1>-ZM.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
          IF <FS_TAS1>-REG NE 'D-KHAT'.
            WA_TOP1-BZIRK = <FS_TAS1>-ZM.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
          WA_TOP1-BZIRK = <FS_TAS1>-ZM.
          WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
          COLLECT WA_TOP1 INTO IT_TOP1.
          CLEAR WA_TOP1.
        ENDIF.
      ELSE.
        IF WA_TAG1-FROM_DT LE <FS_TAS1>-DOJ.
          IF WA_TAG1-COUNTRY EQ 'NP'.
            IF <FS_TAS1>-REG EQ 'D-KHAT'.
              WA_TOP1-BZIRK = <FS_TAS1>-ZM.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
            IF <FS_TAS1>-REG NE 'D-KHAT'.
              WA_TOP1-BZIRK = <FS_TAS1>-ZM.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
            WA_TOP1-BZIRK = <FS_TAS1>-ZM.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ENDIF.
      ENDIF.
    ENDLOOP.
************************************************************************
  ELSEIF WA_TAG1-DIV EQ '60'.
    LOOP AT IT_ZM1 ASSIGNING <FS_TAS1> WHERE DIV EQ 'XL'.
      IF WA_TAG1-FROM_DT EQ 0.
        IF WA_TAG1-COUNTRY EQ 'NP'.
          IF <FS_TAS1>-REG EQ 'D-KHAT'.
            WA_TOP1-BZIRK = <FS_TAS1>-ZM.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
          IF <FS_TAS1>-REG NE 'D-KHAT'.
            WA_TOP1-BZIRK = <FS_TAS1>-ZM.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
          WA_TOP1-BZIRK = <FS_TAS1>-ZM.
          WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
          COLLECT WA_TOP1 INTO IT_TOP1.
          CLEAR WA_TOP1.
        ENDIF.
      ELSE.
        IF WA_TAG1-FROM_DT LE <FS_TAS1>-DOJ.
          IF WA_TAG1-COUNTRY EQ 'NP'.
            IF <FS_TAS1>-REG EQ 'D-KHAT'.
              WA_TOP1-BZIRK = <FS_TAS1>-ZM.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
            IF <FS_TAS1>-REG NE 'D-KHAT'.
              WA_TOP1-BZIRK = <FS_TAS1>-ZM.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
            WA_TOP1-BZIRK = <FS_TAS1>-ZM.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ENDIF.
      ENDIF.
    ENDLOOP.
****************************

*    ************************************************************************
  ELSEIF WA_TAG1-DIV EQ '70'.
    LOOP AT IT_ZM1 ASSIGNING <FS_TAS1> WHERE DIV EQ 'LS'.
      IF WA_TAG1-FROM_DT EQ 0.
        IF WA_TAG1-COUNTRY EQ 'NP'.
          IF <FS_TAS1>-REG EQ 'D-KHAT'.
            WA_TOP1-BZIRK = <FS_TAS1>-ZM.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
          IF <FS_TAS1>-REG NE 'D-KHAT'.
            WA_TOP1-BZIRK = <FS_TAS1>-ZM.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
          WA_TOP1-BZIRK = <FS_TAS1>-ZM.
          WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
          COLLECT WA_TOP1 INTO IT_TOP1.
          CLEAR WA_TOP1.
        ENDIF.
      ELSE.
        IF WA_TAG1-FROM_DT LE <FS_TAS1>-DOJ.
          IF WA_TAG1-COUNTRY EQ 'NP'.
            IF <FS_TAS1>-REG EQ 'D-KHAT'.
              WA_TOP1-BZIRK = <FS_TAS1>-ZM.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
            IF <FS_TAS1>-REG NE 'D-KHAT'.
              WA_TOP1-BZIRK = <FS_TAS1>-ZM.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
            WA_TOP1-BZIRK = <FS_TAS1>-ZM.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ENDIF.
      ENDIF.
    ENDLOOP.
**********************************************************
  ELSEIF WA_TAG1-DIV EQ '99'.
    LOOP AT IT_ZM1 ASSIGNING <FS_TAS1> WHERE DIV EQ 'BCL'.
      IF WA_TAG1-FROM_DT EQ 0.
        IF WA_TAG1-COUNTRY EQ 'NP'.
          IF <FS_TAS1>-REG EQ 'D-KHAT'.
            WA_TOP1-BZIRK = <FS_TAS1>-ZM.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
          IF <FS_TAS1>-REG NE 'D-KHAT'.
            WA_TOP1-BZIRK = <FS_TAS1>-ZM.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
          WA_TOP1-BZIRK = <FS_TAS1>-ZM.
          WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
          COLLECT WA_TOP1 INTO IT_TOP1.
          CLEAR WA_TOP1.
        ENDIF.
      ELSE.
        IF WA_TAG1-FROM_DT LE <FS_TAS1>-DOJ.
          IF WA_TAG1-COUNTRY EQ 'NP'.
            IF <FS_TAS1>-REG EQ 'D-KHAT'.
              WA_TOP1-BZIRK = <FS_TAS1>-ZM.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
            IF <FS_TAS1>-REG NE 'D-KHAT'.
              WA_TOP1-BZIRK = <FS_TAS1>-ZM.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
            WA_TOP1-BZIRK = <FS_TAS1>-ZM.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ENDIF.
      ENDIF.
    ENDLOOP.
  ENDIF.

  SORT IT_TOP1 DESCENDING BY NETVAL.
  LOOP AT IT_TOP1 ASSIGNING <FS_TOP1>.
    READ TABLE IT_EX1 INTO WA_EX1 WITH KEY BZIRK = <FS_TOP1>-BZIRK MATNR = WA_TAG1-SAMP_PRD.
    IF SY-SUBRC NE 0.
*    WRITE : / 'P-ZM',<FS_TOP1>-BZIRK,<FS_TOP1>-NETVAL,COUNT.
      WA_TOP2-BZIRK = <FS_TOP1>-BZIRK.
      WA_TOP2-NETVAL = <FS_TOP1>-NETVAL.
      COLLECT WA_TOP2 INTO IT_TOP2.
      CLEAR WA_TOP2.
    ENDIF.
  ENDLOOP.
*  CLEAR : <FS_TOP1>.

  IF IT_TOP2 IS NOT INITIAL.
    LOOP AT IT_TOP2 INTO WA_TOP2 WHERE BZIRK NE '      '.
      CLEAR :  DIV1,DCOUNT.
*      READ TABLE IT_DIV2 INTO WA_DIV2 WITH KEY ZM = WA_TOP2-BZIRK SPART = '50'.
*      IF SY-SUBRC EQ 0.
*        READ TABLE IT_DIV2 INTO WA_DIV2 WITH KEY ZM = WA_TOP2-BZIRK SPART = '60'.
*        IF SY-SUBRC EQ 0.
*          DIV1 = '99'.
*        ELSE.
*          DIV1 = '50'.
*        ENDIF.
*      ELSE.
*        DIV1 = '60'.
*      ENDIF.

      READ TABLE IT_DIV2 INTO WA_DIV2 WITH KEY ZM = WA_TOP2-BZIRK SPART = '50'.
      IF SY-SUBRC EQ 0.
        DIV1 = '50'.
        DCOUNT = DCOUNT + 1.
      ENDIF.
      READ TABLE IT_DIV2 INTO WA_DIV2 WITH KEY ZM = WA_TOP2-BZIRK SPART = '60'.
      IF SY-SUBRC EQ 0.
        DIV1 = '60'.
        DCOUNT = DCOUNT + 1.
      ENDIF.
      READ TABLE IT_DIV2 INTO WA_DIV2 WITH KEY ZM = WA_TOP2-BZIRK SPART = '70'.
      IF SY-SUBRC EQ 0.
        DIV1 = '70'.
        DCOUNT = DCOUNT + 1.
      ENDIF.
      IF DCOUNT GT 1.
        DIV1 = '99'.
      ENDIF.

      ZSAMPPROCESS_WA-ZMONTH = MONTH.
      ZSAMPPROCESS_WA-ZYEAR = YEAR.
      ZSAMPPROCESS_WA-BZIRK = WA_TOP2-BZIRK.
      ZSAMPPROCESS_WA-SAMPCODE = WA_TAG1-SAMP_PRD.
      ZSAMPPROCESS_WA-DIV = DIV1.
      ZSAMPPROCESS_WA-SAMPQTY = WA_TAG1-SQTY.
*      collect zsampprocess_wa into it_zsampprocess_wa.
      MODIFY ZSAMPPROCESS FROM ZSAMPPROCESS_WA.
      CLEAR : ZSAMPPROCESS_WA.
    ENDLOOP.
  ENDIF.
*  modify zsampprocess from table it_zsampprocess_wa.
*  commit work and wait .
  CLEAR : IT_ZSAMPPROCESS_WA.
  CLEAR : IT_TOP2,IT_TOP1.

ENDFORM.                    "ZA

*&---------------------------------------------------------------------*
*&      Form  DA
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
FORM DA.
  CLEAR DIV.
  FORMAT COLOR 3.
*  WRITE : / 'A',WA_TAG1-SAMP_PRD,WA_TAG1-DIV,WA_TAG1-COUNTRY,WA_TAG1-DRP,WA_TAG1-SALE_TYPE,WA_TAG1-ZGROUP,WA_TAG1-TOP1,
*  WA_TAG1-TOP2,WA_TAG1-SQTY,WA_TAG1-USE_MONTH,WA_TAG1-PRD_CODE,count1.
  COUNT1 = COUNT1 + 1.
*  if wa_tag1-sno eq '1'.
  COUNT = 1.
*  ENDIF.
  IF WA_TAG1-DIV EQ '00'.
*    SELECT SINGLE * FROM MARA WHERE MATNR EQ WA_TAG1-SAMP_PRD.
*    IF SY-SUBRC EQ 0.
*      IF MARA-SPART EQ '50'.
*        DIV = 'BC'.
*      ELSEIF MARA-SPART EQ '60'.
*        DIV = 'XL'.
*      ELSEIF MARA-SPART EQ '70'.
*        DIV = 'LS'.
*      ENDIF.
*    ENDIF.

    SELECT SINGLE * FROM ZSAMP_PRD  WHERE PRD_CODE EQ WA_TAG1-SAMP_PRD.  " product group take from table ZSAMP_PRD : JYOTSNA 27.2.24
    IF SY-SUBRC EQ 0.
      IF ZSAMP_PRD-GRP_DIV EQ '50'.
        DIV = 'BC'.
      ELSEIF ZSAMP_PRD-GRP_DIV EQ '60'.
        DIV = 'XL'.
      ELSEIF ZSAMP_PRD-GRP_DIV EQ '70'.
        DIV = 'LS'.
      ENDIF.
    ENDIF.

    FORMAT COLOR 4.
    LOOP AT IT_REG1 ASSIGNING <FS_TAS1> WHERE ( DIV EQ DIV ) OR ( DIV EQ 'BCL' ) .
      IF WA_TAG1-FROM_DT EQ 0.
        IF WA_TAG1-COUNTRY EQ 'NP'.
          IF <FS_TAS1>-REG EQ 'D-KHAT'.
            WA_TOP1-BZIRK = <FS_TAS1>-REG.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
          IF <FS_TAS1>-REG NE 'D-KHAT'.
            WA_TOP1-BZIRK = <FS_TAS1>-REG.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
          WA_TOP1-BZIRK = <FS_TAS1>-REG.
          WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
          COLLECT WA_TOP1 INTO IT_TOP1.
          CLEAR WA_TOP1.
        ENDIF.
      ELSE.
        IF WA_TAG1-FROM_DT LE <FS_TAS1>-DOJ.
          IF WA_TAG1-COUNTRY EQ 'NP'.
            IF <FS_TAS1>-REG EQ 'D-KHAT'.
              WA_TOP1-BZIRK = <FS_TAS1>-REG.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
            IF <FS_TAS1>-REG NE 'D-KHAT'.
              WA_TOP1-BZIRK = <FS_TAS1>-REG.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
            WA_TOP1-BZIRK = <FS_TAS1>-REG.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ENDIF.
      ENDIF.
    ENDLOOP.
  ELSEIF WA_TAG1-DIV EQ '50'.
    LOOP AT IT_REG1 ASSIGNING <FS_TAS1> WHERE DIV EQ 'BC' .
      IF WA_TAG1-FROM_DT EQ 0.
        IF WA_TAG1-COUNTRY EQ 'NP'.
          IF <FS_TAS1>-REG EQ 'D-KHAT'.
            WA_TOP1-BZIRK = <FS_TAS1>-REG.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
          IF <FS_TAS1>-REG NE 'D-KHAT'.
            WA_TOP1-BZIRK = <FS_TAS1>-REG.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
          WA_TOP1-BZIRK = <FS_TAS1>-REG.
          WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
          COLLECT WA_TOP1 INTO IT_TOP1.
          CLEAR WA_TOP1.
        ENDIF.
      ELSE.
        IF WA_TAG1-FROM_DT LE <FS_TAS1>-DOJ.
          IF WA_TAG1-COUNTRY EQ 'NP'.
            IF <FS_TAS1>-REG EQ 'D-KHAT'.
              WA_TOP1-BZIRK = <FS_TAS1>-REG.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
            IF <FS_TAS1>-REG NE 'D-KHAT'.
              WA_TOP1-BZIRK = <FS_TAS1>-REG.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
            WA_TOP1-BZIRK = <FS_TAS1>-REG.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ENDIF.
      ENDIF.
    ENDLOOP.
*********************************************************************
  ELSEIF WA_TAG1-DIV EQ '60'.
    LOOP AT IT_REG1 ASSIGNING <FS_TAS1> WHERE DIV EQ 'XL' .
      IF WA_TAG1-FROM_DT EQ 0.
        IF WA_TAG1-COUNTRY EQ 'NP'.
          IF <FS_TAS1>-REG EQ 'D-KHAT'.
            WA_TOP1-BZIRK = <FS_TAS1>-REG.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
          IF <FS_TAS1>-REG NE 'D-KHAT'.
            WA_TOP1-BZIRK = <FS_TAS1>-REG.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
          WA_TOP1-BZIRK = <FS_TAS1>-REG.
          WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
          COLLECT WA_TOP1 INTO IT_TOP1.
          CLEAR WA_TOP1.
        ENDIF.
      ELSE.
        IF WA_TAG1-FROM_DT LE <FS_TAS1>-DOJ.
          IF WA_TAG1-COUNTRY EQ 'NP'.
            IF <FS_TAS1>-REG EQ 'D-KHAT'.
              WA_TOP1-BZIRK = <FS_TAS1>-REG.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
            IF <FS_TAS1>-REG NE 'D-KHAT'.
              WA_TOP1-BZIRK = <FS_TAS1>-REG.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
            WA_TOP1-BZIRK = <FS_TAS1>-REG.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ENDIF.
      ENDIF.
    ENDLOOP.
******************************************************************
  ELSEIF WA_TAG1-DIV EQ '70'.
    LOOP AT IT_REG1 ASSIGNING <FS_TAS1> WHERE DIV EQ 'LS' .
      IF WA_TAG1-FROM_DT EQ 0.
        IF WA_TAG1-COUNTRY EQ 'NP'.
          IF <FS_TAS1>-REG EQ 'D-KHAT'.
            WA_TOP1-BZIRK = <FS_TAS1>-REG.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
          IF <FS_TAS1>-REG NE 'D-KHAT'.
            WA_TOP1-BZIRK = <FS_TAS1>-REG.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
          WA_TOP1-BZIRK = <FS_TAS1>-REG.
          WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
          COLLECT WA_TOP1 INTO IT_TOP1.
          CLEAR WA_TOP1.
        ENDIF.
      ELSE.
        IF WA_TAG1-FROM_DT LE <FS_TAS1>-DOJ.
          IF WA_TAG1-COUNTRY EQ 'NP'.
            IF <FS_TAS1>-REG EQ 'D-KHAT'.
              WA_TOP1-BZIRK = <FS_TAS1>-REG.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
            IF <FS_TAS1>-REG NE 'D-KHAT'.
              WA_TOP1-BZIRK = <FS_TAS1>-REG.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
            WA_TOP1-BZIRK = <FS_TAS1>-REG.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ENDIF.
      ENDIF.
    ENDLOOP.
**************************************************************************
  ELSEIF WA_TAG1-DIV EQ '99'.
    LOOP AT IT_REG1 ASSIGNING <FS_TAS1> WHERE DIV EQ 'BCL' .
      IF WA_TAG1-FROM_DT EQ 0.
        IF WA_TAG1-COUNTRY EQ 'NP'.
          IF <FS_TAS1>-REG EQ 'D-KHAT'.
            WA_TOP1-BZIRK = <FS_TAS1>-REG.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
          IF <FS_TAS1>-REG NE 'D-KHAT'.
            WA_TOP1-BZIRK = <FS_TAS1>-REG.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
          WA_TOP1-BZIRK = <FS_TAS1>-REG.
          WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
          COLLECT WA_TOP1 INTO IT_TOP1.
          CLEAR WA_TOP1.
        ENDIF.
      ELSE.
        IF WA_TAG1-FROM_DT LE <FS_TAS1>-DOJ.
          IF WA_TAG1-COUNTRY EQ 'NP'.
            IF <FS_TAS1>-REG EQ 'D-KHAT'.
              WA_TOP1-BZIRK = <FS_TAS1>-REG.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'IN'.
            IF <FS_TAS1>-REG NE 'D-KHAT'.
              WA_TOP1-BZIRK = <FS_TAS1>-REG.
              WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
              COLLECT WA_TOP1 INTO IT_TOP1.
              CLEAR WA_TOP1.
            ENDIF.
          ELSEIF WA_TAG1-COUNTRY EQ 'AL'.
            WA_TOP1-BZIRK = <FS_TAS1>-REG.
            WA_TOP1-NETVAL = <FS_TAS1>-NETVAL.
            COLLECT WA_TOP1 INTO IT_TOP1.
            CLEAR WA_TOP1.
          ENDIF.
        ENDIF.
      ENDIF.
    ENDLOOP.
  ENDIF.

  SORT IT_TOP1 DESCENDING BY NETVAL.
  LOOP AT IT_TOP1 ASSIGNING <FS_TOP1>.
    READ TABLE IT_EX1 INTO WA_EX1 WITH KEY BZIRK = <FS_TOP1>-BZIRK MATNR = WA_TAG1-SAMP_PRD.
    IF SY-SUBRC NE 0.
*    WRITE : / 'P-REG',<FS_TOP1>-BZIRK,<FS_TOP1>-NETVAL,COUNT.
      WA_TOP2-BZIRK = <FS_TOP1>-BZIRK.
      WA_TOP2-NETVAL = <FS_TOP1>-NETVAL.
      WA_TOP2-COUNT = COUNT.
      COLLECT WA_TOP2 INTO IT_TOP2.
      CLEAR WA_TOP2.
      COUNT = COUNT + 1.
    ENDIF.
  ENDLOOP.
  IF IT_TOP2 IS NOT INITIAL.
    LOOP AT IT_TOP2 INTO WA_TOP2 WHERE BZIRK NE '      '.
*     WHERE COUNT ge wa_tag1-top1 AND count le wa_tag1-top2.
*    WRITE : / 'REG ALL',<FS_TOP1>-BZIRK,<FS_TOP1>-NETVAL,<FS_TOP1>-COUNT.
*    wa_tag1-top1,wa_tag1-top2.
      CLEAR :  DIV1,DCOUNT.
*      READ TABLE IT_DIV2 INTO WA_DIV2 WITH KEY REG = WA_TOP2-BZIRK SPART = '50'.
*      IF SY-SUBRC EQ 0.
*        READ TABLE IT_DIV2 INTO WA_DIV2 WITH KEY REG = WA_TOP2-BZIRK SPART = '60'.
*        IF SY-SUBRC EQ 0.
*          DIV1 = '99'.
*        ELSE.
*          DIV1 = '50'.
*        ENDIF.
*      ELSE.
*        DIV1 = '60'.
*      ENDIF.

      READ TABLE IT_DIV2 INTO WA_DIV2 WITH KEY REG = WA_TOP2-BZIRK SPART = '50'.
      IF SY-SUBRC EQ 0.
        DIV1 = '50'.
        DCOUNT = DCOUNT + 1.
      ENDIF.
      READ TABLE IT_DIV2 INTO WA_DIV2 WITH KEY REG = WA_TOP2-BZIRK SPART = '60'.
      IF SY-SUBRC EQ 0.
        DIV1 = '60'.
        DCOUNT = DCOUNT + 1.
      ENDIF.
      READ TABLE IT_DIV2 INTO WA_DIV2 WITH KEY REG = WA_TOP2-BZIRK SPART = '70'.
      IF SY-SUBRC EQ 0.
        DIV1 = '70'.
        DCOUNT = DCOUNT + 1.
      ENDIF.
      IF DCOUNT GT 1.
        DIV1 = '99'.
      ENDIF.

      ZSAMPPROCESS_WA-ZMONTH = MONTH.
      ZSAMPPROCESS_WA-ZYEAR = YEAR.
      ZSAMPPROCESS_WA-BZIRK = WA_TOP2-BZIRK.
      ZSAMPPROCESS_WA-SAMPCODE = WA_TAG1-SAMP_PRD.
      ZSAMPPROCESS_WA-DIV = DIV1.
      ZSAMPPROCESS_WA-SAMPQTY = WA_TAG1-SQTY.
      MODIFY ZSAMPPROCESS FROM ZSAMPPROCESS_WA.
*      collect zsampprocess_wa into it_zsampprocess_wa.
      CLEAR : ZSAMPPROCESS_WA.
    ENDLOOP.
  ENDIF.
*  modify zsampprocess from table it_zsampprocess_wa.
*  commit work and wait .
  CLEAR : IT_ZSAMPPROCESS_WA.
  CLEAR : IT_TOP2,IT_TOP1.
ENDFORM.                    "DA

*&---------------------------------------------------------------------*
*&      Form  AA
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
FORM AA.

ENDFORM.                    "AA


*TOP-OF-PAGE.

*  WRITE : /1 'ALLOCATION',35 'TERRITORY',45 'SAMPLE',58 'SAMPLE_QTY'.
*  ULINE.
*&---------------------------------------------------------------------*
*&      Form  SALE1
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*

FORM EXCLUDE.

  SELECT * FROM ZSAMPEXCLUDE INTO TABLE IT_ZSAMPEXCLUDE WHERE BEGDA LE SDATE1 AND ENDDA GE SDATE2.
  LOOP AT IT_ZSAMPEXCLUDE INTO WA_ZSAMPEXCLUDE WHERE INDALL EQ 'A'.
    IF WA_ZSAMPEXCLUDE-BZIRK+0(2) EQ 'D-'.
      LOOP AT IT_TAB4 INTO WA_TAB4 WHERE REG EQ WA_ZSAMPEXCLUDE-BZIRK.
        WA_EX1-BZIRK = WA_TAB4-REG.
        WA_EX1-MATNR = WA_ZSAMPEXCLUDE-MATNR.
        COLLECT WA_EX1 INTO IT_EX1.
        CLEAR WA_EX1.
        WA_EX1-BZIRK = WA_TAB4-ZM.
        WA_EX1-MATNR = WA_ZSAMPEXCLUDE-MATNR.
        COLLECT WA_EX1 INTO IT_EX1.
        CLEAR WA_EX1.
        WA_EX1-BZIRK = WA_TAB4-RM.
        WA_EX1-MATNR = WA_ZSAMPEXCLUDE-MATNR.
        COLLECT WA_EX1 INTO IT_EX1.
        CLEAR WA_EX1.
        WA_EX1-BZIRK = WA_TAB4-BZIRK.
        WA_EX1-MATNR = WA_ZSAMPEXCLUDE-MATNR.
        COLLECT WA_EX1 INTO IT_EX1.
        CLEAR WA_EX1.
      ENDLOOP.
    ELSEIF WA_ZSAMPEXCLUDE-BZIRK+0(2) EQ 'R-'.
      LOOP AT IT_TAB4 INTO WA_TAB4 WHERE RM EQ WA_ZSAMPEXCLUDE-BZIRK.
        WA_EX1-BZIRK = WA_TAB4-RM.
        WA_EX1-MATNR = WA_ZSAMPEXCLUDE-MATNR.
        COLLECT WA_EX1 INTO IT_EX1.
        CLEAR WA_EX1.
        WA_EX1-BZIRK = WA_TAB4-BZIRK.
        WA_EX1-MATNR = WA_ZSAMPEXCLUDE-MATNR.
        COLLECT WA_EX1 INTO IT_EX1.
        CLEAR WA_EX1.
      ENDLOOP.
    ELSEIF WA_ZSAMPEXCLUDE-BZIRK+0(2) EQ 'Z-'.
      LOOP AT IT_TAB4 INTO WA_TAB4 WHERE ZM EQ WA_ZSAMPEXCLUDE-BZIRK.
        WA_EX1-BZIRK = WA_TAB4-ZM.
        WA_EX1-MATNR = WA_ZSAMPEXCLUDE-MATNR.
        COLLECT WA_EX1 INTO IT_EX1.
        CLEAR WA_EX1.
        WA_EX1-BZIRK = WA_TAB4-RM.
        WA_EX1-MATNR = WA_ZSAMPEXCLUDE-MATNR.
        COLLECT WA_EX1 INTO IT_EX1.
        CLEAR WA_EX1.
        WA_EX1-BZIRK = WA_TAB4-BZIRK.
        WA_EX1-MATNR = WA_ZSAMPEXCLUDE-MATNR.
        COLLECT WA_EX1 INTO IT_EX1.
        CLEAR WA_EX1.
      ENDLOOP.
    ELSE.
      READ TABLE IT_TAB4 INTO WA_TAB4 WITH KEY BZIRK = WA_ZSAMPEXCLUDE-BZIRK.
      IF SY-SUBRC EQ 0.
        WA_EX1-BZIRK = WA_TAB4-BZIRK.
        WA_EX1-MATNR = WA_ZSAMPEXCLUDE-MATNR.
        COLLECT WA_EX1 INTO IT_EX1.
        CLEAR WA_EX1.
      ENDIF.
    ENDIF.
  ENDLOOP.

  LOOP AT IT_ZSAMPEXCLUDE INTO WA_ZSAMPEXCLUDE WHERE INDALL EQ 'I'.
    IF WA_ZSAMPEXCLUDE-BZIRK+0(2) EQ 'D-'.
      READ TABLE IT_TAB4 INTO WA_TAB4 WITH KEY REG = WA_ZSAMPEXCLUDE-BZIRK.
      IF SY-SUBRC EQ 0.
        WA_EX1-BZIRK = WA_TAB4-REG.
        WA_EX1-MATNR = WA_ZSAMPEXCLUDE-MATNR.
        COLLECT WA_EX1 INTO IT_EX1.
        CLEAR WA_EX1.
      ENDIF.
    ELSEIF WA_ZSAMPEXCLUDE-BZIRK+0(2) EQ 'R-'.
      READ TABLE IT_TAB4 INTO WA_TAB4 WITH KEY RM = WA_ZSAMPEXCLUDE-BZIRK.
      IF SY-SUBRC EQ 0.
        WA_EX1-BZIRK = WA_TAB4-RM.
        WA_EX1-MATNR = WA_ZSAMPEXCLUDE-MATNR.
        COLLECT WA_EX1 INTO IT_EX1.
        CLEAR WA_EX1.
      ENDIF.
    ELSEIF WA_ZSAMPEXCLUDE-BZIRK+0(2) EQ 'Z-'.
      READ TABLE IT_TAB4 INTO WA_TAB4 WITH KEY ZM = WA_ZSAMPEXCLUDE-BZIRK.
      IF SY-SUBRC EQ 0.
        WA_EX1-BZIRK = WA_TAB4-ZM.
        WA_EX1-MATNR = WA_ZSAMPEXCLUDE-MATNR.
        COLLECT WA_EX1 INTO IT_EX1.
        CLEAR WA_EX1.
      ENDIF.
    ELSE.
      READ TABLE IT_TAB4 INTO WA_TAB4 WITH KEY BZIRK = WA_ZSAMPEXCLUDE-BZIRK.
      IF SY-SUBRC EQ 0.
        WA_EX1-BZIRK = WA_TAB4-BZIRK.
        WA_EX1-MATNR = WA_ZSAMPEXCLUDE-MATNR.
        COLLECT WA_EX1 INTO IT_EX1.
        CLEAR WA_EX1.
      ENDIF.
    ENDIF.
  ENDLOOP.

  SORT IT_EX1 BY BZIRK.
  DELETE ADJACENT DUPLICATES FROM IT_EX1 COMPARING BZIRK MATNR.
  WRITE : / 'FOLLOWING TERRITOTIES & PRODUCT COMBINATIONS ARE EXCLUEDED'.
  LOOP AT IT_EX1 INTO WA_EX1 WHERE BZIRK NE '      '.
    WRITE : / WA_EX1-BZIRK,WA_EX1-MATNR.
  ENDLOOP.

ENDFORM.                    "exclude

*&---------------------------------------------------------------------*
*&      Form  SALEV
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
FORM SALEV.
  LM1 = DATE2-LOW+4(2).
  LY1 = DATE2-LOW+0(4).

  CALL FUNCTION 'RE_ADD_MONTH_TO_DATE'
    EXPORTING
      MONTHS  = '1'
      OLDDATE = DATE2-LOW
    IMPORTING
      NEWDATE = 1DATE2.
  LM2 = 1DATE2+4(2).
  LY2 = 1DATE2+0(4).

  CALL FUNCTION 'RE_ADD_MONTH_TO_DATE'
    EXPORTING
      MONTHS  = '1'
      OLDDATE = 1DATE2
    IMPORTING
      NEWDATE = 2DATE2.
  LM3 = 2DATE2+4(2).
  LY3 = 2DATE2+0(4).
******************************************
  CALL FUNCTION 'RE_ADD_MONTH_TO_DATE'
    EXPORTING
      MONTHS  = '1'
      OLDDATE = 2DATE2
    IMPORTING
      NEWDATE = 3DATE2.
  LM4 = 3DATE2+4(2).
  LY4 = 3DATE2+0(4).
*****************************************
*  call function 'HR_JP_MONTH_BEGIN_END_DATE'
*                 exporting
*                 iv_date                   = 2date2
*                  importing
**                     EV_MONTH_BEGIN_DATE       =
*                     ev_month_end_date         = ldate2.

  CALL FUNCTION 'HR_JP_MONTH_BEGIN_END_DATE'
    EXPORTING
      IV_DATE           = 3DATE2
    IMPORTING
*     EV_MONTH_BEGIN_DATE       =
      EV_MONTH_END_DATE = LDATE2.

  IF DATE2-LOW+6(2) NE '01'.
    MESSAGE 'ENTER START DATE OF THE MONTH' TYPE 'E'.
  ENDIF.
  IF DATE2-HIGH GT LDATE2.
    MESSAGE 'ENTER PERIOD FOR MAXIMUM 3 MONTHS' TYPE 'E'.
  ENDIF.


*  IF IT_TAB4 IS NOT INITIAL.
*    SELECT * FROM ZRCUMPSO INTO TABLE  IT_ZRCUMPSO1 FOR ALL ENTRIES IN IT_TAB4 WHERE ZMONTH EQ LM1 AND ZYEAR EQ LY1 AND BZIRK EQ IT_TAB4-BZIRK .
*  ENDIF.
*  IF IT_TAB4 IS NOT INITIAL.
*    SELECT * FROM ZRCUMPSO INTO TABLE  IT_ZRCUMPSO2 FOR ALL ENTRIES IN IT_TAB4 WHERE ZMONTH EQ LM2 AND ZYEAR EQ LY2 AND BZIRK EQ IT_TAB4-BZIRK .
*  ENDIF.
*  IF IT_TAB4 IS NOT INITIAL.
*    SELECT * FROM ZRCUMPSO INTO TABLE  IT_ZRCUMPSO3 FOR ALL ENTRIES IN IT_TAB4 WHERE ZMONTH EQ LM3 AND ZYEAR EQ LY3 AND BZIRK EQ IT_TAB4-BZIRK .
*  ENDIF.
*  IF IT_TAB4 IS NOT INITIAL.
*    SELECT * FROM ZRCUMPSO INTO TABLE  IT_ZRCUMPSO4 FOR ALL ENTRIES IN IT_TAB4 WHERE ZMONTH EQ LM4 AND ZYEAR EQ LY4 AND BZIRK EQ IT_TAB4-BZIRK .
*  ENDIF.
  IF IT_TAB4 IS NOT INITIAL.
    SELECT * FROM ZCUMPSO1 INTO TABLE  IT_ZRCUMPSO1 FOR ALL ENTRIES IN IT_TAB4 WHERE ZMONTH EQ LM1 AND ZYEAR EQ LY1 AND BZIRK EQ IT_TAB4-BZIRK .
  ENDIF.
  IF IT_TAB4 IS NOT INITIAL.
    SELECT * FROM ZCUMPSO1 INTO TABLE  IT_ZRCUMPSO2 FOR ALL ENTRIES IN IT_TAB4 WHERE ZMONTH EQ LM2 AND ZYEAR EQ LY2 AND BZIRK EQ IT_TAB4-BZIRK .
  ENDIF.
  IF IT_TAB4 IS NOT INITIAL.
    SELECT * FROM ZCUMPSO1 INTO TABLE  IT_ZRCUMPSO3 FOR ALL ENTRIES IN IT_TAB4 WHERE ZMONTH EQ LM3 AND ZYEAR EQ LY3 AND BZIRK EQ IT_TAB4-BZIRK .
  ENDIF.
  IF IT_TAB4 IS NOT INITIAL.
    SELECT * FROM ZCUMPSO1 INTO TABLE  IT_ZRCUMPSO4 FOR ALL ENTRIES IN IT_TAB4 WHERE ZMONTH EQ LM4 AND ZYEAR EQ LY4 AND BZIRK EQ IT_TAB4-BZIRK .
  ENDIF.


  LOOP AT IT_ZRCUMPSO1 INTO WA_ZRCUMPSO1.
    MOVE-CORRESPONDING WA_ZRCUMPSO1 TO WA_ZRCUMPSO.
    COLLECT WA_ZRCUMPSO INTO IT_ZRCUMPSO.
    CLEAR WA_ZRCUMPSO.
  ENDLOOP.

  LOOP AT IT_ZRCUMPSO2 INTO WA_ZRCUMPSO2.
    MOVE-CORRESPONDING WA_ZRCUMPSO2 TO WA_ZRCUMPSO.
    COLLECT WA_ZRCUMPSO INTO IT_ZRCUMPSO.
    CLEAR WA_ZRCUMPSO.
  ENDLOOP.

  LOOP AT IT_ZRCUMPSO3 INTO WA_ZRCUMPSO3.
    MOVE-CORRESPONDING WA_ZRCUMPSO3 TO WA_ZRCUMPSO.
    COLLECT WA_ZRCUMPSO INTO IT_ZRCUMPSO.
    CLEAR WA_ZRCUMPSO.
  ENDLOOP.

  LOOP AT IT_ZRCUMPSO4 INTO WA_ZRCUMPSO4.
    MOVE-CORRESPONDING WA_ZRCUMPSO4 TO WA_ZRCUMPSO.
    COLLECT WA_ZRCUMPSO INTO IT_ZRCUMPSO.
    CLEAR WA_ZRCUMPSO.
  ENDLOOP.
*  BREAK-POINT.

*  if it_tab4 is not initial.
*    select * from zrcumpso into table  IT_ZRCUMPSO for all entries in it_tab4 where zmonth ge m1 and zmonth le m2 and zyear eq y1 and bzirk eq
*      it_tab4-bzirk .
*  endif.

  LOOP AT IT_ZRCUMPSO INTO WA_ZRCUMPSO.
    CLEAR : DIV,DCOUNT.
    WA_TAS1-BZIRK = WA_ZRCUMPSO-BZIRK.
    WA_TAS1-NETVAL = WA_ZRCUMPSO-NETVAL.

*    read table it_zdsmter into wa_zdsmter with key bzirk = wa_zrcumpso-bzirk spart = '50'.
*    if sy-subrc eq 0.
*      read table it_zdsmter into wa_zdsmter with key bzirk = wa_zrcumpso-bzirk spart = '60'.
*      if sy-subrc eq 0.
*        div = 'BCL'.
*      else.
*        div = 'BC'.
*      endif.
*    else.
*      div = 'XL'.
*    endif.
    READ TABLE IT_ZDSMTER INTO WA_ZDSMTER WITH KEY BZIRK = WA_ZRCUMPSO-BZIRK SPART = '50'.
    IF SY-SUBRC EQ 0.
      DIV = 'BC'.
      DCOUNT = DCOUNT + 1.
    ENDIF.
    READ TABLE IT_ZDSMTER INTO WA_ZDSMTER WITH KEY BZIRK = WA_ZRCUMPSO-BZIRK SPART = '60'.
    IF SY-SUBRC EQ 0.
      DIV = 'XL'.
      DCOUNT = DCOUNT + 1.
    ENDIF.
    READ TABLE IT_ZDSMTER INTO WA_ZDSMTER WITH KEY BZIRK = WA_ZRCUMPSO-BZIRK SPART = '70'.
    IF SY-SUBRC EQ 0.
      DIV = 'LS'.
      DCOUNT = DCOUNT + 1.
    ENDIF.
    IF DCOUNT GT 1.
      DIV = 'BCL'.
    ENDIF.


    WA_TAS1-DIV = DIV.
    COLLECT WA_TAS1 INTO IT_TAS1.
    CLEAR WA_TAS1.
  ENDLOOP.
*  clear : <fs_tab>.
*  unassign <itab>.
  SORT IT_TAS1 BY DIV.

  LOOP AT IT_TAS1 INTO WA_TAS1.  " PSO SALE
    WA_TAS2-BZIRK = WA_TAS1-BZIRK.
    WA_TAS2-NETVAL = WA_TAS1-NETVAL.
    WA_TAS2-DIV = WA_TAS1-DIV.
    READ TABLE IT_TAB4 INTO WA_TAB4 WITH KEY BZIRK = WA_TAS1-BZIRK.
    IF SY-SUBRC EQ 0.
      WA_TAS2-RM = WA_TAB4-RM.
      WA_TAS2-ZM = WA_TAB4-ZM.
      WA_TAS2-REG = WA_TAB4-REG.
    ENDIF.
    COLLECT WA_TAS2 INTO IT_TAS2.
    CLEAR WA_TAS2.
  ENDLOOP.

  LOOP AT IT_TAS2 INTO WA_TAS2.
    READ TABLE IT_YTERRALLC INTO WA_YTERRALLC WITH KEY BZIRK = WA_TAS2-BZIRK.
    IF SY-SUBRC EQ 0.
      WA_PSO1-REG = WA_TAS2-REG.
      WA_PSO1-ZM = WA_TAS2-ZM.
      WA_PSO1-RM = WA_TAS2-RM.
      WA_PSO1-BZIRK = WA_TAS2-BZIRK.
      WA_PSO1-NETVAL = WA_TAS2-NETVAL.
      WA_PSO1-DIV = WA_TAS2-DIV.
      READ TABLE IT_PA0001 INTO WA_PA0001  WITH KEY PLANS = WA_YTERRALLC-PLANS.
      IF SY-SUBRC EQ 0.
        WA_PSO1-PERNR = WA_PA0001-PERNR.
        READ TABLE IT_PA0302 INTO WA_PA0302 WITH KEY PERNR = WA_PA0001-PERNR.
        IF SY-SUBRC EQ 0.
          WA_PSO1-DOJ = WA_PA0302-BEGDA.
        ENDIF.
      ENDIF.
      COLLECT WA_PSO1 INTO IT_PSO1.
      CLEAR  WA_PSO1.
    ENDIF.
  ENDLOOP.

*  LOOP at it_pso1 INTO wa_pso1.
*    WRITE : /'first',wa_pso1-reg,wa_pso1-zm,wa_pso1-rm,wa_pso1-bzirk,wa_pso1-netval,wa_pso1-div,wa_pso1-pernr,countt.
*    countt = countt + 1.
*  endloop.

******************all territories**************
  LOOP AT IT_TAB4 INTO WA_TAB4.
    CLEAR : DIV,DCOUNT.
    READ TABLE IT_YTERRALLC INTO WA_YTERRALLC WITH KEY BZIRK = WA_TAB4-BZIRK.
    IF SY-SUBRC EQ 0.
      READ TABLE IT_PSO1 INTO WA_PSO1 WITH KEY BZIRK = WA_TAB4-BZIRK.
      IF SY-SUBRC EQ 4.
        WA_PSO1-REG = WA_TAB4-REG.
        WA_PSO1-ZM = WA_TAB4-ZM.
        WA_PSO1-RM = WA_TAB4-RM.
        WA_PSO1-BZIRK = WA_TAB4-BZIRK.
        WA_PSO1-NETVAL = 0.
        READ TABLE IT_ZDSMTER INTO WA_ZDSMTER WITH KEY BZIRK = WA_TAB4-BZIRK SPART = '50'.
        IF SY-SUBRC EQ 0.
          DIV = 'BC'.
          DCOUNT = DCOUNT + 1.
        ENDIF.
        READ TABLE IT_ZDSMTER INTO WA_ZDSMTER WITH KEY BZIRK = WA_TAB4-BZIRK SPART = '60'.
        IF SY-SUBRC EQ 0.
          DIV = 'XL'.
          DCOUNT = DCOUNT + 1.
        ENDIF.
        READ TABLE IT_ZDSMTER INTO WA_ZDSMTER WITH KEY BZIRK = WA_TAB4-BZIRK SPART = '70'.
        IF SY-SUBRC EQ 0.
          DIV = 'LS'.
          DCOUNT = DCOUNT + 1.
        ENDIF.
        IF DCOUNT GT 1.
          DIV = 'BCL'.
        ENDIF.
        WA_PSO1-DIV = DIV.
        READ TABLE IT_PA0001 INTO WA_PA0001  WITH KEY PLANS = WA_YTERRALLC-PLANS.
        IF SY-SUBRC EQ 0.
          WA_PSO1-PERNR = WA_PA0001-PERNR.
          READ TABLE IT_PA0302 INTO WA_PA0302 WITH KEY PERNR = WA_PA0001-PERNR.
          IF SY-SUBRC EQ 0.
            SELECT SINGLE * FROM PA0302 WHERE PERNR EQ WA_PA0001-PERNR AND MASSN EQ '01'.
            IF SY-SUBRC EQ 0.
              WA_PSO1-DOJ = PA0302-BEGDA.
            ENDIF.
          ENDIF.
        ENDIF.
        COLLECT WA_PSO1 INTO IT_PSO1.
        CLEAR : WA_PSO1.
      ENDIF.
    ENDIF.
  ENDLOOP.

*  LOOP at it_pso1 INTO wa_pso1.
*    WRITE : /'second',wa_pso1-reg,wa_pso1-zm,wa_pso1-rm,wa_pso1-bzirk,wa_pso1-netval,wa_pso1-div,wa_pso1-pernr,countt.
*    countt = countt + 1.
*  endloop.
************************************************

  LOOP AT IT_TAS2 INTO WA_TAS2.
    CLEAR : DIV,DCOUNT.
    READ TABLE IT_YTERRALLC1 INTO WA_YTERRALLC1 WITH KEY BZIRK = WA_TAS2-RM.
    IF SY-SUBRC EQ 0.
      WA_RM1-REG = WA_TAS2-REG.
      WA_RM1-ZM = WA_TAS2-ZM.
      WA_RM1-RM = WA_TAS2-RM.
      WA_RM1-NETVAL = WA_TAS2-NETVAL.
      READ TABLE IT_DIV2 INTO WA_DIV2 WITH KEY RM = WA_TAS2-RM SPART = '50'.
      IF SY-SUBRC = 0.
        DIV = 'BC'.
        DCOUNT = DCOUNT + 1.
      ENDIF.
      READ TABLE IT_DIV2 INTO WA_DIV2 WITH KEY RM = WA_TAS2-RM SPART = '60'.
      IF SY-SUBRC = 0.
        DIV = 'XL'.
        DCOUNT = DCOUNT + 1.
      ENDIF.
      READ TABLE IT_DIV2 INTO WA_DIV2 WITH KEY RM = WA_TAS2-RM SPART = '70'.
      IF SY-SUBRC = 0.
        DIV = 'LS'.
        DCOUNT = DCOUNT + 1.
      ENDIF.
      IF DCOUNT GT 1.
        DIV = 'BCL'.
      ENDIF.
      WA_RM1-DIV = DIV.

      READ TABLE IT_PA0001 INTO WA_PA0001  WITH KEY PLANS = WA_YTERRALLC1-PLANS.
      IF SY-SUBRC EQ 0.
        WA_RM1-PERNR = WA_PA0001-PERNR.
        READ TABLE IT_PA0302 INTO WA_PA0302 WITH KEY PERNR = WA_PA0001-PERNR.
        IF SY-SUBRC EQ 0.
          WA_RM1-DOJ = WA_PA0302-BEGDA.
        ENDIF.
      ENDIF.
      COLLECT WA_RM1 INTO IT_RM1.
      CLEAR  WA_RM1.
    ENDIF.
  ENDLOOP.

*******************ALL RM TERR*****************
  LOOP AT IT_TAB4 INTO WA_TAB4.
    CLEAR : DIV,DCOUNT.
    READ TABLE IT_YTERRALLC1 INTO WA_YTERRALLC1 WITH KEY BZIRK = WA_TAB4-RM.
    IF SY-SUBRC EQ 0.
      READ TABLE IT_RM1 INTO WA_RM1 WITH KEY RM = WA_TAB4-RM.
      IF SY-SUBRC EQ 4.
        WRITE : / 'second RM',WA_TAB4-BZIRK.
        WA_RM1-REG = WA_TAB4-REG.
        WA_RM1-ZM = WA_TAB4-ZM.
        WA_RM1-RM = WA_TAB4-RM.
        WA_RM1-NETVAL = 0.
        READ TABLE IT_ZDSMTER INTO WA_ZDSMTER WITH KEY BZIRK = WA_TAB4-RM SPART = '50'.
        IF SY-SUBRC EQ 0.
          DIV = 'BC'.
          DCOUNT = DCOUNT + 1.
        ENDIF.
        READ TABLE IT_ZDSMTER INTO WA_ZDSMTER WITH KEY BZIRK = WA_TAB4-RM SPART = '60'.
        IF SY-SUBRC EQ 0.
          DIV = 'XL'.
          DCOUNT = DCOUNT + 1.
        ENDIF.
        READ TABLE IT_ZDSMTER INTO WA_ZDSMTER WITH KEY BZIRK = WA_TAB4-RM SPART = '70'.
        IF SY-SUBRC EQ 0.
          DIV = 'LS'.
          DCOUNT = DCOUNT + 1.
        ENDIF.
        IF DCOUNT GT 1.
          DIV = 'BCL'.
        ENDIF.

        WA_RM1-DIV = DIV.
        READ TABLE IT_PA0001 INTO WA_PA0001  WITH KEY PLANS = WA_YTERRALLC1-PLANS.
        IF SY-SUBRC EQ 0.
          WA_RM1-PERNR = WA_PA0001-PERNR.
          READ TABLE IT_PA0302 INTO WA_PA0302 WITH KEY PERNR = WA_PA0001-PERNR.
          IF SY-SUBRC EQ 0.
            SELECT SINGLE * FROM PA0302 WHERE PERNR EQ WA_PA0001-PERNR AND MASSN EQ '01'.
            IF SY-SUBRC EQ 0.
              WA_RM1-DOJ = PA0302-BEGDA.
            ENDIF.
          ENDIF.
        ENDIF.
        COLLECT WA_RM1 INTO IT_RM1.
        CLEAR : WA_RM1.
      ENDIF.
    ENDIF.
  ENDLOOP.
*****************************************

  LOOP AT IT_TAS2 INTO WA_TAS2.
    CLEAR : DIV,DCOUNT.
    READ TABLE IT_YTERRALLC2 INTO WA_YTERRALLC2 WITH KEY BZIRK = WA_TAS2-ZM.
    IF SY-SUBRC EQ 0.
      WA_ZM1-REG = WA_TAS2-REG.
      WA_ZM1-ZM = WA_TAS2-ZM.
      WA_ZM1-NETVAL = WA_TAS2-NETVAL.
      READ TABLE IT_DIV2 INTO WA_DIV2 WITH KEY ZM = WA_TAS2-ZM SPART = '50'.
      IF SY-SUBRC = 0.
        DIV = 'BC'.
        DCOUNT = DCOUNT + 1.
      ENDIF.
      READ TABLE IT_DIV2 INTO WA_DIV2 WITH KEY ZM = WA_TAS2-ZM SPART = '60'.
      IF SY-SUBRC = 0.
        DIV = 'XL'.
        DCOUNT = DCOUNT + 1.
      ENDIF.
      READ TABLE IT_DIV2 INTO WA_DIV2 WITH KEY ZM = WA_TAS2-ZM SPART = '70'.
      IF SY-SUBRC = 0.
        DIV = 'LS'.
        DCOUNT = DCOUNT + 1.
      ENDIF.
      IF DCOUNT GT 1.
        DIV = 'BCL'.
      ENDIF.
      WA_ZM1-DIV = DIV.

      READ TABLE IT_PA0001 INTO WA_PA0001  WITH KEY PLANS = WA_YTERRALLC2-PLANS.
      IF SY-SUBRC EQ 0.
        WA_ZM1-PERNR = WA_PA0001-PERNR.
        READ TABLE IT_PA0302 INTO WA_PA0302 WITH KEY PERNR = WA_PA0001-PERNR.
        IF SY-SUBRC EQ 0.
          WA_ZM1-DOJ = WA_PA0302-BEGDA.
        ENDIF.
      ENDIF.
      COLLECT WA_ZM1 INTO IT_ZM1.
      CLEAR  WA_ZM1.
    ENDIF.
  ENDLOOP.

*******************ALL ZM TERR*****************
  LOOP AT IT_TAB4 INTO WA_TAB4.
    CLEAR : DIV,DCOUNT.
    READ TABLE IT_YTERRALLC2 INTO WA_YTERRALLC2 WITH KEY BZIRK = WA_TAB4-ZM.
    IF SY-SUBRC EQ 0.
      READ TABLE IT_ZM1 INTO WA_ZM1 WITH KEY ZM = WA_TAB4-ZM.
      IF SY-SUBRC EQ 4.
        WRITE : / 'second RM',WA_TAB4-BZIRK.
        WA_ZM1-REG = WA_TAB4-REG.
        WA_ZM1-ZM = WA_TAB4-ZM.
        WA_ZM1-NETVAL = 0.
        READ TABLE IT_ZDSMTER INTO WA_ZDSMTER WITH KEY BZIRK = WA_TAB4-ZM SPART = '50'.
        IF SY-SUBRC EQ 0.
          DIV = 'BC'.
          DCOUNT = DCOUNT + 1.
        ENDIF.
        READ TABLE IT_ZDSMTER INTO WA_ZDSMTER WITH KEY BZIRK = WA_TAB4-ZM SPART = '60'.
        IF SY-SUBRC EQ 0.
          DIV = 'XL'.
          DCOUNT = DCOUNT + 1.
        ENDIF.
        READ TABLE IT_ZDSMTER INTO WA_ZDSMTER WITH KEY BZIRK = WA_TAB4-ZM SPART = '70'.
        IF SY-SUBRC EQ 0.
          DIV = 'LS'.
          DCOUNT = DCOUNT + 1.
        ENDIF.
        IF DCOUNT GT 1.
          DIV = 'BCL'.
        ENDIF.
        WA_ZM1-DIV = DIV.
        READ TABLE IT_PA0001 INTO WA_PA0001  WITH KEY PLANS = WA_YTERRALLC2-PLANS.
        IF SY-SUBRC EQ 0.
          WA_ZM1-PERNR = WA_PA0001-PERNR.
          READ TABLE IT_PA0302 INTO WA_PA0302 WITH KEY PERNR = WA_PA0001-PERNR.
          IF SY-SUBRC EQ 0.
            SELECT SINGLE * FROM PA0302 WHERE PERNR EQ WA_PA0001-PERNR AND MASSN EQ '01'.
            IF SY-SUBRC EQ 0.
              WA_ZM1-DOJ = PA0302-BEGDA.
            ENDIF.
          ENDIF.
        ENDIF.
        COLLECT WA_ZM1 INTO IT_ZM1.
        CLEAR : WA_ZM1.
      ENDIF.
    ENDIF.
  ENDLOOP.
*****************************************

  LOOP AT IT_TAS2 INTO WA_TAS2.
    CLEAR : DIV,DCOUNT.
    READ TABLE IT_YTERRALLC3 INTO WA_YTERRALLC3 WITH KEY BZIRK = WA_TAS2-REG.
    IF SY-SUBRC EQ 0.
      WA_REG1-REG = WA_TAS2-REG.
      WA_REG1-NETVAL = WA_TAS2-NETVAL.
      READ TABLE IT_DIV2 INTO WA_DIV2 WITH KEY REG = WA_TAS2-REG SPART = '50'.
      IF SY-SUBRC = 0.
        DIV = 'BC'.
        DCOUNT = DCOUNT + 1.
      ENDIF.
      READ TABLE IT_DIV2 INTO WA_DIV2 WITH KEY REG = WA_TAS2-REG SPART = '60'.
      IF SY-SUBRC = 0.
        DIV = 'XL'.
        DCOUNT = DCOUNT + 1.
      ENDIF.
      READ TABLE IT_DIV2 INTO WA_DIV2 WITH KEY REG = WA_TAS2-REG SPART = '70'.
      IF SY-SUBRC = 0.
        DIV = 'LS'.
        DCOUNT = DCOUNT + 1.
      ENDIF.
      IF DCOUNT GT 1.
        DIV = 'BCL'.
      ENDIF.
      WA_REG1-DIV = DIV.
      READ TABLE IT_PA0001 INTO WA_PA0001  WITH KEY PLANS = WA_YTERRALLC3-PLANS.
      IF SY-SUBRC EQ 0.
        WA_REG1-PERNR = WA_PA0001-PERNR.
        READ TABLE IT_PA0302 INTO WA_PA0302 WITH KEY PERNR = WA_PA0001-PERNR.
        IF SY-SUBRC EQ 0.
          WA_REG1-DOJ = WA_PA0302-BEGDA.
        ENDIF.
      ENDIF.
      COLLECT WA_REG1 INTO IT_REG1.
      CLEAR  WA_REG1.
    ENDIF.
  ENDLOOP.

*******************ALL REG TERR*****************
  LOOP AT IT_TAB4 INTO WA_TAB4.
    CLEAR : DIV,DCOUNT.
    READ TABLE IT_YTERRALLC3 INTO WA_YTERRALLC3 WITH KEY BZIRK = WA_TAB4-REG.
    IF SY-SUBRC EQ 0.
      READ TABLE IT_REG1 INTO WA_REG1 WITH KEY REG = WA_TAB4-REG.
      IF SY-SUBRC EQ 4.
        WA_REG1-REG = WA_TAB4-REG.
        WA_REG1-NETVAL = 0.
        READ TABLE IT_ZDSMTER INTO WA_ZDSMTER WITH KEY BZIRK = WA_TAB4-REG SPART = '50'.
        IF SY-SUBRC EQ 0.
          DIV = 'BC'.
          DCOUNT = DCOUNT + 1.
        ENDIF.
        READ TABLE IT_ZDSMTER INTO WA_ZDSMTER WITH KEY BZIRK = WA_TAB4-REG SPART = '60'.
        IF SY-SUBRC EQ 0.
          DIV = 'XL'.
          DCOUNT = DCOUNT + 1.
        ENDIF.
        READ TABLE IT_ZDSMTER INTO WA_ZDSMTER WITH KEY BZIRK = WA_TAB4-REG SPART = '70'.
        IF SY-SUBRC EQ 0.
          DIV = 'LS'.
          DCOUNT = DCOUNT + 1.
        ENDIF.
        IF DCOUNT GT 1.
          DIV = 'BCL'.
        ENDIF.
        WA_REG1-DIV = DIV.
        READ TABLE IT_PA0001 INTO WA_PA0001  WITH KEY PLANS = WA_YTERRALLC3-PLANS.
        IF SY-SUBRC EQ 0.
          WA_REG1-PERNR = WA_PA0001-PERNR.
          READ TABLE IT_PA0302 INTO WA_PA0302 WITH KEY PERNR = WA_PA0001-PERNR.
          IF SY-SUBRC EQ 0.
            SELECT SINGLE * FROM PA0302 WHERE PERNR EQ WA_PA0001-PERNR AND MASSN EQ '01'.
            IF SY-SUBRC EQ 0.
              WA_REG1-DOJ = PA0302-BEGDA.
            ENDIF.
          ENDIF.
        ENDIF.
        COLLECT WA_REG1 INTO IT_REG1.
        CLEAR : WA_REG1.
      ENDIF.
    ENDIF.
  ENDLOOP.
***keep vacant territories as per new logic Jyotsna27.2.24
*  DELETE IT_PSO1 WHERE PERNR EQ '00000000'.
*  DELETE IT_RM1 WHERE PERNR EQ '00000000'.
*  DELETE IT_ZM1 WHERE PERNR EQ '00000000'.
*  DELETE IT_REG1 WHERE PERNR EQ '00000000'.



  CLEAR : IT_TAS1,IT_TAS2,IT_TAP1,IT_TAP2,IT_TAP3.
ENDFORM.                    "SALE1






*&---------------------------------------------------------------------*
*&      Form  SALEP
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
FORM SALEP.
  SORT IT_TAD1 BY PRD_CODE.
  SORT IT_TAB4 BY BZIRK.
  SORT IT_TAS2 BY BZIRK SAMP_PRD.
  SORT IT_YTERRALLC BY BZIRK.
  SORT IT_YTERRALLC1 BY BZIRK.
  SORT IT_YTERRALLC2 BY BZIRK.
  SORT IT_YTERRALLC3 BY BZIRK.
  SORT IT_PA0001 BY PLANS.

  CLEAR : IT_TAS1,IT_TAS2.
  M1 = DATE1-LOW+4(2).
  Y1 = DATE1-LOW+0(4).

  CALL FUNCTION 'RE_ADD_MONTH_TO_DATE'
    EXPORTING
      MONTHS  = '1'
      OLDDATE = DATE1-LOW
    IMPORTING
      NEWDATE = 1DATE1.
  M2 = 1DATE1+4(2).
  Y2 = 1DATE1+0(4).

  CALL FUNCTION 'RE_ADD_MONTH_TO_DATE'
    EXPORTING
      MONTHS  = '1'
      OLDDATE = 1DATE1
    IMPORTING
      NEWDATE = 2DATE1.
  M3 = 2DATE1+4(2).
  Y3 = 2DATE1+0(4).

  CALL FUNCTION 'RE_ADD_MONTH_TO_DATE'
    EXPORTING
      MONTHS  = '1'
      OLDDATE = 2DATE1
    IMPORTING
      NEWDATE = 3DATE1.
  M4 = 3DATE1+4(2).
  Y4 = 3DATE1+0(4).

  CALL FUNCTION 'HR_JP_MONTH_BEGIN_END_DATE'
    EXPORTING
      IV_DATE           = 3DATE1
    IMPORTING
*     EV_MONTH_BEGIN_DATE       =
      EV_MONTH_END_DATE = LDATE1.

  IF DATE1-LOW+6(2) NE '01'.
    MESSAGE 'ENTER START DATE OF THE MONTH' TYPE 'E'.
  ENDIF.
  IF DATE1-HIGH GT LDATE1.
    MESSAGE 'ENTER PERIOD FOR MAXIMUM 3 MONTHS' TYPE 'E'.
  ENDIF.


*  IF IT_TAD1 IS NOT INITIAL.
*    SELECT * FROM ZRPQV INTO TABLE IT_ZRPQV1 FOR ALL ENTRIES IN IT_TAD1 WHERE ( ZMONTH EQ M1 AND ZYEAR EQ Y1 ) AND MATNR EQ IT_TAD1-PRD_CODE.
*  ENDIF.
*  IF IT_TAD1 IS NOT INITIAL.
*    SELECT * FROM ZRPQV INTO TABLE IT_ZRPQV2 FOR ALL ENTRIES IN IT_TAD1 WHERE ( ZMONTH EQ M2 AND ZYEAR EQ Y2 ) AND MATNR EQ IT_TAD1-PRD_CODE.
*  ENDIF.
*  IF IT_TAD1 IS NOT INITIAL.
*    SELECT * FROM ZRPQV INTO TABLE IT_ZRPQV3 FOR ALL ENTRIES IN IT_TAD1 WHERE ( ZMONTH EQ M3 AND ZYEAR EQ Y3 ) AND MATNR EQ IT_TAD1-PRD_CODE.
*  ENDIF.
*  IF IT_TAD1 IS NOT INITIAL.
*    SELECT * FROM ZRPQV INTO TABLE IT_ZRPQV4 FOR ALL ENTRIES IN IT_TAD1 WHERE ( ZMONTH EQ M4 AND ZYEAR EQ Y4 ) AND MATNR EQ IT_TAD1-PRD_CODE.
*  ENDIF.
  IF IT_TAD1 IS NOT INITIAL.
    SELECT * FROM ZSAMP_PQV1 INTO TABLE IT_ZRPQV1 FOR ALL ENTRIES IN IT_TAD1 WHERE ( ZMONTH EQ M1 AND ZYEAR EQ Y1 ) AND MATNR EQ IT_TAD1-PRD_CODE.
  ENDIF.
  IF IT_TAD1 IS NOT INITIAL.
    SELECT * FROM ZSAMP_PQV1 INTO TABLE IT_ZRPQV2 FOR ALL ENTRIES IN IT_TAD1 WHERE ( ZMONTH EQ M2 AND ZYEAR EQ Y2 ) AND MATNR EQ IT_TAD1-PRD_CODE.
  ENDIF.
  IF IT_TAD1 IS NOT INITIAL.
    SELECT * FROM ZSAMP_PQV1 INTO TABLE IT_ZRPQV3 FOR ALL ENTRIES IN IT_TAD1 WHERE ( ZMONTH EQ M3 AND ZYEAR EQ Y3 ) AND MATNR EQ IT_TAD1-PRD_CODE.
  ENDIF.
  IF IT_TAD1 IS NOT INITIAL.
    SELECT * FROM ZSAMP_PQV1 INTO TABLE IT_ZRPQV4 FOR ALL ENTRIES IN IT_TAD1 WHERE ( ZMONTH EQ M4 AND ZYEAR EQ Y4 ) AND MATNR EQ IT_TAD1-PRD_CODE.
  ENDIF.

  LOOP AT IT_ZRPQV1 INTO WA_ZRPQV1.
    MOVE-CORRESPONDING WA_ZRPQV1 TO WA_ZRPQV.
    COLLECT WA_ZRPQV INTO IT_ZRPQV.
    CLEAR WA_ZRPQV1.
  ENDLOOP.

  LOOP AT IT_ZRPQV2 INTO WA_ZRPQV2.
    MOVE-CORRESPONDING WA_ZRPQV2 TO WA_ZRPQV.
    COLLECT WA_ZRPQV INTO IT_ZRPQV.
    CLEAR WA_ZRPQV2.
  ENDLOOP.

  LOOP AT IT_ZRPQV3 INTO WA_ZRPQV3.
    MOVE-CORRESPONDING WA_ZRPQV3 TO WA_ZRPQV.
    COLLECT WA_ZRPQV INTO IT_ZRPQV.
    CLEAR WA_ZRPQV3.
  ENDLOOP.

  LOOP AT IT_ZRPQV4 INTO WA_ZRPQV4.
    MOVE-CORRESPONDING WA_ZRPQV4 TO WA_ZRPQV.
    COLLECT WA_ZRPQV INTO IT_ZRPQV.
    CLEAR WA_ZRPQV4.
  ENDLOOP.

  LOOP AT IT_ZRPQV INTO WA_ZRPQV.
    CLEAR : DIV,DCOUNT.
    WA_TAS1-MATNR = WA_ZRPQV-MATNR.
    WA_TAS1-BZIRK = WA_ZRPQV-BZIRK.
    WA_TAS1-NETVAL = WA_ZRPQV-GROSSPTS.
*    READ TABLE IT_DIV2 INTO WA_DIV2 WITH KEY BZIRK = WA_ZRPQV-BZIRK SPART = '50' .
*    IF SY-SUBRC EQ 0.
*      READ TABLE IT_DIV2 INTO WA_DIV2 WITH KEY BZIRK = WA_ZRPQV-BZIRK SPART = '60' .
*      IF SY-SUBRC EQ 0.
*        DIV = 'BCL'.
*      ELSE.
*        DIV = 'BC'.
*      ENDIF.
*    ELSE.
*      DIV = 'XL'.
*    ENDIF.

    READ TABLE IT_DIV2 INTO WA_DIV2 WITH KEY BZIRK = WA_ZRPQV-BZIRK SPART = '50' .
    IF SY-SUBRC EQ 0.
      DIV = 'BC'.
      DCOUNT = DCOUNT + 1.
    ENDIF.
    READ TABLE IT_DIV2 INTO WA_DIV2 WITH KEY BZIRK = WA_ZRPQV-BZIRK SPART = '60' .
    IF SY-SUBRC EQ 0.
      DIV = 'XL'.
      DCOUNT = DCOUNT + 1.
    ENDIF.
    READ TABLE IT_DIV2 INTO WA_DIV2 WITH KEY BZIRK = WA_ZRPQV-BZIRK SPART = '70' .
    IF SY-SUBRC EQ 0.
      DIV = 'LS'.
      DCOUNT = DCOUNT + 1.
    ENDIF.
    IF DCOUNT GT 1.
      DIV = 'BCL'.
    ENDIF.

    WA_TAS1-DIV = DIV.
    COLLECT WA_TAS1 INTO IT_TAS1.
    CLEAR WA_TAS1.
  ENDLOOP.
  SORT IT_TAS1 BY DIV.

  LOOP AT IT_TAS1 ASSIGNING <FS_TAS1>.  " PSO SALE
*    read table it_tad1 into wa_tad1 with key prd_code = <fs_tas1>-matnr.
    LOOP AT IT_TAD1 INTO WA_TAD1 WHERE PRD_CODE = <FS_TAS1>-MATNR.
      WA_TAS2-SAMP_PRD = WA_TAD1-SAMP_PRD.
      WA_TAS2-BZIRK = <FS_TAS1>-BZIRK.
      WA_TAS2-NETVAL = <FS_TAS1>-NETVAL.
      WA_TAS2-DIV = <FS_TAS1>-DIV.
      READ TABLE IT_TAB4 INTO WA_TAB4 WITH KEY BZIRK = <FS_TAS1>-BZIRK .
      IF SY-SUBRC EQ 0.
        WA_TAS2-RM = WA_TAB4-RM.
        WA_TAS2-ZM = WA_TAB4-ZM.
        WA_TAS2-REG = WA_TAB4-REG.
      ENDIF.
      COLLECT WA_TAS2 INTO IT_TAS2.
      CLEAR WA_TAS2.
    ENDLOOP.
  ENDLOOP.
*  ULINE.
  SORT IT_TAS2 BY SAMP_PRD REG RM BZIRK.

  IF R2 EQ 'X'.

    LOOP AT IT_TAS2 INTO WA_TAS2.
*    WRITE : / 'a',wa_tas2-samp_prd,wa_tas2-netval,wa_tas2-div,wa_tas2-bzirk,wa_tas2-rm,wa_tas2-zm,wa_tas2-reg,wa_tas2-netval,wa_tas2-div.
      READ TABLE IT_YTERRALLC INTO WA_YTERRALLC WITH KEY BZIRK = WA_TAS2-BZIRK .
      IF SY-SUBRC EQ 0.
        WA_PPSO1-SAMP_PRD = WA_TAS2-SAMP_PRD.
        WA_PPSO1-REG = WA_TAS2-REG.
        WA_PPSO1-ZM = WA_TAS2-ZM.
        WA_PPSO1-RM = WA_TAS2-RM.
        WA_PPSO1-BZIRK = WA_TAS2-BZIRK.
        WA_PPSO1-NETVAL = WA_TAS2-NETVAL.
        WA_PPSO1-DIV = WA_TAS2-DIV.
        READ TABLE IT_PA0001 INTO WA_PA0001 WITH KEY PLANS = WA_YTERRALLC-PLANS .
        IF SY-SUBRC EQ 0.
          WA_PPSO1-PERNR = WA_PA0001-PERNR.
          READ TABLE IT_PA0302 INTO WA_PA0302 WITH KEY PERNR = WA_PA0001-PERNR.
          IF SY-SUBRC EQ 0.
            WA_PPSO1-DOJ = WA_PA0302-BEGDA.
          ENDIF.
        ENDIF.
        COLLECT WA_PPSO1 INTO IT_PPSO1.
        CLEAR  WA_PPSO1.
      ENDIF.
    ENDLOOP.

******************all territories**************
    LOOP AT IT_TAB4 INTO WA_TAB4.

      READ TABLE IT_YTERRALLC INTO WA_YTERRALLC WITH KEY BZIRK = WA_TAB4-BZIRK.
      IF SY-SUBRC EQ 0.
        LOOP AT IT_PRD1 INTO WA_PRD1.
          CLEAR : DIV,DCOUNT.
          READ TABLE IT_PPSO1 INTO WA_PPSO1 WITH KEY BZIRK = WA_TAB4-BZIRK SAMP_PRD = WA_PRD1-SAMP_PRD..
          IF SY-SUBRC EQ 4.
            WA_PPSO1-SAMP_PRD = WA_PRD1-SAMP_PRD.
            WA_PPSO1-REG = WA_TAB4-REG.
            WA_PPSO1-ZM = WA_TAB4-ZM.
            WA_PPSO1-RM = WA_TAB4-RM.
            WA_PPSO1-BZIRK = WA_TAB4-BZIRK.
            WA_PPSO1-NETVAL = 0.
            READ TABLE IT_ZDSMTER INTO WA_ZDSMTER WITH KEY BZIRK = WA_TAB4-BZIRK SPART = '50'.
            IF SY-SUBRC EQ 0.
              DIV = 'BC'.
              DCOUNT = DCOUNT + 1.
            ENDIF.
            READ TABLE IT_ZDSMTER INTO WA_ZDSMTER WITH KEY BZIRK = WA_TAB4-BZIRK SPART = '60'.
            IF SY-SUBRC EQ 0.
              DIV = 'XL'.
              DCOUNT = DCOUNT + 1.
            ENDIF.
            READ TABLE IT_ZDSMTER INTO WA_ZDSMTER WITH KEY BZIRK = WA_TAB4-BZIRK SPART = '70'.
            IF SY-SUBRC EQ 0.
              DIV = 'LS'.
              DCOUNT = DCOUNT + 1.
            ENDIF.
            IF DCOUNT GT 1.
              DIV = 'BCL'.
            ENDIF.
            WA_PPSO1-DIV = DIV.
            READ TABLE IT_PA0001 INTO WA_PA0001  WITH KEY PLANS = WA_YTERRALLC-PLANS.
            IF SY-SUBRC EQ 0.
              WA_PPSO1-PERNR = WA_PA0001-PERNR.
              READ TABLE IT_PA0302 INTO WA_PA0302 WITH KEY PERNR = WA_PA0001-PERNR.
              IF SY-SUBRC EQ 0.
                SELECT SINGLE * FROM PA0302 WHERE PERNR EQ WA_PA0001-PERNR AND MASSN EQ '01'.
                IF SY-SUBRC EQ 0.
                  WA_PPSO1-DOJ = PA0302-BEGDA.
                ENDIF.
              ENDIF.
            ENDIF.
            COLLECT WA_PPSO1 INTO IT_PPSO1.
            CLEAR  WA_PPSO1.
          ENDIF.
        ENDLOOP.
*          ENDIF.
*        ENDIF.
      ENDIF.
    ENDLOOP.

*  LOOP at it_pppso1 INTO wa_pppso1.
*    LOOP at it_ppso1 INTO wa_ppso1 with
*  endloop.


  ELSEIF R3 EQ 'X'.


    LOOP AT IT_TAS2 INTO WA_TAS2.
      CLEAR : DIV,DCOUNT.
*    WRITE : / 'a',wa_tas2-samp_prd,wa_tas2-netval,wa_tas2-div,wa_tas2-bzirk,wa_tas2-rm,wa_tas2-zm,wa_tas2-reg,wa_tas2-netval,wa_tas2-div.
      READ TABLE IT_YTERRALLC1 INTO WA_YTERRALLC1 WITH KEY BZIRK = WA_TAS2-RM .
      IF SY-SUBRC EQ 0.
        WA_PRM1-SAMP_PRD = WA_TAS2-SAMP_PRD.
        WA_PRM1-REG = WA_TAS2-REG.
        WA_PRM1-ZM = WA_TAS2-ZM.
        WA_PRM1-RM = WA_TAS2-RM.
        WA_PRM1-NETVAL = WA_TAS2-NETVAL.
        READ TABLE IT_DIV2 INTO WA_DIV2 WITH KEY RM = WA_TAS2-RM SPART = '50' .
        IF SY-SUBRC EQ 0.
          DIV = 'BC'.
          DCOUNT = DCOUNT + 1.
        ENDIF.
        READ TABLE IT_DIV2 INTO WA_DIV2 WITH KEY RM = WA_TAS2-RM SPART = '60' .
        IF SY-SUBRC EQ 0.
          DIV = 'XL'.
          DCOUNT = DCOUNT + 1.
        ENDIF.
        READ TABLE IT_DIV2 INTO WA_DIV2 WITH KEY RM = WA_TAS2-RM SPART = '70' .
        IF SY-SUBRC EQ 0.
          DIV = 'LS'.
          DCOUNT = DCOUNT + 1.
        ENDIF.
        IF DCOUNT GT 1.
          DIV = 'BCL'.
        ENDIF.
        WA_PRM1-DIV = DIV.
        READ TABLE IT_PA0001 INTO WA_PA0001  WITH KEY PLANS = WA_YTERRALLC1-PLANS .
        IF SY-SUBRC EQ 0.
          WA_PRM1-PERNR = WA_PA0001-PERNR.
          READ TABLE IT_PA0302 INTO WA_PA0302 WITH KEY PERNR = WA_PA0001-PERNR.
          IF SY-SUBRC EQ 0.
            WA_PRM1-DOJ = WA_PA0302-BEGDA.
          ENDIF.
        ENDIF.
        COLLECT WA_PRM1 INTO IT_PRM1.
        CLEAR  WA_PRM1.
      ENDIF.
    ENDLOOP.

*************ALL RM TERR************
    LOOP AT IT_TAB4 INTO WA_TAB4.
      CLEAR : DIV,DCOUNT.
      READ TABLE IT_YTERRALLC1 INTO WA_YTERRALLC1 WITH KEY BZIRK = WA_TAB4-RM.
      IF SY-SUBRC EQ 0.
        LOOP AT IT_PRD1 INTO WA_PRD1.
          CLEAR : DIV,DCOUNT.
          READ TABLE IT_PRM1 INTO WA_PRM1 WITH KEY RM = WA_TAB4-RM SAMP_PRD = WA_PRD1-SAMP_PRD..
          IF SY-SUBRC EQ 4.
            WA_PRM1-SAMP_PRD = WA_PRD1-SAMP_PRD.
            WA_PRM1-REG = WA_TAB4-REG.
            WA_PRM1-ZM = WA_TAB4-ZM.
            WA_PRM1-RM = WA_TAB4-RM.
            WA_PRM1-NETVAL = 0.
            READ TABLE IT_DIV2 INTO WA_DIV2 WITH KEY RM = WA_TAB4-RM SPART = '50'.
            IF SY-SUBRC EQ 0.
              DIV = 'BC'.
              DCOUNT = DCOUNT + 1.
            ENDIF.
            READ TABLE IT_DIV2 INTO WA_DIV2 WITH KEY RM = WA_TAB4-RM SPART = '60'.
            IF SY-SUBRC EQ 0.
              DIV = 'XL'.
              DCOUNT = DCOUNT + 1.
            ENDIF.
            READ TABLE IT_DIV2 INTO WA_DIV2 WITH KEY RM = WA_TAB4-RM SPART = '70'.
            IF SY-SUBRC EQ 0.
              DIV = 'LS'.
              DCOUNT = DCOUNT + 1.
            ENDIF.
            IF DCOUNT GT 1.
              DIV = 'BCL'.
            ENDIF.
            WA_PRM1-DIV = DIV.
            READ TABLE IT_PA0001 INTO WA_PA0001 WITH KEY PLANS = WA_YTERRALLC1-PLANS.
            IF SY-SUBRC EQ 0.
              READ TABLE IT_PA0302 INTO WA_PA0302 WITH KEY PERNR = WA_PA0001-PERNR.
              IF SY-SUBRC EQ 0.
                WA_PRM1-PERNR = WA_PA0001-PERNR.
                SELECT SINGLE * FROM PA0302 WHERE PERNR EQ WA_PA0001-PERNR AND MASSN EQ '01'.
                IF SY-SUBRC EQ 0.
                  WA_PRM1-DOJ = PA0302-BEGDA.
                ENDIF.
              ENDIF.
            ENDIF.
            COLLECT WA_PRM1 INTO IT_PRM1.
            CLEAR  WA_PRM1.
          ENDIF.
        ENDLOOP.
      ENDIF.
    ENDLOOP.


    LOOP AT IT_TAS2 INTO WA_TAS2.
      CLEAR : DIV,DCOUNT.
*    WRITE : / 'a',wa_tas2-samp_prd,wa_tas2-netval,wa_tas2-div,wa_tas2-bzirk,wa_tas2-rm,wa_tas2-zm,wa_tas2-reg,wa_tas2-netval,wa_tas2-div.
      READ TABLE IT_YTERRALLC2 INTO WA_YTERRALLC2 WITH KEY BZIRK = WA_TAS2-ZM .
      IF SY-SUBRC EQ 0.
        WA_PZM1-SAMP_PRD = WA_TAS2-SAMP_PRD.
        WA_PZM1-REG = WA_TAS2-REG.
        WA_PZM1-ZM = WA_TAS2-ZM.
        WA_PZM1-NETVAL = WA_TAS2-NETVAL.
        READ TABLE IT_DIV2 INTO WA_DIV2 WITH KEY ZM = WA_TAS2-ZM SPART = '50'.
        IF SY-SUBRC EQ 0.
          DIV = 'BC'.
          DCOUNT = DCOUNT + 1.
        ENDIF.
        READ TABLE IT_DIV2 INTO WA_DIV2 WITH KEY ZM = WA_TAS2-ZM SPART = '60'.
        IF SY-SUBRC EQ 0.
          DIV = 'XL'.
          DCOUNT = DCOUNT + 1.
        ENDIF.
        READ TABLE IT_DIV2 INTO WA_DIV2 WITH KEY ZM = WA_TAS2-ZM SPART = '70'.
        IF SY-SUBRC EQ 0.
          DIV = 'LS'.
          DCOUNT = DCOUNT + 1.
        ENDIF.
        IF DCOUNT GT 1.
          DIV = 'BCL'.
        ENDIF.
        WA_PZM1-DIV = DIV.
        READ TABLE IT_PA0001 INTO WA_PA0001  WITH KEY PLANS = WA_YTERRALLC2-PLANS .
        IF SY-SUBRC EQ 0.
          WA_PZM1-PERNR = WA_PA0001-PERNR.
          READ TABLE IT_PA0302 INTO WA_PA0302 WITH KEY PERNR = WA_PA0001-PERNR.
          IF SY-SUBRC EQ 0.
            WA_PZM1-DOJ = WA_PA0302-BEGDA.
          ENDIF.
        ENDIF.
        COLLECT WA_PZM1 INTO IT_PZM1.
        CLEAR  WA_PZM1.
      ENDIF.
    ENDLOOP.

*************ALL ZM TERR************
    LOOP AT IT_TAB4 INTO WA_TAB4.
      CLEAR : DIV,DCOUNT.
      READ TABLE IT_YTERRALLC2 INTO WA_YTERRALLC2 WITH KEY BZIRK = WA_TAB4-ZM.
      IF SY-SUBRC EQ 0.
        LOOP AT IT_PRD1 INTO WA_PRD1.
          CLEAR : DIV,DCOUNT.
          READ TABLE IT_PZM1 INTO WA_PZM1 WITH KEY ZM = WA_TAB4-ZM SAMP_PRD = WA_PRD1-SAMP_PRD..
          IF SY-SUBRC EQ 4.
            WA_PZM1-SAMP_PRD = WA_PRD1-SAMP_PRD.
            WA_PZM1-REG = WA_TAB4-REG.
            WA_PZM1-ZM = WA_TAB4-ZM.
            WA_PZM1-NETVAL = 0.
            READ TABLE IT_DIV2 INTO WA_DIV2 WITH KEY ZM = WA_TAB4-ZM SPART = '50'.
            IF SY-SUBRC EQ 0.
              DIV = 'BC'.
              DCOUNT = DCOUNT + 1.
            ENDIF.
            READ TABLE IT_DIV2 INTO WA_DIV2 WITH KEY ZM = WA_TAB4-ZM SPART = '60'.
            IF SY-SUBRC EQ 0.
              DIV = 'XL'.
              DCOUNT = DCOUNT + 1.
            ENDIF.
            READ TABLE IT_DIV2 INTO WA_DIV2 WITH KEY ZM = WA_TAB4-ZM SPART = '70'.
            IF SY-SUBRC EQ 0.
              DIV = 'LS'.
              DCOUNT = DCOUNT + 1.
            ENDIF.
            IF DCOUNT GT 1.
              DIV = 'BCL'.
            ENDIF.
            WA_PZM1-DIV = DIV.

            READ TABLE IT_PA0001 INTO WA_PA0001  WITH KEY PLANS = WA_YTERRALLC2-PLANS.
            IF SY-SUBRC EQ 0.
              WA_PZM1-PERNR = WA_PA0001-PERNR.
              READ TABLE IT_PA0302 INTO WA_PA0302 WITH KEY PERNR = WA_PA0001-PERNR.
              IF SY-SUBRC EQ 0.
                SELECT SINGLE * FROM PA0302 WHERE PERNR = WA_PA0001-PERNR AND MASSN EQ '01'.
                IF SY-SUBRC EQ 0.
                  WA_PZM1-DOJ = PA0302-BEGDA.
                ENDIF.
              ENDIF.
            ENDIF.
            COLLECT WA_PZM1 INTO IT_PZM1.
            CLEAR  WA_PZM1.
          ENDIF.
        ENDLOOP.

      ENDIF.
    ENDLOOP.

*********************************
    LOOP AT IT_TAS2 INTO WA_TAS2.
      CLEAR : DIV,DCOUNT.
*    WRITE : / 'a',wa_tas2-samp_prd,wa_tas2-netval,wa_tas2-div,wa_tas2-bzirk,wa_tas2-rm,wa_tas2-zm,wa_tas2-reg,wa_tas2-netval,wa_tas2-div.
      READ TABLE IT_YTERRALLC3 INTO WA_YTERRALLC3 WITH KEY BZIRK = WA_TAS2-REG.
      IF SY-SUBRC EQ 0.
        WA_PREG1-SAMP_PRD = WA_TAS2-SAMP_PRD.
        WA_PREG1-REG = WA_TAS2-REG.
        WA_PREG1-NETVAL = WA_TAS2-NETVAL.
        READ TABLE IT_DIV2 INTO WA_DIV2 WITH KEY REG = WA_TAS2-REG SPART = '50' .
        IF SY-SUBRC EQ 0.
          DIV = 'BC'.
          DCOUNT = DCOUNT + 1.
        ENDIF.
        READ TABLE IT_DIV2 INTO WA_DIV2 WITH KEY REG = WA_TAS2-REG SPART = '60' .
        IF SY-SUBRC EQ 0.
          DIV = 'XL'.
          DCOUNT = DCOUNT + 1.
        ENDIF.
        READ TABLE IT_DIV2 INTO WA_DIV2 WITH KEY REG = WA_TAS2-REG SPART = '70' .
        IF SY-SUBRC EQ 0.
          DIV = 'LS'.
          DCOUNT = DCOUNT + 1.
        ENDIF.
        IF DCOUNT GT 1.
          DIV = 'BCL'.
        ENDIF.
        WA_PREG1-DIV = DIV.

        READ TABLE IT_PA0001 INTO WA_PA0001  WITH KEY PLANS = WA_YTERRALLC3-PLANS .
        IF SY-SUBRC EQ 0.
          WA_PREG1-PERNR = WA_PA0001-PERNR.
          READ TABLE IT_PA0302 INTO WA_PA0302 WITH KEY PERNR = WA_PA0001-PERNR.
          IF SY-SUBRC EQ 0.
            WA_PREG1-DOJ = WA_PA0302-BEGDA.
          ENDIF.
        ENDIF.

        COLLECT WA_PREG1 INTO IT_PREG1.
        CLEAR  WA_PREG1.
      ENDIF.
    ENDLOOP.


*************ALL REG TERR************
    LOOP AT IT_TAB4 INTO WA_TAB4.
      CLEAR : DIV,DCOUNT.
      READ TABLE IT_YTERRALLC3 INTO WA_YTERRALLC3 WITH KEY BZIRK = WA_TAB4-REG.
      IF SY-SUBRC EQ 0.
        LOOP AT IT_PRD1 INTO WA_PRD1.
          CLEAR : DIV,DCOUNT.
          READ TABLE IT_PREG1 INTO WA_PREG1 WITH KEY REG = WA_TAB4-REG SAMP_PRD = WA_PRD1-SAMP_PRD..
          IF SY-SUBRC EQ 4.
            WA_PREG1-SAMP_PRD = WA_PRD1-SAMP_PRD.
            WA_PREG1-REG = WA_TAB4-REG.
            WA_PREG1-NETVAL = 0.
            READ TABLE IT_DIV2 INTO WA_DIV2 WITH KEY REG = WA_TAB4-REG SPART = '50'.
            IF SY-SUBRC EQ 0.
              DIV = 'BC'.
              DCOUNT = DCOUNT + 1.
            ENDIF.
            READ TABLE IT_DIV2 INTO WA_DIV2 WITH KEY REG = WA_TAB4-REG SPART = '60'.
            IF SY-SUBRC EQ 0.
              DIV = 'XL'.
              DCOUNT = DCOUNT + 1.
            ENDIF.
            READ TABLE IT_DIV2 INTO WA_DIV2 WITH KEY REG = WA_TAB4-REG SPART = '70'.
            IF SY-SUBRC EQ 0.
              DIV = 'LS'.
              DCOUNT = DCOUNT + 1.
            ENDIF.
            IF DCOUNT GT 1.
              DIV = 'BCL'.
            ENDIF.
            WA_PREG1-DIV = DIV.
            READ TABLE IT_PA0001 INTO WA_PA0001  WITH KEY PLANS = WA_YTERRALLC3-PLANS.
            IF SY-SUBRC EQ 0.
              WA_PREG1-PERNR = WA_PA0001-PERNR.
              READ TABLE IT_PA0302 INTO WA_PA0302 WITH KEY PERNR = WA_PA0001-PERNR.
              IF SY-SUBRC EQ 0.
                SELECT SINGLE * FROM PA0302 WHERE PERNR = WA_PA0001-PERNR AND MASSN EQ '01'.
                IF SY-SUBRC EQ 0.
                  WA_PREG1-DOJ = PA0302-BEGDA.
                ENDIF.
              ENDIF.
            ENDIF.
            COLLECT WA_PREG1 INTO IT_PREG1.
            CLEAR  WA_PREG1.
          ENDIF.
        ENDLOOP.
      ENDIF.
    ENDLOOP.




  ENDIF.

ENDFORM.                    "SALE1
