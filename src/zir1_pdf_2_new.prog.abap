*&---------------------------------------------------------------------*
*& Report  ZIR1_PDF_2
*&
*&---------------------------------------------------------------------*
*& TR / Date - BCDK936414 / 25.02.2025
*& Change - added new bill type ZSCA of export merchant sale
*&---------------------------------------------------------------------*
*& TR / Date - BCDK936865 / 23.05.2025
*& Change - added plant 2030 (PUN2) in stock details in output at bottom.
*&---------------------------------------------------------------------*
REPORT ZIR1_PDF_2_A1.
CONSTANTS: GC_BUKRS TYPE BUKRS VALUE '1000'.

TABLES: T001W,
        VBRK,
        ZPENEXCLUDE,
        T134G,
        A602,
        KONP,
        MARA,
        EKKO,
        ZBUDGET_TAB1,
        BKPF,
        BSEG,
        ZEXPESTSALE,
        ZTB_T134G,
        ZIR1_AUTO.

TYPES: BEGIN OF TYP_WERKS,
         WERKS TYPE WERKS_D,
       END OF TYP_WERKS.

TYPES: BEGIN OF TYP_INV,
         VBELN   TYPE VBELN_VF,
*         KUNAG TYPE KUNAG,
         MATNR_I TYPE MATNR,
         POSNR_I TYPE POSNR_VF,
         VBTYP   TYPE VBTYP,
         KNUMV   TYPE KNUMV,
         FKART   TYPE FKART,
         FKDAT   TYPE FKDAT,
         FKIMG_I TYPE FKIMG,
         VRKME_I TYPE VRKME,
*         GSBER_I TYPE GSBER,
         WERKS_I TYPE WERKS_D,
         NETWR_I TYPE NETWR,
         KALSM   TYPE KALSM,
       END OF TYP_INV.


TYPES: BEGIN OF TYP_GSBER,
         GSBER TYPE GSBER,
         DMBTR TYPE DMBTR,
       END OF TYP_GSBER.

TYPES: BEGIN OF TYP_MARD,
         MATNR TYPE MATNR,
         WERKS TYPE WERKS_D,
         LGORT TYPE LGORT_D,
         LABST TYPE LABST,
         INSME TYPE INSME,
         EINME TYPE EINME,
         SPEME TYPE SPEME,
         RETME TYPE RETME,
       END OF TYP_MARD.

TYPES: BEGIN OF TYP_MATNR,
         MATNR TYPE MATNR,
         WERKS TYPE WERKS_D,
         MENGE TYPE MENGE_D,
       END OF TYP_MATNR.

TYPES: BEGIN OF TYP_KONP,
         KNUMH TYPE KNUMH,
         KOPOS TYPE KOPOS,
         KBETR TYPE KBETR,
         KONWA TYPE KONWA,
       END OF TYP_KONP.

TYPES: BEGIN OF TYP_MARC,
         MATNR TYPE MATNR,
         WERKS TYPE WERKS_D,
         TRAME TYPE TRAME,
       END OF TYP_MARC.

TYPES: BEGIN OF TYP_T012K,
         BUKRS TYPE BUKRS,
         HBKID TYPE HBKID,
         HKTID TYPE HKTID,
         HKONT TYPE HKONT,
       END OF TYP_T012K.

TYPES: BEGIN OF TYP_BSIS,
         BUKRS TYPE BUKRS,
         HKONT TYPE HKONT,
         AUGDT TYPE AUGDT,
         AUGBL TYPE AUGBL,
         ZUONR TYPE DZUONR,
         GJAHR TYPE GJAHR,
         BELNR TYPE BELNR_D,
         BUZEI TYPE BUZEI,
         BUDAT TYPE BUDAT,
         SHKZG TYPE SHKZG,
         GSBER TYPE GSBER,
         DMBTR TYPE DMBTR,
       END OF TYP_BSIS.

TYPES: BEGIN OF TYP_BSID,
         BUKRS TYPE BUKRS,
         KUNNR TYPE KUNNR,
         UMSKS TYPE UMSKS,
         UMSKZ TYPE UMSKZ,
         AUGDT TYPE AUGDT,
         AUGBL TYPE AUGBL,
         ZUONR TYPE DZUONR,
         GJAHR TYPE GJAHR,
         BELNR TYPE BELNR_D,
         BUZEI TYPE BUZEI,
         BUDAT TYPE BUDAT,
         BLART TYPE BLART,
         BSCHL TYPE BSCHL,
         SHKZG TYPE SHKZG,
         GSBER TYPE GSBER,
         DMBTR TYPE DMBTR,
         ZFBDT TYPE DZFBDT,
         ZBD1T TYPE DZBD1T,
         VBELN TYPE VBELN,
       END OF TYP_BSID.

TYPES: BEGIN OF TYP_ODR,
         GSBER TYPE GSBER,
         DMBTR TYPE DMBTR,
         N     TYPE C,
       END OF TYP_ODR.

TYPES: BEGIN OF TYP_MARA,
         MATNR TYPE MATNR,
         SPART TYPE SPART,
       END OF TYP_MARA.

TYPES: BEGIN OF  TYP_KUNNR,
         KUNNR TYPE KUNNR,
       END OF TYP_KUNNR.

TYPES: BEGIN OF TYP_VBFA,
         VBELV   TYPE VBELN_VON,
         POSNV   TYPE POSNR_VON,
         VBELN   TYPE VBELN_NACH,
         POSNN   TYPE POSNR_NACH,
         VBTYP_N TYPE VBTYP_N,
         RFMNG   TYPE RFMNG,
         MEINS   TYPE MEINS,
       END OF TYP_VBFA.

TYPES: BEGIN OF TYP_VBELN,
         VBELN TYPE VBELN,
         POSNR TYPE POSNR,
       END OF TYP_VBELN.

TYPES: BEGIN OF TYP_YSDIR1,
         VBELN    TYPE VBELN,
         VBELN_1  TYPE VBELN,
         POSNR    TYPE POSNR,
         VBELN_2  TYPE VBELN,
         VBELN_3  TYPE VBELN,
         POSNR_3  TYPE POSNR,
         GBSTK    TYPE GBSTK,
         CMGST    TYPE CMGST,
         SPSTG    TYPE SPSTG,
         LFSTA    TYPE LFSTA,
         GBSTA    TYPE GBSTA,
         KUNNR    TYPE KUNAG,
         MATNR    TYPE MATNR,
*         GSBER    TYPE GSBER,
         NETWR    TYPE NETWR_AP,
         WAERK    TYPE WAERK,
         KWMENG   TYPE KWMENG,
         VRKME    TYPE VRKME,
         WERKS    TYPE YSDIR1-WERKS,
         NETVALUE TYPE DMBTR,
       END OF TYP_YSDIR1.

TYPES: BEGIN OF TYP_PLNTSTK,
         WERKS TYPE WERKS_D,
         NETWR TYPE NETWR,
       END OF TYP_PLNTSTK.

TYPES: BEGIN OF TYP_PLNT_NAM,
         WERKS TYPE WERKS_D,
         KUNNR TYPE KUNNR,
       END OF TYP_PLNT_NAM.

TYPES: BEGIN OF TYP_KNUMV,
         KNUMV TYPE KNUMV,
       END OF TYP_KNUMV.

TYPES: BEGIN OF TYP_KONV,
         KNUMV TYPE KNUMV,
         KPOSN TYPE KPOSN,
         STUNR TYPE STUNR,
         ZAEHK TYPE DZAEHK,
         KWERT TYPE KWERT,
       END OF TYP_KONV.

DATA: BEGIN OF WA_INV_DISP,
        VBELN   LIKE VBRK-VBELN,
        FKDAT   LIKE VBRK-FKDAT,
        KUNAG   TYPE VBRK-KUNAG,
        NETWR_I LIKE VBRP-NETWR,
      END OF WA_INV_DISP.

DATA: BEGIN OF WA_PLNT_STK,
        MATNR LIKE MARD-MATNR,
        WERKS LIKE MARD-WERKS,
        DMBTR LIKE MBEW-STPRS,
      END OF WA_PLNT_STK.

DATA: BEGIN OF WA_ODR_OPN,
        VBELN    LIKE VBAP-VBELN,
        KUNNR    LIKE VBAK-KUNNR,
        NETVALUE LIKE VBAP-NETWR,
      END OF WA_ODR_OPN.

DATA: BEGIN OF WA_ACCT,
        BUKRS type BUKRS,
        BELNR type BELNR_d,
        GJAHR type GJAHR,
        BUZEI type BUZEI,
        DMBTR type DMBTR,
        KUNNR type KUNNR,
      END OF WA_ACCT.


* Declaration of Internal Table

DATA: ITAB_WERKS      TYPE TABLE OF TYP_WERKS,
      ITAB_WERKSO     TYPE TABLE OF TYP_WERKS,
      ITAB_WERKSP     TYPE TABLE OF TYP_WERKS,
*      itab_werksi     type table of typ_werks,
      ITAB_T134G      TYPE TABLE OF ZTB_T134G,
      ITAB_T134G1     TYPE TABLE OF ZTB_T134G,
      WA_T134G        TYPE ZTB_T134G,
      ITAB_T134GO     TYPE TABLE OF ZTB_T134G,
      WA_T134GO       TYPE ZTB_T134G,
      ITAB_T134GP     TYPE TABLE OF ZTB_T134G,
*      itab_t134gi     type table of t134g,
      WA_T134GP       TYPE T134G,
      ITAB_TGSBT      TYPE TABLE OF TGSBT,
      ITAB_INV_CUR    TYPE TABLE OF TYP_INV,
      WA_INV_CUR      TYPE TYP_INV,
      ITAB_INV_PRE    TYPE TABLE OF TYP_INV,
      WA_INV_PRE      TYPE TYP_INV,
      ITAB_INV_PRE_YR TYPE TABLE OF TYP_INV,
      WA_INV_PRE_YR   TYPE TYP_INV,
      "ADDED BY PRASANNA SRIDHARAN ON 18.11.2011
      ITAB_GSBER      TYPE TABLE OF TYP_GSBER,
      ITAB_MARD       TYPE TABLE OF TYP_MARD,
      ITAB_A004       TYPE TABLE OF A004,
      ITAB_KONP       TYPE TABLE OF TYP_KONP,
      ITAB_MATNR      TYPE TABLE OF TYP_MATNR,
      ITAB_MARC       TYPE TABLE OF TYP_MARC,
*      ITAB_T012K      TYPE TABLE OF TYP_T012K,
      ITAB_BSIS       TYPE TABLE OF TYP_BSIS,
      ITAB_BSID       TYPE TABLE OF TYP_BSID,
      WA_BSID         TYPE TYP_BSID,
      ITAB_ODR        TYPE TABLE OF TYP_ODR,
      ITAB_NOTE       TYPE TABLE OF TYP_BSID,
      ITAB_OPEN       TYPE TABLE OF TYP_YSDIR1,
      ITAB_PARTIAL    TYPE TABLE OF TYP_YSDIR1,
      WA_PARTIAL      TYPE TYP_YSDIR1,
      WA_OPEN         TYPE TYP_YSDIR1,
      ITAB_CREDIT     TYPE TABLE OF TYP_YSDIR1,
      WA_CREDIT       TYPE TYP_YSDIR1,
      ITAB_OPEN1      TYPE TABLE OF TYP_YSDIR1, " Credit Limit
      ITAB_OPEN2      TYPE TABLE OF TYP_YSDIR1,
      ITAB_OPEN3      TYPE TABLE OF TYP_YSDIR1,
      ITAB_OPEN4      TYPE TABLE OF TYP_YSDIR1,
      ITAB_VBFA       TYPE TABLE OF TYP_VBFA,
      WA_VBFA         TYPE TYP_VBFA,
      ITAB_STKDET     TYPE TABLE OF YSTKDET,
      ITAB_PLNTSTK    TYPE TABLE OF TYP_PLNTSTK,
      ITAB_PLNT_NAM   TYPE TABLE OF TYP_PLNT_NAM,
      ITAB_MARA       TYPE TABLE OF TYP_MARA,
      ITAB_VBELN      TYPE TABLE OF TYP_VBELN,
      ITAB_KNUMV      TYPE TABLE OF TYP_KNUMV,
      ITAB_KONV       TYPE SORTED TABLE OF TYP_KONV WITH UNIQUE KEY KNUMV
                                                              KPOSN
                                                              STUNR
                                                              ZAEHK,
      ITAB_INV_DISP   LIKE WA_INV_DISP OCCURS 0,
      ITAB_PLNT_STK   LIKE WA_PLNT_STK OCCURS 0,
      ITAB_OPEN_DISP  LIKE WA_ODR_OPN OCCURS 0,
      ITAB_ACCT       LIKE WA_ACCT OCCURS 0.


TYPES : BEGIN OF CUM1,
*          bcdmbtr type prcd_elements-kbetr,
*          bcbud   type prcd_elements-kbetr,
*          xldmbtr type prcd_elements-kbetr,
*          xlbud   type prcd_elements-kbetr,
          DMBTR TYPE P DECIMALS 2,
          MATNR TYPE MARA-MATNR,
        END OF CUM1.

TYPES : BEGIN OF CUM2,
          BCDMBTR TYPE KBETR,
          BCBUD   TYPE KBETR,
          XLDMBTR TYPE KBETR,
          XLBUD   TYPE KBETR,
          LSDMBTR TYPE KBETR,
          LSBUD   TYPE KBETR,
        END OF CUM2.
DATA: IT_CUM1 TYPE TABLE OF CUM1,
      WA_CUM1 TYPE CUM1,
      IT_CUM2 TYPE TABLE OF CUM2,
      WA_CUM2 TYPE CUM2.

TYPES : BEGIN OF OML1 ,
          OMLVAL TYPE KBETR,
          NSKVAL TYPE KBETR,
          GOAVAL TYPE KBETR,
        END OF OML1.

DATA : IT_OML1 TYPE TABLE OF OML1,
       WA_OML1 TYPE OML1,
       IT_OML2 TYPE TABLE OF OML1,
       WA_OML2 TYPE OML1.

TYPE-POOLS:  SLIS.

DATA: G_REPID     LIKE SY-REPID,
      FIELDCAT    TYPE SLIS_T_FIELDCAT_ALV,
      WA_FIELDCAT LIKE LINE OF FIELDCAT,
      SORT        TYPE SLIS_T_SORTINFO_ALV,
      WA_SORT     LIKE LINE OF SORT,
      LAYOUT      TYPE SLIS_LAYOUT_ALV,
      L_GLAY      TYPE LVC_S_GLAY.
DATA: G_REPID1     LIKE SY-REPID,
      FIELDCAT1    TYPE SLIS_T_FIELDCAT_ALV,
      WA_FIELDCAT1 LIKE LINE OF FIELDCAT,
      SORT1        TYPE SLIS_T_SORTINFO_ALV,
      WA_SORT1     LIKE LINE OF SORT,
      LAYOUT1      TYPE SLIS_LAYOUT_ALV,
      L_GLAY1      TYPE LVC_S_GLAY.
TYPES : BEGIN OF SALE1,
          WERKS TYPE VBRP-WERKS,
          NEP   TYPE VBRP-WERKS,
          LYS   TYPE VBRK-NETWR,
          LMS   TYPE VBRK-NETWR,
          CUMS  TYPE VBRK-NETWR,
          CS    TYPE VBRK-NETWR,
          GSBER TYPE T134G-GSBER,
        END OF SALE1.

DATA : IT_ZDAILYSALES TYPE TABLE OF ZDAILYSALES,
       WA_ZDAILYSALES TYPE ZDAILYSALES.
DATA : IT_SALE1 TYPE TABLE OF SALE1,
       WA_SALE1 TYPE SALE1.
FIELD-SYMBOLS : <IT_SALE1> TYPE SALE1.
DATA : W_FKART TYPE VBRK-FKART.

DATA: IT_FLDCAT    TYPE LVC_T_FCAT,
      WA_IT_FLDCAT TYPE LVC_S_FCAT.

DATA: W_DATE    TYPE DATS,
      W_DATE1   TYPE DATS,
      W_MON(2)  TYPE N,
      W_YER(4)  TYPE N,
      W_YER1(4), "ADDED BY PRASSANA ON 18.11.2011
      W_DATE2   TYPE I,
      W_NOS(5)  TYPE N,
      C         TYPE I,
      MATNR1    TYPE MARA-MATNR.

DATA : A TYPE I.
DATA : LMTOT TYPE P,
       LYTOT TYPE P.

DATA: WA_GSBER   TYPE TYP_GSBER,
      WA_MATNR   TYPE TYP_MATNR,
      WA_ODR     TYPE TYP_ODR,
      WA_PLNTSTK TYPE TYP_PLNTSTK,
      WA_KNUMV   TYPE TYP_KNUMV,
*      g_repid    LIKE sy-repid,
      MOFF       LIKE SY-FDPOS,
      NO         TYPE DLYDY,
      NO1        TYPE DLYDY,
*      WA_ZFBDT LIKE BSEG-ZFBDT,
      MESG(50)   TYPE C.


DATA : BCBUD TYPE ZBUDGET_TAB1-VAL,
       XLBUD TYPE ZBUDGET_TAB1-VAL,
       LSBUD TYPE ZBUDGET_TAB1-VAL.




FIELD-SYMBOLS: <FS>,
               <FS1>,
               <FS_T134G>    TYPE ZTB_T134G,
*               <fs_t134g>    TYPE t134g,
               <FS_TGSBT>    TYPE TGSBT,
               <FS_INV>      TYPE TYP_INV,
               <FS_MARD>     TYPE TYP_MARD,
               <FS_A004>     TYPE A004,
               <FS_KONP>     TYPE TYP_KONP,
               <FS_MATNR>    TYPE TYP_MATNR,
               <FS_MARC>     TYPE TYP_MARC,
               <FS_BSIS>     TYPE TYP_BSIS,
               <FS_BSID>     TYPE TYP_BSID,
               <FS_ODR>      TYPE TYP_ODR,
               <FS_YSDIR1>   TYPE TYP_YSDIR1,
               <FS_VBFA>     TYPE TYP_VBFA,
               <FS_STKDET>   TYPE YSTKDET,
               <FS_PLNT_NAM> TYPE TYP_PLNT_NAM,
               <FS_MARA>     TYPE TYP_MARA,
               <FS_WERKS>    TYPE TYP_WERKS,
               <FS_VBELN>    TYPE TYP_VBELN,
               <FS_KONV>     TYPE TYP_KONV.

FIELD-SYMBOLS: <DYN_TABLE> TYPE STANDARD TABLE,
               <DYN_WA>.


DATA:TYP1 TYPE C.

RANGES: R_DAT FOR SY-DATUM,
*        R_GSBER FOR VBRP-GSBER.
        R_WERKS FOR VBRP-WERKS.



******************** anbu ends






TYPES: BEGIN OF TY_VBFA1,
         VBELV   TYPE VBFA-VBELV,
         VBTYP_N TYPE VBFA-VBTYP_N,
       END OF TY_VBFA1.

TYPES: BEGIN OF TY_KNVV,
         KUNNR TYPE KNVV-KUNNR,
         KDGRP TYPE KNVV-KDGRP,
       END OF TY_KNVV.

TYPES: BEGIN OF TY_KNKK,
         KUNNR TYPE KUNNR,
         KLIMK TYPE KNKK-KLIMK,
         SKFOR TYPE KNKK-SKFOR,
       END OF TY_KNKK.

TYPES: BEGIN OF TY_CUST,
         KUNNR TYPE KUNNR,
       END OF TY_CUST.

DATA: ITAB_VBFA1 TYPE TABLE OF TY_VBFA1,
      WA_VBFA1   TYPE TY_VBFA1,
      ITAB_KNVV  TYPE TABLE OF TY_KNVV,
      WA_KNVV    TYPE TY_KNVV,
*      IT_KNKK    TYPE TABLE OF TY_KNKK,
*      WA_KNKK    TYPE TY_KNKK,
      WA_CUST    TYPE TY_CUST,
      IT_CUST    TYPE TABLE OF TY_CUST.



TYPES: BEGIN OF TY_BKPF,
         BELNR TYPE BKPF-BELNR,
         BLART TYPE BKPF-BLART,
         AWKEY TYPE CHAR10,
       END OF TY_BKPF.

TYPES: BEGIN OF TY_VBRK,
         VBELN TYPE CHAR10,
         VBTYP TYPE VBRK-VBTYP,
         FKSTO TYPE VBRK-FKSTO,
       END OF TY_VBRK.

TYPES: BEGIN OF TY_VBRK_CAN,
         VBELN TYPE CHAR10,
         FKSTO TYPE VBRK-FKSTO,
         SFAKN TYPE VBRK-SFAKN,
         NETWR TYPE NETWR,
       END OF TY_VBRK_CAN.


TYPES: BEGIN OF TY_BKPF1,
         BELNR     TYPE BKPF-BELNR,
         BLART     TYPE BKPF-BLART,
         AWKEY     TYPE CHAR20,
         XREVERSAL TYPE BKPF-XREVERSAL,
       END OF TY_BKPF1.

TYPES: BEGIN OF TY_VBRK1,
         VBELN TYPE CHAR20,
         VBTYP TYPE VBRK-VBTYP,
       END OF TY_VBRK1.

TYPES: BEGIN OF TY_BSEG,
         BELNR TYPE BSEG-BELNR,
         GJAHR TYPE BSEG-GJAHR,
         GSBER TYPE BSEG-GSBER,
         BSCHL TYPE BSEG-BSCHL,
         DMBTR TYPE BSEG-DMBTR,
         KUNNR TYPE BSEG-KUNNR,
       END OF TY_BSEG.

TYPES: BEGIN OF TY_MARD,
         MATNR TYPE MATNR,
         WERKS TYPE WERKS,
         LABST TYPE MARD-LABST,
       END OF TY_MARD.


DATA: IT_BKPF         TYPE TABLE OF TY_BKPF,
      IT_BKPF1        TYPE TABLE OF TY_BKPF,
      WA_BKPF1        TYPE TY_BKPF,
      IT_BKPF2        TYPE TABLE OF TY_BKPF,
      WA_BKPF2        TYPE TY_BKPF,
      IT_BKPF3        TYPE TABLE OF TY_BKPF,
      IT_CRENOTE      TYPE TABLE OF TY_BSEG,
      WA_CRENOTE      TYPE TY_BSEG,
      IT_MARD         TYPE TABLE OF TY_MARD,
      WA_MARD         TYPE TY_MARD,
      IT_MARD1        TYPE TABLE OF TY_MARD,
      WA_MARD1        TYPE TY_MARD,
      IT_DEBNOTE      TYPE TABLE OF TY_BSEG,
      WA_DEBNOTE      TYPE TY_BSEG,
      WA_BKPF         TYPE TY_BKPF,
      IT_VBRK         TYPE TABLE OF TY_VBRK,
      IT_VBRK_CAN     TYPE TABLE OF TY_VBRK_CAN,
      WA_VBRK_CAN     TYPE TY_VBRK_CAN,
      IT_O            TYPE TABLE OF TY_VBRK1,
      WA_O            TYPE TY_VBRK1,
      IT_P            TYPE TABLE OF TY_VBRK1,
      WA_P            TYPE TY_VBRK1,
      IT_BKPF4        TYPE TABLE OF TY_BKPF1,
      WA_BKPF4        TYPE TY_BKPF1,
      IT_BKPF5        TYPE TABLE OF TY_BKPF1,
      WA_BKPF5        TYPE TY_BKPF1,
      WA_VBRK         TYPE TY_VBRK,
      G_DATE          TYPE SY-DATUM,
      L_YEAR1         TYPE CHAR4,
      G_LABST         TYPE MARD-LABST,
      IT_MKPF         TYPE TABLE OF MKPF,
      WA_MKPF         TYPE MKPF,
      IT_MSEG         TYPE TABLE OF MSEG,
      WA_MSEG         TYPE MSEG,
      IT_ZBUDGET_TAB1 TYPE TABLE OF ZBUDGET_TAB1,
      WA_ZBUDGET_TAB1 TYPE ZBUDGET_TAB1.


G_DATE = SY-DATUM.
*     L_YEAR1 = G_DATE+0(4).


******************************************************************************************SABU ADDED FOR THE MAILING IN PDF FORMAT
" ******************* EMAIL OPTIONS VARIABLES ADDED HERE ********************

DATA : OPTIONS        TYPE ITCPO,
       L_OTF_DATA     LIKE ITCOO OCCURS 10,
       L_ASC_DATA     LIKE TLINE OCCURS 10,
       L_DOCS         LIKE DOCS  OCCURS 10,
       L_PDF_DATA     LIKE SOLISTI1 OCCURS 10,
       L_PDF_DATA1    LIKE SOLISTI1 OCCURS 10,
       L_BIN_FILESIZE TYPE I.

DATA :  RESULT      LIKE  ITCPP.
DATA: DOCDATA LIKE SOLISTI1  OCCURS  10,
      OBJHEAD LIKE SOLISTI1  OCCURS  1,
      OBJBIN1 LIKE SOLISTI1  OCCURS 10,
      OBJBIN  LIKE SOLISTI1  OCCURS 10.
DATA: LISTOBJECT LIKE ABAPLIST  OCCURS  1 .
DATA: DOC_CHNG LIKE SODOCCHGI1.
DATA RECLIST    LIKE SOMLRECI1  OCCURS  1 WITH HEADER LINE.
DATA MCOUNT TYPE I.


DATA : USRID_LONG LIKE PA0105-USRID_LONG.
DATA : W_USRID_LONG TYPE PA0105-USRID_LONG.
DATA RIGHE_ATTACHMENT TYPE I.
DATA RIGHE_TESTO TYPE I.
DATA TAB_LINES TYPE I.
DATA  BEGIN OF OBJPACK OCCURS 0 .
INCLUDE STRUCTURE  SOPCKLSTI1.
DATA END OF OBJPACK.

DATA BEGIN OF OBJTXT OCCURS 0.
INCLUDE STRUCTURE SOLISTI1.
DATA END OF OBJTXT.
DATA: V_MSG(125) TYPE C.
DATA : WA_D1(10) TYPE C,
       WA_D2(10) TYPE C,
       C1(241)   TYPE C.
DATA: LTX LIKE T247-LTX.
*DATA : uemail(70) TYPE c.

DATA: SDATE1      TYPE SY-DATUM,
      EXPVAL1     TYPE P DECIMALS 2,
      EXPVAL2     TYPE P,
      EXPVAL(10)  TYPE C,
      TEXPVAL1    TYPE P DECIMALS 2,
      TEXPVAL2    TYPE P,
      TEXPVAL(10) TYPE C,
      VAL         TYPE P DECIMALS 2.
DATA: EXPV1 TYPE P.
DATA: EIT_VBRK        TYPE TABLE OF VBRK,
      EWA_VBRK        TYPE VBRK,
      TIT_VBRK        TYPE TABLE OF VBRK,
      TWA_VBRK        TYPE VBRK,
      IT_ZIR1_EXCLUDE TYPE TABLE OF ZIR1_EXCLUDE,  "addedon 17.5.23
      WA_ZIR1_EXCLUDE TYPE ZIR1_EXCLUDE.
"************** EMAIL OPTION VARIABLES ENDS HERE**********************




DATA : TS_AHM(7) TYPE P  DECIMALS 0,
       TS_BHS(7) TYPE P  DECIMALS 0,
       TS_PUN(7) TYPE P  DECIMALS 0,
       TS_OZH(7) TYPE P  DECIMALS 0,
       TS_DEL(7) TYPE P  DECIMALS 0,
       TS_COC(7) TYPE P  DECIMALS 0,
       TS_MAD(7) TYPE P  DECIMALS 0,
       TS_HUB(7) TYPE P  DECIMALS 0,
       TS_HYD(7) TYPE P  DECIMALS 0,
       TS_VIJ(7) TYPE P  DECIMALS 0,
       TS_LUC(7) TYPE P  DECIMALS 0,
       TS_VAR(7) TYPE P  DECIMALS 0,
       TS_MEE(7) TYPE P  DECIMALS 0,
       TS_ROH(7) TYPE P  DECIMALS 0,
       TS_CHA(7) TYPE P  DECIMALS 0,
       TS_ZIR(7) TYPE P  DECIMALS 0,
       TS_JAI(7) TYPE P  DECIMALS 0,
       TS_IND(7) TYPE P  DECIMALS 0,
       TS_RAI(7) TYPE P  DECIMALS 0,
       TS_PAT(7) TYPE P  DECIMALS 0,
       TS_RAN(7) TYPE P  DECIMALS 0,
       TS_KLC(7) TYPE P  DECIMALS 0,
       TS_CTK(7) TYPE P  DECIMALS 0,
*       ts_nsk(7) TYPE p  DECIMALS 0,
*       ts_goa(7) TYPE p  DECIMALS 0,
       TS_NOS(7) TYPE P  DECIMALS 0,
       TS_TOT(7) TYPE P  DECIMALS 0.


DATA : LM_AHM(7) TYPE P  DECIMALS 0,
       LM_BHS(7) TYPE P  DECIMALS 0,
       LM_PUN(7) TYPE P  DECIMALS 0,
       LM_OZH(7) TYPE P  DECIMALS 0,
       LM_DEL(7) TYPE P  DECIMALS 0,
       LM_COC(7) TYPE P  DECIMALS 0,
       LM_MAD(7) TYPE P  DECIMALS 0,
       LM_HUB(7) TYPE P  DECIMALS 0,
       LM_HYD(7) TYPE P  DECIMALS 0,
       LM_VIJ(7) TYPE P  DECIMALS 0,
       LM_LUC(7) TYPE P  DECIMALS 0,
       LM_VAR(7) TYPE P  DECIMALS 0,
       LM_MEE(7) TYPE P  DECIMALS 0,
       LM_ROH(7) TYPE P  DECIMALS 0,
       LM_CHA(7) TYPE P  DECIMALS 0,
       LM_ZIR(7) TYPE P  DECIMALS 0,
       LM_JAI(7) TYPE P  DECIMALS 0,
       LM_IND(7) TYPE P  DECIMALS 0,
       LM_RAI(7) TYPE P  DECIMALS 0,
       LM_PAT(7) TYPE P  DECIMALS 0,
       LM_RAN(7) TYPE P  DECIMALS 0,
       LM_KLC(7) TYPE P  DECIMALS 0,
       LM_CTK(7) TYPE P  DECIMALS 0,
*       lm_nsk(7) TYPE p  DECIMALS 0,
*       lm_goa(7) TYPE p  DECIMALS 0,
       LM_NOS(7) TYPE P  DECIMALS 0,
       LM_TOT(7) TYPE P  DECIMALS 0.



DATA : CS_AHM(7) TYPE P  DECIMALS 0,
       CS_BHS(7) TYPE P  DECIMALS 0,
       CS_PUN(7) TYPE P  DECIMALS 0,
       CS_OZH(7) TYPE P  DECIMALS 0,
       CS_DEL(7) TYPE P  DECIMALS 0,
       CS_COC(7) TYPE P  DECIMALS 0,
       CS_MAD(7) TYPE P  DECIMALS 0,
       CS_HUB(7) TYPE P  DECIMALS 0,
       CS_HYD(7) TYPE P  DECIMALS 0,
       CS_VIJ(7) TYPE P  DECIMALS 0,
       CS_LUC(7) TYPE P  DECIMALS 0,
       CS_VAR(7) TYPE P  DECIMALS 0,
       CS_MEE(7) TYPE P  DECIMALS 0,
       CS_ROH(7) TYPE P  DECIMALS 0,
       CS_CHA(7) TYPE P  DECIMALS 0,
       CS_ZIR(7) TYPE P  DECIMALS 0,
       CS_JAI(7) TYPE P  DECIMALS 0,
       CS_IND(7) TYPE P  DECIMALS 0,
       CS_RAI(7) TYPE P  DECIMALS 0,
       CS_PAT(7) TYPE P  DECIMALS 0,
       CS_RAN(7) TYPE P  DECIMALS 0,
       CS_KLC(7) TYPE P  DECIMALS 0,
       CS_CTK(7) TYPE P  DECIMALS 0,
*       cs_nsk(7) TYPE p  DECIMALS 0,
*       cs_goa(7) TYPE p  DECIMALS 0,
       CS_NOS(7) TYPE P  DECIMALS 0,
       CS_TOT(7) TYPE P  DECIMALS 0.





DATA : LY_AHM(7) TYPE P  DECIMALS 0,
       LY_BHS(7) TYPE P  DECIMALS 0,
       LY_PUN(7) TYPE P  DECIMALS 0,
       LY_OZH(7) TYPE P  DECIMALS 0,
       LY_DEL(7) TYPE P  DECIMALS 0,
       LY_COC(7) TYPE P  DECIMALS 0,
       LY_MAD(7) TYPE P  DECIMALS 0,
       LY_HUB(7) TYPE P  DECIMALS 0,
       LY_HYD(7) TYPE P  DECIMALS 0,
       LY_VIJ(7) TYPE P  DECIMALS 0,
       LY_LUC(7) TYPE P  DECIMALS 0,
       LY_VAR(7) TYPE P  DECIMALS 0,
       LY_MEE(7) TYPE P  DECIMALS 0,
       LY_ROH(7) TYPE P  DECIMALS 0,
       LY_CHA(7) TYPE P  DECIMALS 0,
       LY_ZIR(7) TYPE P  DECIMALS 0,
       LY_JAI(7) TYPE P  DECIMALS 0,
       LY_IND(7) TYPE P  DECIMALS 0,
       LY_RAI(7) TYPE P  DECIMALS 0,
       LY_PAT(7) TYPE P  DECIMALS 0,
       LY_RAN(7) TYPE P  DECIMALS 0,
       LY_KLC(7) TYPE P  DECIMALS 0,
       LY_CTK(7) TYPE P  DECIMALS 0,
*       ly_nsk(7) TYPE p  DECIMALS 0,
*       ly_goa(7) TYPE p  DECIMALS 0,
       LY_NOS(7) TYPE P  DECIMALS 0,
       LY_TOT(7) TYPE P  DECIMALS 0.

DATA : CLS_AHM(7) TYPE P  DECIMALS 0,
       CLS_BHS(7) TYPE P  DECIMALS 0,
       CLS_PUN(7) TYPE P  DECIMALS 0,
       CLS_OZH(7) TYPE P  DECIMALS 0,
       CLS_DEL(7) TYPE P  DECIMALS 0,
       CLS_COC(7) TYPE P  DECIMALS 0,
       CLS_MAD(7) TYPE P  DECIMALS 0,
       CLS_HUB(7) TYPE P  DECIMALS 0,
       CLS_HYD(7) TYPE P  DECIMALS 0,
       CLS_VIJ(7) TYPE P  DECIMALS 0,
       CLS_LUC(7) TYPE P  DECIMALS 0,
       CLS_VAR(7) TYPE P  DECIMALS 0,
       CLS_MEE(7) TYPE P  DECIMALS 0,
       CLS_ROH(7) TYPE P  DECIMALS 0,
       CLS_CHA(7) TYPE P  DECIMALS 0,
       CLS_ZIR(7) TYPE P  DECIMALS 0,
       CLS_JAI(7) TYPE P  DECIMALS 0,
       CLS_IND(7) TYPE P  DECIMALS 0,
       CLS_RAI(7) TYPE P  DECIMALS 0,
       CLS_PAT(7) TYPE P  DECIMALS 0,
       CLS_RAN(7) TYPE P  DECIMALS 0,
       CLS_KLC(7) TYPE P  DECIMALS 0,
       CLS_CTK(7) TYPE P  DECIMALS 0,
*       cls_nsk(7) TYPE p  DECIMALS 0,
*       cls_goa(7) TYPE p  DECIMALS 0,
       CLS_NOS(7) TYPE P  DECIMALS 0,
       CLS_TOT(7) TYPE P  DECIMALS 0.


DATA : ITS_AHM(7) TYPE P  DECIMALS 0,
       ITS_BHS(7) TYPE P  DECIMALS 0,
       ITS_PUN(7) TYPE P  DECIMALS 0,
       ITS_OZH(7) TYPE P  DECIMALS 0,
       ITS_DEL(7) TYPE P  DECIMALS 0,
       ITS_COC(7) TYPE P  DECIMALS 0,
       ITS_MAD(7) TYPE P  DECIMALS 0,
       ITS_HUB(7) TYPE P  DECIMALS 0,
       ITS_HYD(7) TYPE P  DECIMALS 0,
       ITS_VIJ(7) TYPE P  DECIMALS 0,
       ITS_LUC(7) TYPE P  DECIMALS 0,
       ITS_VAR(7) TYPE P  DECIMALS 0,
       ITS_MEE(7) TYPE P  DECIMALS 0,
       ITS_ROH(7) TYPE P  DECIMALS 0,
       ITS_CHA(7) TYPE P  DECIMALS 0,
       ITS_ZIR(7) TYPE P  DECIMALS 0,
       ITS_JAI(7) TYPE P  DECIMALS 0,
       ITS_IND(7) TYPE P  DECIMALS 0,
       ITS_RAI(7) TYPE P  DECIMALS 0,
       ITS_PAT(7) TYPE P  DECIMALS 0,
       ITS_RAN(7) TYPE P  DECIMALS 0,
       ITS_KLC(7) TYPE P  DECIMALS 0,
       ITS_CTK(7) TYPE P  DECIMALS 0,
       ITS_NSK(7) TYPE P  DECIMALS 0,
       ITS_GOA(7) TYPE P  DECIMALS 0,
       ITS_NOS(7) TYPE P  DECIMALS 0,
       ITS_TOT(7) TYPE P  DECIMALS 0.


DATA : TSV_AHM(7) TYPE P  DECIMALS 0,
       TSV_BHS(7) TYPE P  DECIMALS 0,
       TSV_PUN(7) TYPE P  DECIMALS 0,
       TSV_OZH(7) TYPE P  DECIMALS 0,
       TSV_DEL(7) TYPE P  DECIMALS 0,
       TSV_COC(7) TYPE P  DECIMALS 0,
       TSV_MAD(7) TYPE P  DECIMALS 0,
       TSV_HUB(7) TYPE P  DECIMALS 0,
       TSV_HYD(7) TYPE P  DECIMALS 0,
       TSV_VIJ(7) TYPE P  DECIMALS 0,
       TSV_LUC(7) TYPE P  DECIMALS 0,
       TSV_VAR(7) TYPE P  DECIMALS 0,
       TSV_MEE(7) TYPE P  DECIMALS 0,
       TSV_ROH(7) TYPE P  DECIMALS 0,
       TSV_CHA(7) TYPE P  DECIMALS 0,
       TSV_ZIR(7) TYPE P  DECIMALS 0,
       TSV_JAI(7) TYPE P  DECIMALS 0,
       TSV_IND(7) TYPE P  DECIMALS 0,
       TSV_RAI(7) TYPE P  DECIMALS 0,
       TSV_PAT(7) TYPE P  DECIMALS 0,
       TSV_RAN(7) TYPE P  DECIMALS 0,
       TSV_KLC(7) TYPE P  DECIMALS 0,
       TSV_CTK(7) TYPE P  DECIMALS 0,
*       tsv_nsk(7) TYPE p  DECIMALS 0,
*       tsv_goa(7) TYPE p  DECIMALS 0,
       TSV_NOS(7) TYPE P  DECIMALS 0,
       TSV_TOT(7) TYPE P  DECIMALS 0.


DATA : PP_AHM(7) TYPE P  DECIMALS 0,
       PP_BHS(7) TYPE P  DECIMALS 0,
       PP_PUN(7) TYPE P  DECIMALS 0,
       PP_OZH(7) TYPE P  DECIMALS 0,
       PP_DEL(7) TYPE P  DECIMALS 0,
       PP_COC(7) TYPE P  DECIMALS 0,
       PP_MAD(7) TYPE P  DECIMALS 0,
       PP_HUB(7) TYPE P  DECIMALS 0,
       PP_HYD(7) TYPE P  DECIMALS 0,
       PP_VIJ(7) TYPE P  DECIMALS 0,
       PP_LUC(7) TYPE P  DECIMALS 0,
       PP_VAR(7) TYPE P  DECIMALS 0,
       PP_MEE(7) TYPE P  DECIMALS 0,
       PP_ROH(7) TYPE P  DECIMALS 0,
       PP_CHA(7) TYPE P  DECIMALS 0,
       PP_ZIR(7) TYPE P  DECIMALS 0,
       PP_JAI(7) TYPE P  DECIMALS 0,
       PP_IND(7) TYPE P  DECIMALS 0,
       PP_RAI(7) TYPE P  DECIMALS 0,
       PP_PAT(7) TYPE P  DECIMALS 0,
       PP_RAN(7) TYPE P  DECIMALS 0,
       PP_KLC(7) TYPE P  DECIMALS 0,
       PP_CTK(7) TYPE P  DECIMALS 0,
*       pp_nsk(7) TYPE p  DECIMALS 0,
*       pp_goa(7) TYPE p  DECIMALS 0,
       PP_NOS(7) TYPE P  DECIMALS 0,
       PP_TOT(7) TYPE P  DECIMALS 0.


DATA : OD_AHM(7) TYPE P  DECIMALS 0,
       OD_BHS(7) TYPE P  DECIMALS 0,
       OD_PUN(7) TYPE P  DECIMALS 0,
       OD_OZH(7) TYPE P  DECIMALS 0,
       OD_DEL(7) TYPE P  DECIMALS 0,
       OD_COC(7) TYPE P  DECIMALS 0,
       OD_MAD(7) TYPE P  DECIMALS 0,
       OD_HUB(7) TYPE P  DECIMALS 0,
       OD_HYD(7) TYPE P  DECIMALS 0,
       OD_VIJ(7) TYPE P  DECIMALS 0,
       OD_LUC(7) TYPE P  DECIMALS 0,
       OD_VAR(7) TYPE P  DECIMALS 0,
       OD_MEE(7) TYPE P  DECIMALS 0,
       OD_ROH(7) TYPE P  DECIMALS 0,
       OD_CHA(7) TYPE P  DECIMALS 0,
       OD_ZIR(7) TYPE P  DECIMALS 0,
       OD_JAI(7) TYPE P  DECIMALS 0,
       OD_IND(7) TYPE P  DECIMALS 0,
       OD_RAI(7) TYPE P  DECIMALS 0,
       OD_PAT(7) TYPE P  DECIMALS 0,
       OD_RAN(7) TYPE P  DECIMALS 0,
       OD_KLC(7) TYPE P  DECIMALS 0,
       OD_CTK(7) TYPE P  DECIMALS 0,
*       od_nsk(7) TYPE p  DECIMALS 0,
*       od_goa(7) TYPE p  DECIMALS 0,
       OD_NOS(7) TYPE P  DECIMALS 0,
       OD_TOT(7) TYPE P  DECIMALS 0.

DATA : CL_AHM(7) TYPE P  DECIMALS 0,
       CL_BHS(7) TYPE P  DECIMALS 0,
       CL_PUN(7) TYPE P  DECIMALS 0,
       CL_OZH(7) TYPE P  DECIMALS 0,
       CL_DEL(7) TYPE P  DECIMALS 0,
       CL_COC(7) TYPE P  DECIMALS 0,
       CL_MAD(7) TYPE P  DECIMALS 0,
       CL_HUB(7) TYPE P  DECIMALS 0,
       CL_HYD(7) TYPE P  DECIMALS 0,
       CL_VIJ(7) TYPE P  DECIMALS 0,
       CL_LUC(7) TYPE P  DECIMALS 0,
       CL_VAR(7) TYPE P  DECIMALS 0,
       CL_MEE(7) TYPE P  DECIMALS 0,
       CL_ROH(7) TYPE P  DECIMALS 0,
       CL_CHA(7) TYPE P  DECIMALS 0,
       CL_ZIR(7) TYPE P  DECIMALS 0,
       CL_JAI(7) TYPE P  DECIMALS 0,
       CL_IND(7) TYPE P  DECIMALS 0,
       CL_RAI(7) TYPE P  DECIMALS 0,
       CL_PAT(7) TYPE P  DECIMALS 0,
       CL_RAN(7) TYPE P  DECIMALS 0,
       CL_KLC(7) TYPE P  DECIMALS 0,
       CL_CTK(7) TYPE P  DECIMALS 0,
*       cl_nsk(7) TYPE p  DECIMALS 0,
*       cl_goa(7) TYPE p  DECIMALS 0,
       CL_NOS(7) TYPE P  DECIMALS 0,
       CL_TOT(7) TYPE P  DECIMALS 0.

DATA : OR_AHM(7) TYPE P  DECIMALS 0,
       OR_BHS(7) TYPE P  DECIMALS 0,
       OR_PUN(7) TYPE P  DECIMALS 0,
       OR_OZH(7) TYPE P  DECIMALS 0,
       OR_DEL(7) TYPE P  DECIMALS 0,
       OR_COC(7) TYPE P  DECIMALS 0,
       OR_MAD(7) TYPE P  DECIMALS 0,
       OR_HUB(7) TYPE P  DECIMALS 0,
       OR_HYD(7) TYPE P  DECIMALS 0,
       OR_VIJ(7) TYPE P  DECIMALS 0,
       OR_LUC(7) TYPE P  DECIMALS 0,
       OR_VAR(7) TYPE P  DECIMALS 0,
       OR_MEE(7) TYPE P  DECIMALS 0,
       OR_ROH(7) TYPE P  DECIMALS 0,
       OR_CHA(7) TYPE P  DECIMALS 0,
       OR_ZIR(7) TYPE P  DECIMALS 0,
       OR_JAI(7) TYPE P  DECIMALS 0,
       OR_IND(7) TYPE P  DECIMALS 0,
       OR_RAI(7) TYPE P  DECIMALS 0,
       OR_PAT(7) TYPE P  DECIMALS 0,
       OR_RAN(7) TYPE P  DECIMALS 0,
       OR_KLC(7) TYPE P  DECIMALS 0,
       OR_CTK(7) TYPE P  DECIMALS 0,
       OR_NSK(7) TYPE P  DECIMALS 0,
       OR_GOA(7) TYPE P  DECIMALS 0,
       OR_NOS(7) TYPE P  DECIMALS 0,
       OR_TOT(7) TYPE P  DECIMALS 0.


DATA : TP_AHM(7) TYPE P  DECIMALS 0,
       TP_BHS(7) TYPE P  DECIMALS 0,
       TP_PUN(7) TYPE P  DECIMALS 0,
       TP_OZH(7) TYPE P  DECIMALS 0,
       TP_DEL(7) TYPE P  DECIMALS 0,
       TP_COC(7) TYPE P  DECIMALS 0,
       TP_MAD(7) TYPE P  DECIMALS 0,
       TP_HUB(7) TYPE P  DECIMALS 0,
       TP_HYD(7) TYPE P  DECIMALS 0,
       TP_VIJ(7) TYPE P  DECIMALS 0,
       TP_LUC(7) TYPE P  DECIMALS 0,
       TP_VAR(7) TYPE P  DECIMALS 0,
       TP_MEE(7) TYPE P  DECIMALS 0,
       TP_ROH(7) TYPE P  DECIMALS 0,
       TP_CHA(7) TYPE P  DECIMALS 0,
       TP_ZIR(7) TYPE P  DECIMALS 0,
       TP_JAI(7) TYPE P  DECIMALS 0,
       TP_IND(7) TYPE P  DECIMALS 0,
       TP_RAI(7) TYPE P  DECIMALS 0,
       TP_PAT(7) TYPE P  DECIMALS 0,
       TP_RAN(7) TYPE P  DECIMALS 0,
       TP_KLC(7) TYPE P  DECIMALS 0,
       TP_CTK(7) TYPE P  DECIMALS 0,
       TP_NSK(7) TYPE P  DECIMALS 0,
       TP_GOA(7) TYPE P  DECIMALS 0,
       TP_NOS(7) TYPE P  DECIMALS 0,
       TP_TOT(7) TYPE P  DECIMALS 0.

DATA : PR_AHM(7) TYPE P  DECIMALS 0,
       PR_BHS(7) TYPE P  DECIMALS 0,
       PR_PUN(7) TYPE P  DECIMALS 0,
       PR_OZH(7) TYPE P  DECIMALS 0,
       PR_DEL(7) TYPE P  DECIMALS 0,
       PR_COC(7) TYPE P  DECIMALS 0,
       PR_MAD(7) TYPE P  DECIMALS 0,
       PR_HUB(7) TYPE P  DECIMALS 0,
       PR_HYD(7) TYPE P  DECIMALS 0,
       PR_VIJ(7) TYPE P  DECIMALS 0,
       PR_LUC(7) TYPE P  DECIMALS 0,
       PR_VAR(7) TYPE P  DECIMALS 0,
       PR_MEE(7) TYPE P  DECIMALS 0,
       PR_ROH(7) TYPE P  DECIMALS 0,
       PR_CHA(7) TYPE P  DECIMALS 0,
       PR_ZIR(7) TYPE P  DECIMALS 0,
       PR_JAI(7) TYPE P  DECIMALS 0,
       PR_IND(7) TYPE P  DECIMALS 0,
       PR_RAI(7) TYPE P  DECIMALS 0,
       PR_PAT(7) TYPE P  DECIMALS 0,
       PR_RAN(7) TYPE P  DECIMALS 0,
       PR_KLC(7) TYPE P  DECIMALS 0,
       PR_CTK(7) TYPE P  DECIMALS 0,
*       pr_nsk(7) TYPE p  DECIMALS 0,
*       pr_goa(7) TYPE p  DECIMALS 0,
       PR_NOS(7) TYPE P  DECIMALS 0,
       PR_TOT(7) TYPE P  DECIMALS 0.



DATA : CPR_AHM(7) TYPE P  DECIMALS 0,
       CPR_BHS(7) TYPE P  DECIMALS 0,
       CPR_PUN(7) TYPE P  DECIMALS 0,
       CPR_OZH(7) TYPE P  DECIMALS 0,
       CPR_DEL(7) TYPE P  DECIMALS 0,
       CPR_COC(7) TYPE P  DECIMALS 0,
       CPR_MAD(7) TYPE P  DECIMALS 0,
       CPR_HUB(7) TYPE P  DECIMALS 0,
       CPR_HYD(7) TYPE P  DECIMALS 0,
       CPR_VIJ(7) TYPE P  DECIMALS 0,
       CPR_LUC(7) TYPE P  DECIMALS 0,
       CPR_VAR(7) TYPE P  DECIMALS 0,
       CPR_MEE(7) TYPE P  DECIMALS 0,
       CPR_ROH(7) TYPE P  DECIMALS 0,
       CPR_CHA(7) TYPE P  DECIMALS 0,
       CPR_ZIR(7) TYPE P  DECIMALS 0,
       CPR_JAI(7) TYPE P  DECIMALS 0,
       CPR_IND(7) TYPE P  DECIMALS 0,
       CPR_RAI(7) TYPE P  DECIMALS 0,
       CPR_PAT(7) TYPE P  DECIMALS 0,
       CPR_RAN(7) TYPE P  DECIMALS 0,
       CPR_KLC(7) TYPE P  DECIMALS 0,
       CPR_CTK(7) TYPE P  DECIMALS 0,
*       CPR_NSK(7) TYPE P  DECIMALS 0,
*       CPR_GOA(7) TYPE P  DECIMALS 0,
       CPR_NOS(7) TYPE P  DECIMALS 0,
       CPR_TOT(7) TYPE P  DECIMALS 0.


DATA : TR_AHM(7) TYPE P  DECIMALS 0,
       TR_BHS(7) TYPE P  DECIMALS 0,
       TR_PUN(7) TYPE P  DECIMALS 0,
       TR_OZH(7) TYPE P  DECIMALS 0,
       TR_DEL(7) TYPE P  DECIMALS 0,
       TR_COC(7) TYPE P  DECIMALS 0,
       TR_MAD(7) TYPE P  DECIMALS 0,
       TR_HUB(7) TYPE P  DECIMALS 0,
       TR_HYD(7) TYPE P  DECIMALS 0,
       TR_VIJ(7) TYPE P  DECIMALS 0,
       TR_LUC(7) TYPE P  DECIMALS 0,
       TR_VAR(7) TYPE P  DECIMALS 0,
       TR_MEE(7) TYPE P  DECIMALS 0,
       TR_ROH(7) TYPE P  DECIMALS 0,
       TR_CHA(7) TYPE P  DECIMALS 0,
       TR_ZIR(7) TYPE P  DECIMALS 0,
       TR_JAI(7) TYPE P  DECIMALS 0,
       TR_IND(7) TYPE P  DECIMALS 0,
       TR_RAI(7) TYPE P  DECIMALS 0,
       TR_PAT(7) TYPE P  DECIMALS 0,
       TR_RAN(7) TYPE P  DECIMALS 0,
       TR_KLC(7) TYPE P  DECIMALS 0,
       TR_CTK(7) TYPE P  DECIMALS 0,
*       TR_NSK(7) TYPE P  DECIMALS 0,
*       TR_GOA(7) TYPE P  DECIMALS 0,
       TR_NOS(7) TYPE P  DECIMALS 0,
       TR_TOT(7) TYPE P  DECIMALS 0.


DATA : ODR_AHM(7) TYPE P  DECIMALS 0,
       ODR_BHS(7) TYPE P  DECIMALS 0,
       ODR_PUN(7) TYPE P  DECIMALS 0,
       ODR_OZH(7) TYPE P  DECIMALS 0,
       ODR_DEL(7) TYPE P  DECIMALS 0,
       ODR_COC(7) TYPE P  DECIMALS 0,
       ODR_MAD(7) TYPE P  DECIMALS 0,
       ODR_HUB(7) TYPE P  DECIMALS 0,
       ODR_HYD(7) TYPE P  DECIMALS 0,
       ODR_VIJ(7) TYPE P  DECIMALS 0,
       ODR_LUC(7) TYPE P  DECIMALS 0,
       ODR_VAR(7) TYPE P  DECIMALS 0,
       ODR_MEE(7) TYPE P  DECIMALS 0,
       ODR_ROH(7) TYPE P  DECIMALS 0,
       ODR_CHA(7) TYPE P  DECIMALS 0,
       ODR_ZIR(7) TYPE P  DECIMALS 0,
       ODR_JAI(7) TYPE P  DECIMALS 0,
       ODR_IND(7) TYPE P  DECIMALS 0,
       ODR_RAI(7) TYPE P  DECIMALS 0,
       ODR_PAT(7) TYPE P  DECIMALS 0,
       ODR_RAN(7) TYPE P  DECIMALS 0,
       ODR_KLC(7) TYPE P  DECIMALS 0,
       ODR_CTK(7) TYPE P  DECIMALS 0,
*       ODR_NSK(7) TYPE P  DECIMALS 0,
*       ODR_GOA(7) TYPE P  DECIMALS 0,
       ODR_NOS(7) TYPE P  DECIMALS 0,
       ODR_TOT(7) TYPE P  DECIMALS 0.

DATA : O3_AHM(7) TYPE P  DECIMALS 0,
       O3_BHS(7) TYPE P  DECIMALS 0,
       O3_PUN(7) TYPE P  DECIMALS 0,
       O3_OZH(7) TYPE P  DECIMALS 0,
       O3_DEL(7) TYPE P  DECIMALS 0,
       O3_COC(7) TYPE P  DECIMALS 0,
       O3_MAD(7) TYPE P  DECIMALS 0,
       O3_HUB(7) TYPE P  DECIMALS 0,
       O3_HYD(7) TYPE P  DECIMALS 0,
       O3_VIJ(7) TYPE P  DECIMALS 0,
       O3_LUC(7) TYPE P  DECIMALS 0,
       O3_VAR(7) TYPE P  DECIMALS 0,
       O3_MEE(7) TYPE P  DECIMALS 0,
       O3_ROH(7) TYPE P  DECIMALS 0,
       O3_CHA(7) TYPE P  DECIMALS 0,
       O3_ZIR(7) TYPE P  DECIMALS 0,
       O3_JAI(7) TYPE P  DECIMALS 0,
       O3_IND(7) TYPE P  DECIMALS 0,
       O3_RAI(7) TYPE P  DECIMALS 0,
       O3_PAT(7) TYPE P  DECIMALS 0,
       O3_RAN(7) TYPE P  DECIMALS 0,
       O3_KLC(7) TYPE P  DECIMALS 0,
       O3_CTK(7) TYPE P  DECIMALS 0,
*       O3_NSK(7) TYPE P  DECIMALS 0,
*       O3_GOA(7) TYPE P  DECIMALS 0,
       O3_NOS(7) TYPE P  DECIMALS 0,
       O3_TOT(7) TYPE P  DECIMALS 0.


DATA : O2_AHM(7) TYPE P  DECIMALS 0,
       O2_BHS(7) TYPE P  DECIMALS 0,
       O2_PUN(7) TYPE P  DECIMALS 0,
       O2_OZH(7) TYPE P  DECIMALS 0,
       O2_DEL(7) TYPE P  DECIMALS 0,
       O2_COC(7) TYPE P  DECIMALS 0,
       O2_MAD(7) TYPE P  DECIMALS 0,
       O2_HUB(7) TYPE P  DECIMALS 0,
       O2_HYD(7) TYPE P  DECIMALS 0,
       O2_VIJ(7) TYPE P  DECIMALS 0,
       O2_LUC(7) TYPE P  DECIMALS 0,
       O2_VAR(7) TYPE P  DECIMALS 0,
       O2_MEE(7) TYPE P  DECIMALS 0,
       O2_ROH(7) TYPE P  DECIMALS 0,
       O2_CHA(7) TYPE P  DECIMALS 0,
       O2_ZIR(7) TYPE P  DECIMALS 0,
       O2_JAI(7) TYPE P  DECIMALS 0,
       O2_IND(7) TYPE P  DECIMALS 0,
       O2_RAI(7) TYPE P  DECIMALS 0,
       O2_PAT(7) TYPE P  DECIMALS 0,
       O2_RAN(7) TYPE P  DECIMALS 0,
       O2_KLC(7) TYPE P  DECIMALS 0,
       O2_CTK(7) TYPE P  DECIMALS 0,
*       O2_NSK(7) TYPE P  DECIMALS 0,
*       O2_GOA(7) TYPE P  DECIMALS 0,
       O2_NOS(7) TYPE P  DECIMALS 0,
       O2_TOT(7) TYPE P  DECIMALS 0.

DATA : O1_AHM(7)  TYPE P  DECIMALS 0,
       O1_BHS(7)  TYPE P  DECIMALS 0,
       O1_PUN(7)  TYPE P  DECIMALS 0,
       O1_OZH(7)  TYPE P  DECIMALS 0,
       O1_DEL(7)  TYPE P  DECIMALS 0,
       O1_COC(7)  TYPE P  DECIMALS 0,
       O1_MAD(7)  TYPE P  DECIMALS 0,
       O1_HUB(7)  TYPE P  DECIMALS 0,
       O1_HYD(7)  TYPE P  DECIMALS 0,
       O1_VIJ(7)  TYPE P  DECIMALS 0,
       O1_LUC(7)  TYPE P  DECIMALS 0,
       O1_VAR(7)  TYPE P  DECIMALS 0,
       O1_MEE(7)  TYPE P  DECIMALS 0,
       O1_ROH(7)  TYPE P  DECIMALS 0,
       O1_CHA(7)  TYPE P  DECIMALS 0,
       O1_ZIR(7)  TYPE P  DECIMALS 0,
       O1_JAI(7)  TYPE P  DECIMALS 0,
       O1_IND(7)  TYPE P  DECIMALS 0,
       O1_RAI(7)  TYPE P  DECIMALS 0,
       O1_PAT(7)  TYPE P  DECIMALS 0,
       O1_RAN(7)  TYPE P  DECIMALS 0,
       O1_KLC(7)  TYPE P  DECIMALS 0,
       O1_CTK(7)  TYPE P  DECIMALS 0,
*       O1_NSK(7)  TYPE P  DECIMALS 0,
*       O1_GOA(7)  TYPE P  DECIMALS 0,
       O1_NOS(7)  TYPE P  DECIMALS 0,
       O1_TOT(10) TYPE P  DECIMALS 0.

DATA : U1_AHM(7) TYPE P  DECIMALS 0,
       U1_BHS(7) TYPE P  DECIMALS 0,
       U1_PUN(7) TYPE P  DECIMALS 0,
       U1_OZH(7) TYPE P  DECIMALS 0,
       U1_DEL(7) TYPE P  DECIMALS 0,
       U1_COC(7) TYPE P  DECIMALS 0,
       U1_MAD(7) TYPE P  DECIMALS 0,
       U1_HUB(7) TYPE P  DECIMALS 0,
       U1_HYD(7) TYPE P  DECIMALS 0,
       U1_VIJ(7) TYPE P  DECIMALS 0,
       U1_LUC(7) TYPE P  DECIMALS 0,
       U1_VAR(7) TYPE P  DECIMALS 0,
       U1_MEE(7) TYPE P  DECIMALS 0,
       U1_ROH(7) TYPE P  DECIMALS 0,
       U1_CHA(7) TYPE P  DECIMALS 0,
       U1_ZIR(7) TYPE P  DECIMALS 0,
       U1_JAI(7) TYPE P  DECIMALS 0,
       U1_IND(7) TYPE P  DECIMALS 0,
       U1_RAI(7) TYPE P  DECIMALS 0,
       U1_PAT(7) TYPE P  DECIMALS 0,
       U1_RAN(7) TYPE P  DECIMALS 0,
       U1_KLC(7) TYPE P  DECIMALS 0,
       U1_CTK(7) TYPE P  DECIMALS 0,
*       U1_NSK(7) TYPE P  DECIMALS 0,
*       U1_GOA(7) TYPE P  DECIMALS 0,
       U1_NOS(7) TYPE P  DECIMALS 0,
       U1_TOT(7) TYPE P  DECIMALS 0.


DATA : CN_AHM(7) TYPE P  DECIMALS 0,
       CN_BHS(7) TYPE P  DECIMALS 0,
       CN_PUN(7) TYPE P  DECIMALS 0,
       CN_OZH(7) TYPE P  DECIMALS 0,
       CN_DEL(7) TYPE P  DECIMALS 0,
       CN_COC(7) TYPE P  DECIMALS 0,
       CN_MAD(7) TYPE P  DECIMALS 0,
       CN_HUB(7) TYPE P  DECIMALS 0,
       CN_HYD(7) TYPE P  DECIMALS 0,
       CN_VIJ(7) TYPE P  DECIMALS 0,
       CN_LUC(7) TYPE P  DECIMALS 0,
       CN_VAR(7) TYPE P  DECIMALS 0,
       CN_MEE(7) TYPE P  DECIMALS 0,
       CN_ROH(7) TYPE P  DECIMALS 0,
       CN_CHA(7) TYPE P  DECIMALS 0,
       CN_ZIR(7) TYPE P  DECIMALS 0,
       CN_JAI(7) TYPE P  DECIMALS 0,
       CN_IND(7) TYPE P  DECIMALS 0,
       CN_RAI(7) TYPE P  DECIMALS 0,
       CN_PAT(7) TYPE P  DECIMALS 0,
       CN_RAN(7) TYPE P  DECIMALS 0,
       CN_KLC(7) TYPE P  DECIMALS 0,
       CN_CTK(7) TYPE P  DECIMALS 0,
*       CN_NSK(7) TYPE P  DECIMALS 0,
*       CN_GOA(7) TYPE P  DECIMALS 0,
       CN_NOS(7) TYPE P  DECIMALS 0,
       CN_TOT(7) TYPE P  DECIMALS 0.


DATA : DN_AHM(7) TYPE P  DECIMALS 0,
       DN_BHS(7) TYPE P  DECIMALS 0,
       DN_PUN(7) TYPE P  DECIMALS 0,
       DN_OZH(7) TYPE P  DECIMALS 0,
       DN_DEL(7) TYPE P  DECIMALS 0,
       DN_COC(7) TYPE P  DECIMALS 0,
       DN_MAD(7) TYPE P  DECIMALS 0,
       DN_HUB(7) TYPE P  DECIMALS 0,
       DN_HYD(7) TYPE P  DECIMALS 0,
       DN_VIJ(7) TYPE P  DECIMALS 0,
       DN_LUC(7) TYPE P  DECIMALS 0,
       DN_VAR(7) TYPE P  DECIMALS 0,
       DN_MEE(7) TYPE P  DECIMALS 0,
       DN_ROH(7) TYPE P  DECIMALS 0,
       DN_CHA(7) TYPE P  DECIMALS 0,
       DN_ZIR(7) TYPE P  DECIMALS 0,
       DN_JAI(7) TYPE P  DECIMALS 0,
       DN_IND(7) TYPE P  DECIMALS 0,
       DN_RAI(7) TYPE P  DECIMALS 0,
       DN_PAT(7) TYPE P  DECIMALS 0,
       DN_RAN(7) TYPE P  DECIMALS 0,
       DN_KLC(7) TYPE P  DECIMALS 0,
       DN_CTK(7) TYPE P  DECIMALS 0,
*       DN_NSK(7) TYPE P  DECIMALS 0,
*       DN_GOA(7) TYPE P  DECIMALS 0,
       DN_NOS(7) TYPE P  DECIMALS 0,
       DN_TOT(7) TYPE P  DECIMALS 0.



*data r_werks type werks.
DATA : S_WERKS  TYPE RANGE OF  T001W-WERKS WITH HEADER LINE,
       S_WERKS1 TYPE RANGE OF  T001W-WERKS WITH HEADER LINE,
       S_WERKS2 TYPE RANGE OF  T001W-WERKS WITH HEADER LINE,
       S_WERKS3 TYPE RANGE OF  T001W-WERKS WITH HEADER LINE.

RANGES: R_AUDAT FOR SY-DATUM.
*ranges: s_werks for r_werks.
*ranges: s_werks1 for r_werks.
*ranges: s_werks2 for r_werks.
*ranges: s_werks3 for r_werks.
DATA ASDT LIKE SY-DATUM.
DATA : P_BUKRS  LIKE T001-BUKRS,
       R1(1)    TYPE C,
       R2(1)    TYPE C,
       P_DIV(1) TYPE C.

***************************************************SABU ADDED FOR THE MAILING IN PDF FORMAT   ENDS HERE ***************************

********ADDED BY SUDHA ON 8.12.2011 BCDK909535***********
DATA:   IT_ATTACH TYPE STANDARD TABLE OF SOLISTI1 INITIAL SIZE 0
                WITH HEADER LINE.

DATA:   IT_MESSAGE TYPE STANDARD TABLE OF SOLISTI1 INITIAL SIZE 0
                WITH HEADER LINE.

DATA: T_PACKING_LIST  LIKE SOPCKLSTI1 OCCURS 0 WITH HEADER LINE,
      T_CONTENTS      LIKE SOLISTI1 OCCURS 0 WITH HEADER LINE,
      T_RECEIVERS     LIKE SOMLRECI1 OCCURS 0 WITH HEADER LINE,
      T_ATTACHMENT    LIKE SOLISTI1 OCCURS 0 WITH HEADER LINE,
      T_OBJECT_HEADER LIKE SOLISTI1 OCCURS 0 WITH HEADER LINE,
      W_CNT           TYPE I,
      W_SENT_ALL(1)   TYPE C,
      W_DOC_DATA      LIKE SODOCCHGI1,
      GD_ERROR        TYPE SY-SUBRC,
      GD_RECIEVER     TYPE SY-SUBRC.

TYPE-POOLS: SLIS.

DATA: ALV_FLDCAT       TYPE SLIS_T_FIELDCAT_ALV,
      WA_FLD           LIKE LINE OF ALV_FLDCAT,
      ALV_LAYOUT       TYPE  SLIS_LAYOUT_ALV,
      WA_IT_LISTHEADER TYPE SLIS_LISTHEADER,
      IT_LISTHEADER    TYPE SLIS_T_LISTHEADER,
      WA_EVENTS        TYPE SLIS_ALV_EVENT,
      IT_EVENTS        TYPE SLIS_T_EVENT.

DATA : IT_T001W TYPE TABLE OF T001W,
       WA_T001W TYPE T001W,
*       it_t134g TYPE TABLE OF t134g,
*       w_t134g  TYPE t134g.
       IT_T134G TYPE TABLE OF ZTB_T134G,
       W_T134G  TYPE ZTB_T134G.
DATA: YEAR(4)        TYPE C,
      PTS            TYPE KBETR,
      OMLVAL         TYPE KBETR,
      NSKVAL         TYPE KBETR,
      TNSKVAL        TYPE KBETR,
      TNSKVAL1       TYPE KBETR,
      TGOAVAL        TYPE KBETR,
      TGOAVAL1       TYPE KBETR,
      GOAVAL         TYPE KBETR,
*      OMLVAL1(10)  TYPE C,
      TOMLVAL        TYPE KBETR,
      TOMLVAL1       TYPE KBETR,
*      NSKVAL1(10)  TYPE C,
      TNSKVAL2(10)   TYPE C,
      TGOAVAL2(10)   TYPE C,
      FOOT_LINE(250) TYPE C,
      TVAL(10)       TYPE  C,
      TOMLVAL2(12)   TYPE C.
*      GOAVAL1(10)  TYPE C.
DATA : BCPER       TYPE P,
       XLPER       TYPE P,
       LSPER       TYPE P,
       BCPER1(7)   TYPE C,
       XLPER1(7)   TYPE C,
       LSPER1(7)   TYPE C,
       XLSALE      TYPE P,
       LSSALE      TYPE P,
       BCSALE      TYPE P,
       XLSALE1(10) TYPE C,
       BCSALE1(10) TYPE C,
       LSSALE1(10) TYPE C.

DATA : ASDT1 TYPE SY-DATUM.

********ADDED ENDED BY SUDHA ON 8.12.2011 BCDK909535***********

SELECTION-SCREEN BEGIN OF BLOCK B1 WITH FRAME TITLE TEXT-001.
  PARAMETERS: UEMAIL(70) TYPE C.
*PARAMETERS: P_BUKRS LIKE T001-BUKRS DEFAULT 'BCLL' NO-DISPLAY.
*PARAMETERS : ASDT LIKE SY-DATUM OBLIGATORY.
*SELECT-OPTIONS: S_WERKS FOR T001W-WERKS,
*                S_WERKS1 FOR T001W-WERKS,
*                S_WERKS2 FOR T001W-WERKS,
*                S_WERKS3 FOR T001W-WERKS.
SELECTION-SCREEN END OF BLOCK B1.
*
*SELECTION-SCREEN BEGIN OF BLOCK B2 WITH FRAME TITLE TEXT-002.
*SELECTION-SCREEN BEGIN OF LINE.
*PARAMETERS: P_DIV AS CHECKBOX.
*SELECTION-SCREEN COMMENT  4(19) TEXT-003.
*SELECTION-SCREEN END OF LINE.
*SELECTION-SCREEN END OF BLOCK B2.
*
*PARAMETERS : R1 RADIOBUTTON GROUP R1,
*             R2 RADIOBUTTON GROUP R1.
*
*****Added BY SUDHA on 9.12.2011 BCDK909535**************
*selection-screen begin of block b3 with frame title text-005.
*selection-screen begin of line.
*parameters: pmailchk  as checkbox.
*selection-screen comment  4(19) text-004.
*selection-screen end of line.
*selection-screen end of block b3.


*PARAMETERS: p_email   TYPE somlreci1-receiver
***                     DEFAULT 'ir1@bluecrosslabs.com' NO-DISPLAY.
***             DEFAULT 'anbuthambi.jayaraman@techspectra.com'
*NO-DISPLAY.
*DEFAULT 'amit.arora@techspectra.com' NO-DISPLAY.
*****ADDED ENDEDB BY SUDHA oN 9.12.2011 BCDK909535***************

INITIALIZATION.

  P_BUKRS = GC_BUKRS.

  P_DIV = 'X'.
  R1 = ''.
  R2 = 'X'.
  ASDT = '20190125'.
  ASDT = SY-DATUM.


  S_WERKS-LOW = '1000'.
  S_WERKS-HIGH = '2028'.
  S_WERKS-SIGN = 'I'.
  S_WERKS-OPTION = 'BT'.
  APPEND S_WERKS.
  CLEAR S_WERKS1.



  S_WERKS1-LOW = '2009'.
  S_WERKS1-HIGH = ''.
  S_WERKS1-SIGN = 'I'.
  S_WERKS1-OPTION = 'EQ'.
  APPEND S_WERKS1.
  CLEAR S_WERKS1.

  S_WERKS1-LOW = '2018'.
  S_WERKS1-HIGH = ''.
  S_WERKS1-SIGN = 'I'.
  S_WERKS1-OPTION = 'EQ'.
  APPEND S_WERKS1.
  CLEAR S_WERKS1.

  S_WERKS1-LOW = '2022'.
  S_WERKS1-HIGH = ''.
  S_WERKS1-SIGN = 'I'.
  S_WERKS1-OPTION = 'EQ'.
  APPEND S_WERKS1.
  CLEAR S_WERKS1.


  S_WERKS1-LOW = '2025'.
  S_WERKS1-HIGH = ''.
  S_WERKS1-SIGN = 'I'.
  S_WERKS1-OPTION = 'EQ'.
  APPEND S_WERKS1.
  CLEAR S_WERKS1.






  S_WERKS2-LOW = '1000'.
  S_WERKS2-HIGH = ''.
  S_WERKS2-SIGN = 'I'.
  S_WERKS2-OPTION = 'EQ'.
  APPEND S_WERKS2.
  CLEAR S_WERKS2.

  S_WERKS2-LOW = '1001'.
  S_WERKS2-HIGH = ''.
  S_WERKS2-SIGN = 'I'.
  S_WERKS2-OPTION = 'EQ'.
  APPEND S_WERKS2.
  CLEAR S_WERKS2.

  S_WERKS2-LOW = '1003'.
  S_WERKS2-HIGH = ''.
  S_WERKS2-SIGN = 'I'.
  S_WERKS2-OPTION = 'EQ'.
  APPEND S_WERKS2.
  CLEAR S_WERKS2.


  S_WERKS2-LOW = '2000'.
  S_WERKS2-HIGH = ''.
  S_WERKS2-SIGN = 'I'.
  S_WERKS2-OPTION = 'EQ'.
  APPEND S_WERKS2.
  CLEAR S_WERKS2.

  S_WERKS2-LOW = '2002'.
  S_WERKS2-HIGH = ''.
  S_WERKS2-SIGN = 'I'.
  S_WERKS2-OPTION = 'EQ'.
  APPEND S_WERKS2.
  CLEAR S_WERKS2.

  S_WERKS2-LOW = '2024'.
  S_WERKS2-HIGH = ''.
  S_WERKS2-SIGN = 'I'.
  S_WERKS2-OPTION = 'EQ'.
  APPEND S_WERKS2.
  CLEAR S_WERKS2.


  S_WERKS3-LOW = '1000'.
  S_WERKS3-HIGH = ''.
  S_WERKS3-SIGN = 'I'.
  S_WERKS3-OPTION = 'EQ'.
  APPEND S_WERKS3.
  CLEAR S_WERKS3.


  S_WERKS3-LOW = '1001'.
  S_WERKS3-HIGH = ''.
  S_WERKS3-SIGN = 'I'.
  S_WERKS3-OPTION = 'EQ'.
  APPEND S_WERKS3.
  CLEAR S_WERKS3.


  S_WERKS3-LOW = '2000'.
  S_WERKS3-HIGH = ''.
  S_WERKS3-SIGN = 'I'.
  S_WERKS3-OPTION = 'EQ'.
  APPEND S_WERKS3.
  CLEAR S_WERKS3.


*****  s_werks3-low = '2002'.
*****  s_werks3-high = ''.
*****  s_werks3-sign = 'I'.
*****  s_werks3-option = 'EQ'.
*****  APPEND s_werks3.
*****  CLEAR s_werks3.
*****
*****
  S_WERKS3-LOW = '2024'.
  S_WERKS3-HIGH = ''.
  S_WERKS3-SIGN = 'I'.
  S_WERKS3-OPTION = 'EQ'.
  APPEND S_WERKS3.
  CLEAR S_WERKS3.

*****  s_werks3-low = '2027'.
*****  s_werks3-high = ''.
*****  s_werks3-sign = 'I'.
*****  s_werks3-option = 'EQ'.
*****  APPEND s_werks3.
*****  CLEAR s_werks3.


  S_WERKS3-LOW = '2030'.
  S_WERKS3-HIGH = ''.
  S_WERKS3-SIGN = 'I'.
  S_WERKS3-OPTION = 'EQ'.
  APPEND S_WERKS3.
  CLEAR S_WERKS3.



  P_DIV = 'X'.

  G_REPID = SY-REPID.

AT SELECTION-SCREEN.

  SELECT WERKS FROM T001W INTO TABLE ITAB_WERKS WHERE  WERKS IN S_WERKS.

  PERFORM AUTH_PLNT.

  IF S_WERKS1[] IS NOT INITIAL.
    SELECT WERKS FROM T001W INTO TABLE ITAB_WERKSO WHERE  WERKS IN S_WERKS1.

    PERFORM AUTH_PLNT.
  ENDIF.

AT SELECTION-SCREEN OUTPUT.
  ASDT = SY-DATUM.

  UEMAIL =  'IR1@BLUECROSSLABS.COM'.

*&-----------------------------------------------------------------------------&*
* START-OF-SELECTION.
*&-----------------------------------------------------------------------------&*
START-OF-SELECTION.

  YEAR = ASDT+0(4).


  IF R1 EQ 'X'.
    IF SY-HOST EQ 'SAPQLT' OR SY-HOST EQ 'SAPDEV'.

    ELSE.

      PERFORM INIT.

      PERFORM SALES_N.

*    PERFORM inventory.
*
*    PERFORM pending.
*
*    PERFORM receivables.
*
*    PERFORM odr.
*
*    PERFORM note.
*    PERFORM foot.
      IF P_DIV = 'X'.
        PERFORM DIVD.
      ENDIF.

      PERFORM ALV1.
    ENDIF.
  ELSEIF R2 EQ 'X'.
    IF SY-HOST EQ 'SAPQLT' OR SY-HOST EQ 'SAPDEV'.


      EXIT.
    ELSE.

      PERFORM INIT.

      PERFORM SALES_N.
      PERFORM EXPORTSALE.

      PERFORM INVENTORY.

      PERFORM PENDING.

      PERFORM RECEIVABLES.

      PERFORM ODR.

      PERFORM NOTE.
      PERFORM FOOT.
      PERFORM RECEIPT.  "OML
      PERFORM RECEIPT1.  "NSK, GOA

      IF P_DIV = 'X'.
        PERFORM DIVD.
      ENDIF.

*    PERFORM ALV.
      PERFORM EMAIL.

    ENDIF.
  ENDIF.


*&---------------------------------------------------------------------*
*&      Form  DATE
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*      -->P_LOW  text
*      -->P_HIGH  text
*----------------------------------------------------------------------*
FORM DATE  USING    P_LOW
                    P_HIGH.

*  Appending date into ranges

  CLEAR: R_DAT, R_DAT[].

  R_DAT-LOW = P_LOW.
  R_DAT-HIGH = P_HIGH.
  R_DAT-SIGN = 'I'.
  R_DAT-OPTION = 'BT'.
  APPEND R_DAT.
  CLEAR R_DAT.

ENDFORM.                    " DATE

FORM SALES_N .

  IF S_WERKS1 IS NOT INITIAL.
    SELECT * FROM T001W INTO TABLE IT_T001W WHERE WERKS IN S_WERKS2.
    IF SY-SUBRC EQ 0.
      SELECT * FROM ZTB_T134G INTO TABLE IT_T134G FOR ALL ENTRIES IN IT_T001W WHERE WERKS EQ IT_T001W-WERKS AND SPART EQ '10'.
    ENDIF.
  ENDIF.

  ASSIGN COMPONENT 'TYP' OF STRUCTURE <DYN_WA> TO <FS>.
  <FS> = 'A:'.
  ASSIGN COMPONENT 'NAM' OF STRUCTURE <DYN_WA> TO <FS>.
  <FS> = 'Sales'.
  APPEND <DYN_WA> TO <DYN_TABLE>.
  CLEAR <DYN_WA>.


*  Select current month invoice details
  SELECT VBELN MATNR_I POSNR_I VBTYP KNUMV FKART FKDAT FKIMG_I VRKME_I WERKS_I NETWR_I KALSM FROM WB2_V_VBRK_VBRP2 INTO TABLE ITAB_INV_CUR
            WHERE FKDAT EQ ASDT
              AND VBTYP IN ('M', 'N')
*              AND GSBER_I IN R_GSBER
              AND WERKS_I IN R_WERKS
              AND FKART IN ('ZBDF','ZCDF','Z002','Z003','Z004')
              AND FKSTO NE 'X'.
*     fkdat in r_dat

  SORT ITAB_INV_CUR BY VBELN.
  DELETE ITAB_INV_CUR WHERE FKART EQ 'ZSTO'.
  DELETE ITAB_INV_CUR WHERE FKART EQ 'ZSTI'.
  LOOP AT ITAB_INV_CUR INTO WA_INV_CUR.
    IF WA_INV_CUR-FKART EQ 'Z002' AND WA_INV_CUR-KALSM NE 'ZEXPNP'.
      DELETE ITAB_INV_CUR.
    ENDIF.
    IF WA_INV_CUR-FKART EQ 'Z004' AND WA_INV_CUR-KALSM NE 'ZDOMON'.
      DELETE ITAB_INV_CUR.
    ENDIF.
    IF WA_INV_CUR-FKART EQ 'Z003' AND WA_INV_CUR-KALSM NE 'ZEXPNP'.
      DELETE ITAB_INV_CUR.
    ENDIF.
  ENDLOOP.
  DELETE ITAB_INV_CUR WHERE FKIMG_I IS INITIAL.
  LOOP AT ITAB_INV_CUR ASSIGNING <FS_INV>.
    WA_KNUMV-KNUMV = <FS_INV>-KNUMV.
    APPEND WA_KNUMV TO ITAB_KNUMV.
    CLEAR WA_KNUMV.
  ENDLOOP.
  SORT ITAB_KNUMV[] BY KNUMV.
  DELETE ADJACENT DUPLICATES FROM ITAB_KNUMV[].
  IF ITAB_KNUMV[] IS NOT INITIAL.
    SELECT KNUMV KPOSN STUNR ZAEHK KWERT FROM PRCD_ELEMENTS INTO TABLE ITAB_KONV FOR ALL ENTRIES IN ITAB_KNUMV
          WHERE KNUMV = ITAB_KNUMV-KNUMV
            AND KSCHL IN ('ZC02', 'ZSPD', 'ZCST', 'ZDIT')
            AND KINAK = SPACE.
  ENDIF.
  DELETE ITAB_KONV[] WHERE KWERT IS INITIAL. "added by anbu 28.11.2011
  LOOP AT ITAB_INV_CUR ASSIGNING <FS_INV>.
    LOOP AT ITAB_KONV ASSIGNING <FS_KONV> WHERE KNUMV = <FS_INV>-KNUMV
      AND KPOSN = <FS_INV>-POSNR_I.
      <FS_KONV>-KWERT = ABS( <FS_KONV>-KWERT ).
      <FS_INV>-NETWR_I = <FS_INV>-NETWR_I + <FS_KONV>-KWERT.
    ENDLOOP.
  ENDLOOP.
  CLEAR W_NOS.
  LOOP AT ITAB_INV_CUR ASSIGNING <FS_INV> WHERE FKDAT = ASDT.
    READ TABLE ITAB_T134GP INTO WA_T134GP WITH KEY GSBER = <FS_INV>-WERKS_I.
    IF SY-SUBRC EQ 0.
      <FS_INV>-WERKS_I = 'NEP'.
    ELSE.
      READ TABLE ITAB_T134GO INTO WA_T134GO WITH KEY GSBER = <FS_INV>-WERKS_I.
      IF SY-SUBRC EQ 0.
        <FS_INV>-WERKS_I = 'OTH'.
      ENDIF.
    ENDIF.
    WA_GSBER-GSBER = <FS_INV>-WERKS_I.
    WA_GSBER-DMBTR = <FS_INV>-NETWR_I.
    ON CHANGE OF <FS_INV>-VBELN.
      W_NOS = W_NOS + 1.
    ENDON.
    IF <FS_INV>-VBTYP = 'N'.
      WA_GSBER-DMBTR = WA_GSBER-DMBTR * -1.
    ENDIF.
    COLLECT WA_GSBER INTO ITAB_GSBER .
    CLEAR WA_GSBER.
  ENDLOOP.
*  perform nos using w_nos.
  PERFORM FINAL USING '1. Today''s Value'.


*************************** Cummulative month***********************

*  *  Select current month cummulative invoice details
  CLEAR: ITAB_GSBER, WA_GSBER, W_NOS.
  CLEAR : ITAB_INV_PRE,ITAB_KONV,ITAB_KNUMV.
*BREAK-POINT.
  ASDT1 = ASDT.
  ASDT1+6(2) = '01'.
  SELECT VBELN MATNR_I POSNR_I VBTYP KNUMV FKART FKDAT FKIMG_I VRKME_I
      WERKS_I
      NETWR_I KALSM FROM WB2_V_VBRK_VBRP2 INTO TABLE ITAB_INV_PRE
      WHERE FKDAT GE ASDT1 AND FKDAT LE ASDT
        AND VBTYP IN ('M', 'N')
*        AND GSBER_I IN R_GSBER
        AND WERKS_I IN R_WERKS
        AND FKART IN ('ZBDF','ZCDF','Z002','Z003','Z004') AND FKSTO NE 'X'.
*     fkdat in r_dat

  SORT ITAB_INV_PRE BY VBELN.
  DELETE ITAB_INV_PRE WHERE FKART EQ 'ZSTO'.
  DELETE ITAB_INV_PRE WHERE FKART EQ 'ZSTI'.
  LOOP AT ITAB_INV_PRE INTO WA_INV_PRE.
    IF WA_INV_PRE-FKART EQ 'Z002' AND WA_INV_PRE-KALSM NE 'ZEXPNP'.
      DELETE ITAB_INV_PRE.
    ENDIF.
    IF WA_INV_PRE-FKART EQ 'Z004' AND WA_INV_PRE-KALSM NE 'ZDOMON'.
      DELETE ITAB_INV_PRE.
    ENDIF.
    IF WA_INV_PRE-FKART EQ 'Z003' AND WA_INV_PRE-KALSM NE 'ZEXPNP'.
      DELETE ITAB_INV_PRE.
    ENDIF.
  ENDLOOP.
  DELETE ITAB_INV_PRE WHERE FKIMG_I IS INITIAL.
  LOOP AT ITAB_INV_PRE ASSIGNING <FS_INV>.
    WA_KNUMV-KNUMV = <FS_INV>-KNUMV.
    APPEND WA_KNUMV TO ITAB_KNUMV.
    CLEAR WA_KNUMV.
  ENDLOOP.
  SORT ITAB_KNUMV[] BY KNUMV.
  DELETE ADJACENT DUPLICATES FROM ITAB_KNUMV[].
  IF ITAB_KNUMV[] IS NOT INITIAL.
    SELECT KNUMV KPOSN STUNR ZAEHK KWERT FROM PRCD_ELEMENTS INTO TABLE ITAB_KONV FOR ALL ENTRIES IN ITAB_KNUMV
        WHERE KNUMV = ITAB_KNUMV-KNUMV
          AND KSCHL IN ('ZC02', 'ZSPD', 'ZCST', 'ZDIT')
          AND KINAK = SPACE.
  ENDIF.
  DELETE ITAB_KONV[] WHERE KWERT IS INITIAL. "added by anbu 28.11.2011
  LOOP AT ITAB_INV_PRE ASSIGNING <FS_INV>.
    LOOP AT ITAB_KONV ASSIGNING <FS_KONV> WHERE KNUMV = <FS_INV>-KNUMV
      AND KPOSN = <FS_INV>-POSNR_I.
      <FS_KONV>-KWERT = ABS( <FS_KONV>-KWERT ).
      <FS_INV>-NETWR_I = <FS_INV>-NETWR_I + <FS_KONV>-KWERT.
    ENDLOOP.
  ENDLOOP.
  CLEAR W_NOS.
*  loop at itab_inv_pre assigning <fs_inv> where fkdat ge asdt1 and fkdat le asdt.
  LOOP AT ITAB_INV_PRE ASSIGNING <FS_INV> WHERE FKDAT GE ASDT1 AND FKDAT LE ASDT.
*    select single * from mara where matnr eq <fs_inv>-matnr_i.
*    if sy-subrc eq 0.
*      if mara-spart eq '50'.
    WA_CUM1-DMBTR = <FS_INV>-NETWR_I.
    WA_CUM1-MATNR = <FS_INV>-MATNR_I.
*        select single * from zbudget_tab1 where matnr eq <fs_inv>-matnr_i and tag eq 'G' and datab eq asdt1.
*        if sy-subrc eq 0.
*          wa_cum1-bcbud = zbudget_tab1-val.
*        endif.
    COLLECT WA_CUM1 INTO IT_CUM1.
    CLEAR WA_CUM1.
*    endif.
    READ TABLE ITAB_T134GP INTO WA_T134GP WITH KEY GSBER = <FS_INV>-WERKS_I.
    IF SY-SUBRC EQ 0.
      <FS_INV>-WERKS_I = 'NEP'.
    ELSE.
      READ TABLE ITAB_T134GO INTO WA_T134GO WITH KEY GSBER = <FS_INV>-WERKS_I.
      IF SY-SUBRC EQ 0.
        <FS_INV>-WERKS_I = 'OTH'.
      ENDIF.
    ENDIF.
    WA_GSBER-GSBER = <FS_INV>-WERKS_I.
    WA_GSBER-DMBTR = <FS_INV>-NETWR_I.
    ON CHANGE OF <FS_INV>-VBELN.
      W_NOS = W_NOS + 1.
    ENDON.
    IF <FS_INV>-VBTYP = 'N'.
      WA_GSBER-DMBTR = WA_GSBER-DMBTR * -1.
    ENDIF.
    COLLECT WA_GSBER INTO ITAB_GSBER .
    CLEAR WA_GSBER.
  ENDLOOP.
*  break-point.
*  perform nos using w_nos.
  PERFORM FINAL USING '2. Cumm. For Month'.

*********budget total for sale percentage
  CLEAR : BCBUD,XLBUD,LSBUD.
  SELECT * FROM ZBUDGET_TAB1 INTO TABLE IT_ZBUDGET_TAB1 WHERE TAG EQ 'G' AND DATAB EQ ASDT1.
  LOOP AT IT_ZBUDGET_TAB1 INTO WA_ZBUDGET_TAB1.
    SELECT SINGLE * FROM MARA WHERE MATNR EQ WA_ZBUDGET_TAB1-MATNR.
    IF SY-SUBRC EQ 0.
      IF MARA-SPART EQ '50'.
        BCBUD = BCBUD + WA_ZBUDGET_TAB1-VAL.
      ELSEIF MARA-SPART EQ '60'.
        XLBUD = XLBUD + WA_ZBUDGET_TAB1-VAL.
      ELSEIF MARA-SPART EQ '70'.
        LSBUD = LSBUD + WA_ZBUDGET_TAB1-VAL.
      ENDIF.
    ENDIF.
  ENDLOOP.
************************



**********budget total  for sale percentage


*******************************************
  SORT IT_CUM1 BY MATNR.
  LOOP AT IT_CUM1 INTO WA_CUM1.
*    write : / wa_cum1-matnr,wa_cum1-dmbtr.
    SELECT SINGLE * FROM MARA WHERE MATNR EQ WA_CUM1-MATNR.
    IF SY-SUBRC EQ 0.
      IF MARA-SPART EQ '50'.
        WA_CUM2-BCDMBTR = WA_CUM1-DMBTR.
        COLLECT WA_CUM2 INTO IT_CUM2.
        CLEAR WA_CUM2.
      ELSEIF MARA-SPART EQ '60'.
        WA_CUM2-XLDMBTR = WA_CUM1-DMBTR.
        COLLECT WA_CUM2 INTO IT_CUM2.
        CLEAR WA_CUM2.
      ELSEIF MARA-SPART EQ '70'.
        WA_CUM2-LSDMBTR = WA_CUM1-DMBTR.
        COLLECT WA_CUM2 INTO IT_CUM2.
        CLEAR WA_CUM2.


*        WA_CUM2-BCDMBTR = WA_CUM1-DMBTR.
*        SELECT SINGLE * FROM ZBUDGET_TAB1 WHERE MATNR EQ WA_CUM1-MATNR AND TAG EQ 'G' AND DATAB EQ ASDT1.
*        IF SY-SUBRC EQ 0.
*          WA_CUM2-BCBUD = ZBUDGET_TAB1-VAL.
*        ENDIF.
*        COLLECT WA_CUM2 INTO IT_CUM2.
*        CLEAR WA_CUM2.
*      ELSEIF MARA-SPART EQ '60'.
*        WA_CUM2-XLDMBTR = WA_CUM1-DMBTR.
*        SELECT SINGLE * FROM ZBUDGET_TAB1 WHERE MATNR EQ WA_CUM1-MATNR AND TAG EQ 'G' AND DATAB EQ ASDT1.
*        IF SY-SUBRC EQ 0.
*          WA_CUM2-XLBUD = ZBUDGET_TAB1-VAL.
*        ENDIF.
*        COLLECT WA_CUM2 INTO IT_CUM2.
*        CLEAR WA_CUM2.
      ELSE.
***********************EXPORT*********************
        CLEAR : MATNR1.
        MATNR1 = WA_CUM1-MATNR.
        IF MATNR1+10(3) = '425'.
          MATNR1+10(3) = '000'.
        ENDIF.

        SELECT SINGLE * FROM MARA WHERE MATNR EQ MATNR1.
        IF SY-SUBRC EQ 0.
          IF MARA-SPART EQ '50'.
            WA_CUM2-BCDMBTR = WA_CUM1-DMBTR.
            SELECT SINGLE * FROM ZBUDGET_TAB1 WHERE MATNR EQ WA_CUM1-MATNR AND TAG EQ 'G' AND DATAB EQ ASDT1.
            IF SY-SUBRC EQ 0.
              WA_CUM2-BCBUD = ZBUDGET_TAB1-VAL.
            ENDIF.
            COLLECT WA_CUM2 INTO IT_CUM2.
            CLEAR WA_CUM2.
          ELSEIF MARA-SPART EQ '60'.
            WA_CUM2-XLDMBTR = WA_CUM1-DMBTR.
            SELECT SINGLE * FROM ZBUDGET_TAB1 WHERE MATNR EQ WA_CUM1-MATNR AND TAG EQ 'G' AND DATAB EQ ASDT1.
            IF SY-SUBRC EQ 0.
              WA_CUM2-XLBUD = ZBUDGET_TAB1-VAL.
            ENDIF.
            COLLECT WA_CUM2 INTO IT_CUM2.
            CLEAR WA_CUM2.
          ELSEIF MARA-SPART EQ '70'.
            WA_CUM2-LSDMBTR = WA_CUM1-DMBTR.
            SELECT SINGLE * FROM ZBUDGET_TAB1 WHERE MATNR EQ WA_CUM1-MATNR AND TAG EQ 'G' AND DATAB EQ ASDT1.
            IF SY-SUBRC EQ 0.
              WA_CUM2-LSBUD = ZBUDGET_TAB1-VAL.
            ENDIF.
            COLLECT WA_CUM2 INTO IT_CUM2.
            CLEAR WA_CUM2.
          ENDIF.
        ENDIF.


**************************************************
      ENDIF.
    ENDIF.
  ENDLOOP.
  CLEAR : BCPER,XLPER,BCSALE,XLSALE,LSSALE,LSPER.
  LOOP AT IT_CUM2 INTO WA_CUM2.
    IF BCBUD GT 0.
      BCPER = ( WA_CUM2-BCDMBTR / BCBUD ) * 100.
    ENDIF.
    IF XLBUD GT 0.
      XLPER = ( WA_CUM2-XLDMBTR / XLBUD ) * 100.
    ENDIF.
    IF LSBUD GT 0.
      LSPER = ( WA_CUM2-LSDMBTR / LSBUD ) * 100.
    ENDIF.
    BCSALE = WA_CUM2-BCDMBTR / 1000.
    XLSALE = WA_CUM2-XLDMBTR / 1000.
    LSSALE = WA_CUM2-LSDMBTR / 1000.
  ENDLOOP.



*  LOOP AT IT_CUM2 INTO WA_CUM2.
*    BCPER = ( WA_CUM2-BCDMBTR / WA_CUM2-BCBUD ) * 100.
*    XLPER = ( WA_CUM2-XLDMBTR / WA_CUM2-XLBUD ) * 100.
**    write : / 'blue cross sale',wa_cum2-bcdmbtr,'budget', wa_cum2-bcbud.
**    write : / 'XL cross sale',wa_cum2-xldmbtr,'budget', wa_cum2-xlbud.
*    BCSALE = WA_CUM2-BCDMBTR / 1000.
*    XLSALE = WA_CUM2-XLDMBTR / 1000.
*  ENDLOOP.

  BCSALE1 = BCSALE.
  XLSALE1 = XLSALE.
  LSSALE1 = LSSALE.
  CONDENSE: BCSALE1,XLSALE1,LSSALE1.

  BCPER1 = BCPER.
  XLPER1 = XLPER.
  LSPER1 = LSPER.
  CONDENSE BCPER1 NO-GAPS.
  CONDENSE XLPER1 NO-GAPS.
  CONDENSE LSPER1 NO-GAPS.
************************  last month  ********************
  CLEAR : W_DATE,W_DATE1.
  CALL FUNCTION 'RE_ADD_MONTH_TO_DATE'
    EXPORTING
      MONTHS  = '-1'
      OLDDATE = ASDT
    IMPORTING
      NEWDATE = W_DATE1.

  W_DATE = W_DATE1.
  W_DATE+6(2) = '01'.
  CLEAR: ITAB_GSBER, IT_ZDAILYSALES,IT_SALE1,WA_SALE1,WA_ZDAILYSALES,W_NOS.

  SELECT * FROM ZDAILYSALES INTO TABLE IT_ZDAILYSALES WHERE PLANT IN S_WERKS AND ASOF_DT GE W_DATE AND ASOF_DT LE W_DATE1.
  LOOP AT IT_ZDAILYSALES INTO WA_ZDAILYSALES.
*    write : / 'LMS', wa_zdailysales-sale_val.
    WA_SALE1-LMS = WA_ZDAILYSALES-SALE_VAL.
    WA_SALE1-WERKS = WA_ZDAILYSALES-PLANT.
*    SELECT SINGLE * FROM t134g WHERE werks EQ wa_zdailysales-plant AND spart EQ '10'.
    SELECT SINGLE * FROM ZTB_T134G WHERE WERKS EQ WA_ZDAILYSALES-PLANT AND SPART EQ '10'.
    IF SY-SUBRC EQ 0.
*      wa_sale1-gsber = t134g-gsber.
      WA_SALE1-GSBER = ZTB_T134G-GSBER.
    ENDIF.
    LMTOT = LMTOT + WA_ZDAILYSALES-SALE_VAL.
    COLLECT WA_SALE1 INTO IT_SALE1.
    CLEAR WA_SALE1.
  ENDLOOP.
*  write : / 'last month total',lmtot.
  CLEAR : IT_ZDAILYSALES, WA_ZDAILYSALES.
  SELECT * FROM ZDAILYSALES INTO TABLE IT_ZDAILYSALES WHERE PLANT IN S_WERKS2 AND ASOF_DT GE W_DATE AND ASOF_DT LE W_DATE1.
  LOOP AT IT_ZDAILYSALES INTO WA_ZDAILYSALES.
*    write : / 'LMS', wa_zdailysales-sale_val.
    WA_SALE1-LMS = WA_ZDAILYSALES-SALE_VAL.
    WA_SALE1-WERKS = '3000'.
*    SELECT SINGLE * FROM t134g WHERE werks EQ wa_zdailysales-plant AND spart EQ '10'.
    SELECT SINGLE * FROM ZTB_T134G WHERE WERKS EQ WA_ZDAILYSALES-PLANT AND SPART EQ '10'.
    IF SY-SUBRC EQ 0.
      WA_SALE1-GSBER = 'NEP'.
    ENDIF.
    COLLECT WA_SALE1 INTO IT_SALE1.
    CLEAR WA_SALE1.
  ENDLOOP.
  CLEAR : IT_ZDAILYSALES, WA_ZDAILYSALES.
  SELECT * FROM ZDAILYSALES INTO TABLE IT_ZDAILYSALES WHERE PLANT IN S_WERKS1 AND ASOF_DT GE W_DATE AND ASOF_DT LE W_DATE1.
  LOOP AT IT_ZDAILYSALES INTO WA_ZDAILYSALES.
    READ TABLE IT_T134G INTO W_T134G WITH KEY WERKS = WA_ZDAILYSALES-PLANT.
    IF SY-SUBRC EQ 4.
*    write : / 'LMS', wa_zdailysales-sale_val.
      WA_SALE1-LMS = WA_ZDAILYSALES-SALE_VAL.
      WA_SALE1-WERKS = '3000'.
*      SELECT SINGLE * FROM t134g WHERE werks EQ wa_zdailysales-plant AND spart EQ '10'.
      SELECT SINGLE * FROM ZTB_T134G WHERE WERKS EQ WA_ZDAILYSALES-PLANT AND SPART EQ '10'.
      IF SY-SUBRC EQ 0.
        WA_SALE1-GSBER = 'OTH'.
      ENDIF.
      COLLECT WA_SALE1 INTO IT_SALE1.
      CLEAR WA_SALE1.
    ENDIF.
  ENDLOOP.

  LOOP AT IT_SALE1  ASSIGNING <IT_SALE1>.
*     where fkdat = sy-datum.
    WA_GSBER-GSBER = <IT_SALE1>-GSBER.
    WA_GSBER-DMBTR = <IT_SALE1>-LMS.
    COLLECT WA_GSBER INTO ITAB_GSBER.
    CLEAR WA_GSBER.
  ENDLOOP.
*  perform nos using w_nos.
  PERFORM FINAL USING '3. Last Month''s Value'.
  CLEAR: ITAB_GSBER, WA_GSBER, W_NOS,LMTOT.
************************************************************


*********************  last year Value ******************************
  CLEAR : W_DATE,W_DATE1.
  CALL FUNCTION 'RE_ADD_MONTH_TO_DATE'
    EXPORTING
      MONTHS  = '-12'
      OLDDATE = ASDT
    IMPORTING
      NEWDATE = W_DATE1.

  W_DATE = W_DATE1.
  W_DATE+6(2) = '01'.
  CLEAR: ITAB_GSBER, IT_ZDAILYSALES,IT_SALE1,WA_SALE1,WA_ZDAILYSALES.

  SELECT * FROM ZDAILYSALES INTO TABLE IT_ZDAILYSALES WHERE PLANT IN S_WERKS AND ASOF_DT GE W_DATE AND ASOF_DT LE W_DATE1.
  LOOP AT IT_ZDAILYSALES INTO WA_ZDAILYSALES.
*    write : / 'LYS', wa_zdailysales-sale_val.
    WA_SALE1-LMS = WA_ZDAILYSALES-SALE_VAL.
    WA_SALE1-WERKS = WA_ZDAILYSALES-PLANT.
*    SELECT SINGLE * FROM t134g WHERE werks EQ wa_zdailysales-plant AND spart EQ '10'.
    SELECT SINGLE * FROM ZTB_T134G WHERE WERKS EQ WA_ZDAILYSALES-PLANT AND SPART EQ '10'.
    IF SY-SUBRC EQ 0.
      WA_SALE1-GSBER = ZTB_T134G-GSBER.
    ENDIF.
    LYTOT = LYTOT + WA_ZDAILYSALES-SALE_VAL.
    COLLECT WA_SALE1 INTO IT_SALE1.
    CLEAR WA_SALE1.
  ENDLOOP.
*  write : / 'lasy year total',lytot.
  CLEAR : IT_ZDAILYSALES, WA_ZDAILYSALES.
  SELECT * FROM ZDAILYSALES INTO TABLE IT_ZDAILYSALES WHERE PLANT IN S_WERKS2 AND ASOF_DT GE W_DATE AND ASOF_DT LE W_DATE1.
  LOOP AT IT_ZDAILYSALES INTO WA_ZDAILYSALES.
*    write : / 'LYS', wa_zdailysales-sale_val.
    WA_SALE1-LMS = WA_ZDAILYSALES-SALE_VAL.
    WA_SALE1-WERKS = '3000'.
*    SELECT SINGLE * FROM t134g WHERE werks EQ wa_zdailysales-plant AND spart EQ '10'.
    SELECT SINGLE * FROM ZTB_T134G WHERE WERKS EQ WA_ZDAILYSALES-PLANT AND SPART EQ '10'.
    IF SY-SUBRC EQ 0.
      WA_SALE1-GSBER = 'NEP'.
    ENDIF.
    COLLECT WA_SALE1 INTO IT_SALE1.
    CLEAR WA_SALE1.
  ENDLOOP.
  CLEAR : IT_ZDAILYSALES, WA_ZDAILYSALES.
  SELECT * FROM ZDAILYSALES INTO TABLE IT_ZDAILYSALES WHERE PLANT IN S_WERKS1 AND ASOF_DT GE W_DATE AND ASOF_DT LE W_DATE1.
  LOOP AT IT_ZDAILYSALES INTO WA_ZDAILYSALES.
    READ TABLE IT_T134G INTO W_T134G WITH KEY WERKS = WA_ZDAILYSALES-PLANT.
    IF SY-SUBRC EQ 4.
      WA_SALE1-LMS = WA_ZDAILYSALES-SALE_VAL.
      WA_SALE1-WERKS = '3000'.
*      SELECT SINGLE * FROM t134g WHERE werks EQ wa_zdailysales-plant AND spart EQ '10'.
      SELECT SINGLE * FROM ZTB_T134G WHERE WERKS EQ WA_ZDAILYSALES-PLANT AND SPART EQ '10'.
      IF SY-SUBRC EQ 0.
        WA_SALE1-GSBER = 'OTH'.
      ENDIF.
      COLLECT WA_SALE1 INTO IT_SALE1.
      CLEAR WA_SALE1.
    ENDIF.
  ENDLOOP.

  LOOP AT IT_SALE1  ASSIGNING <IT_SALE1>.
*     where fkdat = sy-datum.
    WA_GSBER-GSBER = <IT_SALE1>-GSBER.
    WA_GSBER-DMBTR = <IT_SALE1>-LMS.
    COLLECT WA_GSBER INTO ITAB_GSBER.
    CLEAR WA_GSBER.
  ENDLOOP.
************************************************************

*  perform nos using w_nos.
  PERFORM FINAL USING '4. Last Year''s Value'.

  CLEAR: ITAB_GSBER, WA_GSBER, W_NOS,LYTOT.

* ********************************** last year value*****************

*  loop at itab_inv_pre_yr assigning <fs_inv>.
*    read table itab_t134gp into wa_t134gp with key gsber = <fs_inv>-gsber_i.
*    if sy-subrc eq 0.
*      <fs_inv>-gsber_i = 'NEP'.
*    else.
*      read table itab_t134go into wa_t134go with key gsber = <fs_inv>-gsber_i.
*      if sy-subrc eq 0.
*        <fs_inv>-gsber_i = 'OTH'.
*      endif.
*    endif.
*    wa_gsber-gsber = <fs_inv>-gsber_i.
*    wa_gsber-dmbtr = <fs_inv>-netwr_i.
*    on change of <fs_inv>-vbeln.
*      w_nos = w_nos + 1.
*    endon.
*    if <fs_inv>-vbtyp = 'N'.
*      wa_gsber-dmbtr = wa_gsber-dmbtr * -1.
*    endif.
*    collect wa_gsber into itab_gsber .
*    clear wa_gsber.
*  endloop.





**************************"ENDED BY PRASANNA ON
*18.11.2011******************
*PERFORM FINAL USING '4. L.Y. Mth''s Value'. " COMMENTED BY PRASANNA
*SRIDHARAN




ENDFORM.                    " SALES


*&---------------------------------------------------------------------*
*&      Form  FINAL
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM FINAL USING VALUE(P_0449).

*  Appending final internal table
  LOOP AT ITAB_GSBER INTO WA_GSBER WHERE GSBER NE '   '.
    ASSIGN COMPONENT WA_GSBER-GSBER OF STRUCTURE <DYN_WA> TO <FS>.
    IF SY-SUBRC = 0.
      <FS> = WA_GSBER-DMBTR.
      ASSIGN COMPONENT 'TOTAL' OF STRUCTURE <DYN_WA> TO <FS>.
      IF SY-SUBRC = 0.
        <FS> = <FS> + WA_GSBER-DMBTR.
      ENDIF.
    ENDIF.
  ENDLOOP.
  ASSIGN COMPONENT 'TOTAL' OF STRUCTURE <DYN_WA> TO <FS>.
  IF SY-SUBRC = 0.
*        <fs> = <fs> + wa_gsber-dmbtr.
    IF P_0449+0(2) EQ '3.'.
      <FS> = LMTOT.
    ELSEIF P_0449+0(2) EQ '4.'.
      <FS> = LYTOT.
    ENDIF.
  ENDIF.
  ASSIGN COMPONENT 'NAM' OF STRUCTURE <DYN_WA> TO <FS>.
  <FS> = P_0449.

  APPEND <DYN_WA> TO <DYN_TABLE>.
  CLEAR <DYN_WA>.

ENDFORM.                    " FINAL
*&---------------------------------------------------------------------*
*&      Form  INVENTORY
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM INVENTORY .

  DATA: ITAB_GSBER1 TYPE TABLE OF TYP_GSBER,
        ITAB_MATNR1 TYPE TABLE OF TYP_MATNR.


  ASSIGN COMPONENT 'TYP' OF STRUCTURE <DYN_WA> TO <FS>.
  <FS> = 'B:'.
  ASSIGN COMPONENT 'NAM' OF STRUCTURE <DYN_WA> TO <FS>.
  <FS> = 'Inventory'.
  APPEND <DYN_WA> TO <DYN_TABLE>.
  CLEAR <DYN_WA>.

  IF ITAB_WERKS IS NOT INITIAL.
*    As of know stock value wrt Plant and Location
    SELECT MATNR WERKS LGORT LABST INSME EINME SPEME RETME
    FROM MARD INTO TABLE ITAB_MARD FOR ALL ENTRIES IN
    ITAB_WERKS WHERE WERKS = ITAB_WERKS-WERKS.

*    As of know stock in transit value wrt Plant
    SELECT MATNR WERKS TRAME FROM MARC INTO TABLE ITAB_MARC
    FOR ALL ENTRIES IN ITAB_WERKS WHERE WERKS = ITAB_WERKS-WERKS.
  ENDIF.

  LOOP AT ITAB_MARD ASSIGNING <FS_MARD>.
    WA_MATNR-MATNR = <FS_MARD>-MATNR.
    APPEND WA_MATNR TO ITAB_MATNR1.
    CLEAR WA_MATNR.
  ENDLOOP.

  LOOP AT ITAB_MARC ASSIGNING <FS_MARC>.
    WA_MATNR-MATNR = <FS_MARC>-MATNR.
    APPEND WA_MATNR TO ITAB_MATNR1.
    CLEAR WA_MATNR.
  ENDLOOP.

  SORT ITAB_MATNR1 BY MATNR.
  DELETE ADJACENT DUPLICATES FROM ITAB_MATNR1 COMPARING MATNR.

  IF ITAB_MATNR1 IS NOT INITIAL.
*    Get the division of materials
    SELECT MATNR SPART FROM MARA INTO TABLE ITAB_MARA FOR ALL ENTRIES IN ITAB_MATNR1 WHERE MATNR = ITAB_MATNR1-MATNR.
    SORT ITAB_MARA BY MATNR.
  ENDIF.

  IF ITAB_MATNR1 IS NOT INITIAL.
*  Get the ZPTS Condition record number
    SELECT * FROM A004 INTO TABLE ITAB_A004 FOR ALL ENTRIES IN ITAB_MATNR1
    WHERE KAPPL = 'V' AND
      KSCHL = 'ZPTS' AND VKORG = '1000' AND VTWEG IN ('10', '80') AND
    MATNR = ITAB_MATNR1-MATNR AND
    DATBI >= SY-DATUM AND DATAB =< SY-DATUM.
    SORT ITAB_A004 BY MATNR.
  ENDIF.
*  Get the ZPTS value for materials
  IF ITAB_A004 IS NOT INITIAL.
    SELECT KNUMH KOPOS KBETR KONWA FROM KONP INTO TABLE ITAB_KONP
    FOR ALL ENTRIES IN ITAB_A004  WHERE KNUMH = ITAB_A004-KNUMH AND
    KAPPL = 'V' AND KSCHL = 'ZPTS'.
    SORT ITAB_KONP BY KNUMH.
  ENDIF.

  LOOP AT ITAB_MARD ASSIGNING <FS_MARD>.
    WA_MATNR-MATNR = <FS_MARD>-MATNR.
    WA_MATNR-WERKS = <FS_MARD>-WERKS.
    WA_MATNR-MENGE = <FS_MARD>-LABST + <FS_MARD>-INSME + <FS_MARD>-EINME
    +
    <FS_MARD>-SPEME + <FS_MARD>-RETME.
    COLLECT WA_MATNR INTO ITAB_MATNR.
    CLEAR WA_MATNR.
  ENDLOOP.

  CLEAR: ITAB_GSBER, WA_GSBER.
  LOOP AT ITAB_MATNR ASSIGNING <FS_MATNR>.

    READ TABLE ITAB_A004 ASSIGNING <FS_A004> WITH KEY MATNR =   <FS_MATNR>-MATNR  BINARY SEARCH.
    IF SY-SUBRC = 0.
      READ TABLE ITAB_KONP ASSIGNING <FS_KONP> WITH KEY KNUMH =  <FS_A004>-KNUMH  BINARY SEARCH.
      IF SY-SUBRC = 0.
        READ TABLE ITAB_MARA ASSIGNING <FS_MARA> WITH KEY MATNR = <FS_MATNR>-MATNR BINARY SEARCH.
        IF SY-SUBRC = 0.
          READ TABLE ITAB_T134G ASSIGNING <FS_T134G> WITH KEY WERKS =  <FS_MATNR>-WERKS .
*          spart = <fs_mara>-spart binary search.
          IF SY-SUBRC = 0.
            WA_GSBER-DMBTR = <FS_MATNR>-MENGE * <FS_KONP>-KBETR.
            READ TABLE ITAB_T134GO INTO WA_T134GO WITH KEY GSBER = <FS_T134G>-GSBER.
            IF SY-SUBRC EQ 0.
              <FS_T134G>-GSBER  = 'OTH'.
            ENDIF.
            WA_GSBER-GSBER = <FS_T134G>-GSBER.
            COLLECT WA_GSBER INTO ITAB_GSBER .
            CLEAR WA_GSBER.
          ENDIF.
        ENDIF.
      ENDIF.
    ENDIF.
  ENDLOOP.
*  break-point.
  PERFORM FINAL USING 'CL. Stock Value'.
  ITAB_GSBER1 = ITAB_GSBER.

  CLEAR: ITAB_GSBER, WA_GSBER.
  LOOP AT ITAB_MARC ASSIGNING <FS_MARC>.
    READ TABLE ITAB_A004 ASSIGNING <FS_A004> WITH KEY MATNR =
    <FS_MARC>-MATNR
    BINARY SEARCH.
    IF SY-SUBRC = 0.
      READ TABLE ITAB_KONP ASSIGNING <FS_KONP> WITH KEY KNUMH =
      <FS_A004>-KNUMH
      BINARY SEARCH.
      IF SY-SUBRC = 0.
        READ TABLE ITAB_MARA ASSIGNING <FS_MARA> WITH KEY MATNR =
        <FS_MARC>-MATNR
        BINARY SEARCH.
        IF SY-SUBRC = 0.
          READ TABLE ITAB_T134G ASSIGNING <FS_T134G> WITH KEY WERKS = <FS_MARC>-WERKS .
*          spart = <fs_mara>-spart binary search.
          IF SY-SUBRC = 0.
            WA_GSBER-DMBTR = <FS_MARC>-TRAME * <FS_KONP>-KBETR.

            READ TABLE ITAB_T134GO INTO WA_T134GO WITH KEY GSBER = <FS_T134G>-GSBER.
            IF SY-SUBRC EQ 0.
              <FS_T134G>-GSBER  = 'OTH'.
            ENDIF.

            WA_GSBER-GSBER = <FS_T134G>-GSBER.
            COLLECT WA_GSBER INTO ITAB_GSBER .
            CLEAR WA_GSBER.
          ENDIF.
        ENDIF.
      ENDIF.
    ENDIF.
  ENDLOOP.

  PERFORM FINAL USING 'IT.  Stock Value'.

  CLEAR: WA_GSBER.
  LOOP AT ITAB_GSBER INTO WA_GSBER.
    COLLECT WA_GSBER INTO ITAB_GSBER1.
    CLEAR WA_GSBER.
  ENDLOOP.

  CLEAR: ITAB_GSBER, WA_GSBER.
  ITAB_GSBER = ITAB_GSBER1.
  PERFORM FINAL USING 'Total Stock Value'.


ENDFORM.                    " INVENTORY
*&---------------------------------------------------------------------*
*&      Form  RECEIVABLES
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM RECEIVABLES .
  TYPES: LR_HKONT TYPE RANGE OF HKONT.
  DATA: LT_HKONT  TYPE LR_HKONT,
        LT_PRCTR  TYPE RANGE OF PRCTR,
        LV_PRCTR1 TYPE PRCTR,
        LV_PRCTR2 TYPE PRCTR.

  LT_HKONT = VALUE LR_HKONT( SIGN = 'I' OPTION = 'EQ'
                             ( LOW = '0000013140' )
                             ( LOW = '0000023300' )
                            ).

  ASSIGN COMPONENT 'TYP' OF STRUCTURE <DYN_WA> TO <FS>.
  <FS> = 'D:'.
  ASSIGN COMPONENT 'NAM' OF STRUCTURE <DYN_WA> TO <FS>.
  <FS> = 'Receivables'.
  APPEND <DYN_WA> TO <DYN_TABLE>.
  CLEAR <DYN_WA>.

*  All the House Bank GL 's
*  SELECT BUKRS HBKID  HKTID HKONT FROM T012K INTO TABLE ITAB_T012K WHERE BUKRS = P_BUKRS.

  W_DATE = SY-DATUM.
  W_DATE+6 = '01'.

  PERFORM DATE USING W_DATE SY-DATUM.

  CLEAR: LT_PRCTR.
  LOOP AT R_WERKS INTO DATA(LS_WERKS).
    CLEAR: LV_PRCTR1,LV_PRCTR2.
    CALL FUNCTION 'CONVERSION_EXIT_ALPHA_INPUT'
      EXPORTING
        INPUT  = S_WERKS-LOW
      IMPORTING
        OUTPUT = LV_PRCTR1.

    CALL FUNCTION 'CONVERSION_EXIT_ALPHA_INPUT'
      EXPORTING
        INPUT  = S_WERKS-HIGH
      IMPORTING
        OUTPUT = LV_PRCTR2.

    APPEND VALUE #( SIGN = LS_WERKS-SIGN
                    OPTION = LS_WERKS-OPTION
                    LOW = LV_PRCTR1
                    HIGH = LV_PRCTR2
                ) TO LT_PRCTR.
  ENDLOOP.


  IF LT_HKONT IS NOT INITIAL.
*    Payment recived by bank for the current month
    SELECT BUKRS HKONT AUGDT AUGBL ZUONR GJAHR BELNR BUZEI BUDAT SHKZG GSBER DMBTR
      FROM BSIS CLIENT SPECIFIED INTO TABLE ITAB_BSIS
*      FOR ALL ENTRIES IN ITAB_T012K
        WHERE MANDT = SY-MANDT
          AND  BUKRS = P_BUKRS
          AND HKONT IN LT_HKONT
          AND BUDAT IN R_DAT
          AND  BLART = 'DZ' .
*          AND GSBER IN R_GSBER .
    IF ITAB_BSIS IS NOT INITIAL.
      DATA: IT_BSIS TYPE TABLE OF TYP_BSIS.
      IT_BSIS = CORRESPONDING #( ITAB_BSIS ).
      SORT IT_BSIS BY BUKRS GJAHR BELNR BUZEI.
      SELECT RBUKRS, GJAHR, BELNR, BUZEI, PRCTR
            FROM ACDOCA FOR ALL ENTRIES IN @IT_BSIS
              WHERE RLDNR = '0L'
                AND RBUKRS = @IT_BSIS-BUKRS
                AND GJAHR = @IT_BSIS-GJAHR
                AND BELNR = @IT_BSIS-BELNR
                AND BUZEI = @IT_BSIS-BUZEI
              INTO TABLE @DATA(IT_ACD).
      SORT IT_ACD BY RBUKRS GJAHR BELNR BUZEI.

    ENDIF.


  ENDIF.

  CLEAR: ITAB_GSBER, WA_GSBER.
  LOOP AT ITAB_BSIS ASSIGNING <FS_BSIS> WHERE BUDAT = SY-DATUM.
    CLEAR: LV_PRCTR1.
    LV_PRCTR1 = VALUE #( IT_ACD[ RBUKRS = <FS_BSIS>-BUKRS
                                 GJAHR  = <FS_BSIS>-GJAHR
                                 BELNR  = <FS_BSIS>-BELNR
                                 BUZEI  = <FS_BSIS>-BUZEI ]-PRCTR OPTIONAL  ).
    <FS_BSIS>-GSBER = LV_PRCTR1+6(4).

    READ TABLE ITAB_T134GP INTO WA_T134GP WITH KEY GSBER = <FS_BSIS>-GSBER.
    IF SY-SUBRC EQ 0.
      <FS_BSIS>-GSBER = 'NEP'.
    ELSE.
      READ TABLE ITAB_T134GO INTO WA_T134GO WITH KEY GSBER = <FS_BSIS>-GSBER.
      IF SY-SUBRC EQ 0.
        <FS_BSIS>-GSBER = 'OTH'.
      ENDIF.
    ENDIF.

*    read table itab_t134go into wa_t134go with key gsber = <fs_bsis>-gsber.
*    if sy-subrc eq 0.
*      <fs_bsis>-gsber = 'OTH'.
*    endif.
    WA_GSBER-GSBER = <FS_BSIS>-GSBER.
    WA_GSBER-DMBTR = <FS_BSIS>-DMBTR.
    IF <FS_BSIS>-SHKZG = 'H'.
      WA_GSBER-DMBTR = WA_GSBER-DMBTR * -1.
    ENDIF.
    COLLECT WA_GSBER INTO ITAB_GSBER .
    CLEAR WA_GSBER.
  ENDLOOP.

  PERFORM FINAL USING 'Payment Recd'.

  CLEAR: ITAB_GSBER, WA_GSBER.
  LOOP AT ITAB_BSIS ASSIGNING <FS_BSIS>.
    CLEAR: LV_PRCTR1.
    LV_PRCTR1 = VALUE #( IT_ACD[ RBUKRS = <FS_BSIS>-BUKRS
                                 GJAHR  = <FS_BSIS>-GJAHR
                                 BELNR  = <FS_BSIS>-BELNR
                                 BUZEI  = <FS_BSIS>-BUZEI ]-PRCTR OPTIONAL  ).
    <FS_BSIS>-GSBER = LV_PRCTR1+6(4).

    READ TABLE ITAB_T134GP INTO WA_T134GP WITH KEY GSBER = <FS_BSIS>-GSBER.
    IF SY-SUBRC EQ 0.
      <FS_BSIS>-GSBER = 'NEP'.
    ELSE.
      READ TABLE ITAB_T134GO INTO WA_T134GO WITH KEY GSBER = <FS_BSIS>-GSBER.
      IF SY-SUBRC EQ 0.
        <FS_BSIS>-GSBER = 'OTH'.
      ENDIF.
    ENDIF.

*    read table itab_t134go into wa_t134go with key gsber = <fs_bsis>-gsber.
*    if sy-subrc eq 0.
*      <fs_bsis>-gsber = 'OTH'.
*    endif.
    WA_GSBER-GSBER = <FS_BSIS>-GSBER.
    WA_GSBER-DMBTR = <FS_BSIS>-DMBTR.
    IF <FS_BSIS>-SHKZG = 'H'.
      WA_GSBER-DMBTR = WA_GSBER-DMBTR * -1.
    ENDIF.
    COLLECT WA_GSBER INTO ITAB_GSBER .
    CLEAR WA_GSBER.
  ENDLOOP.

  PERFORM FINAL USING 'Cumm. Pmt Recd.'.

*  Calculate the Total receivables and over due classification
  CLEAR: ITAB_GSBER, WA_GSBER.
  SORT ITAB_BSID BY KUNNR.

  LOOP AT ITAB_BSID INTO WA_BSID.
    CLEAR : W_FKART.
    SELECT SINGLE FKART FROM VBRK INTO W_FKART WHERE VBELN EQ WA_BSID-ZUONR .
    IF SY-SUBRC EQ 0 .
      IF W_FKART EQ 'ZBDF' OR W_FKART EQ 'ZCDF'.
      ELSE.
        SELECT SINGLE * FROM VBRK WHERE VBELN = WA_BSID-ZUONR AND  KALSM IN  ( 'ZEXPNP' , 'ZDOMON' ) .
        IF SY-SUBRC EQ 4.
          DELETE ITAB_BSID WHERE ZUONR = WA_BSID-ZUONR.
        ENDIF.
      ENDIF.
    ENDIF.
  ENDLOOP.

  LOOP AT ITAB_BSID INTO WA_BSID.
    IF WA_BSID-KUNNR EQ 'CUTTACK'.
      DELETE ITAB_BSID WHERE KUNNR = WA_BSID-KUNNR.
    ENDIF.
  ENDLOOP.


  LOOP AT ITAB_BSID ASSIGNING <FS_BSID>.
    SELECT SINGLE * FROM T001W WHERE KUNNR EQ <FS_BSID>-KUNNR.
    IF SY-SUBRC EQ 4.
      IF <FS_BSID>-KUNNR EQ '0000040095'.
      ELSE.
        IF <FS_BSID>-BSCHL = '01' OR <FS_BSID>-BSCHL = '04' OR
        <FS_BSID>-BSCHL = '06'
          OR <FS_BSID>-BSCHL = '07' . " For only open receivables
        ELSE.
          CONTINUE.
        ENDIF.
      ENDIF.

*      read table itab_t134gp into wa_t134gp with key gsber = <fs_bsid>-gsber.
*      if sy-subrc eq 0.
*        <fs_bsid>-gsber = 'NEP'.
*      else.
*        read table itab_t134go into wa_t134go with key gsber = <fs_bsid>-gsber.
*        if sy-subrc eq 0.
*          <fs_bsid>-gsber = 'OTH'.
*        endif.
*      endif.
      IF <FS_BSID>-KUNNR EQ '0000040095'.
        <FS_BSID>-GSBER = 'NEP'.
      ELSE.
        READ TABLE ITAB_T134GO INTO WA_T134GO WITH KEY GSBER = <FS_BSID>-GSBER.
        IF SY-SUBRC EQ 0.
          <FS_BSID>-GSBER = 'OTH'.
        ENDIF.
      ENDIF.

      WA_GSBER-GSBER = <FS_BSID>-GSBER.
      WA_GSBER-DMBTR = <FS_BSID>-DMBTR.
      IF <FS_BSID>-SHKZG = 'H'.
        WA_GSBER-DMBTR = WA_GSBER-DMBTR * -1.
      ENDIF.
      COLLECT WA_GSBER INTO ITAB_GSBER .
      CLEAR WA_GSBER.

*    NO = <FS_BSID>-ZBD1T.
*    CALL FUNCTION 'RP_CALC_DATE_IN_INTERVAL'
*      EXPORTING
*        DATE      = <FS_BSID>-ZFBDT
*        DAYS      = NO
*        MONTHS    = NO1
*        YEARS     = NO1
*      IMPORTING
*        CALC_DATE = WA_ZFBDT.

      CHECK <FS_BSID>-ZFBDT < SY-DATUM.

*    Over due classification
      CALL FUNCTION 'HR_SGPBS_YRS_MTHS_DAYS'
        EXPORTING
          BEG_DA        = <FS_BSID>-ZFBDT
          END_DA        = SY-DATUM
        IMPORTING
          NO_CAL_DAY    = W_DATE2
        EXCEPTIONS
          DATEINT_ERROR = 1
          OTHERS        = 2.
      IF SY-SUBRC <> 0.
        MESSAGE ID SY-MSGID TYPE SY-MSGTY NUMBER SY-MSGNO
                WITH SY-MSGV1 SY-MSGV2 SY-MSGV3 SY-MSGV4.
      ENDIF.

*    IF W_DATE2 > 0.

      READ TABLE ITAB_T134GP INTO WA_T134GP WITH KEY GSBER = <FS_BSID>-GSBER.
      IF SY-SUBRC EQ 0.
*        <FS_BSID>-GSBER = 'NEP'.
      ELSE.
        READ TABLE ITAB_T134GO INTO WA_T134GO WITH KEY GSBER = <FS_BSID>-GSBER.
        IF SY-SUBRC EQ 0.
          <FS_BSID>-GSBER = 'OTH'.
        ENDIF.
      ENDIF.

*      read table itab_t134go into wa_t134go with key gsber = <fs_bsid>-gsber.
*      if sy-subrc eq 0.
*        <fs_bsid>-gsber = 'OTH'.
*      endif.

      WA_ODR-GSBER = <FS_BSID>-GSBER.
      WA_ODR-DMBTR = <FS_BSID>-DMBTR.
      IF <FS_BSID>-SHKZG = 'H'.
        WA_ODR-DMBTR = WA_ODR-DMBTR * -1.
      ENDIF.

      IF W_DATE2 > 90.
        WA_ODR-N = 3.
      ELSEIF W_DATE2 > 60.
        WA_ODR-N = 2.
      ELSEIF W_DATE2 > 30.
        WA_ODR-N = 1.
      ELSEIF W_DATE2 BETWEEN 12 AND 30.
        WA_ODR-N = 0.
      ELSEIF W_DATE2 < 12.
        WA_ODR-N = 4.
      ENDIF.
      COLLECT WA_ODR INTO ITAB_ODR.
      CLEAR WA_ODR.
    ENDIF.
  ENDLOOP.

  DELETE ITAB_ODR WHERE N = 4.
*  break-point .
  PERFORM FINAL USING 'Total Receivables'.

ENDFORM.                    " RECEIVABLES
*&---------------------------------------------------------------------*
*&      Form  ODR
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM ODR .

  ASSIGN COMPONENT 'TYP' OF STRUCTURE <DYN_WA> TO <FS>.
  <FS> = 'E:'.
  ASSIGN COMPONENT 'NAM' OF STRUCTURE <DYN_WA> TO <FS>.
  <FS> = 'O.D.R'.
  APPEND <DYN_WA> TO <DYN_TABLE>.
  CLEAR <DYN_WA>.

  PERFORM ODR_GSBER USING 3.
  PERFORM FINAL USING 'Over 3 Months'.

  PERFORM ODR_GSBER USING 2.
  PERFORM FINAL USING 'Over 2 Months'.

  PERFORM ODR_GSBER USING 1.
  PERFORM FINAL USING 'Over 1 Month'.

  PERFORM ODR_GSBER USING 0.
  PERFORM FINAL USING 'Upto 1 Month'.

  CLEAR: ITAB_GSBER, WA_GSBER.
  LOOP AT ITAB_ODR ASSIGNING <FS_ODR>.
    READ TABLE ITAB_T134GO INTO WA_T134GO WITH KEY GSBER = <FS_ODR>-GSBER.
    IF SY-SUBRC EQ 0.
      <FS_ODR>-GSBER = 'OTH'.
    ENDIF.
    WA_GSBER-GSBER = <FS_ODR>-GSBER.
    WA_GSBER-DMBTR = <FS_ODR>-DMBTR.
    COLLECT WA_GSBER INTO ITAB_GSBER .
    CLEAR WA_GSBER.
  ENDLOOP.
  PERFORM FINAL USING 'Total Overdues'.

ENDFORM.                    " ODR
*&---------------------------------------------------------------------*
*&      Form  ODR_GSBER
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*      -->P_3      text
*----------------------------------------------------------------------*
FORM ODR_GSBER  USING VALUE(P_3).

  CLEAR: ITAB_GSBER, WA_GSBER.
  LOOP AT ITAB_ODR ASSIGNING <FS_ODR> WHERE N = P_3.
    READ TABLE ITAB_T134GO INTO WA_T134GO WITH KEY GSBER = <FS_ODR>-GSBER.
    IF SY-SUBRC EQ 0.
      <FS_ODR>-GSBER = 'OTH'.
    ENDIF.
    WA_GSBER-GSBER = <FS_ODR>-GSBER.
    WA_GSBER-DMBTR = <FS_ODR>-DMBTR.
    COLLECT WA_GSBER INTO ITAB_GSBER .
    CLEAR WA_GSBER.
  ENDLOOP.

ENDFORM.                    " ODR_GSBER
*&---------------------------------------------------------------------*
*&      Form  NOTE
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM NOTE .

  DATA: L_DATE  TYPE SY-DATUM,
        L_DATE1 TYPE SY-DATUM,
        L_DATE2 TYPE SY-DATUM,
        L_YEAR  TYPE CHAR4,
        L_MON   TYPE CHAR2,
        L_DAY   TYPE CHAR2,
        L_FYV   TYPE PERIV.
  DATA: LT_VBRK_TMP TYPE STANDARD TABLE OF TY_VBRK_CAN.

  L_FYV = 'V3'.

  L_DATE = SY-DATUM.

  CALL FUNCTION 'LAST_DAY_OF_MONTHS'
    EXPORTING
      DAY_IN            = L_DATE
    IMPORTING
      LAST_DAY_OF_MONTH = L_DATE1
    EXCEPTIONS
      DAY_IN_NO_DATE    = 1
      OTHERS            = 2.
  IF SY-SUBRC <> 0.
* MESSAGE ID SY-MSGID TYPE SY-MSGTY NUMBER SY-MSGNO
*         WITH SY-MSGV1 SY-MSGV2 SY-MSGV3 SY-MSGV4.
  ENDIF.

  L_YEAR = L_DATE1(4).
  L_MON = L_DATE1+4(2).
  L_DAY = '01'.

  CONCATENATE L_YEAR L_MON L_DAY INTO L_DATE2.




  DATA: ITAB_VBELN1 TYPE TABLE OF TYP_VBELN,
        WA_VBELN    TYPE TYP_VBELN.

  ASSIGN COMPONENT 'TYP' OF STRUCTURE <DYN_WA> TO <FS>.
  <FS> = 'F:'.
  ASSIGN COMPONENT 'NAM' OF STRUCTURE <DYN_WA> TO <FS>.
  <FS> = 'C/N, D/N'.
  APPEND <DYN_WA> TO <DYN_TABLE>.
  CLEAR <DYN_WA>.

  CALL FUNCTION 'GM_GET_FISCAL_YEAR'
    EXPORTING
      I_DATE = SY-DATUM
      I_FYV  = L_FYV
    IMPORTING
      E_FY   = L_YEAR1
* EXCEPTIONS
*     FISCAL_YEAR_DOES_NOT_EXIST       = 1
*     NOT_DEFINED_FOR_DATE             = 2
*     OTHERS = 3
    .
  IF SY-SUBRC <> 0.
* MESSAGE ID SY-MSGID TYPE SY-MSGTY NUMBER SY-MSGNO
*         WITH SY-MSGV1 SY-MSGV2 SY-MSGV3 SY-MSGV4.
  ENDIF.

  SELECT BELNR BLART AWKEY FROM BKPF INTO TABLE IT_BKPF
    WHERE BUKRS = P_BUKRS AND GJAHR = L_YEAR1 AND BUDAT BETWEEN L_DATE2
    AND L_DATE
  AND BLART IN ('IA','DG','DR','RV','DA','OP')
  AND  XREVERSAL EQ ' '.

  LOOP AT IT_BKPF INTO WA_BKPF.  "REMOVE ZFC 15.12.22
    SELECT SINGLE * FROM VBRK WHERE VBELN EQ WA_BKPF-AWKEY AND FKART EQ 'ZFC'.
    IF SY-SUBRC EQ 0.
      DELETE IT_BKPF WHERE BELNR EQ WA_BKPF-BELNR.
    ENDIF.
  ENDLOOP.


*for deleting cancelled document and cancellation of cancelled document
****code added by anbu on 16.2.2012 starts
  IF IT_BKPF IS NOT INITIAL.
    SELECT VBELN FKSTO SFAKN NETWR FROM VBRK INTO TABLE IT_VBRK_CAN
    FOR ALL ENTRIES IN IT_BKPF WHERE VBELN = IT_BKPF-AWKEY.
    IF IT_VBRK_CAN IS NOT INITIAL.
      SELECT VBELN, WERKS FROM VBRP
                FOR ALL ENTRIES IN @IT_VBRK_CAN
                    WHERE VBELN = @IT_VBRK_CAN-VBELN
                    INTO TABLE @DATA(IT_VBRP).
      SORT IT_VBRP BY VBELN.
    ENDIF.

* Temp data
    LT_VBRK_TMP = CORRESPONDING #( IT_VBRK_CAN ).
    SORT LT_VBRK_TMP BY VBELN.

    LOOP AT IT_VBRK_CAN INTO WA_VBRK_CAN.
      IF WA_VBRK_CAN-FKSTO = ' ' AND
         WA_VBRK_CAN-SFAKN = ' '.
        DELETE IT_VBRK_CAN. " from wa_vbrk_can.
        CLEAR WA_VBRK_CAN.
      ENDIF.
    ENDLOOP.

    SORT IT_BKPF BY AWKEY.

    SORT IT_VBRK_CAN BY VBELN.

    LOOP AT IT_BKPF INTO WA_BKPF1.
      READ TABLE IT_VBRK_CAN INTO WA_VBRK_CAN WITH KEY VBELN =
    WA_BKPF1-AWKEY BINARY SEARCH.
      IF SY-SUBRC = 0.
        DELETE IT_BKPF. " from wa_bkpf1.
      ENDIF.
      CLEAR : WA_BKPF1.
    ENDLOOP.

  ENDIF.
****code added by anbu on 16.2.2012 ends

  IT_BKPF1 = IT_BKPF.
  IT_BKPF2 = IT_BKPF.
  IT_BKPF3 = IT_BKPF.

  DELETE IT_BKPF1 WHERE BLART NE 'IA' AND BLART NE 'DG'.
  DELETE IT_BKPF2 WHERE BLART NE 'DR' AND BLART NE 'DA'.
  DELETE IT_BKPF3 WHERE BLART NE 'RV'.

  IF IT_BKPF3 IS NOT INITIAL.
    SELECT VBELN VBTYP FKSTO  FROM VBRK INTO TABLE IT_VBRK FOR ALL ENTRIES IN IT_BKPF3 WHERE VBELN = IT_BKPF3-AWKEY AND  VBTYP IN ('O','P').
  ENDIF.

  DELETE IT_VBRK WHERE FKSTO = 'X'.

*    IT_O = IT_VBRK.
*    IT_P = IT_VBRK.

  LOOP AT IT_VBRK INTO WA_VBRK.
    WA_O-VBELN = WA_VBRK-VBELN.
    WA_O-VBTYP = WA_VBRK-VBTYP.
    APPEND WA_O TO IT_O.
  ENDLOOP.

  LOOP AT IT_VBRK INTO WA_VBRK.
    WA_P-VBELN = WA_VBRK-VBELN.
    WA_P-VBTYP = WA_VBRK-VBTYP.
    APPEND WA_P TO IT_P.
  ENDLOOP.

  DELETE IT_O WHERE VBTYP NE 'O'.
  DELETE IT_P WHERE VBTYP NE 'P'.

  IF IT_O IS NOT INITIAL.
    SELECT BELNR BLART AWKEY FROM BKPF INTO TABLE IT_BKPF4 FOR ALL ENTRIES IN IT_O WHERE GJAHR = L_YEAR1 AND AWKEY =  IT_O-VBELN AND  XREVERSAL EQ ' '.
  ENDIF.

  IF IT_P IS NOT INITIAL.

    SELECT BELNR BLART AWKEY FROM BKPF INTO TABLE IT_BKPF5 FOR ALL ENTRIES IN IT_P WHERE GJAHR = L_YEAR1 AND AWKEY = IT_P-VBELN AND XREVERSAL EQ ' '.

  ENDIF.

  LOOP AT IT_BKPF4 INTO WA_BKPF4.
    MOVE WA_BKPF4 TO WA_BKPF1.
    APPEND WA_BKPF1 TO IT_BKPF1.
    CLEAR: WA_BKPF1, WA_BKPF4.
  ENDLOOP.

  LOOP AT IT_BKPF5 INTO WA_BKPF5.
    MOVE WA_BKPF5 TO WA_BKPF2.
    APPEND WA_BKPF2 TO IT_BKPF2.
    CLEAR: WA_BKPF2, WA_BKPF5.
  ENDLOOP.

  IF IT_BKPF1 IS NOT INITIAL.
***code commented by sathish.b to get credit note for proper fiscal year
*    SELECT BELNR GSBER BSCHL DMBTR FROM BSEG INTO TABLE IT_CRENOTE
*      FOR ALL ENTRIES IN IT_BKPF1 WHERE BELNR = IT_BKPF1-BELNR.
***code commented by sathish.b to get credit note for proper fiscal year

**Code added by sathish.B to get the credit note for proper fiscal year
    SELECT BELNR GJAHR GSBER BSCHL DMBTR KUNNR FROM BSEG INTO TABLE IT_CRENOTE
    FOR ALL ENTRIES IN IT_BKPF1 WHERE BELNR = IT_BKPF1-BELNR AND GJAHR  = L_YEAR1.
**Code added by sathish.B to get the credit note for proper fiscal year
  ENDIF.

  IF IT_BKPF2 IS NOT INITIAL.
    SELECT BELNR GJAHR GSBER BSCHL DMBTR KUNNR FROM BSEG INTO TABLE IT_DEBNOTE
    FOR ALL ENTRIES IN IT_BKPF2 WHERE BELNR = IT_BKPF2-BELNR AND GJAHR = L_YEAR1 AND SHKZG = 'S'.
  ENDIF.
*  Get the Debit/Credit notes for current day in closed items
*SELECT BUKRS KUNNR UMSKS UMSKZ AUGDT AUGBL  ZUONR GJAHR BELNR BUZEI
*BUDAT
*BLART BSCHL SHKZG GSBER DMBTR ZFBDT ZBD1T VBELN FROM BSAD INTO TABLE
*ITAB_NOTE WHERE
*BUKRS = P_BUKRS AND BUDAT BETWEEN L_DATE2 AND L_DATE AND BSCHL IN
*('01', '02', '11', '12')
*    AND GSBER IN R_GSBER.



*  Get the Debit/Credit notes for current day in open items
*LOOP AT ITAB_BSID ASSIGNING <FS_BSID> WHERE BUDAT BETWEEN L_DATE2 AND
*L_DATE AND
*( BSCHL EQ '01' OR BSCHL EQ '02' OR BSCHL EQ '11' OR BSCHL EQ '12' )
*    AND GSBER IN R_GSBER.
*    APPEND <FS_BSID> TO ITAB_NOTE.
*  ENDLOOP.
*
*  LOOP AT ITAB_NOTE ASSIGNING <FS_BSID> WHERE BSCHL = '12'.
*    WA_VBELN-VBELN = <FS_BSID>-VBELN.
*    APPEND WA_VBELN TO ITAB_VBELN1.
*    CLEAR WA_VBELN.
*  ENDLOOP.
*
*  IF ITAB_VBELN1 IS NOT INITIAL.
*    SELECT VBELN FROM VBRK INTO TABLE ITAB_VBELN FOR ALL ENTRIES IN
*      ITAB_VBELN1 WHERE VBELN = ITAB_VBELN1-VBELN AND FKART = 'S2'.
*  ENDIF.

*  CLEAR: ITAB_GSBER, WA_GSBER, W_NOS.
*LOOP AT ITAB_NOTE ASSIGNING <FS_BSID> WHERE BSCHL = '02' OR BSCHL =
*'11'.
*    WA_GSBER-GSBER = <FS_BSID>-GSBER.
*    WA_GSBER-DMBTR = <FS_BSID>-DMBTR.
*    IF <FS_BSID>-SHKZG = 'H'.
*      WA_GSBER-DMBTR = WA_GSBER-DMBTR.
*    ENDIF.
*    W_NOS = W_NOS + 1.
*    COLLECT WA_GSBER INTO ITAB_GSBER .
*    CLEAR WA_GSBER.
*  ENDLOOP.
  CLEAR: ITAB_GSBER, WA_GSBER, W_NOS.
*  DELETE ADJACENT DUPLICATES FROM IT_CRENOTE COMPARING BELNR.
  DELETE IT_CRENOTE WHERE BSCHL NE '11' AND BSCHL NE '02'.

*  ***********  delete cn of fb75 other than 29d

*  LOOP AT IT_CRENOTE INTO WA_CRENOTE.
  LOOP AT IT_CRENOTE ASSIGNING FIELD-SYMBOL(<F1>).
    WA_CRENOTE = <F1>.
    SELECT SINGLE * FROM BKPF WHERE BUKRS = GC_BUKRS AND  BELNR EQ  WA_CRENOTE-BELNR AND GJAHR EQ WA_CRENOTE-GJAHR AND TCODE EQ 'FB75'.
    IF SY-SUBRC EQ 0.
*      SELECT SINGLE * FROM BSEG WHERE BUKRS = GC_BUKRS AND  BELNR EQ  WA_CRENOTE-BELNR AND GJAHR EQ WA_CRENOTE-GJAHR AND KOSTL EQ '29D'.
      SELECT SINGLE * FROM BSEG WHERE BUKRS = P_BUKRS AND  BELNR EQ  WA_CRENOTE-BELNR AND GJAHR EQ WA_CRENOTE-GJAHR AND KOART = 'D'.
      IF SY-SUBRC EQ 4.
        DELETE IT_CRENOTE WHERE BELNR = WA_CRENOTE-BELNR AND GJAHR EQ WA_CRENOTE-GJAHR.
      ENDIF.
      <F1>-DMBTR = VALUE #( LT_VBRK_TMP[ VBELN = BKPF-AWKEY ]-NETWR OPTIONAL ).
    ENDIF.
    DATA(LWA_BKPF) = VALUE #( IT_BKPF[ BELNR = <F1>-BELNR ] OPTIONAL ).
    <F1>-GSBER = VALUE #( IT_VBRP[ VBELN = LWA_BKPF-AWKEY ]-WERKS OPTIONAL ).
    CLEAR: LWA_BKPF.

  ENDLOOP.
  UNASSIGN <F1>.

  LOOP AT IT_CRENOTE INTO WA_CRENOTE.

    READ TABLE ITAB_T134GO INTO WA_T134GO WITH KEY GSBER = WA_CRENOTE-GSBER.
    IF SY-SUBRC EQ 0.
      WA_CRENOTE-GSBER = 'OTH'.
    ENDIF.

    WA_GSBER-GSBER = WA_CRENOTE-GSBER.
    WA_GSBER-DMBTR = WA_CRENOTE-DMBTR.
*    W_NOS = W_NOS + 1.
    COLLECT WA_GSBER INTO ITAB_GSBER .
    CLEAR WA_GSBER.
  ENDLOOP.

  LOOP AT IT_CRENOTE INTO WA_CRENOTE.
    ASSIGN COMPONENT WA_CRENOTE-GSBER OF STRUCTURE <DYN_WA> TO <FS>.
    IF SY-SUBRC = 0.
      W_NOS = W_NOS + 1.
    ENDIF.
  ENDLOOP.
*LOOP AT ITAB_NOTE ASSIGNING <FS_BSID> WHERE BLART = 'AB' AND BSCHL =
*02.
*    WA_GSBER-GSBER = <FS_BSID>-GSBER.
*    WA_GSBER-DMBTR = <FS_BSID>-DMBTR.
*    IF <FS_BSID>-SHKZG = 'H'.
*      WA_GSBER-DMBTR = WA_GSBER-DMBTR * -1.
*    ENDIF.
*    W_NOS = W_NOS + 1.
*    COLLECT WA_GSBER INTO ITAB_GSBER .
*    CLEAR WA_GSBER.
*  ENDLOOP.

  PERFORM NOS USING W_NOS.
  PERFORM FINAL USING '1. Value of C/N'.

  CLEAR: ITAB_GSBER, WA_GSBER, W_NOS.
  CLEAR: ITAB_GSBER, WA_GSBER, W_NOS.
*  LOOP AT IT_DEBNOTE INTO WA_DEBNOTE.
  LOOP AT IT_DEBNOTE ASSIGNING FIELD-SYMBOL(<F2>).
    CLEAR: LWA_BKPF.
    LWA_BKPF = VALUE #( IT_BKPF[ BELNR = <F2>-BELNR ] OPTIONAL ).
    <F2>-GSBER = VALUE #( IT_VBRP[ VBELN = LWA_BKPF-AWKEY ]-WERKS OPTIONAL ).
    <F2>-DMBTR = VALUE #( LT_VBRK_TMP[ VBELN = LWA_BKPF-AWKEY ]-NETWR OPTIONAL ).
    CLEAR: LWA_BKPF.
    WA_DEBNOTE = <F2>.

    READ TABLE ITAB_T134GO INTO WA_T134GO WITH KEY GSBER = WA_DEBNOTE-GSBER.
    IF SY-SUBRC EQ 0.
      WA_DEBNOTE-GSBER = 'OTH'.
    ENDIF.
    WA_GSBER-GSBER = WA_DEBNOTE-GSBER.
    WA_GSBER-DMBTR = WA_DEBNOTE-DMBTR.
*    W_NOS = W_NOS + 1.
    COLLECT WA_GSBER INTO ITAB_GSBER .
    CLEAR WA_GSBER.
  ENDLOOP.
  UNASSIGN <F2>.

  LOOP AT IT_DEBNOTE INTO WA_DEBNOTE.
    ASSIGN COMPONENT WA_DEBNOTE-GSBER OF STRUCTURE <DYN_WA> TO <FS>.
    IF SY-SUBRC = 0.
      W_NOS = W_NOS + 1.
    ENDIF.
  ENDLOOP.

  PERFORM NOS USING W_NOS.
  PERFORM FINAL USING '2. Value of D/N'.
  CLEAR <DYN_WA>.

  APPEND <DYN_WA> TO <DYN_TABLE>.


ENDFORM.                    " NOTE
*&---------------------------------------------------------------------*
*&      Form  INIT
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM INIT .

  SELECT WERKS FROM T001W INTO TABLE ITAB_WERKS WHERE WERKS IN S_WERKS.

*  Selection of Business areas based on Plant
  IF ITAB_WERKS IS NOT INITIAL.
*    SELECT * FROM t134g INTO TABLE itab_t134g FOR ALL
*    ENTRIES IN itab_werks WHERE werks = itab_werks-werks AND spart EQ '10'.
    SELECT * FROM ZTB_T134G INTO TABLE ITAB_T134G FOR ALL
    ENTRIES IN ITAB_WERKS WHERE WERKS = ITAB_WERKS-WERKS AND SPART EQ '10'.
  ENDIF.

  ITAB_T134G1 = ITAB_T134G.

  SELECT WERKS FROM T001W INTO TABLE ITAB_WERKSO WHERE WERKS IN S_WERKS1.
  IF ITAB_WERKSO IS NOT INITIAL.
    SELECT * FROM ZTB_T134G INTO TABLE ITAB_T134GO FOR ALL ENTRIES IN ITAB_WERKSO WHERE WERKS = ITAB_WERKSO-WERKS AND SPART EQ '10'.
  ENDIF.

  SELECT WERKS FROM T001W INTO TABLE ITAB_WERKSP WHERE WERKS IN S_WERKS2.
  IF ITAB_WERKSP IS NOT INITIAL.
    SELECT * FROM ZTB_T134G INTO TABLE ITAB_T134GP FOR ALL ENTRIES IN ITAB_WERKSP WHERE WERKS = ITAB_WERKSP-WERKS.
  ENDIF.

*  select werks from t001w into table itab_werksi where werks in s_werks3.
*  if itab_werksi is not initial.
*    select * from t134g into table itab_t134gi for all entries in itab_werksi where werks = itab_werksi-werks.
*  endif.

  SORT ITAB_T134G1 BY GSBER.
  DELETE ADJACENT DUPLICATES FROM ITAB_T134G1 COMPARING GSBER.
  DELETE ITAB_T134G1 WHERE GSBER = 'MUM'.
  IF ITAB_T134G1 IS NOT INITIAL.
    SELECT * FROM TGSBT INTO TABLE ITAB_TGSBT
          FOR ALL ENTRIES IN ITAB_T134G1
            WHERE SPRAS = SY-LANGU
              AND GSBER = ITAB_T134G1-GSBER.
  ENDIF.

*  LOOP AT ITAB_TGSBT ASSIGNING <FS_TGSBT>.
  LOOP AT ITAB_T134G1 INTO DATA(LS_T134G1).
    R_WERKS-LOW = LS_T134G1-GSBER.
    R_WERKS-SIGN = 'I'.
    R_WERKS-OPTION = 'EQ'.
    APPEND R_WERKS.
    CLEAR R_WERKS.
  ENDLOOP.

  R_WERKS-LOW = 'MUM'.
  R_WERKS-SIGN = 'I'.
  R_WERKS-OPTION = 'EQ'.
  APPEND R_WERKS.
  CLEAR R_WERKS.

  PERFORM DYNAMIC.

  SORT ITAB_T134G BY WERKS SPART.

ENDFORM.                    " INIT
*&---------------------------------------------------------------------*
*&      Form  DYNAMIC
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM DYNAMIC .

*   For creating Dynamic Internal table based on Business Areas

  DATA: NEW_TABLE TYPE REF TO DATA,
        NEW_LINE  TYPE REF TO DATA.


  CLEAR WA_IT_FLDCAT.
  WA_IT_FLDCAT-FIELDNAME = 'TYP'.
  WA_IT_FLDCAT-DATATYPE = 'CHAR'.
  WA_IT_FLDCAT-INTLEN = 2.
  WA_IT_FLDCAT-KEY = 'X'.
  APPEND WA_IT_FLDCAT TO IT_FLDCAT .

  CLEAR WA_IT_FLDCAT.
  WA_IT_FLDCAT-FIELDNAME = 'NAM'.
  WA_IT_FLDCAT-DATATYPE = 'CHAR'.
  WA_IT_FLDCAT-INTLEN = 30.
  WA_IT_FLDCAT-KEY = 'X'.
  APPEND WA_IT_FLDCAT TO IT_FLDCAT .

  C = 1.
  LOOP AT ITAB_T134G1 INTO WA_T134G.
    IF C EQ 1.
      WA_T134G-GSBER = 'NEP'.
      APPEND WA_T134G TO ITAB_T134G1.
      CLEAR WA_T134G.
    ENDIF.
    C = C + 1.
  ENDLOOP.

  C = 1.
  LOOP AT ITAB_T134GO INTO WA_T134GO.
    IF C EQ 1.
      WA_T134G-GSBER = 'OTH'.
      APPEND WA_T134G TO ITAB_T134G1.
      CLEAR WA_T134G.
    ENDIF.
    C = C + 1.
  ENDLOOP.

  LOOP AT ITAB_T134G1 ASSIGNING <FS_T134G>.
    READ TABLE ITAB_T134GO INTO WA_T134GO WITH KEY GSBER = <FS_T134G>-GSBER.
    IF SY-SUBRC EQ 4.
      CLEAR WA_IT_FLDCAT.
      CASE <FS_T134G>-GSBER.
        WHEN 'MUM'.
          WA_IT_FLDCAT-FIELDNAME = <FS_T134G>-GSBER.
*    READ TABLE ITAB_TGSBT ASSIGNING <FS_TGSBT> WITH KEY
*    GSBER = <FS_T134G>-GSBER.
*    IF SY-SUBRC = 0.
*      FIND '-' IN <FS_TGSBT>-GTEXT MATCH OFFSET MOFF.
*      WA_IT_FLDCAT-SELTEXT = <FS_TGSBT>-GTEXT(MOFF).
*    ENDIF.
          WA_IT_FLDCAT-SELTEXT = <FS_T134G>-GSBER.
          WA_IT_FLDCAT-DATATYPE = 'CURR'.
          WA_IT_FLDCAT-INTLEN = 13.
          WA_IT_FLDCAT-DECIMALS = 2.
          WA_IT_FLDCAT-NO_OUT = 'X'.
          APPEND WA_IT_FLDCAT TO IT_FLDCAT .
        WHEN OTHERS.
          WA_IT_FLDCAT-FIELDNAME = <FS_T134G>-GSBER.
          WA_IT_FLDCAT-SELTEXT = <FS_T134G>-GSBER.
          WA_IT_FLDCAT-DATATYPE = 'CURR'.
          WA_IT_FLDCAT-INTLEN = 13.
          WA_IT_FLDCAT-DECIMALS = 2.
          WA_IT_FLDCAT-NO_OUT = ' '.
          APPEND WA_IT_FLDCAT TO IT_FLDCAT .
      ENDCASE.
    ENDIF.
  ENDLOOP.

*  clear wa_it_fldcat.
*  wa_it_fldcat-fieldname = 'NOS'.
*  wa_it_fldcat-seltext = 'Nos'.
*  wa_it_fldcat-datatype = 'NUMC'.
*  wa_it_fldcat-intlen = 5.
*  append wa_it_fldcat to it_fldcat .

  CLEAR WA_IT_FLDCAT.
  WA_IT_FLDCAT-FIELDNAME = 'TOTAL'.
  WA_IT_FLDCAT-SELTEXT = 'Total'.
  WA_IT_FLDCAT-DATATYPE = 'CURR'.
  WA_IT_FLDCAT-INTLEN = 13.
  WA_IT_FLDCAT-DECIMALS = 2.
  APPEND WA_IT_FLDCAT TO IT_FLDCAT .

  CALL METHOD CL_ALV_TABLE_CREATE=>CREATE_DYNAMIC_TABLE
    EXPORTING
      IT_FIELDCATALOG           = IT_FLDCAT
    IMPORTING
      EP_TABLE                  = NEW_TABLE
    EXCEPTIONS
      GENERATE_SUBPOOL_DIR_FULL = 1
      OTHERS                    = 2.
  IF SY-SUBRC <> 0.
    MESSAGE ID SY-MSGID TYPE SY-MSGTY NUMBER SY-MSGNO
               WITH SY-MSGV1 SY-MSGV2 SY-MSGV3 SY-MSGV4.
  ENDIF.

  ASSIGN NEW_TABLE->* TO <DYN_TABLE>.

  CREATE DATA NEW_LINE LIKE LINE OF <DYN_TABLE>.
  ASSIGN NEW_LINE->* TO <DYN_WA>.

ENDFORM.                    " DYNAMIC
*&---------------------------------------------------------------------*
*&      Form  ALV
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM ALV .

*  type-pools: slis.
*
*  data: alv_fldcat type slis_t_fieldcat_alv,
*        wa_fld like line of alv_fldcat,
*        alv_layout type  slis_layout_alv,
*        wa_it_listheader type slis_listheader,
*        it_listheader type slis_t_listheader,
*        wa_events type slis_alv_event,
*        it_events type slis_t_event.

  LOOP AT IT_FLDCAT INTO WA_IT_FLDCAT.
    WA_FLD-FIELDNAME = WA_IT_FLDCAT-FIELDNAME.
    WA_FLD-SELTEXT_L = WA_IT_FLDCAT-SELTEXT.
    WA_FLD-INTLEN = WA_IT_FLDCAT-INTLEN.
    WA_FLD-INTLEN = WA_IT_FLDCAT-DATATYPE.
    WA_FLD-INTLEN = WA_IT_FLDCAT-DECIMALS.
    WA_FLD-KEY = WA_IT_FLDCAT-KEY.
    WA_FLD-NO_ZERO = 'X'.
    WA_FLD-NO_OUT = WA_IT_FLDCAT-NO_OUT.
    IF P_DIV = 'X'.
      WA_FLD-DECIMALS_OUT = '0'.
    ENDIF.
    APPEND WA_FLD TO ALV_FLDCAT.
  ENDLOOP.

  ALV_LAYOUT-WINDOW_TITLEBAR = 'IR1'.
  ALV_LAYOUT-COLWIDTH_OPTIMIZE = 'X'.
  ALV_LAYOUT-ZEBRA = 'X'.

  WA_EVENTS-NAME = SLIS_EV_END_OF_LIST.
  WA_EVENTS-FORM = 'END_OF_LIST'.
  APPEND WA_EVENTS  TO IT_EVENTS.
  CLEAR WA_EVENTS .

  CALL FUNCTION 'REUSE_ALV_GRID_DISPLAY'
    EXPORTING
      I_CALLBACK_PROGRAM      = G_REPID
*     I_CALLBACK_PF_STATUS_SET          = ' '
      I_CALLBACK_USER_COMMAND = 'USER_COMMAND'
      I_CALLBACK_TOP_OF_PAGE  = 'TOP_OF_LIST'
      IS_LAYOUT               = ALV_LAYOUT
      IT_FIELDCAT             = ALV_FLDCAT
      I_DEFAULT               = 'X'
      I_SAVE                  = 'A'
      IT_EVENTS               = IT_EVENTS
    TABLES
      T_OUTTAB                = <DYN_TABLE>
    EXCEPTIONS
      PROGRAM_ERROR           = 1
      OTHERS                  = 2.
  IF SY-SUBRC <> 0.
    MESSAGE ID SY-MSGID TYPE SY-MSGTY NUMBER SY-MSGNO
            WITH SY-MSGV1 SY-MSGV2 SY-MSGV3 SY-MSGV4.
  ENDIF.

ENDFORM.                    " ALV
*&---------------------------------------------------------------------*
*&      Form  PENDING
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM PENDING .

  DATA: ITAB_KUNNR  TYPE TABLE OF TYP_KUNNR,
        WA_KUNNR    TYPE TYP_KUNNR,
        ITAB_VBELN  TYPE TABLE OF TYP_VBELN,
        WA_VBELN    TYPE TYP_VBELN,
        WA_VALUE    TYPE DMBTR,
        L_DATE      TYPE SY-DATUM,
        L_DATE1     TYPE SY-DATUM,
        L_YEAR      TYPE CHAR4,
        L_MON       TYPE CHAR2,
        L_DAY       TYPE CHAR2,
        ITAB_GSBER1 TYPE TABLE OF TYP_GSBER, " Credit Limit
        ITAB_GSBER2 TYPE TABLE OF TYP_GSBER,
        ITAB_GSBER3 TYPE TABLE OF TYP_GSBER,
        ITAB_GSBER4 TYPE TABLE OF TYP_GSBER,
        WA_OPEN     TYPE TYP_YSDIR1.

  L_DATE = SY-DATUM.
  L_DATE1 = L_DATE.
  L_YEAR = L_DATE1(4).
  L_MON = L_DATE1+4(2).
  L_DAY = '01'.
  CLEAR L_DATE1.
  CONCATENATE L_YEAR L_MON L_DAY INTO L_DATE1.

  R_AUDAT-SIGN = 'I'.
  R_AUDAT-OPTION = 'BT'.
  R_AUDAT-LOW = L_DATE1.
  R_AUDAT-HIGH = L_DATE.
  APPEND R_AUDAT.

  ASSIGN COMPONENT 'TYP' OF STRUCTURE <DYN_WA> TO <FS>.
  <FS> = 'C:'.
  ASSIGN COMPONENT 'NAM' OF STRUCTURE <DYN_WA> TO <FS>.
  <FS> = 'Pending Orders'.
  APPEND <DYN_WA> TO <DYN_TABLE>.
  CLEAR <DYN_WA>.

*  All the open orders
  SELECT VBELN VBELN_1 POSNR VBELN_2 VBELN_3 POSNR_3 GBSTK CMGST
    SPSTG LFSTA GBSTA KUNNR MATNR NETWR WAERK KWMENG VRKME WERKS
    FROM YSDIR1 INTO TABLE ITAB_OPEN WHERE AUDAT IN R_AUDAT AND VBTYP = 'C'
      AND AUART IN ('ZBDO','ZCDO')
*      AND GSBER IN R_GSBER.
      AND WERKS IN R_WERKS.
  IF SY-SUBRC = 0.
    SORT ITAB_OPEN BY VBELN.
  ENDIF.
  LOOP AT ITAB_OPEN INTO WA_OPEN.
    WA_OPEN-NETVALUE = WA_OPEN-NETWR / WA_OPEN-KWMENG.
    MODIFY ITAB_OPEN FROM WA_OPEN TRANSPORTING NETVALUE.
    CLEAR WA_OPEN.
  ENDLOOP.

*  Collect partially delivered orders
  LOOP AT ITAB_OPEN ASSIGNING <FS_YSDIR1> WHERE LFSTA = 'B'.
    WA_VBELN-VBELN = <FS_YSDIR1>-VBELN.
    WA_VBELN-POSNR = <FS_YSDIR1>-POSNR.
    APPEND WA_VBELN TO ITAB_VBELN.
  ENDLOOP.

  IF ITAB_VBELN IS NOT INITIAL.
*    Get the partial delivered quantity
    SELECT VBELV POSNV VBELN POSNN VBTYP_N RFMNG MEINS FROM VBFA
      INTO TABLE ITAB_VBFA FOR ALL ENTRIES IN ITAB_VBELN WHERE
    VBELV = ITAB_VBELN-VBELN AND POSNV = ITAB_VBELN-POSNR
    AND VBTYP_N = 'J'.
  ENDIF.

  DELETE ITAB_VBFA WHERE RFMNG IS INITIAL.

  LOOP AT ITAB_OPEN ASSIGNING <FS_YSDIR1>.
    SELECT SINGLE * FROM ZPENEXCLUDE WHERE MATNR EQ <FS_YSDIR1>-MATNR.
    IF SY-SUBRC EQ 0.
      <FS_YSDIR1>-KWMENG = 0.
      <FS_YSDIR1>-NETVALUE = 0.
    ENDIF.

    READ TABLE ITAB_VBFA INTO WA_VBFA WITH KEY VBELV = <FS_YSDIR1>-VBELN POSNV = <FS_YSDIR1>-POSNR BINARY SEARCH.
    IF SY-SUBRC = 0.
      <FS_YSDIR1>-KWMENG = <FS_YSDIR1>-KWMENG - WA_VBFA-RFMNG.
      MODIFY ITAB_OPEN FROM <FS_YSDIR1> TRANSPORTING KWMENG.
    ENDIF.
  ENDLOOP.

  SORT ITAB_OPEN BY MATNR.

  IF ITAB_OPEN IS NOT INITIAL.
    SELECT MATNR WERKS LABST FROM MARD INTO TABLE IT_MARD FOR ALL ENTRIES IN ITAB_OPEN WHERE MATNR  = ITAB_OPEN-MATNR AND  WERKS =   ITAB_OPEN-WERKS.
    IF SY-SUBRC = 0.
      SORT IT_MARD BY MATNR.
    ENDIF.
  ENDIF.

  LOOP AT IT_MARD INTO WA_MARD.
    SELECT SINGLE * FROM ZPENEXCLUDE WHERE MATNR EQ WA_MARD-MATNR.
    IF SY-SUBRC EQ 0.
      WA_MARD-LABST = 0.
    ENDIF.
    WA_MARD1-MATNR = WA_MARD-MATNR.
    WA_MARD1-WERKS = WA_MARD-WERKS.
    WA_MARD1-LABST = WA_MARD-LABST.
    COLLECT WA_MARD1 INTO IT_MARD1.
    CLEAR WA_MARD1.
  ENDLOOP.

  SORT IT_MARD1 BY MATNR.

  LOOP AT IT_MARD1 INTO WA_MARD1.
    LOOP AT ITAB_OPEN ASSIGNING <FS_YSDIR1> WHERE MATNR = WA_MARD1-MATNR AND   WERKS = WA_MARD1-WERKS.
      IF WA_MARD1-LABST > <FS_YSDIR1>-KWMENG.

        SELECT SINGLE * FROM ZPENEXCLUDE WHERE MATNR EQ <FS_YSDIR1>-MATNR.
        IF SY-SUBRC EQ 0.
          <FS_YSDIR1>-KWMENG = 0.
          <FS_YSDIR1>-NETVALUE = 0.
          <FS_YSDIR1>-NETWR = 0.
        ENDIF.

        WA_MARD1-LABST = WA_MARD1-LABST - <FS_YSDIR1>-KWMENG.
        MOVE-CORRESPONDING <FS_YSDIR1> TO WA_OPEN.
        APPEND WA_OPEN TO ITAB_OPEN1.
        DELETE ITAB_OPEN.
      ELSE.

        SELECT SINGLE * FROM ZPENEXCLUDE WHERE MATNR EQ <FS_YSDIR1>-MATNR.
        IF SY-SUBRC EQ 0.
          <FS_YSDIR1>-KWMENG = 0.
          <FS_YSDIR1>-NETVALUE = 0.
          <FS_YSDIR1>-NETWR = 0.
        ENDIF.

        <FS_YSDIR1>-KWMENG = <FS_YSDIR1>-KWMENG - WA_MARD1-LABST.
        <FS_YSDIR1>-NETVALUE = <FS_YSDIR1>-NETVALUE *
        <FS_YSDIR1>-KWMENG.
        READ TABLE ITAB_T134GO INTO WA_T134GO WITH KEY GSBER = <FS_YSDIR1>-WERKS.
        IF SY-SUBRC EQ 0.
          <FS_YSDIR1>-WERKS = 'OTH'.
        ENDIF.
        WA_GSBER-GSBER = <FS_YSDIR1>-WERKS.
        WA_GSBER-DMBTR = <FS_YSDIR1>-NETVALUE.
        COLLECT WA_GSBER INTO ITAB_GSBER1 .
      ENDIF.
    ENDLOOP.
  ENDLOOP.

*  Get the customer open items
  SELECT BUKRS KUNNR UMSKS UMSKZ AUGDT AUGBL ZUONR GJAHR BELNR BUZEI BUDAT BLART BSCHL SHKZG GSBER DMBTR ZFBDT ZBD1T VBELN
  FROM BSID INTO TABLE ITAB_BSID WHERE BUKRS = P_BUKRS AND   SHKZG = 'S'.

  IF ITAB_BSID IS NOT INITIAL.
    DATA: LT_BSID TYPE STANDARD TABLE OF TYP_BSID.
    LT_BSID = CORRESPONDING #( ITAB_BSID ).
    SORT LT_BSID BY BUKRS GJAHR BELNR BUZEI.
    SELECT RBUKRS, GJAHR, BELNR, BUZEI, PRCTR
       FROM ACDOCA FOR ALL ENTRIES IN @LT_BSID
         WHERE RLDNR = '0L'
           AND RBUKRS = @LT_BSID-BUKRS
           AND GJAHR = @LT_BSID-GJAHR
           AND BELNR = @LT_BSID-BELNR
           AND BUZEI = @LT_BSID-BUZEI
         INTO TABLE @DATA(IT_ACD).
    SORT IT_ACD BY RBUKRS GJAHR BELNR BUZEI.
  ENDIF.

  DATA: G_DATE TYPE SY-DATUM.

  SORT ITAB_BSID BY KUNNR.

  IF ITAB_BSID IS NOT INITIAL.

    SELECT KUNNR KDGRP FROM KNVV INTO TABLE ITAB_KNVV FOR ALL ENTRIES IN ITAB_BSID WHERE KUNNR = ITAB_BSID-KUNNR  AND  VKORG = '1000'
    AND  VTWEG = '10' AND  SPART = '50'.
    IF SY-SUBRC = 0.
      SORT ITAB_KNVV BY KUNNR.
    ENDIF.
  ENDIF.

*  Collect the customers who are over due
  DATA: LV_PRCTR TYPE PRCTR.
  LOOP AT ITAB_BSID ASSIGNING <FS_BSID>.
    CLEAR: LV_PRCTR.
    LV_PRCTR = VALUE #( IT_ACD[ RBUKRS = <FS_BSID>-BUKRS
                                GJAHR  = <FS_BSID>-GJAHR
                                BELNR  = <FS_BSID>-BELNR
                                BUZEI  = <FS_BSID>-BUZEI ]-PRCTR OPTIONAL  ).
    <FS_BSID>-GSBER = LV_PRCTR+6(4).

*    Calculation of Due Date
    NO = <FS_BSID>-ZBD1T.
    READ TABLE ITAB_KNVV INTO WA_KNVV WITH KEY KUNNR = <FS_BSID>-KUNNR.
    CALL FUNCTION 'RP_CALC_DATE_IN_INTERVAL'
      EXPORTING
        DATE      = <FS_BSID>-ZFBDT
        DAYS      = NO
        MONTHS    = NO1
        YEARS     = NO1
      IMPORTING
        CALC_DATE = <FS_BSID>-ZFBDT. "Due date

    IF WA_KNVV-KDGRP = '01'.
      G_DATE = <FS_BSID>-ZFBDT + 3.
    ELSE.
      G_DATE = <FS_BSID>-ZFBDT + 10.
    ENDIF.
    IF G_DATE < SY-DATUM.
      WA_KUNNR-KUNNR = <FS_BSID>-KUNNR.
      APPEND WA_KUNNR TO ITAB_KUNNR.
    ENDIF.
  ENDLOOP.

  SORT ITAB_KUNNR BY KUNNR.
  DELETE ADJACENT DUPLICATES FROM ITAB_KUNNR COMPARING KUNNR.

  IF ITAB_KUNNR IS NOT INITIAL.
    CLEAR: WA_GSBER.
    LOOP AT ITAB_OPEN1 ASSIGNING <FS_YSDIR1>.
      READ TABLE ITAB_KUNNR INTO WA_KUNNR WITH KEY KUNNR = <FS_YSDIR1>-KUNNR BINARY SEARCH.
      IF SY-SUBRC = 0.
        SELECT SINGLE * FROM ZPENEXCLUDE WHERE MATNR EQ <FS_YSDIR1>-MATNR.
        IF SY-SUBRC EQ 0.
          <FS_YSDIR1>-KWMENG = 0.
          <FS_YSDIR1>-NETVALUE = 0.
          <FS_YSDIR1>-NETWR = 0.
        ENDIF.
        <FS_YSDIR1>-NETVALUE = <FS_YSDIR1>-NETVALUE * <FS_YSDIR1>-KWMENG.
        READ TABLE ITAB_T134GO INTO WA_T134GO WITH KEY GSBER = <FS_YSDIR1>-WERKS.
        IF SY-SUBRC EQ 0.
          <FS_YSDIR1>-WERKS = 'OTH'.
        ENDIF.
        WA_GSBER-GSBER = <FS_YSDIR1>-WERKS.
        WA_GSBER-DMBTR = <FS_YSDIR1>-NETVALUE.
        MOVE-CORRESPONDING <FS_YSDIR1> TO WA_OPEN.
        WA_OPEN-NETWR = <FS_YSDIR1>-NETVALUE.
        APPEND WA_OPEN TO ITAB_OPEN2.
        COLLECT WA_GSBER INTO ITAB_GSBER2 .
        CLEAR: WA_GSBER, WA_OPEN.
        DELETE ITAB_OPEN1.
      ENDIF.
    ENDLOOP.
  ENDIF.

  IF ITAB_OPEN1 IS NOT INITIAL.
*    SELECT KUNNR KLIMK SKFOR FROM KNKK INTO TABLE IT_KNKK FOR ALL ENTRIES IN ITAB_OPEN1 WHERE KUNNR = ITAB_OPEN1-KUNNR.
    SELECT FROM UKMBP_CMS_SGM AS A
      FIELDS
      A~PARTNER AS KUNNR,
      A~CREDIT_LIMIT,
      A~CRED_LIM_CALC
      FOR ALL ENTRIES IN @ITAB_OPEN1
      WHERE A~PARTNER = @ITAB_OPEN1-KUNNR
        AND A~CREDIT_SGMNT = '1000'
      INTO TABLE @DATA(LT_CRSGT).
    SORT LT_CRSGT BY KUNNR.
  ENDIF.

*  LOOP AT IT_KNKK INTO WA_KNKK.
*    IF WA_KNKK-SKFOR > WA_KNKK-KLIMK.
*      WA_CUST-KUNNR = WA_KNKK-KUNNR.
*      APPEND WA_CUST TO IT_CUST.
*    ENDIF.
*    CLEAR: WA_CUST,WA_KNKK.
*  ENDLOOP.
  LOOP AT LT_CRSGT INTO DATA(LWA_CRSGT).
    IF LWA_CRSGT-CRED_LIM_CALC > LWA_CRSGT-CREDIT_LIMIT.
      WA_CUST-KUNNR = LWA_CRSGT-KUNNR.
      APPEND WA_CUST TO IT_CUST.
    ENDIF.
    CLEAR: WA_CUST,LWA_CRSGT.
  ENDLOOP.
  IF IT_CUST IS NOT INITIAL.
    SELECT VBELN VBELN_1 POSNR VBELN_2 VBELN_3 POSNR_3 GBSTK CMGST
    SPSTG LFSTA GBSTA KUNNR MATNR NETWR WAERK KWMENG VRKME WERKS
    FROM
    YSDIR1 INTO TABLE ITAB_CREDIT FOR ALL ENTRIES IN IT_CUST WHERE KUNNR
    = IT_CUST-KUNNR.
    IF SY-SUBRC = 0.
      SORT ITAB_CREDIT BY VBELN.
    ENDIF.
  ENDIF.

*  Calcualte Credit Limit order value
  CLEAR: WA_GSBER.
  LOOP AT ITAB_OPEN1 ASSIGNING <FS_YSDIR1>.
    READ TABLE ITAB_CREDIT INTO WA_CREDIT WITH KEY VBELN = <FS_YSDIR1>-VBELN BINARY SEARCH.
    IF SY-SUBRC = 0.
      SELECT SINGLE * FROM ZPENEXCLUDE WHERE MATNR EQ <FS_YSDIR1>-MATNR.
      IF SY-SUBRC EQ 0.
        <FS_YSDIR1>-KWMENG = 0.
        <FS_YSDIR1>-NETVALUE = 0.
        <FS_YSDIR1>-NETWR = 0.
      ENDIF.
      <FS_YSDIR1>-NETVALUE = <FS_YSDIR1>-NETVALUE * <FS_YSDIR1>-KWMENG.
      READ TABLE ITAB_T134GO INTO WA_T134GO WITH KEY GSBER = <FS_YSDIR1>-WERKS.
      IF SY-SUBRC EQ 0.
        <FS_YSDIR1>-WERKS = 'OTH'.
      ENDIF.
      WA_GSBER-GSBER = <FS_YSDIR1>-WERKS.
      WA_GSBER-DMBTR = <FS_YSDIR1>-NETVALUE.
      MOVE-CORRESPONDING <FS_YSDIR1> TO WA_OPEN.
      APPEND WA_OPEN TO ITAB_OPEN3.
      COLLECT WA_GSBER INTO ITAB_GSBER3.
      CLEAR: WA_GSBER, WA_OPEN,WA_CREDIT.
      DELETE ITAB_OPEN1.
    ENDIF.
  ENDLOOP.

**Calculating Other Reasons
  CLEAR: WA_GSBER.
  LOOP AT ITAB_OPEN1 ASSIGNING <FS_YSDIR1>.
    SELECT SINGLE * FROM ZPENEXCLUDE WHERE MATNR EQ <FS_YSDIR1>-MATNR.
    IF SY-SUBRC EQ 0.
      <FS_YSDIR1>-KWMENG = 0.
      <FS_YSDIR1>-NETVALUE = 0.
      <FS_YSDIR1>-NETWR = 0.
    ENDIF.
    <FS_YSDIR1>-NETVALUE = <FS_YSDIR1>-NETVALUE * <FS_YSDIR1>-KWMENG.
    READ TABLE ITAB_T134GO INTO WA_T134GO WITH KEY GSBER = <FS_YSDIR1>-WERKS.
    IF SY-SUBRC EQ 0.
      <FS_YSDIR1>-WERKS = 'OTH'.
    ENDIF.
    WA_GSBER-GSBER = <FS_YSDIR1>-WERKS.
    WA_GSBER-DMBTR = <FS_YSDIR1>-NETVALUE.
    MOVE-CORRESPONDING <FS_YSDIR1> TO WA_OPEN.
    APPEND WA_OPEN TO ITAB_OPEN4.
    COLLECT WA_GSBER INTO ITAB_GSBER4.
    CLEAR: WA_GSBER, WA_OPEN,WA_CREDIT.
    DELETE ITAB_OPEN1.
  ENDLOOP.

  CLEAR: ITAB_GSBER, WA_GSBER.
  ITAB_GSBER = ITAB_GSBER1.
  PERFORM FINAL USING 'Prod. Pending '.

  CLEAR: ITAB_GSBER, WA_GSBER.
  ITAB_GSBER = ITAB_GSBER2.
  PERFORM FINAL USING 'Over Dues'.

  CLEAR: ITAB_GSBER, WA_GSBER.
  ITAB_GSBER = ITAB_GSBER3.
  PERFORM FINAL USING 'CreditLimit'.

  CLEAR: ITAB_GSBER, WA_GSBER.
  ITAB_GSBER = ITAB_GSBER4.
  PERFORM FINAL USING 'Other Reasons'.

  CLEAR: ITAB_GSBER, WA_GSBER.
  LOOP AT ITAB_GSBER1 INTO WA_GSBER.
    COLLECT WA_GSBER INTO ITAB_GSBER.
    CLEAR WA_GSBER.
  ENDLOOP.
  LOOP AT ITAB_GSBER2 INTO WA_GSBER.
    COLLECT WA_GSBER INTO ITAB_GSBER.
    CLEAR WA_GSBER.
  ENDLOOP.
  LOOP AT ITAB_GSBER3 INTO WA_GSBER.
    COLLECT WA_GSBER INTO ITAB_GSBER.
    CLEAR WA_GSBER.
  ENDLOOP.
  LOOP AT ITAB_GSBER4 INTO WA_GSBER.
    COLLECT WA_GSBER INTO ITAB_GSBER.
    CLEAR WA_GSBER.
  ENDLOOP.
  PERFORM FINAL USING 'Total Pending Orders'.





ENDFORM.                    " PENDING
*&---------------------------------------------------------------------*
*&      Form  OPEN_VALUE
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*      <--P_WA_VALUE  text
*----------------------------------------------------------------------*
FORM OPEN_VALUE  CHANGING P_WA_VALUE.

*  Calculate Open order value considering partial deliveries

  DATA: WA_MENGE TYPE MENGE_D.

  CLEAR: P_WA_VALUE, WA_MENGE.
  IF <FS_YSDIR1>-LFSTA = 'B'. " Partial delivery
    LOOP AT ITAB_VBFA ASSIGNING <FS_VBFA> WHERE VBELV =
    <FS_YSDIR1>-VBELN
      AND POSNV = <FS_YSDIR1>-POSNR.
      WA_MENGE = WA_MENGE + <FS_VBFA>-RFMNG.
    ENDLOOP.
    P_WA_VALUE = WA_MENGE * <FS_YSDIR1>-NETWR.
    P_WA_VALUE = P_WA_VALUE / <FS_YSDIR1>-KWMENG.
  ELSE.
    P_WA_VALUE = <FS_YSDIR1>-NETWR.
  ENDIF.

ENDFORM.                    " OPEN_VALUE
*&---------------------------------------------------------------------*
*&      Form  DIVD
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM DIVD .

  LOOP AT <DYN_TABLE> ASSIGNING <DYN_WA>.
    LOOP AT ITAB_T134G1 ASSIGNING <FS_T134G>.
      ASSIGN COMPONENT <FS_T134G>-GSBER OF STRUCTURE <DYN_WA> TO <FS>.
      IF SY-SUBRC = 0.
        <FS> = <FS> / 1000.
        CALL FUNCTION 'ROUND'
          EXPORTING
            INPUT         = <FS>
            SIGN          = 'X'
          IMPORTING
            OUTPUT        = <FS>
          EXCEPTIONS
            INPUT_INVALID = 1
            OVERFLOW      = 2
            TYPE_INVALID  = 3
            OTHERS        = 4.
        IF SY-SUBRC <> 0.
          MESSAGE ID SY-MSGID TYPE SY-MSGTY NUMBER SY-MSGNO
                  WITH SY-MSGV1 SY-MSGV2 SY-MSGV3 SY-MSGV4.
        ENDIF.
      ENDIF.
    ENDLOOP.
    ASSIGN COMPONENT 'TOTAL' OF STRUCTURE <DYN_WA> TO <FS>.
    IF SY-SUBRC = 0.
      <FS> = <FS> / 1000.
      CALL FUNCTION 'ROUND'
        EXPORTING
          INPUT         = <FS>
          SIGN          = 'X'
        IMPORTING
          OUTPUT        = <FS>
        EXCEPTIONS
          INPUT_INVALID = 1
          OVERFLOW      = 2
          TYPE_INVALID  = 3
          OTHERS        = 4.
      IF SY-SUBRC <> 0.
        MESSAGE ID SY-MSGID TYPE SY-MSGTY NUMBER SY-MSGNO
                WITH SY-MSGV1 SY-MSGV2 SY-MSGV3 SY-MSGV4.
      ENDIF.
    ENDIF.
  ENDLOOP.

  LOOP AT ITAB_PLNTSTK INTO WA_PLNTSTK.
    WA_PLNTSTK-NETWR = WA_PLNTSTK-NETWR / 1000.
    CALL FUNCTION 'ROUND'
      EXPORTING
        INPUT         = WA_PLNTSTK-NETWR
        SIGN          = 'X'
      IMPORTING
        OUTPUT        = WA_PLNTSTK-NETWR
      EXCEPTIONS
        INPUT_INVALID = 1
        OVERFLOW      = 2
        TYPE_INVALID  = 3
        OTHERS        = 4.
    IF SY-SUBRC <> 0.
      MESSAGE ID SY-MSGID TYPE SY-MSGTY NUMBER SY-MSGNO
              WITH SY-MSGV1 SY-MSGV2 SY-MSGV3 SY-MSGV4.
    ENDIF.
    MODIFY ITAB_PLNTSTK FROM WA_PLNTSTK.
    CLEAR WA_PLNTSTK.
  ENDLOOP.

ENDFORM.                    " DIVD

*&---------------------------------------------------------------------*
*&      Form  END_OF_LIST
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
FORM END_OF_LIST.

  DATA: LIST        TYPE SLIS_T_LISTHEADER,
        W_LIST      LIKE LINE OF LIST,
        W_VAL       TYPE NETWR,
        W_VALUE(15) TYPE C,
        WA_LN1      TYPE I,
        WA_LN2      TYPE I,
        WA_CNC(60)  TYPE C.

  W_LIST-TYP = 'A'.

  DESCRIBE TABLE ITAB_PLNTSTK.
  IF SY-TFILL > 0.
    W_LIST-INFO = 'Stock Value :'.
    CLEAR W_VAL.
    LOOP AT ITAB_PLNTSTK INTO WA_PLNTSTK.
      READ TABLE ITAB_PLNT_NAM ASSIGNING <FS_PLNT_NAM> WITH KEY WERKS = WA_PLNTSTK.
      IF SY-SUBRC = 0.
        W_VALUE = WA_PLNTSTK-NETWR.
        W_VAL = W_VAL + WA_PLNTSTK-NETWR.

        CLEAR: WA_LN1, WA_LN2, WA_CNC.

        IF WA_PLNTSTK-WERKS EQ '2002'.
          <FS_PLNT_NAM>-KUNNR = 'OZH1'.
        ENDIF.
        IF WA_PLNTSTK-WERKS EQ '2027'.
          <FS_PLNT_NAM>-KUNNR = 'OZH2'.
        ENDIF.

        CONCATENATE <FS_PLNT_NAM>-KUNNR '=' W_VALUE INTO
        WA_CNC SEPARATED BY SPACE.
        WA_LN1 = STRLEN( W_LIST-INFO ).
        WA_LN2 = STRLEN( WA_CNC ).
        WA_LN1 = WA_LN1 + WA_LN2 + 1.
        IF WA_LN1 > 60.
          APPEND W_LIST TO LIST.
          CLEAR W_LIST-INFO.
        ENDIF.
        CONCATENATE W_LIST-INFO WA_CNC INTO W_LIST-INFO SEPARATED BY
        SPACE.
      ENDIF.
    ENDLOOP.
  ENDIF.

  LOOP AT <DYN_TABLE> ASSIGNING <DYN_WA>.
    ASSIGN COMPONENT 'NAM' OF STRUCTURE <DYN_WA> TO <FS>.
    IF <FS> = 'Total Stock Value'.
      ASSIGN COMPONENT 'TOTAL' OF STRUCTURE <DYN_WA> TO <FS>.
      W_VAL = W_VAL + <FS>.
      EXIT.
    ENDIF.
  ENDLOOP.
  APPEND W_LIST TO LIST.
  CLEAR W_LIST-INFO.

  W_VALUE = W_VAL.
  CONCATENATE W_LIST-INFO 'TOTAL STOCK VALUE' '=' W_VALUE
*  ',BC%' bcper1 ' XL% '  xlper1
  INTO  W_LIST-INFO SEPARATED BY SPACE.
  APPEND W_LIST TO LIST.
  CLEAR W_LIST-INFO.

  CONCATENATE W_LIST-INFO 'BC/BCL SALE' '=' BCSALE1 ', BC%' BCPER1 'XL SALE' XLSALE1 ', XL% '  XLPER1 'LS SALE' LSSALE1 ', LS% '  LSPER1
  INTO
 W_LIST-INFO SEPARATED BY SPACE.
  APPEND W_LIST TO LIST.
  CLEAR W_LIST-INFO.

*  W_VALUE = OMLVAL.
  CONCATENATE W_LIST-INFO 'OML' '=' TOMLVAL2 ', NSK' '=' TNSKVAL2 ', GOA' '=' TGOAVAL2  INTO
  W_LIST-INFO SEPARATED BY SPACE.
  APPEND W_LIST TO LIST.

  CALL FUNCTION 'REUSE_ALV_COMMENTARY_WRITE'
    EXPORTING
      IT_LIST_COMMENTARY = LIST.

  CLEAR LIST.

ENDFORM.                    "END_OF_LIST
*&---------------------------------------------------------------------*
*&      Form  FOOT
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM FOOT.
  DATA: LT_STKDET TYPE ZTTST_STKDET,
        RG_MTART  TYPE MD_RANGE_T_MTART.

  IF S_WERKS3[] IS NOT INITIAL.

* alternate code for YSTKDET
    RG_MTART = VALUE #( SIGN = 'I' OPTION = 'EQ'
                          ( LOW = 'ZFRT' )
                          ( LOW = 'ZHWA' ) ).
    CALL METHOD ZCL_MATNR_UTILITY=>READ_STOCKS(
      EXPORTING
        IT_WERKS  = S_WERKS3[]
        IT_MTART  = RG_MTART
      IMPORTING
        RT_STKDET = LT_STKDET ).

    SELECT * FROM YSTKDET INTO TABLE ITAB_STKDET WHERE WERKS IN S_WERKS3
    AND
    MTART IN ('ZFRT', 'ZHWA').

    SELECT WERKS KUNNR FROM T001W INTO TABLE ITAB_PLNT_NAM WHERE  WERKS IN S_WERKS3.

*    LOOP AT ITAB_STKDET ASSIGNING <FS_STKDET>.
    LOOP AT LT_STKDET INTO DATA(LS_STKDT).
      READ TABLE ITAB_A004 ASSIGNING <FS_A004> WITH KEY MATNR = LS_STKDT-MATNR  BINARY SEARCH.
      IF SY-SUBRC = 0.
        READ TABLE ITAB_KONP ASSIGNING <FS_KONP> WITH KEY KNUMH = <FS_A004>-KNUMH BINARY SEARCH.
        IF SY-SUBRC = 0.
          WA_PLNTSTK-WERKS = LS_STKDT-WERKS.
          WA_PLNTSTK-NETWR = LS_STKDT-TRAME + LS_STKDT-LABST + LS_STKDT-INSME +
                             LS_STKDT-EINME + LS_STKDT-SPEME + LS_STKDT-RETME.
          WA_PLNTSTK-NETWR = WA_PLNTSTK-NETWR * <FS_KONP>-KBETR.
          COLLECT WA_PLNTSTK INTO ITAB_PLNTSTK.
          CLEAR WA_PLNTSTK.
        ENDIF.
      ENDIF.
    ENDLOOP.
  ENDIF.
ENDFORM.                    " FOOT
*&---------------------------------------------------------------------*
*&      Form  TOP_OF_LIST
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
FORM TOP_OF_LIST.

  DATA: LIST       TYPE SLIS_T_LISTHEADER,
        W_LIST     LIKE LINE OF LIST,
        W_DAT(15)  TYPE C,
        W_DAT1(15) TYPE C.

  W_LIST-TYP = 'H'.
  CONCATENATE W_DAT SY-DATUM+6 '-' SY-DATUM+4(2) '-' SY-DATUM(4)
  INTO W_DAT.
  CONCATENATE ASDT+6 '-' ASDT+4(2) '-' ASDT(4)
  INTO W_DAT1.

*  concatenate w_list-info 'IR-1 : DAILY SALES / DISTRIBUTION REPORT AS OF :'  w_dat  'SALE AS OF' ASDT into w_list-info separated by space.
  CONCATENATE W_LIST-INFO 'IR-1 : SALES AS OF :' W_DAT1 ',' 'REPORT ON:'  W_DAT  INTO W_LIST-INFO SEPARATED BY SPACE.
  APPEND W_LIST TO LIST.
  CLEAR W_LIST.

  IF P_DIV = 'X'.
    W_LIST-TYP = 'S'.
    W_LIST-INFO = 'Value Rs. in 000'.
    APPEND W_LIST TO LIST.
    CLEAR W_LIST.
  ENDIF.

  CALL FUNCTION 'REUSE_ALV_COMMENTARY_WRITE'
    EXPORTING
      IT_LIST_COMMENTARY = LIST.

  CLEAR LIST.

ENDFORM.                    "END_OF_LIST
*&---------------------------------------------------------------------*
*&      Form  NOS
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*      -->P_W_NOS  text
*----------------------------------------------------------------------*
FORM NOS  USING    P_W_NOS.

  ASSIGN COMPONENT 'NOS' OF STRUCTURE <DYN_WA> TO <FS>.
  IF SY-SUBRC = 0.
    <FS> = P_W_NOS.
  ENDIF.

ENDFORM.                    " NOS
*&---------------------------------------------------------------------*
*&      Form  USER_COMMAND
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*      -->UCOMM      text
*      -->SELC       text
*----------------------------------------------------------------------*
FORM USER_COMMAND USING UCOMM LIKE SY-UCOMM SELC TYPE SLIS_SELFIELD.

  DATA: TABNAM     TYPE SLIS_TABNAME,

*   DATA: TABNAM TYPE DD02L-TABNAME,
        FIELDCAT   TYPE SLIS_T_FIELDCAT_ALV,
        ALV_LAYOUT TYPE  SLIS_LAYOUT_ALV,
        TITLE      LIKE SY-TITLE,
        NO         TYPE DLYDY,
        NO1        TYPE DLYDY,
        SIGN       TYPE SPLI1 VALUE '-'.

  FIELD-SYMBOLS: <FS_TAB> TYPE TABLE.

  LOOP AT ITAB_BSID INTO WA_BSID.
    SELECT SINGLE * FROM T001W WHERE KUNNR EQ WA_BSID-KUNNR.
    IF SY-SUBRC EQ 0.
      DELETE ITAB_BSID WHERE KUNNR EQ T001W-KUNNR.
    ENDIF.
  ENDLOOP.

  CHECK UCOMM = '&IC1'.
  IF SELC-FIELDNAME EQ 'TOTAL' OR SELC-FIELDNAME EQ 'NOS'.
    EXIT.
  ENDIF.

  CLEAR : A.

  CASE SELC-TABINDEX.
    WHEN 2.
      CLEAR: ITAB_INV_DISP, WA_INV_DISP.
      LOOP AT ITAB_INV_CUR ASSIGNING <FS_INV>
              WHERE WERKS_I =  SELC-FIELDNAME AND FKDAT EQ SY-DATUM.
        MOVE-CORRESPONDING <FS_INV> TO WA_INV_DISP.
        IF <FS_INV>-VBTYP = 'N'.
          WA_INV_DISP-NETWR_I = WA_INV_DISP-NETWR_I * -1.
        ENDIF.
        COLLECT WA_INV_DISP INTO ITAB_INV_DISP.
      ENDLOOP.
      ASSIGN ITAB_INV_DISP TO <FS_TAB>.
      TABNAM = 'WA_INV_DISP'.
      TITLE = 'Sales - Today''s Value'.
      PERFORM TITLE USING SELC-FIELDNAME
                    CHANGING TITLE.
      A = 1.
    WHEN 3.
      CLEAR: ITAB_INV_DISP, WA_INV_DISP.
      W_DATE = SY-DATUM.
      W_DATE+6 = '01'.
      PERFORM DATE USING W_DATE SY-DATUM.
      LOOP AT ITAB_INV_CUR ASSIGNING <FS_INV>
              WHERE WERKS_I =  SELC-FIELDNAME AND FKDAT IN R_DAT.
        MOVE-CORRESPONDING <FS_INV> TO WA_INV_DISP.
        IF <FS_INV>-VBTYP = 'N'.
          WA_INV_DISP-NETWR_I = WA_INV_DISP-NETWR_I * -1.
        ENDIF.
        COLLECT WA_INV_DISP INTO ITAB_INV_DISP.
      ENDLOOP.
      ASSIGN ITAB_INV_DISP TO <FS_TAB>.
      TABNAM = 'WA_INV_DISP'.
      TITLE = 'Sales - Cumm. For Month'.
      PERFORM TITLE USING SELC-FIELDNAME
                    CHANGING TITLE.
      A = 1.
    WHEN 4.
      CLEAR: ITAB_INV_DISP, WA_INV_DISP.
      W_DATE = SY-DATUM.
      W_DATE+6 = '01'.
      W_MON = W_DATE+4(2).
      W_MON = W_MON - 1.
      W_YER = W_DATE(4).
      IF W_MON = 0.
        W_MON = '12'.
        W_YER = W_YER - 1.
      ENDIF.
      W_DATE1(4) = W_YER.
      W_DATE1+4(2) = W_MON.
      W_DATE1+6 = SY-DATUM+6.

      W_DATE = W_DATE1.
      W_DATE+6 = '01'.

      PERFORM DATE USING W_DATE W_DATE1. " Previous month

      LOOP AT ITAB_INV_PRE ASSIGNING <FS_INV>
            WHERE WERKS_I =  SELC-FIELDNAME AND FKDAT IN R_DAT.
        MOVE-CORRESPONDING <FS_INV> TO WA_INV_DISP.
        IF <FS_INV>-VBTYP = 'N'.
          WA_INV_DISP-NETWR_I = WA_INV_DISP-NETWR_I * -1.
        ENDIF.
        COLLECT WA_INV_DISP INTO ITAB_INV_DISP.
      ENDLOOP.
      ASSIGN ITAB_INV_DISP TO <FS_TAB>.
      TABNAM = 'WA_INV_DISP'.
      TITLE = 'Sales - Last Mth''s Value'.
      PERFORM TITLE USING SELC-FIELDNAME
                    CHANGING TITLE.
      A = 1.

    WHEN 5.
      CLEAR: ITAB_INV_DISP, WA_INV_DISP.
      W_DATE = SY-DATUM.
      W_DATE+6 = '01'.
      W_MON = W_DATE+4(2).
*      W_MON = W_MON - 1.
      W_YER = W_DATE(4).
      IF W_MON = 0.
        W_MON = '12'.
        W_YER = W_YER - 1.
      ENDIF.
      W_DATE1(4) = W_YER - 1.
      W_DATE1+4(2) = W_MON.
      W_DATE1+6 = SY-DATUM+6.

      W_DATE = W_DATE1.
      W_DATE+6 = '01'.

      PERFORM DATE USING W_DATE W_DATE1. " Previous month

      LOOP AT ITAB_INV_PRE_YR ASSIGNING <FS_INV> WHERE WERKS_I = SELC-FIELDNAME AND FKDAT IN R_DAT.
        MOVE-CORRESPONDING <FS_INV> TO WA_INV_DISP.
        IF <FS_INV>-VBTYP = 'N'.
          WA_INV_DISP-NETWR_I = WA_INV_DISP-NETWR_I * -1.
        ENDIF.
        COLLECT WA_INV_DISP INTO ITAB_INV_DISP.
      ENDLOOP.
      ASSIGN ITAB_INV_DISP TO <FS_TAB>.
      TABNAM = 'WA_INV_DISP'.
      TITLE = 'Sales - Last Mth''s Value'.
      PERFORM TITLE USING SELC-FIELDNAME
                    CHANGING TITLE.
      A = 1.
    WHEN 7.
      CLEAR: WA_PLNT_STK, ITAB_PLNT_STK.
      LOOP AT ITAB_MARD ASSIGNING <FS_MARD>.
        READ TABLE ITAB_A004 ASSIGNING <FS_A004> WITH KEY MATNR =
        <FS_MARD>-MATNR
        BINARY SEARCH.
        IF SY-SUBRC = 0.
          READ TABLE ITAB_KONP ASSIGNING <FS_KONP> WITH KEY KNUMH =
          <FS_A004>-KNUMH
          BINARY SEARCH.
          IF SY-SUBRC = 0.
            READ TABLE ITAB_MARA ASSIGNING <FS_MARA> WITH KEY MATNR =
            <FS_MARD>-MATNR BINARY SEARCH.
            IF SY-SUBRC = 0.
              READ TABLE ITAB_T134G ASSIGNING <FS_T134G> WITH KEY WERKS
              =
              <FS_MARD>-WERKS SPART = <FS_MARA>-SPART GSBER =
              SELC-FIELDNAME.
              IF SY-SUBRC = 0.
                MOVE-CORRESPONDING <FS_MARD> TO WA_PLNT_STK.
                WA_PLNT_STK-DMBTR = <FS_MARD>-LABST + <FS_MARD>-INSME +
                <FS_MARD>-EINME +
                <FS_MARD>-SPEME + <FS_MARD>-RETME.
                WA_PLNT_STK-DMBTR = WA_PLNT_STK-DMBTR * <FS_KONP>-KBETR.
                IF WA_PLNT_STK-DMBTR GT 0.
                  COLLECT WA_PLNT_STK INTO ITAB_PLNT_STK .
                  CLEAR WA_PLNT_STK.
                ENDIF.
              ENDIF.
            ENDIF.
          ENDIF.
        ENDIF.
      ENDLOOP.
      ASSIGN ITAB_PLNT_STK TO <FS_TAB>.
      TABNAM = 'WA_PLNT_STK'.
      TITLE = 'Inventory - CL. Stock Value'.
      PERFORM TITLE USING SELC-FIELDNAME
                    CHANGING TITLE.
      A = 2.
    WHEN 8.
      CLEAR: WA_PLNT_STK, ITAB_PLNT_STK.
      LOOP AT ITAB_MARC ASSIGNING <FS_MARC>.
        READ TABLE ITAB_A004 ASSIGNING <FS_A004> WITH KEY MATNR = <FS_MARC>-MATNR BINARY SEARCH.
        IF SY-SUBRC = 0.
          READ TABLE ITAB_KONP ASSIGNING <FS_KONP> WITH KEY KNUMH =
          <FS_A004>-KNUMH
          BINARY SEARCH.
          IF SY-SUBRC = 0.
            READ TABLE ITAB_MARA ASSIGNING <FS_MARA> WITH KEY MATNR =
            <FS_MARC>-MATNR BINARY SEARCH.
            IF SY-SUBRC = 0.
              READ TABLE ITAB_T134G ASSIGNING <FS_T134G> WITH KEY WERKS
              =
              <FS_MARC>-WERKS SPART = <FS_MARA>-SPART GSBER =
              SELC-FIELDNAME.
              IF SY-SUBRC = 0.
                MOVE-CORRESPONDING <FS_MARC> TO WA_PLNT_STK.
                WA_PLNT_STK-DMBTR = <FS_MARC>-TRAME * <FS_KONP>-KBETR.
                IF WA_PLNT_STK-DMBTR GT 0.
                  COLLECT WA_PLNT_STK INTO ITAB_PLNT_STK .
                  CLEAR WA_PLNT_STK.
                ENDIF.
              ENDIF.
            ENDIF.
          ENDIF.
        ENDIF.
      ENDLOOP.
      ASSIGN ITAB_PLNT_STK TO <FS_TAB>.
      TABNAM = 'WA_PLNT_STK'.
      TITLE = 'Inventory - IT.  Stock Value'.
      PERFORM TITLE USING SELC-FIELDNAME
                    CHANGING TITLE.
      DELETE ITAB_PLNT_STK WHERE DMBTR EQ 0.
      A = 2.
    WHEN 11.
      CLEAR: ITAB_OPEN_DISP, WA_ODR_OPN.
      LOOP AT ITAB_OPEN ASSIGNING <FS_YSDIR1> WHERE WERKS =
      SELC-FIELDNAME.
        MOVE-CORRESPONDING <FS_YSDIR1> TO WA_ODR_OPN.
        COLLECT WA_ODR_OPN INTO ITAB_OPEN_DISP.
      ENDLOOP.
      ASSIGN ITAB_OPEN_DISP TO <FS_TAB>.
      TABNAM = 'WA_ODR_OPN'.
      TITLE = 'Pending - Prod. Pending'.
      PERFORM TITLE USING SELC-FIELDNAME
                    CHANGING TITLE.
      A = 3.
    WHEN 12.
      CLEAR: ITAB_OPEN_DISP, WA_ODR_OPN.
      LOOP AT ITAB_OPEN2 ASSIGNING <FS_YSDIR1> WHERE WERKS =
      SELC-FIELDNAME.
        MOVE-CORRESPONDING <FS_YSDIR1> TO WA_ODR_OPN.
        COLLECT WA_ODR_OPN INTO ITAB_OPEN_DISP.
      ENDLOOP.
      ASSIGN ITAB_OPEN_DISP TO <FS_TAB>.
      TABNAM = 'WA_ODR_OPN'.
      TITLE = 'Pending - Overdues'.
      PERFORM TITLE USING SELC-FIELDNAME
                    CHANGING TITLE.
      A = 3.
    WHEN 13.
      CLEAR: ITAB_OPEN_DISP, WA_ODR_OPN.
      LOOP AT ITAB_OPEN3 ASSIGNING <FS_YSDIR1> WHERE WERKS =
      SELC-FIELDNAME.
        MOVE-CORRESPONDING <FS_YSDIR1> TO WA_ODR_OPN.
        COLLECT WA_ODR_OPN INTO ITAB_OPEN_DISP.
      ENDLOOP.
      ASSIGN ITAB_OPEN_DISP TO <FS_TAB>.
      TABNAM = 'WA_ODR_OPN'.
      TITLE = 'Credit Limit'.
      PERFORM TITLE USING SELC-FIELDNAME
                    CHANGING TITLE.
      A = 3.
    WHEN 14.
      CLEAR: ITAB_OPEN_DISP, WA_ODR_OPN.
      LOOP AT ITAB_OPEN4 ASSIGNING <FS_YSDIR1> WHERE WERKS =
      SELC-FIELDNAME.
        MOVE-CORRESPONDING <FS_YSDIR1> TO WA_ODR_OPN.
        COLLECT WA_ODR_OPN INTO ITAB_OPEN_DISP.
      ENDLOOP.
      ASSIGN ITAB_OPEN_DISP TO <FS_TAB>.
      TABNAM = 'WA_ODR_OPN'.
      TITLE = 'Other Reasons'.
      PERFORM TITLE USING SELC-FIELDNAME
                    CHANGING TITLE.
      A = 3.
    WHEN 17.
      CLEAR: ITAB_ACCT, WA_ACCT.
      LOOP AT ITAB_BSIS ASSIGNING <FS_BSIS> WHERE BUDAT = SY-DATUM AND
        GSBER = SELC-FIELDNAME.
        MOVE-CORRESPONDING <FS_BSIS> TO WA_ACCT.
        IF <FS_BSIS>-SHKZG = 'H'.
          WA_ACCT-DMBTR = WA_ACCT-DMBTR * -1.
        ENDIF.
        APPEND WA_ACCT TO ITAB_ACCT.
      ENDLOOP.
      ASSIGN ITAB_ACCT TO <FS_TAB>.
      TABNAM = 'WA_ACCT'.
      TITLE = 'Receivables - Payment Recd'.
      PERFORM TITLE USING SELC-FIELDNAME
                    CHANGING TITLE.

    WHEN 18.
      CLEAR: ITAB_ACCT, WA_ACCT.
      LOOP AT ITAB_BSIS ASSIGNING <FS_BSIS> WHERE GSBER = SELC-FIELDNAME
      .
        MOVE-CORRESPONDING <FS_BSIS> TO WA_ACCT.
        IF <FS_BSIS>-SHKZG = 'H'.
          WA_ACCT-DMBTR = WA_ACCT-DMBTR * -1.
        ENDIF.
        APPEND WA_ACCT TO ITAB_ACCT.
      ENDLOOP.
      ASSIGN ITAB_ACCT TO <FS_TAB>.
      TABNAM = 'WA_ACCT'.
      TITLE = 'Receivables - Cumm. Pmt Recd.'.
      PERFORM TITLE USING SELC-FIELDNAME
                    CHANGING TITLE.

    WHEN 19.
      CLEAR: ITAB_ACCT, WA_ACCT.
      LOOP AT ITAB_BSID ASSIGNING <FS_BSID> WHERE GSBER = SELC-FIELDNAME
      .
        IF <FS_BSID>-BSCHL = '01' OR <FS_BSID>-BSCHL = '04'  OR
        <FS_BSID>-BSCHL = '06' OR <FS_BSID>-BSCHL = '07'.
          " For only open receivables
        ELSE.
          CONTINUE.
        ENDIF.
        MOVE-CORRESPONDING <FS_BSID> TO WA_ACCT.
        IF <FS_BSID>-SHKZG = 'H'.
          WA_ACCT-DMBTR = WA_ACCT-DMBTR * -1.
        ENDIF.
        APPEND WA_ACCT TO ITAB_ACCT.
      ENDLOOP.
      ASSIGN ITAB_ACCT TO <FS_TAB>.
      TABNAM = 'WA_ACCT'.
      TITLE = 'Receivables - Total Receivables'.
      PERFORM TITLE USING SELC-FIELDNAME
                    CHANGING TITLE.

    WHEN 21.
      CLEAR: ITAB_ACCT, WA_ACCT, W_DATE, NO.
      NO = 90.
      CALL FUNCTION 'RP_CALC_DATE_IN_INTERVAL'
        EXPORTING
          DATE      = SY-DATUM
          DAYS      = NO
          MONTHS    = NO1
          SIGNUM    = SIGN
          YEARS     = NO1
        IMPORTING
          CALC_DATE = W_DATE.
      LOOP AT ITAB_BSID ASSIGNING <FS_BSID> WHERE ZFBDT <= W_DATE AND
        GSBER = SELC-FIELDNAME.
        IF <FS_BSID>-BSCHL = '01' OR <FS_BSID>-BSCHL = '04' OR
        <FS_BSID>-BSCHL = '06' OR <FS_BSID>-BSCHL = '07' .
        ELSE.
          CONTINUE.
        ENDIF.
        MOVE-CORRESPONDING <FS_BSID> TO WA_ACCT.
        IF <FS_BSID>-SHKZG = 'H'.
          WA_ACCT-DMBTR = WA_ACCT-DMBTR * -1.
        ENDIF.
        APPEND WA_ACCT TO ITAB_ACCT.
      ENDLOOP.
      ASSIGN ITAB_ACCT TO <FS_TAB>.
      TABNAM = 'WA_ACCT'.
      TITLE = 'ODR - Over 3 Months'.
      PERFORM TITLE USING SELC-FIELDNAME
                    CHANGING TITLE.

    WHEN 22.
      CLEAR: ITAB_ACCT, WA_ACCT, W_DATE, W_DATE1, NO.
      NO = 60.
      CALL FUNCTION 'RP_CALC_DATE_IN_INTERVAL'
        EXPORTING
          DATE      = SY-DATUM
          DAYS      = NO
          MONTHS    = NO1
          SIGNUM    = SIGN
          YEARS     = NO1
        IMPORTING
          CALC_DATE = W_DATE.
      NO = 90.
      CALL FUNCTION 'RP_CALC_DATE_IN_INTERVAL'
        EXPORTING
          DATE      = SY-DATUM
          DAYS      = NO
          MONTHS    = NO1
          SIGNUM    = SIGN
          YEARS     = NO1
        IMPORTING
          CALC_DATE = W_DATE1.

      LOOP AT ITAB_BSID ASSIGNING <FS_BSID> WHERE ZFBDT <= W_DATE AND
        ZFBDT > W_DATE1 AND GSBER = SELC-FIELDNAME.
        IF <FS_BSID>-BSCHL = '01' OR <FS_BSID>-BSCHL = '04'  OR
        <FS_BSID>-BSCHL = '06' OR <FS_BSID>-BSCHL = '07'.
        ELSE.
          CONTINUE.
        ENDIF.
        MOVE-CORRESPONDING <FS_BSID> TO WA_ACCT.
        IF <FS_BSID>-SHKZG = 'H'.
          WA_ACCT-DMBTR = WA_ACCT-DMBTR * -1.
        ENDIF.
        APPEND WA_ACCT TO ITAB_ACCT.
      ENDLOOP.
      ASSIGN ITAB_ACCT TO <FS_TAB>.
      TABNAM = 'WA_ACCT'.
      TITLE = 'ODR - Over 2 Months'.
      PERFORM TITLE USING SELC-FIELDNAME
                    CHANGING TITLE.

    WHEN 23.
      CLEAR: ITAB_ACCT, WA_ACCT, W_DATE, W_DATE1, NO.
      NO = 30.
      CALL FUNCTION 'RP_CALC_DATE_IN_INTERVAL'
        EXPORTING
          DATE      = SY-DATUM
          DAYS      = NO
          MONTHS    = NO1
          SIGNUM    = SIGN
          YEARS     = NO1
        IMPORTING
          CALC_DATE = W_DATE.
      NO = 60.
      CALL FUNCTION 'RP_CALC_DATE_IN_INTERVAL'
        EXPORTING
          DATE      = SY-DATUM
          DAYS      = NO
          MONTHS    = NO1
          SIGNUM    = SIGN
          YEARS     = NO1
        IMPORTING
          CALC_DATE = W_DATE1.

      LOOP AT ITAB_BSID ASSIGNING <FS_BSID> WHERE ZFBDT <= W_DATE AND
        ZFBDT > W_DATE1 AND GSBER = SELC-FIELDNAME.
        IF <FS_BSID>-BSCHL = '01' OR <FS_BSID>-BSCHL = '04'  OR
        <FS_BSID>-BSCHL = '06' OR <FS_BSID>-BSCHL = '07'.
        ELSE.
          CONTINUE.
        ENDIF.
        MOVE-CORRESPONDING <FS_BSID> TO WA_ACCT.
        IF <FS_BSID>-SHKZG = 'H'.
          WA_ACCT-DMBTR = WA_ACCT-DMBTR * -1.
        ENDIF.
        APPEND WA_ACCT TO ITAB_ACCT.
      ENDLOOP.
      ASSIGN ITAB_ACCT TO <FS_TAB>.
      TABNAM = 'WA_ACCT'.
      TITLE = 'ODR - Over 1 Month'.
      PERFORM TITLE USING SELC-FIELDNAME
                    CHANGING TITLE.

    WHEN 24.
      CLEAR: ITAB_ACCT, WA_ACCT, W_DATE, W_DATE1, NO.
      NO = 11.
      CALL FUNCTION 'RP_CALC_DATE_IN_INTERVAL'
        EXPORTING
          DATE      = SY-DATUM
          DAYS      = NO
          MONTHS    = NO1
          SIGNUM    = SIGN
          YEARS     = NO1
        IMPORTING
          CALC_DATE = W_DATE.
      NO = 30.
      CALL FUNCTION 'RP_CALC_DATE_IN_INTERVAL'
        EXPORTING
          DATE      = SY-DATUM
          DAYS      = NO
          MONTHS    = NO1
          SIGNUM    = SIGN
          YEARS     = NO1
        IMPORTING
          CALC_DATE = W_DATE1.

      LOOP AT ITAB_BSID ASSIGNING <FS_BSID> WHERE ZFBDT <= W_DATE AND
        ZFBDT > W_DATE1 AND GSBER = SELC-FIELDNAME.
        IF <FS_BSID>-BSCHL = '01' OR <FS_BSID>-BSCHL = '04'
           OR <FS_BSID>-BSCHL = '06' OR <FS_BSID>-BSCHL = '07'.
        ELSE.
          CONTINUE.
        ENDIF.
        MOVE-CORRESPONDING <FS_BSID> TO WA_ACCT.
        IF <FS_BSID>-SHKZG = 'H'.
          WA_ACCT-DMBTR = WA_ACCT-DMBTR * -1.
        ENDIF.
        APPEND WA_ACCT TO ITAB_ACCT.
      ENDLOOP.
      ASSIGN ITAB_ACCT TO <FS_TAB>.
      TABNAM = 'WA_ACCT'.
      TITLE = 'ODR - Upto 1 Month'.
      PERFORM TITLE USING SELC-FIELDNAME
                    CHANGING TITLE.

    WHEN 27.
*      CLEAR: ITAB_ACCT, WA_ACCT.
*LOOP AT ITAB_NOTE ASSIGNING <FS_BSID> WHERE GSBER = SELC-FIELDNAME AND
*        ( BSCHL = '02' OR BSCHL = '11' ).
*        MOVE-CORRESPONDING <FS_BSID> TO WA_ACCT.
*        IF <FS_BSID>-SHKZG = 'H'.
*          WA_ACCT-DMBTR = WA_ACCT-DMBTR * -1.
*        ENDIF.
*        APPEND WA_ACCT TO ITAB_ACCT.
*      ENDLOOP.
**      LOOP AT ITAB_NOTE ASSIGNING <FS_BSID> WHERE GSBER =
*SELC-FIELDNAME AND
**        BLART = 'AB' AND BSCHL = 02.
**        MOVE-CORRESPONDING <FS_BSID> TO WA_ACCT.
**        IF <FS_BSID>-SHKZG = 'H'.
**          WA_ACCT-DMBTR = WA_ACCT-DMBTR * -1.
**        ENDIF.
**        APPEND WA_ACCT TO ITAB_ACCT.
**      ENDLOOP.
*      ASSIGN ITAB_ACCT TO <FS_TAB>.
*      TABNAM = 'WA_ACCT'.
*      TITLE = 'Value of C/N'.
*      PERFORM TITLE USING SELC-FIELDNAME
*                    CHANGING TITLE.

      CLEAR: ITAB_ACCT, WA_ACCT,WA_CRENOTE.
      LOOP AT IT_CRENOTE INTO WA_CRENOTE WHERE GSBER = SELC-FIELDNAME.
        MOVE-CORRESPONDING WA_CRENOTE TO WA_ACCT.
*        IF <FS_BSID>-SHKZG = 'H'.
*          WA_ACCT-DMBTR = WA_ACCT-DMBTR * -1.
*        ENDIF.
        APPEND WA_ACCT TO ITAB_ACCT.
      ENDLOOP.
*LOOP AT ITAB_NOTE ASSIGNING <FS_BSID> WHERE GSBER = SELC-FIELDNAME AND
*        BLART = 'AB' AND BSCHL = 02.
*        MOVE-CORRESPONDING <FS_BSID> TO WA_ACCT.
*        IF <FS_BSID>-SHKZG = 'H'.
*          WA_ACCT-DMBTR = WA_ACCT-DMBTR * -1.
*        ENDIF.
*        APPEND WA_ACCT TO ITAB_ACCT.
*      ENDLOOP.
      ASSIGN ITAB_ACCT TO <FS_TAB>.
      TABNAM = 'WA_ACCT'.
      TITLE = 'Value of C/N'.
      PERFORM TITLE USING SELC-FIELDNAME
                    CHANGING TITLE.

    WHEN 28.
      CLEAR: ITAB_ACCT, WA_ACCT,WA_DEBNOTE.
      LOOP AT IT_DEBNOTE INTO WA_DEBNOTE WHERE GSBER = SELC-FIELDNAME.
        MOVE-CORRESPONDING WA_DEBNOTE TO WA_ACCT.
*        IF <FS_BSID>-SHKZG = 'H'.
*          WA_ACCT-DMBTR = WA_ACCT-DMBTR * -1.
*        ENDIF.
        APPEND WA_ACCT TO ITAB_ACCT.
      ENDLOOP.
      ASSIGN ITAB_ACCT TO <FS_TAB>.
      TABNAM = 'WA_ACCT'.
      TITLE = 'Value of D/N'.
      PERFORM TITLE USING SELC-FIELDNAME
                    CHANGING TITLE.
*      CLEAR: ITAB_ACCT, WA_ACCT.
*LOOP AT ITAB_NOTE ASSIGNING <FS_BSID> WHERE GSBER = SELC-FIELDNAME AND
*        ( BSCHL = '01' OR BSCHL = '12' ).
*        CASE <FS_BSID>-BSCHL.
*          WHEN 01.
*            IF <FS_BSID>-ZUONR EQ <FS_BSID>-VBELN.
*              CONTINUE. " TO avoid normal invoice
*            ENDIF.
*          WHEN 12.
*            READ TABLE ITAB_VBELN ASSIGNING <FS_VBELN> WITH KEY VBELN =
*            <FS_BSID>-VBELN.
*            IF SY-SUBRC <> 0.
*              CONTINUE. " TO avoid normal invoice
*            ENDIF.
*        ENDCASE.
*        MOVE-CORRESPONDING <FS_BSID> TO WA_ACCT.
*        IF <FS_BSID>-SHKZG = 'H'.
*          WA_ACCT-DMBTR = WA_ACCT-DMBTR * -1.
*        ENDIF.
*        APPEND WA_ACCT TO ITAB_ACCT.
*      ENDLOOP.
*LOOP AT ITAB_NOTE ASSIGNING <FS_BSID> WHERE GSBER = SELC-FIELDNAME AND
*        BLART = 'AB' AND BSCHL = 12.
*READ TABLE ITAB_INV_CUR ASSIGNING <FS_INV> WITH KEY VBELN =
*<FS_BSID>-ZUONR.
*        IF SY-SUBRC = 0.
*          CONTINUE.
*        ENDIF.
*        MOVE-CORRESPONDING <FS_BSID> TO WA_ACCT.
*        IF <FS_BSID>-SHKZG = 'H'.
*          WA_ACCT-DMBTR = WA_ACCT-DMBTR * -1.
*        ENDIF.
*        APPEND WA_ACCT TO ITAB_ACCT.
*      ENDLOOP.
*      ASSIGN ITAB_ACCT TO <FS_TAB>.
*      TABNAM = 'WA_ACCT'.
*      TITLE = 'Value of D/N'.
*      PERFORM TITLE USING SELC-FIELDNAME
*                    CHANGING TITLE.
*
    WHEN OTHERS.
      EXIT.
  ENDCASE.


***  CALL FUNCTION 'REUSE_ALV_FIELDCATALOG_MERGE'
***    EXPORTING
***      i_program_name         = g_repid
***      i_internal_tabname     = tabnam
***      i_inclname             = g_repid
***      i_bypassing_buffer     = 'X'
***    CHANGING
***      ct_fieldcat            = fieldcat
***    EXCEPTIONS
***      inconsistent_interface = 1
***      program_error          = 2
***      OTHERS                 = 3.
***  IF sy-subrc <> 0.
***    MESSAGE ID sy-msgid TYPE sy-msgty NUMBER sy-msgno
***            WITH sy-msgv1 sy-msgv2 sy-msgv3 sy-msgv4.
***  ENDIF.

  IF A EQ 1.

*    WA_FIELDCAT1-FIELDNAME = 'KUNAG'.
*    WA_FIELDCAT1-SELTEXT_L = 'CUSTOMER CODE'.
*    APPEND WA_FIELDCAT1 TO FIELDCAT1.
*    CLEAR WA_FIELDCAT1.

    WA_FIELDCAT1-FIELDNAME = 'VBELN'.
    WA_FIELDCAT1-SELTEXT_L = 'INVOICE'.
    APPEND WA_FIELDCAT1 TO FIELDCAT1.
    CLEAR WA_FIELDCAT1.

    WA_FIELDCAT1-FIELDNAME = 'FKDAT'.
    WA_FIELDCAT1-SELTEXT_L = 'INV DATE'.
    APPEND WA_FIELDCAT1 TO FIELDCAT1.
    CLEAR WA_FIELDCAT1.

    WA_FIELDCAT1-FIELDNAME = 'NETWR_I'.
    WA_FIELDCAT1-SELTEXT_L = 'AMOUNT'.
    APPEND WA_FIELDCAT1 TO FIELDCAT1.
    CLEAR WA_FIELDCAT1.

    LAYOUT1-ZEBRA = 'X'.
    LAYOUT1-COLWIDTH_OPTIMIZE = 'X'.
    LAYOUT1-WINDOW_TITLEBAR  = 'INVOICE DETAIL LIST'.


    CALL FUNCTION 'REUSE_ALV_GRID_DISPLAY'
      EXPORTING
*       I_INTERFACE_CHECK       = ' '
*       I_BYPASSING_BUFFER      = ' '
*       I_BUFFER_ACTIVE         = ' '
        I_CALLBACK_PROGRAM      = G_REPID
*       I_CALLBACK_PF_STATUS_SET          = 'STATUS'
        I_CALLBACK_USER_COMMAND = 'USER_COMM1'
        I_CALLBACK_TOP_OF_PAGE  = 'TOP2'
*       I_CALLBACK_HTML_TOP_OF_PAGE       = ' '
*       I_CALLBACK_HTML_END_OF_LIST       = ' '
*       I_STRUCTURE_NAME        =
*       I_BACKGROUND_ID         = ' '
*       I_GRID_TITLE            =
*       I_GRID_SETTINGS         = L_GLAY
        IS_LAYOUT               = LAYOUT1
        IT_FIELDCAT             = FIELDCAT1
*       IT_EXCLUDING            =
*       IT_SPECIAL_GROUPS       =
*       IT_SORT                 =
*       IT_FILTER               =
*       IS_SEL_HIDE             =
*       I_DEFAULT               = 'X'
        I_SAVE                  = 'A'
*       IS_VARIANT              =
*       IT_EVENTS               =
*       IT_EVENT_EXIT           =
*       IS_PRINT                =
*       IS_REPREP_ID            =
*       I_SCREEN_START_COLUMN   = 0
*       I_SCREEN_START_LINE     = 0
*       I_SCREEN_END_COLUMN     = 0
*       I_SCREEN_END_LINE       = 0
*       I_HTML_HEIGHT_TOP       = 0
*       I_HTML_HEIGHT_END       = 0
*       IT_ALV_GRAPHICS         =
*       IT_HYPERLINK            =
*       IT_ADD_FIELDCAT         =
*       IT_EXCEPT_QINFO         =
*       IR_SALV_FULLSCREEN_ADAPTER        =
* IMPORTING
*       E_EXIT_CAUSED_BY_CALLER =
*       ES_EXIT_CAUSED_BY_USER  =
      TABLES
        T_OUTTAB                = ITAB_INV_DISP
      EXCEPTIONS
        PROGRAM_ERROR           = 1
        OTHERS                  = 2.
    IF SY-SUBRC <> 0.
* MESSAGE ID SY-MSGID TYPE SY-MSGTY NUMBER SY-MSGNO
*         WITH SY-MSGV1 SY-MSGV2 SY-MSGV3 SY-MSGV4.
    ENDIF.


    CLEAR : ITAB_ACCT,WA_ACCT, FIELDCAT1, A.

  ELSEIF A EQ 2.
    WA_FIELDCAT1-FIELDNAME = 'WERKS'.
    WA_FIELDCAT1-SELTEXT_L = 'PLANT'.
    APPEND WA_FIELDCAT1 TO FIELDCAT1.
    CLEAR WA_FIELDCAT1.

    WA_FIELDCAT1-FIELDNAME = 'MATNR'.
    WA_FIELDCAT1-SELTEXT_L = 'PRODUCT CODE'.
    APPEND WA_FIELDCAT1 TO FIELDCAT1.
    CLEAR WA_FIELDCAT1.

    WA_FIELDCAT1-FIELDNAME = 'DMBTR'.
    WA_FIELDCAT1-SELTEXT_L = 'VALUE'.
    APPEND WA_FIELDCAT1 TO FIELDCAT1.
    CLEAR WA_FIELDCAT1.

    LAYOUT1-ZEBRA = 'X'.
    LAYOUT1-COLWIDTH_OPTIMIZE = 'X'.
    LAYOUT1-WINDOW_TITLEBAR  = 'INVENTORY DETAIL LIST'.


    CALL FUNCTION 'REUSE_ALV_GRID_DISPLAY'
      EXPORTING
*       I_INTERFACE_CHECK       = ' '
*       I_BYPASSING_BUFFER      = ' '
*       I_BUFFER_ACTIVE         = ' '
        I_CALLBACK_PROGRAM      = G_REPID
*       I_CALLBACK_PF_STATUS_SET          = 'STATUS'
        I_CALLBACK_USER_COMMAND = 'USER_COMM1'
        I_CALLBACK_TOP_OF_PAGE  = 'TOP2'
*       I_CALLBACK_HTML_TOP_OF_PAGE       = ' '
*       I_CALLBACK_HTML_END_OF_LIST       = ' '
*       I_STRUCTURE_NAME        =
*       I_BACKGROUND_ID         = ' '
*       I_GRID_TITLE            =
*       I_GRID_SETTINGS         = L_GLAY
        IS_LAYOUT               = LAYOUT1
        IT_FIELDCAT             = FIELDCAT1
*       IT_EXCLUDING            =
*       IT_SPECIAL_GROUPS       =
*       IT_SORT                 =
*       IT_FILTER               =
*       IS_SEL_HIDE             =
*       I_DEFAULT               = 'X'
        I_SAVE                  = 'A'
*       IS_VARIANT              =
*       IT_EVENTS               =
*       IT_EVENT_EXIT           =
*       IS_PRINT                =
*       IS_REPREP_ID            =
*       I_SCREEN_START_COLUMN   = 0
*       I_SCREEN_START_LINE     = 0
*       I_SCREEN_END_COLUMN     = 0
*       I_SCREEN_END_LINE       = 0
*       I_HTML_HEIGHT_TOP       = 0
*       I_HTML_HEIGHT_END       = 0
*       IT_ALV_GRAPHICS         =
*       IT_HYPERLINK            =
*       IT_ADD_FIELDCAT         =
*       IT_EXCEPT_QINFO         =
*       IR_SALV_FULLSCREEN_ADAPTER        =
* IMPORTING
*       E_EXIT_CAUSED_BY_CALLER =
*       ES_EXIT_CAUSED_BY_USER  =
      TABLES
        T_OUTTAB                = ITAB_PLNT_STK
      EXCEPTIONS
        PROGRAM_ERROR           = 1
        OTHERS                  = 2.
    IF SY-SUBRC <> 0.
* MESSAGE ID SY-MSGID TYPE SY-MSGTY NUMBER SY-MSGNO
*         WITH SY-MSGV1 SY-MSGV2 SY-MSGV3 SY-MSGV4.
    ENDIF.


    CLEAR : ITAB_ACCT,WA_ACCT, FIELDCAT1, A.

  ELSEIF A EQ 3.

    WA_FIELDCAT1-FIELDNAME = 'VBELN'.
    WA_FIELDCAT1-SELTEXT_L = 'ORDER NO.'.
    APPEND WA_FIELDCAT1 TO FIELDCAT1.
    CLEAR WA_FIELDCAT1.

    WA_FIELDCAT1-FIELDNAME = 'KUNNR'.
    WA_FIELDCAT1-SELTEXT_L = 'CUSTOMER CODE'.
    APPEND WA_FIELDCAT1 TO FIELDCAT1.
    CLEAR WA_FIELDCAT1.

    WA_FIELDCAT1-FIELDNAME = 'NETVALUE'.
    WA_FIELDCAT1-SELTEXT_L = 'VALUE'.
    APPEND WA_FIELDCAT1 TO FIELDCAT1.
    CLEAR WA_FIELDCAT1.

    LAYOUT1-ZEBRA = 'X'.
    LAYOUT1-COLWIDTH_OPTIMIZE = 'X'.
    LAYOUT1-WINDOW_TITLEBAR  = 'ORDER DETAILS'.


    CALL FUNCTION 'REUSE_ALV_GRID_DISPLAY'
      EXPORTING
*       I_INTERFACE_CHECK       = ' '
*       I_BYPASSING_BUFFER      = ' '
*       I_BUFFER_ACTIVE         = ' '
        I_CALLBACK_PROGRAM      = G_REPID
*       I_CALLBACK_PF_STATUS_SET          = 'STATUS'
        I_CALLBACK_USER_COMMAND = 'USER_COMM1'
        I_CALLBACK_TOP_OF_PAGE  = 'TOP2'
*       I_CALLBACK_HTML_TOP_OF_PAGE       = ' '
*       I_CALLBACK_HTML_END_OF_LIST       = ' '
*       I_STRUCTURE_NAME        =
*       I_BACKGROUND_ID         = ' '
*       I_GRID_TITLE            =
*       I_GRID_SETTINGS         = L_GLAY
        IS_LAYOUT               = LAYOUT1
        IT_FIELDCAT             = FIELDCAT1
*       IT_EXCLUDING            =
*       IT_SPECIAL_GROUPS       =
*       IT_SORT                 =
*       IT_FILTER               =
*       IS_SEL_HIDE             =
*       I_DEFAULT               = 'X'
        I_SAVE                  = 'A'
*       IS_VARIANT              =
*       IT_EVENTS               =
*       IT_EVENT_EXIT           =
*       IS_PRINT                =
*       IS_REPREP_ID            =
*       I_SCREEN_START_COLUMN   = 0
*       I_SCREEN_START_LINE     = 0
*       I_SCREEN_END_COLUMN     = 0
*       I_SCREEN_END_LINE       = 0
*       I_HTML_HEIGHT_TOP       = 0
*       I_HTML_HEIGHT_END       = 0
*       IT_ALV_GRAPHICS         =
*       IT_HYPERLINK            =
*       IT_ADD_FIELDCAT         =
*       IT_EXCEPT_QINFO         =
*       IR_SALV_FULLSCREEN_ADAPTER        =
* IMPORTING
*       E_EXIT_CAUSED_BY_CALLER =
*       ES_EXIT_CAUSED_BY_USER  =
      TABLES
        T_OUTTAB                = ITAB_OPEN_DISP
      EXCEPTIONS
        PROGRAM_ERROR           = 1
        OTHERS                  = 2.
    IF SY-SUBRC <> 0.
* MESSAGE ID SY-MSGID TYPE SY-MSGTY NUMBER SY-MSGNO
*         WITH SY-MSGV1 SY-MSGV2 SY-MSGV3 SY-MSGV4.
    ENDIF.


    CLEAR : ITAB_ACCT,WA_ACCT, FIELDCAT1, A.

  ELSE.

*    LOOP AT ITAB_ACCT INTO WA_ACCT .
**     WHERE GSBER = SELC-FIELDNAME .
**  AND ( BSCHL = '01' OR BSCHL = '12' ).
*      WRITE : / WA_ACCT-BUKRS.
*    ENDLOOP.

    WA_FIELDCAT1-FIELDNAME = 'KUNNR'.
    WA_FIELDCAT1-SELTEXT_L = 'CUSTOMER CODE'.
    APPEND WA_FIELDCAT1 TO FIELDCAT1.
    CLEAR WA_FIELDCAT1.

    WA_FIELDCAT1-FIELDNAME = 'BELNR'.
    WA_FIELDCAT1-SELTEXT_L = 'DOC NO.'.
    APPEND WA_FIELDCAT1 TO FIELDCAT1.
    CLEAR WA_FIELDCAT1.

    WA_FIELDCAT1-FIELDNAME = 'GJAHR'.
    WA_FIELDCAT1-SELTEXT_L = 'YEAR'.
    APPEND WA_FIELDCAT1 TO FIELDCAT1.
    CLEAR WA_FIELDCAT1.

    WA_FIELDCAT1-FIELDNAME = 'BUZEI'.
    WA_FIELDCAT1-SELTEXT_L = 'ITEM NO.'.
    APPEND WA_FIELDCAT1 TO FIELDCAT1.
    CLEAR WA_FIELDCAT1.

    WA_FIELDCAT1-FIELDNAME = 'DMBTR'.
    WA_FIELDCAT1-SELTEXT_L = 'VALUE'.
    APPEND WA_FIELDCAT1 TO FIELDCAT1.
    CLEAR WA_FIELDCAT1.

    LAYOUT1-ZEBRA = 'X'.
    LAYOUT1-COLWIDTH_OPTIMIZE = 'X'.
    LAYOUT1-WINDOW_TITLEBAR  = 'DETAIL LIST'.


    CALL FUNCTION 'REUSE_ALV_GRID_DISPLAY'
      EXPORTING
*       I_INTERFACE_CHECK       = ' '
*       I_BYPASSING_BUFFER      = ' '
*       I_BUFFER_ACTIVE         = ' '
        I_CALLBACK_PROGRAM      = G_REPID
*       I_CALLBACK_PF_STATUS_SET          = 'STATUS'
        I_CALLBACK_USER_COMMAND = 'USER_COMM1'
        I_CALLBACK_TOP_OF_PAGE  = 'TOP2'
*       I_CALLBACK_HTML_TOP_OF_PAGE       = ' '
*       I_CALLBACK_HTML_END_OF_LIST       = ' '
*       I_STRUCTURE_NAME        =
*       I_BACKGROUND_ID         = ' '
*       I_GRID_TITLE            =
*       I_GRID_SETTINGS         = L_GLAY
        IS_LAYOUT               = LAYOUT1
        IT_FIELDCAT             = FIELDCAT1
*       IT_EXCLUDING            =
*       IT_SPECIAL_GROUPS       =
*       IT_SORT                 =
*       IT_FILTER               =
*       IS_SEL_HIDE             =
*       I_DEFAULT               = 'X'
        I_SAVE                  = 'A'
*       IS_VARIANT              =
*       IT_EVENTS               =
*       IT_EVENT_EXIT           =
*       IS_PRINT                =
*       IS_REPREP_ID            =
*       I_SCREEN_START_COLUMN   = 0
*       I_SCREEN_START_LINE     = 0
*       I_SCREEN_END_COLUMN     = 0
*       I_SCREEN_END_LINE       = 0
*       I_HTML_HEIGHT_TOP       = 0
*       I_HTML_HEIGHT_END       = 0
*       IT_ALV_GRAPHICS         =
*       IT_HYPERLINK            =
*       IT_ADD_FIELDCAT         =
*       IT_EXCEPT_QINFO         =
*       IR_SALV_FULLSCREEN_ADAPTER        =
* IMPORTING
*       E_EXIT_CAUSED_BY_CALLER =
*       ES_EXIT_CAUSED_BY_USER  =
      TABLES
        T_OUTTAB                = ITAB_ACCT
      EXCEPTIONS
        PROGRAM_ERROR           = 1
        OTHERS                  = 2.
    IF SY-SUBRC <> 0.
* MESSAGE ID SY-MSGID TYPE SY-MSGTY NUMBER SY-MSGNO
*         WITH SY-MSGV1 SY-MSGV2 SY-MSGV3 SY-MSGV4.
    ENDIF.


    CLEAR : ITAB_ACCT,WA_ACCT, FIELDCAT1, A.
  ENDIF.
***EXIT.
***  alv_layout-colwidth_optimize = 'X'.
***  alv_layout-numc_sum = 'X'.
***  alv_layout-window_titlebar = title.
***
***
***  CALL FUNCTION 'REUSE_ALV_GRID_DISPLAY'
***    EXPORTING
***      i_callback_program = g_repid
****     I_CALLBACK_PF_STATUS_SET          = ' '
****     I_CALLBACK_USER_COMMAND           = 'USER_COMMAND'
****     I_CALLBACK_TOP_OF_PAGE            = ' '
****     I_CALLBACK_HTML_TOP_OF_PAGE       = ' '
***      is_layout          = alv_layout
***      it_fieldcat        = fieldcat
****     IT_SORT            =
***    TABLES
***      t_outtab           = <fs_tab>
***    EXCEPTIONS
***      program_error      = 1
***      OTHERS             = 2.
***  IF sy-subrc <> 0.
***    MESSAGE ID sy-msgid TYPE sy-msgty NUMBER sy-msgno
***            WITH sy-msgv1 sy-msgv2 sy-msgv3 sy-msgv4.
***  ENDIF.

ENDFORM.                    "USER_COMMAND

FORM USER_COMM1 USING UCOMM LIKE SY-UCOMM
                     SELFIELD TYPE SLIS_SELFIELD.



  CASE SELFIELD-FIELDNAME.
    WHEN 'VBELN'.
      SET PARAMETER ID 'VF' FIELD SELFIELD-VALUE.
      CALL TRANSACTION 'VF03' AND SKIP FIRST SCREEN.
    WHEN 'BELNR'.
      SET PARAMETER ID 'BLN' FIELD SELFIELD-VALUE.
      CALL TRANSACTION 'FB03' AND SKIP FIRST SCREEN.
    WHEN 'VBELN1'.
      SET PARAMETER ID 'BV' FIELD SELFIELD-VALUE.
      CALL TRANSACTION 'VL03N' AND SKIP FIRST SCREEN.
    WHEN OTHERS.
  ENDCASE.
ENDFORM.                    "USER_COMM
*&---------------------------------------------------------------------*
*&      Form  TITLE
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*      -->P_SELC_FIELDNAME  text
*      <--P_TITLE  text
*----------------------------------------------------------------------*
FORM TITLE  USING    P_SELC_FIELDNAME
            CHANGING P_TITLE.

  READ TABLE ITAB_TGSBT ASSIGNING <FS_TGSBT> WITH KEY
    GSBER = P_SELC_FIELDNAME.
  IF SY-SUBRC = 0.
    FIND '-' IN <FS_TGSBT>-GTEXT MATCH OFFSET MOFF.
    CONCATENATE P_TITLE '-' <FS_TGSBT>-GTEXT(MOFF) INTO
    P_TITLE SEPARATED BY SPACE..
  ENDIF.

ENDFORM.                    " TITLE
*&---------------------------------------------------------------------*
*&      Form  AUTH_PLNT
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM AUTH_PLNT .

  LOOP AT ITAB_WERKS ASSIGNING <FS_WERKS>.
    AUTHORITY-CHECK OBJECT 'M_BCO_WERK'
           ID 'WERKS' FIELD <FS_WERKS>-WERKS.
    IF SY-SUBRC <> 0.
      CONCATENATE 'No authorization for Plant' <FS_WERKS>-WERKS INTO
      MESG
      SEPARATED BY SPACE.
      MESSAGE MESG TYPE 'E'.
    ENDIF.
  ENDLOOP.

  CLEAR: ITAB_WERKS, ITAB_WERKS[].

ENDFORM.                    " AUTH_PLNT
*&---------------------------------------------------------------------*
*&      Form  BUILD_XLS_DATA_TABLE
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
*form BUILD_XLS_DATA_TABLE .
****   CONSTANTS: con_cret TYPE x VALUE '0D',  "OK for non Unicode
****              con_tab TYPE x VALUE '09'.   "OK for non Unicode
**  data : alv_fldcat type slis_t_fieldcat_alv,
**          wa_fld type  slis_fieldcat_alv.
*class cl_abap_char_utilities definition load.
*data : v_date type dats.
*
*
*constants:
*    con_tab  type c value cl_abap_char_utilities=>HORIZONTAL_TAB,
*    con_cret type c value cl_abap_char_utilities=>CR_LF.
*
* data: list type slis_t_listheader,
*        w_list like line of list,
*        w_val type netwr,
*        w_value(15) type c,
*        wa_ln1 type i,
*        wa_ln2 type i,
*        wa_cnc(60) type c.
*
* types : begin of st_list,
*          info(255) type c,
*        end of st_list.
*
*data : itab_list type table of st_list,
*        wa_list type st_list.
*
*
*
*
** CONCATENATE sy-datum+6 '-' sy-datum+4(2) '-' sy-datum(4) into v_date.
**  concatenate
**  'IR-1' ':' 'DAILY' 'SALES' '/' 'DISTRIBUTION' 'REPORT' 'AS' 'OF' ':'
** v_date
**  into it_attach separated by space.
**  CONCATENATE  con_cret it_attach INTO it_attach.
**   append it_attach.
**   clear  it_attach.
**
*
*
*
*loop at alv_fldcat into wa_fld.
*  if wa_fld-fieldname = 'TYP'.
*    CONCATENATE it_attach  'TYPE'  into it_attach
*                                   SEPARATED BY con_tab.
*  elseif wa_fld-fieldname = 'NAM'.
*    CONCATENATE it_attach 'SALES_DIST_REPORT_IR1'  into it_attach
*                                   SEPARATED BY con_tab.
*  else.
*CONCATENATE it_attach wa_fld-fieldname  into it_attach
*                                   SEPARATED BY con_tab.
*ENDIF.
**  CONCATENATE ' ' ' ' 'AHM' 'BHI' 'CAR' 'COC' 'CUT' 'DDN' 'DEL' 'GAZ'
**                      'GOA' 'HUB' 'HYD' 'IND' 'JAI' 'KOL' 'LUC' 'MEE'
**                      'NSK'  'PAT' 'PUN' 'RAN' 'RPR' 'Nos' 'Total'
**                       INTO it_attach SEPARATED BY con_tab.
*
*  endloop.
**  CONCATENATE ' ' ' ' it_attach into it_attach SEPARATED BY con_tab.
*     CONCATENATE  it_attach con_tab into it_attach  .
*  append it_attach.
*  clear  it_attach.
*
*
**types : begin of wa,
**        typ(20), nam(20),
**        ahm type p DECIMALS 2,
**        bhi type p DECIMALS 2,
**        car type p DECIMALS 2,
**        coc type p DECIMALS 2,
**        cut type p DECIMALS 2,
**        ddn type p DECIMALS 2,
**        del type p DECIMALS 2,
**        gaz type p DECIMALS 2,
**        goa type p DECIMALS 2,
**        hub type p DECIMALS 2,
**        hyd type p DECIMALS 2,
**        ind type p DECIMALS 2,
**        jai type p DECIMALS 2,
**        kol type p DECIMALS 2,
**        luc type p DECIMALS 2,
**        mee type p DECIMALS 2,
**        nsk type p DECIMALS 2,
**  oza type p DECIMALS 2,
**  pat type p DECIMALS 2,
**  pun type p DECIMALS 2,
**  ran type p DECIMALS 2,
**  rpr type p DECIMALS 2,
**  nos type p DECIMALS 2,
**  total type p DECIMALS 2,
**        end of wa.
*
*
*types : begin of wa,
*        typ(20), nam(20),
*        ahm(10) type c," DECIMALS 2,
*        bhi(10) type c," DECIMALS 2,
*        car(10) type c," DECIMALS 2,
*        coc(10) type c," DECIMALS 2,
*        cut(10) type c," DECIMALS 2,
*        ddn(10) type c,
*        del(10) type c,
*        gaz(10) type c,
*        goa(10) type c,
*        hub(10) type c,
*        hyd(10) type c,
*        ind(14) type c,
*        jai(10) type c,
*        kol(10) type c,
*        luc(10) type c,
*        mee(10) type c,
*        nsk(10) type c,
*        oza(10) type c,
*        pat(10) type c,
*        pun(10) type c,
*        ran(10) type c,
*        rpr(10) type c,
*        nos(10) type c,
*        total(14) type  c,
*        end of wa.
*
*data : wa1 type wa,
*       v_str type string,
*       t_str type string.
*
*LOOP AT <dyn_table> ASSIGNING <dyn_wa>.
* MOVE-CORRESPONDING <dyn_wa> to wa1.
*
*loop at alv_fldcat into wa_fld.
*CONCATENATE 'wa1-' wa_fld-fieldname into v_str.
*Assign (v_str) to <FS1>.
*CONCATENATE  it_attach <FS1> into it_attach SEPARATED BY con_tab.
*CONDENSE it_attach.
*endloop.
*
**CONCATENATE wa1-typ wa1-nam wa1-ahm wa1-bhi wa1-car wa1-coc wa1-cut
**            wa1-ddn wa1-del wa1-gaz wa1-goa wa1-hub wa1-hyd wa1-ind
**            wa1-jai wa1-kol wa1-luc wa1-mee wa1-nsk
**            wa1-pat
**            wa1-pun wa1-ran wa1-rpr wa1-nos wa1-total
**            into it_attach SEPARATED BY con_tab.
**
*CONCATENATE it_attach con_tab into it_attach.
*  CONCATENATE  con_cret it_attach INTO it_attach.
*  APPEND it_attach.
*  clear it_attach.
*ENDLOOP.
*
*
*
*
**  describe table itab_plntstk.
**  if sy-tfill > 0.
**    w_list-info = 'Stock Value :'.
**    clear w_val.
**    loop at itab_plntstk into wa_plntstk.
**      read table itab_plnt_nam assigning <fs_plnt_nam> with key werks
**      = wa_plntstk.
**      if sy-subrc = 0.
**        w_value = wa_plntstk-netwr.
**        w_val = w_val + wa_plntstk-netwr.
**
**        clear: wa_ln1, wa_ln2, wa_cnc.
**        concatenate <fs_plnt_nam>-kunnr '=' w_value into
**        wa_cnc separated by con_tab.
**
**        wa_ln1 = strlen( w_list-info ).
**        wa_ln2 = strlen( wa_cnc ).
**        wa_ln1 = wa_ln1 + wa_ln2 + 1.
***        if wa_ln1 > 60.
***          append w_list to list.
***          clear w_list-info.
***        endif.
**        concatenate  w_list-info wa_cnc into w_list-info
**        separated  BY con_tab.
**        CONDENSE w_list-info. " added by amit
**      endif.
**    endloop.
**  endif.
*
*describe table itab_plntstk.
*  if sy-tfill > 0.
*    wa_list-info = 'Stock Value :'.
*    clear w_val.
*    loop at itab_plntstk into wa_plntstk.
*      read table itab_plnt_nam assigning <fs_plnt_nam> with key werks
*      = wa_plntstk.
*      if sy-subrc = 0.
*        w_value = wa_plntstk-netwr.
*        w_val = w_val + wa_plntstk-netwr.
*
*        clear: wa_ln1, wa_ln2, wa_cnc.
*        concatenate <fs_plnt_nam>-kunnr '=' w_value into
*        wa_cnc separated by con_tab.
*
*        wa_ln1 = strlen( wa_list-info ).
*        wa_ln2 = strlen( wa_cnc ).
*        wa_ln1 = wa_ln1 + wa_ln2 + 1.
**        if wa_ln1 > 60.
**          append w_list to list.
**          clear w_list-info.
**        endif.
*        concatenate  wa_list-info wa_cnc into wa_list-info
*        separated  BY con_tab.
*        CONDENSE wa_list-info. " added by amit
*      endif.
*    endloop.
*  endif.
*
*  loop at <dyn_table> assigning <dyn_wa>.
*    assign component 'NAM' of structure <dyn_wa> to <fs>.
*    if <fs> = 'Total Stock Value'.
*      assign component 'TOTAL' of structure <dyn_wa> to <fs>.
*      w_val = w_val + <fs>.
*      exit.
*    endif.
*  endloop.
**  append w_list to list.
**  clear w_list-info.
*
*  w_value = w_val.
*  concatenate wa_list-info 'TOTAL STOCK VALUE' '=' w_value into
*  wa_list-info separated BY con_tab.
*  CONDENSE wa_list-info.
*  CONCATENATE wa_list-info con_tab into wa_list-info.
*  append wa_list to itab_list.
*  clear wa_list.
*
*
**CONCATENATE con_cret ' ' it_attach into it_attach SEPARATED BY
**con_tab.
***  CONCATENATE con_cret it_attach into it_attach.
** APPEND it_attach.
** clear it_attach.
*
*
*delete list where info is INITIAL.
*loop at itab_list INTO wa_list.
*  move wa_list-info to it_attach .
**  CONDENSE it_attach.
*  CONCATENATE con_cret it_attach into it_attach.
* APPEND it_attach.
* clear it_attach.
*ENDLOOP.

*endform.                    " BUILD_XLS_DATA_TABLE
*&---------------------------------------------------------------------*
*&      Form  SEND_FILE_AS_EMAIL_ATTACHMENT
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*      -->P_IT_MESSAGE  text
*      -->P_IT_ATTACH  text
*      -->P_P_EMAIL  text
*      -->P_1706   text
*      -->P_1707   text
*      -->P_1708   text
*      -->P_1709   text
*      -->P_1710   text
*      -->P_1711   text
*      <--P_GD_ERROR  text
*      <--P_GD_RECIEVER  text
*----------------------------------------------------------------------*
*form SEND_FILE_AS_EMAIL_ATTACHMENT  tables
*                               pit_message  structure it_message
*                               pit_attach   structure it_attach
*                                    using    p_email
*                                             p_mtitle
*                                             p_format
*                                             p_filename
*                                             p_attdescription
*                                             p_sender_address
*                                             p_sender_addres_type
*
*                                    changing p_error
*                                             p_reciever.
*
*DATA: ld_error    TYPE sy-subrc,
*        ld_reciever TYPE sy-subrc,
*        ld_mtitle LIKE sodocchgi1-obj_descr,
*        ld_email LIKE  somlreci1-receiver,
*        ld_format TYPE  so_obj_tp ,
*        ld_attdescription TYPE  so_obj_nam ,
*        ld_attfilename TYPE  so_obj_des ,
*        ld_sender_address LIKE  soextreci1-receiver,
*        ld_sender_address_type LIKE  soextreci1-adr_typ,
*        ld_receiver LIKE  sy-subrc.
*
*  ld_email   = p_email.
*  ld_mtitle = p_mtitle.
*  ld_format              = p_format.
*  ld_attdescription      = 'YIR1'."p_attdescription.
*  ld_attfilename         = p_filename.
*  ld_sender_address      = p_sender_address.
*  ld_sender_address_type = p_sender_addres_type.
*
*
** Fill the document data.
*  w_doc_data-doc_size = 1.
*
** Populate the subject/generic message attributes
*  w_doc_data-obj_langu = sy-langu.
*  w_doc_data-obj_name  = 'SAPRPT'.
*  w_doc_data-obj_descr = ld_mtitle .
*  w_doc_data-sensitivty = 'F'.
*
** Fill the document data and get size of attachment
*  CLEAR w_doc_data.
*  READ TABLE it_attach INDEX w_cnt.
*  w_doc_data-doc_size =
*     ( w_cnt - 1 ) * 255 + STRLEN( it_attach ).
*  w_doc_data-obj_langu  = sy-langu.
*  w_doc_data-obj_name   = 'SAPRPT'.
*  w_doc_data-obj_descr  = ld_mtitle.
*  w_doc_data-sensitivty = 'F'.
*  CLEAR t_attachment.
*  REFRESH t_attachment.
*  t_attachment[] = pit_attach[].
*
** Describe the body of the message
*  CLEAR t_packing_list.
*  REFRESH t_packing_list.
*  t_packing_list-transf_bin = space.
*  t_packing_list-head_start = 1.
*  t_packing_list-head_num = 0.
*  t_packing_list-body_start = 1.
*  DESCRIBE TABLE it_message LINES t_packing_list-body_num.
*  t_packing_list-doc_type = 'RAW'.
*  APPEND t_packing_list.
*
** Create attachment notification
*  t_packing_list-transf_bin = 'X'.
*  t_packing_list-head_start = 1.
*  t_packing_list-head_num   = 1.
*  t_packing_list-body_start = 1.
*
*  DESCRIBE TABLE t_attachment LINES t_packing_list-body_num.
*  t_packing_list-doc_type   =  ld_format.
*  t_packing_list-obj_descr  =  ld_attdescription.
*  t_packing_list-obj_name   =  ld_attfilename.
*  t_packing_list-doc_size   =  t_packing_list-body_num * 255.
*  APPEND t_packing_list.
*
** Add the recipients email address
*  CLEAR t_receivers.
*  REFRESH t_receivers.
*  t_receivers-receiver = ld_email.
*  t_receivers-rec_type = 'U'.
*  t_receivers-com_type = 'INT'.
*  t_receivers-notif_del = 'X'.
*  t_receivers-notif_ndel = 'X'.
*  APPEND t_receivers.
*
*  CALL FUNCTION 'SO_DOCUMENT_SEND_API1'
*       EXPORTING
*            document_data              = w_doc_data
*            put_in_outbox              = 'X'
*            sender_address             = ld_sender_address
*            sender_address_type        = ld_sender_address_type
*            commit_work                = 'X'
*       IMPORTING
*            sent_to_all                = w_sent_all
*       TABLES
*            packing_list               = t_packing_list
*            contents_bin               = t_attachment
*            contents_txt               = it_message
*            receivers                  = t_receivers
*       EXCEPTIONS
*            too_many_receivers         = 1
*            document_not_sent          = 2
*            document_type_not_exist    = 3
*            operation_no_authorization = 4
*            parameter_error            = 5
*            x_error                    = 6
*            enqueue_error              = 7
*            OTHERS                     = 8.
*
** Populate zerror return code
*  ld_error = sy-subrc.
* COMMIT WORK.
*
* clear : t_packing_list,
*         t_attachment,
*         it_message,
*         t_receivers.
*
* refresh : t_packing_list,
*         t_attachment,
*         it_message,
*         t_receivers.
*
** Populate zreceiver return code
*  LOOP AT t_receivers.
*    ld_receiver = t_receivers-retrn_code.
*  ENDLOOP.
*
*
*endform.                    " SEND_FILE_AS_EMAIL_ATTACHMENT
*&---------------------------------------------------------------------*
*&      Form  POPULATE_EMAIL_MESSAGE_BODY
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
*form POPULATE_EMAIL_MESSAGE_BODY .
*  REFRESH it_message.
*it_message = 'Please find attached list of YIR1 Report'.
*  APPEND it_message.
*
*endform.                    " POPULATE_EMAIL_MESSAGE_BODY
*&---------------------------------------------------------------------*
*&      Form  INITIATE_MAIL_EXECUTE_PROGRAM
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
*form INITIATE_MAIL_EXECUTE_PROGRAM .
*     WAIT UP TO 2 SECONDS.
*  SUBMIT rsconn01 WITH   mode = 'INT'
**                  WITH output = 'X'
*                  AND RETURN.

*endform.                    " INITIATE_MAIL_EXECUTE_PROGRAM
*&---------------------------------------------------------------------*
*&      Form  ALV1
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM ALV1 .

  LOOP AT IT_FLDCAT INTO WA_IT_FLDCAT.
    WA_FLD-FIELDNAME = WA_IT_FLDCAT-FIELDNAME.
    WA_FLD-SELTEXT_L = WA_IT_FLDCAT-SELTEXT.
    WA_FLD-INTLEN = WA_IT_FLDCAT-INTLEN.
    WA_FLD-INTLEN = WA_IT_FLDCAT-DATATYPE.
    WA_FLD-INTLEN = WA_IT_FLDCAT-DECIMALS.
    WA_FLD-KEY = WA_IT_FLDCAT-KEY.
    WA_FLD-NO_ZERO = 'X'.
    WA_FLD-NO_OUT = WA_IT_FLDCAT-NO_OUT.
    IF P_DIV = 'X'.
      WA_FLD-DECIMALS_OUT = '0'.
    ENDIF.
    APPEND WA_FLD TO ALV_FLDCAT.
  ENDLOOP.

  ALV_LAYOUT-WINDOW_TITLEBAR = 'IR1'.
  ALV_LAYOUT-COLWIDTH_OPTIMIZE = 'X'.
  ALV_LAYOUT-ZEBRA = 'X'.

  WA_EVENTS-NAME = SLIS_EV_END_OF_LIST.
  WA_EVENTS-FORM = 'END_OF_LIST'.
  APPEND WA_EVENTS  TO IT_EVENTS.
  CLEAR WA_EVENTS .

  CALL FUNCTION 'REUSE_ALV_GRID_DISPLAY'
    EXPORTING
      I_CALLBACK_PROGRAM      = G_REPID
*     I_CALLBACK_PF_STATUS_SET          = ' '
      I_CALLBACK_USER_COMMAND = 'USER_COMMAND'
      I_CALLBACK_TOP_OF_PAGE  = 'TOP_OF_LIST'
      IS_LAYOUT               = ALV_LAYOUT
      IT_FIELDCAT             = ALV_FLDCAT
      I_DEFAULT               = 'X'
      I_SAVE                  = 'A'
*     it_events               = it_events
    TABLES
      T_OUTTAB                = <DYN_TABLE>
    EXCEPTIONS
      PROGRAM_ERROR           = 1
      OTHERS                  = 2.
  IF SY-SUBRC <> 0.
    MESSAGE ID SY-MSGID TYPE SY-MSGTY NUMBER SY-MSGNO
            WITH SY-MSGV1 SY-MSGV2 SY-MSGV3 SY-MSGV4.
  ENDIF.


ENDFORM.

FORM TOP2.

  DATA: COMMENT    TYPE SLIS_T_LISTHEADER,
        WA_COMMENT LIKE LINE OF COMMENT.

  WA_COMMENT-TYP = 'A'.
  WA_COMMENT-INFO = 'DETAIL LIST'.
*  WA_COMMENT-INFO = P_FRMDT.
  APPEND WA_COMMENT TO COMMENT.

  CALL FUNCTION 'REUSE_ALV_COMMENTARY_WRITE'
    EXPORTING
      IT_LIST_COMMENTARY = COMMENT
*     I_LOGO             = 'ENJOYSAP_LOGO'
*     I_END_OF_LIST_GRID =
*     I_ALV_FORM         =
    .

  CLEAR COMMENT.

ENDFORM.                    "TOP
*&---------------------------------------------------------------------*
*&      Form  RECEIPT
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM RECEIPT.
  CLEAR : IT_MSEG,WA_MSEG,IT_MKPF,WA_MKPF.
*  break-point.

  SELECT * FROM MKPF INTO TABLE IT_MKPF WHERE MJAHR EQ YEAR AND VGART IN ('WE','WF') AND BUDAT EQ ASDT.
  IF SY-SUBRC EQ 0.
    SELECT * FROM MSEG INTO TABLE IT_MSEG FOR ALL ENTRIES IN IT_MKPF WHERE MBLNR EQ IT_MKPF-MBLNR AND MJAHR EQ IT_MKPF-MJAHR AND LGORT NE 'CSM'
      AND WERKS IN ('2000','2002','3000','2027').
  ENDIF.


  LOOP AT IT_MSEG INTO WA_MSEG.
    SELECT SINGLE * FROM EKKO WHERE EBELN EQ WA_MSEG-EBELN AND BSART EQ 'ZUB'.
    IF SY-SUBRC EQ 4.
      CLEAR : PTS.
      READ TABLE IT_MKPF INTO WA_MKPF WITH KEY MBLNR = WA_MSEG-MBLNR MJAHR = WA_MSEG-MJAHR.
      IF SY-SUBRC EQ 0.
        SELECT SINGLE * FROM MARA WHERE MATNR EQ WA_MSEG-MATNR.
        IF SY-SUBRC EQ 0.
          IF MARA-MTART EQ 'ZFRT' OR MARA-MTART EQ 'ZHWA'.
            CLEAR : PTS.
*            IF WA_MSEG-WERKS EQ '2000' OR WA_MSEG-WERKS EQ '2002' OR WA_MSEG-WERKS EQ '3000' OR WA_MSEG-WERKS EQ '2027'.
*            write : / wa_mseg-werks,wa_mseg-lgort,wa_mseg-mblnr,wa_mseg-mjahr,wa_mseg-matnr,wa_mseg-charg,wa_mseg-menge,wa_mseg-shkzg.
            SELECT SINGLE * FROM A602 WHERE MATNR EQ WA_MSEG-MATNR AND CHARG EQ WA_MSEG-CHARG AND  KSCHL = 'Z001'
           AND DATAB LE SY-DATUM AND DATBI GE SY-DATUM.
            IF SY-SUBRC EQ 0.
              SELECT SINGLE * FROM KONP WHERE KNUMH = A602-KNUMH AND KSCHL EQ 'Z001' AND LOEVM_KO NE 'X'.
              IF SY-SUBRC EQ 0.
*                write : konp-kbetr.
                PTS = ( 6857 / 100 ) * ( KONP-KBETR / 100 ).
*                write : pts.
                OMLVAL = PTS * WA_MSEG-MENGE.
                TOMLVAL = TOMLVAL + OMLVAL.
              ENDIF.
            ENDIF.
*            ENDIF.
          ENDIF.
        ENDIF.
      ENDIF.
    ENDIF.
  ENDLOOP.

  TOMLVAL1 = TOMLVAL / 1000.
  TOMLVAL2 = TOMLVAL1.

ENDFORM.
*&---------------------------------------------------------------------*
*&      Form  RECEIPT1
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM RECEIPT1.
  CLEAR : IT_MSEG,WA_MSEG,IT_MKPF,WA_MKPF.
*  break-point.
  YEAR = ASDT+0(4).
  SELECT * FROM MKPF INTO TABLE IT_MKPF WHERE MJAHR EQ YEAR AND BUDAT EQ ASDT.
  IF SY-SUBRC EQ 0.
    SELECT * FROM MSEG INTO TABLE IT_MSEG FOR ALL ENTRIES IN IT_MKPF WHERE MBLNR EQ IT_MKPF-MBLNR AND MJAHR EQ IT_MKPF-MJAHR
      AND WERKS IN ('1000','1001') AND LGORT GE 'FG01' AND LGORT LE 'FG04' AND XAUTO NE  'X' AND INSMK EQ ' ' AND BWART IN ('321', '322').
  ENDIF.

  LOOP AT IT_MSEG INTO WA_MSEG.
    SELECT SINGLE * FROM EKKO WHERE EBELN EQ WA_MSEG-EBELN AND BSART EQ 'ZUB'.
    IF SY-SUBRC EQ 4.
      CLEAR : PTS,NSKVAL.
      READ TABLE IT_MKPF INTO WA_MKPF WITH KEY MBLNR = WA_MSEG-MBLNR MJAHR = WA_MSEG-MJAHR.
      IF SY-SUBRC EQ 0.
        IF WA_MSEG-SHKZG EQ 'S'.
          WA_MSEG-MENGE = WA_MSEG-MENGE * ( - 1 ).
        ENDIF.
        SELECT SINGLE * FROM MARA WHERE MATNR EQ WA_MSEG-MATNR.
        IF SY-SUBRC EQ 0.
          IF MARA-MTART EQ 'ZFRT' OR MARA-MTART EQ 'ZHWA'.
            CLEAR : PTS.
*          IF WA_MSEG-WERKS EQ '1000'.
*            write : / '1000',wa_mseg-werks,wa_mseg-lgort,wa_mseg-bwart,wa_mseg-mblnr,wa_mseg-mjahr,wa_mkpf-budat,wa_mseg-matnr,wa_mseg-charg,wa_mseg-menge,wa_mseg-shkzg.
            SELECT SINGLE * FROM A602 WHERE MATNR EQ WA_MSEG-MATNR AND CHARG EQ WA_MSEG-CHARG AND  KSCHL = 'Z001'
           AND DATAB LE SY-DATUM AND DATBI GE SY-DATUM.
            IF SY-SUBRC EQ 0.
              SELECT SINGLE * FROM KONP WHERE KNUMH = A602-KNUMH AND KSCHL EQ 'Z001' AND LOEVM_KO NE 'X'.
              IF SY-SUBRC EQ 0.
*                write : konp-kbetr.
                PTS = ( 6857 / 100 ) * ( KONP-KBETR / 100 ).
*                write : pts.
                IF WA_MSEG-WERKS EQ '1000'.
                  NSKVAL = PTS * WA_MSEG-MENGE.
*                  write : 'A',nskval.
                  TNSKVAL = TNSKVAL + NSKVAL.
                ELSEIF WA_MSEG-WERKS EQ '1001'.
                  GOAVAL = PTS * WA_MSEG-MENGE.
                  TGOAVAL = TGOAVAL + GOAVAL.
                ENDIF.
              ENDIF.
            ENDIF.
*          ENDIF.
          ENDIF.
        ENDIF.
      ENDIF.
    ENDIF.
  ENDLOOP.

  TNSKVAL1 = TNSKVAL / 1000.
  TNSKVAL2 = TNSKVAL1.
  TGOAVAL1 = TGOAVAL / 1000.
  TGOAVAL2 = TGOAVAL1.



ENDFORM.

FORM EMAIL.
  FIELD-SYMBOLS : <LV_FIELD_VAL> TYPE ANY.

*  elseif r4 eq 'X'.
***************EMAIL TO SPECIFIC********
  READ TABLE  <DYN_TABLE> INTO <DYN_WA> INDEX 2.
  IF SY-SUBRC = 0.
* Temp start
*    PERFORM SET_VALUES USING <DYN_WA>  '2013' '2001'  '2023'  '2001'  '2003'
*                                       '2004' '2005'  '2006'  '2007'  '2010'
*                                       '2011' '2013'  '2014'  '2015'  '2016'
*                                       '2017' '2019'  '2020'  '2021'  '2023'
*                                       '2024' '2026'  '2028'  'NEP'   'TOTAL'
*                       CHANGING        TS_AHM   TS_BHS  TS_PUN  TS_OZH  TS_DEL
*                                       TS_COC   TS_MAD  TS_HUB  TS_HYD  TS_VIJ
*                                       TS_LUC   TS_VAR  TS_MEE  TS_ROH  TS_CHA
*                                       TS_ZIR   TS_JAI  TS_IND  TS_RAI  TS_PAT
*                                       TS_RAN   TS_KLC  TS_CTK  TS_NOS  TS_TOT.

    PERFORM SET_VALUES USING <DYN_WA>
                       CHANGING        TS_AHM   TS_BHS  TS_PUN  TS_OZH  TS_DEL
                                       TS_COC   TS_MAD  TS_HUB  TS_HYD  TS_VIJ
                                       TS_LUC   TS_VAR  TS_MEE  TS_ROH  TS_CHA
                                       TS_ZIR   TS_JAI  TS_IND  TS_RAI  TS_PAT
                                       TS_RAN   TS_KLC  TS_CTK  TS_NOS  TS_TOT.

* Temp end
  ENDIF.

  READ TABLE  <DYN_TABLE> INTO <DYN_WA> INDEX 3.
  IF SY-SUBRC = 0.
    PERFORM SET_VALUES USING <DYN_WA>
                       CHANGING        CS_AHM   CS_BHS  CS_PUN  CS_OZH  CS_DEL
                                       CS_COC   CS_MAD  CS_HUB  CS_HYD  CS_VIJ
                                       CS_LUC   CS_VAR  CS_MEE  CS_ROH  CS_CHA
                                       CS_ZIR   CS_JAI  CS_IND  CS_RAI  CS_PAT
                                       CS_RAN   CS_KLC  CS_CTK  CS_NOS  CS_TOT.
  ENDIF.

  READ TABLE  <DYN_TABLE> INTO <DYN_WA> INDEX 4.
  IF SY-SUBRC = 0.
    PERFORM SET_VALUES USING <DYN_WA>
                        CHANGING       LM_AHM   LM_BHS  LM_PUN  LM_OZH  LM_DEL
                                       LM_COC   LM_MAD  LM_HUB  LM_HYD  LM_VIJ
                                       LM_LUC   LM_VAR  LM_MEE  LM_ROH  LM_CHA
                                       LM_ZIR   LM_JAI  LM_IND  LM_RAI  LM_PAT
                                       LM_RAN   LM_KLC  LM_CTK  LM_NOS  LM_TOT.
  ENDIF.

  READ TABLE  <DYN_TABLE> INTO <DYN_WA> INDEX 5.
  IF SY-SUBRC = 0.
    PERFORM SET_VALUES USING <DYN_WA>
                        CHANGING       LY_AHM   LY_BHS  LY_PUN  LY_OZH  LY_DEL
                                       LY_COC   LY_MAD  LY_HUB  LY_HYD  LY_VIJ
                                       LY_LUC   LY_VAR  LY_MEE  LY_ROH  LY_CHA
                                       LY_ZIR   LY_JAI  LY_IND  LY_RAI  LY_PAT
                                       LY_RAN   LY_KLC  LY_CTK  LY_NOS  LY_TOT.
  ENDIF.

  READ TABLE  <DYN_TABLE> INTO <DYN_WA> INDEX 7.
  IF SY-SUBRC = 0.
    PERFORM SET_VALUES USING <DYN_WA>
                        CHANGING       CLS_AHM   CLS_BHS  CLS_PUN  CLS_OZH  CLS_DEL
                                       CLS_COC   CLS_MAD  CLS_HUB  CLS_HYD  CLS_VIJ
                                       CLS_LUC   CLS_VAR  CLS_MEE  CLS_ROH  CLS_CHA
                                       CLS_ZIR   CLS_JAI  CLS_IND  CLS_RAI  CLS_PAT
                                       CLS_RAN   CLS_KLC  CLS_CTK  CLS_NOS  CLS_TOT.

    CLS_TOT = CLS_AHM + CLS_BHS + CLS_PUN + CLS_OZH + CLS_DEL +
              CLS_COC + CLS_MAD + CLS_HUB + CLS_HYD + CLS_VIJ +
              CLS_LUC + CLS_VAR + CLS_MEE + CLS_ROH + CLS_CHA +
              CLS_ZIR + CLS_JAI + CLS_IND + CLS_RAI + CLS_PAT +
              CLS_RAN + CLS_KLC + CLS_CTK .
  ENDIF.

  READ TABLE  <DYN_TABLE> INTO <DYN_WA> INDEX 8.
  IF SY-SUBRC = 0.
    PERFORM SET_VALUES USING <DYN_WA>
                        CHANGING       ITS_AHM   ITS_BHS  ITS_PUN  ITS_OZH  ITS_DEL
                                       ITS_COC   ITS_MAD  ITS_HUB  ITS_HYD  ITS_VIJ
                                       ITS_LUC   ITS_VAR  ITS_MEE  ITS_ROH  ITS_CHA
                                       ITS_ZIR   ITS_JAI  ITS_IND  ITS_RAI  ITS_PAT
                                       ITS_RAN   ITS_KLC  ITS_CTK  ITS_NOS  ITS_TOT.

    ITS_TOT =   ITS_AHM + ITS_BHS + ITS_PUN + ITS_OZH + ITS_DEL +
                ITS_COC + ITS_MAD + ITS_HUB + ITS_HYD + ITS_VIJ +
                ITS_LUC + ITS_VAR + ITS_MEE + ITS_ROH + ITS_CHA +
                ITS_ZIR + ITS_JAI + ITS_IND + ITS_RAI + ITS_PAT +
                ITS_RAN + ITS_KLC + ITS_CTK .
  ENDIF.

  READ TABLE  <DYN_TABLE> INTO <DYN_WA> INDEX 9.
  IF SY-SUBRC = 0.
    PERFORM SET_VALUES USING <DYN_WA>
                        CHANGING       TSV_AHM   TSV_BHS  TSV_PUN  TSV_OZH  TSV_DEL
                                       TSV_COC   TSV_MAD  TSV_HUB  TSV_HYD  TSV_VIJ
                                       TSV_LUC   TSV_VAR  TSV_MEE  TSV_ROH  TSV_CHA
                                       TSV_ZIR   TSV_JAI  TSV_IND  TSV_RAI  TSV_PAT
                                       TSV_RAN   TSV_KLC  TSV_CTK  TSV_NOS  TSV_TOT.
    TSV_TOT = CLS_AHM + TSV_BHS + TSV_PUN + TSV_OZH + TSV_DEL +
              TSV_COC + TSV_MAD + TSV_HUB + TSV_HYD + TSV_VIJ +
              TSV_LUC + TSV_VAR + TSV_MEE + TSV_ROH + TSV_CHA +
              TSV_ZIR + TSV_JAI + TSV_IND + TSV_RAI + TSV_PAT +
              TSV_RAN + TSV_KLC + TSV_CTK .
  ENDIF.

  READ TABLE  <DYN_TABLE> INTO <DYN_WA> INDEX 11.
  IF SY-SUBRC = 0.
    PERFORM SET_VALUES USING <DYN_WA>
                        CHANGING       PP_AHM   PP_BHS  PP_PUN  PP_OZH  PP_DEL
                                       PP_COC   PP_MAD  PP_HUB  PP_HYD  PP_VIJ
                                       PP_LUC   PP_VAR  PP_MEE  PP_ROH  PP_CHA
                                       PP_ZIR   PP_JAI  PP_IND  PP_RAI  PP_PAT
                                       PP_RAN   PP_KLC  PP_CTK  PP_NOS  PP_TOT.

  ENDIF.

  READ TABLE  <DYN_TABLE> INTO <DYN_WA> INDEX 12.
  IF SY-SUBRC = 0.
    PERFORM SET_VALUES USING <DYN_WA>
                        CHANGING       OD_AHM   OD_BHS  OD_PUN  OD_OZH  OD_DEL
                                       OD_COC   OD_MAD  OD_HUB  OD_HYD  OD_VIJ
                                       OD_LUC   OD_VAR  OD_MEE  OD_ROH  OD_CHA
                                       OD_ZIR   OD_JAI  OD_IND  OD_RAI  OD_PAT
                                       OD_RAN   OD_KLC  OD_CTK  OD_NOS  OD_TOT.
  ENDIF.

  READ TABLE  <DYN_TABLE> INTO <DYN_WA> INDEX 13.
  IF SY-SUBRC = 0.
    PERFORM SET_VALUES USING <DYN_WA>
                        CHANGING       CL_AHM   CL_BHS  CL_PUN  CL_OZH  CL_DEL
                                       CL_COC   CL_MAD  CL_HUB  CL_HYD  CL_VIJ
                                       CL_LUC   CL_VAR  CL_MEE  CL_ROH  CL_CHA
                                       CL_ZIR   CL_JAI  CL_IND  CL_RAI  CL_PAT
                                       CL_RAN   CL_KLC  CL_CTK  CL_NOS  CL_TOT.
  ENDIF.

* Subtotals
  TP_AHM = PP_AHM + OD_AHM + CL_AHM + OR_AHM.
  TP_BHS = PP_BHS + OD_BHS + CL_BHS + OR_BHS.
  TP_PUN = PP_PUN + OD_PUN + CL_PUN + OR_PUN.
  TP_OZH = PP_OZH + OD_OZH + CL_OZH + OR_OZH.
  TP_DEL = PP_DEL + OD_DEL + CL_DEL + OR_DEL.
  TP_COC = PP_COC + OD_COC + CL_COC + OR_COC.
  TP_MAD = PP_MAD + OD_MAD + CL_MAD + OR_MAD.
  TP_HUB = PP_HUB + OD_HUB + CL_HUB + OR_HUB.
  TP_HYD = PP_HYD + OD_HYD + CL_HYD + OR_HYD.
  TP_VIJ = PP_VIJ + OD_AHM + CL_VIJ + OR_VIJ.
  TP_LUC = PP_LUC + OD_LUC + CL_LUC + OR_LUC.
  TP_VAR = PP_VAR + OD_VAR + CL_VAR + OR_VAR.
  TP_MEE = PP_MEE + OD_MEE + CL_MEE + OR_MEE.
  TP_ROH = PP_ROH + OD_ROH + CL_ROH + OR_ROH.
  TP_CHA = PP_CHA + OD_CHA + CL_CHA + OR_CHA.
  TP_ZIR = PP_ZIR + OD_ZIR + CL_ZIR + OR_ZIR.
  TP_JAI = PP_JAI + OD_JAI + CL_JAI + OR_JAI.
  TP_IND = PP_IND + OD_IND + CL_IND + OR_IND.
  TP_RAI = PP_RAI + OD_RAI + CL_RAI + OR_RAI.
  TP_PAT = PP_PAT + OD_PAT + CL_PAT + OR_PAT.
  TP_RAN = PP_RAN + OD_RAN + CL_RAN + OR_RAN.
  TP_KLC = PP_KLC + OD_KLC + CL_KLC + OR_KLC.
  TP_CTK = PP_CTK + OD_CTK + CL_CTK + OR_CTK.
  TP_TOT = PP_TOT + OD_TOT + CL_TOT + OR_TOT.

  READ TABLE  <DYN_TABLE> INTO <DYN_WA> INDEX 17.
  IF SY-SUBRC = 0.
    PERFORM SET_VALUES USING <DYN_WA>
                        CHANGING       PR_AHM   PR_BHS  PR_PUN  PR_OZH  PR_DEL
                                       PR_COC   PR_MAD  PR_HUB  PR_HYD  PR_VIJ
                                       PR_LUC   PR_VAR  PR_MEE  PR_ROH  PR_CHA
                                       PR_ZIR   PR_JAI  PR_IND  PR_RAI  PR_PAT
                                       PR_RAN   PR_KLC  PR_CTK  PR_NOS  PR_TOT.
  ENDIF.

  READ TABLE  <DYN_TABLE> INTO <DYN_WA> INDEX 18.
  IF SY-SUBRC = 0.
    PERFORM SET_VALUES USING <DYN_WA>
                        CHANGING       CPR_AHM   CPR_BHS  CPR_PUN  CPR_OZH  CPR_DEL
                                       CPR_COC   CPR_MAD  CPR_HUB  CPR_HYD  CPR_VIJ
                                       CPR_LUC   CPR_VAR  CPR_MEE  CPR_ROH  CPR_CHA
                                       CPR_ZIR   CPR_JAI  CPR_IND  CPR_RAI  CPR_PAT
                                       CPR_RAN   CPR_KLC  CPR_CTK  CPR_NOS  CPR_TOT.
  ENDIF.

  READ TABLE  <DYN_TABLE> INTO <DYN_WA> INDEX 19.
  IF SY-SUBRC = 0.
    PERFORM SET_VALUES USING <DYN_WA>
                        CHANGING       TR_AHM   TR_BHS  TR_PUN  TR_OZH  TR_DEL
                                       TR_COC   TR_MAD  TR_HUB  TR_HYD  TR_VIJ
                                       TR_LUC   TR_VAR  TR_MEE  TR_ROH  TR_CHA
                                       TR_ZIR   TR_JAI  TR_IND  TR_RAI  TR_PAT
                                       TR_RAN   TR_KLC  TR_CTK  TR_NOS  TR_TOT.
  ENDIF.

  READ TABLE  <DYN_TABLE> INTO <DYN_WA> INDEX 21.
  IF SY-SUBRC = 0.
    PERFORM SET_VALUES USING <DYN_WA>
                        CHANGING       O3_AHM   O3_BHS  O3_PUN  O3_OZH  O3_DEL
                                       O3_COC   O3_MAD  O3_HUB  O3_HYD  O3_VIJ
                                       O3_LUC   O3_VAR  O3_MEE  O3_ROH  O3_CHA
                                       O3_ZIR   O3_JAI  O3_IND  O3_RAI  O3_PAT
                                       O3_RAN   O3_KLC  O3_CTK  O3_NOS  O3_TOT.

    O3_TOT =  O3_AHM + O3_BHS + O3_PUN + O3_OZH + O3_DEL +
              O3_COC + O3_MAD + O3_HUB + O3_HYD + O3_VIJ +
              O3_LUC + O3_VAR + O3_MEE + O3_ROH + O3_CHA +
              O3_ZIR + O3_JAI + O3_IND + O3_RAI + O3_PAT +
              O3_RAN + O3_KLC + O3_CTK .
  ENDIF.

  READ TABLE  <DYN_TABLE> INTO <DYN_WA> INDEX 22.
  IF SY-SUBRC = 0.
    PERFORM SET_VALUES USING <DYN_WA>
                        CHANGING       O2_AHM   O2_BHS  O2_PUN  O2_OZH  O2_DEL
                                       O2_COC   O2_MAD  O2_HUB  O2_HYD  O2_VIJ
                                       O2_LUC   O2_VAR  O2_MEE  O2_ROH  O2_CHA
                                       O2_ZIR   O2_JAI  O2_IND  O2_RAI  O2_PAT
                                       O2_RAN   O2_KLC  O2_CTK  O2_NOS  O2_TOT.

    O2_TOT =  O2_AHM + O2_BHS + O2_PUN + O2_OZH + O2_DEL +
              O2_COC + O2_MAD + O2_HUB + O2_HYD + O2_VIJ +
              O2_LUC + O2_VAR + O2_MEE + O2_ROH + O2_CHA +
              O2_ZIR + O2_JAI + O2_IND + O2_RAI + O2_PAT +
              O2_RAN + O2_KLC + O2_CTK .
  ENDIF.

  READ TABLE  <DYN_TABLE> INTO <DYN_WA> INDEX 23.
  IF SY-SUBRC = 0.
    PERFORM SET_VALUES USING <DYN_WA>
                        CHANGING       O1_AHM   O1_BHS  O1_PUN  O1_OZH  O1_DEL
                                       O1_COC   O1_MAD  O1_HUB  O1_HYD  O1_VIJ
                                       O1_LUC   O1_VAR  O1_MEE  O1_ROH  O1_CHA
                                       O1_ZIR   O1_JAI  O1_IND  O1_RAI  O1_PAT
                                       O1_RAN   O1_KLC  O1_CTK  O1_NOS  O1_TOT.

    O1_TOT =  O1_AHM + O1_BHS + O1_PUN + O1_OZH + O1_DEL +
              O1_COC + O1_MAD + O1_HUB + O1_HYD + O1_VIJ +
              O1_LUC + O1_VAR + O1_MEE + O1_ROH + O1_CHA +
              O1_ZIR + O1_JAI + O1_IND + O1_RAI + O1_PAT +
              O1_RAN + O1_KLC + O1_CTK .
  ENDIF.


  READ TABLE  <DYN_TABLE> INTO <DYN_WA> INDEX 24.
  IF SY-SUBRC = 0.
    PERFORM SET_VALUES USING <DYN_WA>
                        CHANGING       U1_AHM   U1_BHS  U1_PUN  U1_OZH  U1_DEL
                                       U1_COC   U1_MAD  U1_HUB  U1_HYD  U1_VIJ
                                       U1_LUC   U1_VAR  U1_MEE  U1_ROH  U1_CHA
                                       U1_ZIR   U1_JAI  U1_IND  U1_RAI  U1_PAT
                                       U1_RAN   U1_KLC  U1_CTK  U1_NOS  U1_TOT.

    U1_TOT =  U1_AHM + U1_BHS + U1_PUN + U1_OZH + U1_DEL +
              U1_COC + U1_MAD + U1_HUB + U1_HYD + U1_VIJ +
              U1_LUC + U1_VAR + U1_MEE + U1_ROH + U1_CHA +
              U1_ZIR + U1_JAI + U1_IND + U1_RAI + U1_PAT +
              U1_RAN + U1_KLC + U1_CTK .
  ENDIF.
  ODR_AHM = O1_AHM + O2_AHM + O3_AHM + U1_AHM.
  ODR_BHS = O1_BHS + O2_BHS + O3_BHS + U1_BHS.
  ODR_PUN = O1_PUN + O2_PUN + O3_PUN + U1_PUN.
  ODR_OZH = O1_OZH + O2_OZH + O3_OZH + U1_OZH.
  ODR_DEL = O1_DEL + O2_DEL + O3_DEL + U1_DEL.
  ODR_COC = O1_COC + O2_COC + O3_COC + U1_COC.
  ODR_MAD = O1_MAD + O2_MAD + O3_MAD + U1_MAD.
  ODR_HUB = O1_HUB + O2_HUB + O3_HUB + U1_HUB.
  ODR_HYD = O1_HYD + O2_HYD + O3_HYD + U1_HYD.
  ODR_VIJ = O1_VIJ + O2_AHM + O3_VIJ + U1_VIJ.
  ODR_LUC = O1_LUC + O2_LUC + O3_LUC + U1_LUC.
  ODR_VAR = O1_VAR + O2_VAR + O3_VAR + U1_VAR.
  ODR_MEE = O1_MEE + O2_MEE + O3_MEE + U1_MEE.
  ODR_ROH = O1_ROH + O2_ROH + O3_ROH + U1_ROH.
  ODR_CHA = O1_CHA + O2_CHA + O3_CHA + U1_CHA.
  ODR_ZIR = O1_ZIR + O2_ZIR + O3_ZIR + U1_ZIR.
  ODR_JAI = O1_JAI + O2_JAI + O3_JAI + U1_JAI.
  ODR_IND = O1_IND + O2_IND + O3_IND + U1_IND.
  ODR_RAI = O1_RAI + O2_RAI + O3_RAI + U1_RAI.
  ODR_PAT = O1_PAT + O2_PAT + O3_PAT + U1_PAT.
  ODR_RAN = O1_RAN + O2_RAN + O3_RAN + U1_RAN.
  ODR_KLC = O1_KLC + O2_KLC + O3_KLC + U1_KLC.
  ODR_CTK = O1_CTK + O2_CTK + O3_CTK + U1_CTK.
  ODR_TOT = O1_TOT + O2_TOT + O3_TOT + U1_TOT.

  READ TABLE  <DYN_TABLE> INTO <DYN_WA> INDEX 27.
  IF SY-SUBRC = 0.
    PERFORM SET_VALUES USING <DYN_WA>
                        CHANGING       CN_AHM   CN_BHS  CN_PUN  CN_OZH  CN_DEL
                                       CN_COC   CN_MAD  CN_HUB  CN_HYD  CN_VIJ
                                       CN_LUC   CN_VAR  CN_MEE  CN_ROH  CN_CHA
                                       CN_ZIR   CN_JAI  CN_IND  CN_RAI  CN_PAT
                                       CN_RAN   CN_KLC  CN_CTK  CN_NOS  CN_TOT.
  ENDIF.

  READ TABLE  <DYN_TABLE> INTO <DYN_WA> INDEX 28.
  IF SY-SUBRC = 0.
    PERFORM SET_VALUES USING <DYN_WA>
                        CHANGING       DN_AHM   DN_BHS  DN_PUN  DN_OZH  DN_DEL
                                       DN_COC   DN_MAD  DN_HUB  DN_HYD  DN_VIJ
                                       DN_LUC   DN_VAR  DN_MEE  DN_ROH  DN_CHA
                                       DN_ZIR   DN_JAI  DN_IND  DN_RAI  DN_PAT
                                       DN_RAN   DN_KLC  DN_CTK  DN_NOS  DN_TOT.

  ENDIF.

  PERFORM  END_REPORT.

  WRITE ASDT TO WA_D1 DD/MM/YYYY.
*

  OPTIONS-TDGETOTF = 'X'.

  CALL FUNCTION 'OPEN_FORM'
    EXPORTING
      DEVICE   = 'PRINTER'
      DIALOG   = ''
      OPTIONS  = OPTIONS
*     form     = 'ZSR24_1'
      LANGUAGE = SY-LANGU
    EXCEPTIONS
      CANCELED = 1
      DEVICE   = 2.
  IF SY-SUBRC <> 0.
* MESSAGE ID SY-MSGID TYPE SY-MSGTY NUMBER SY-MSGNO
*         WITH SY-MSGV1 SY-MSGV2 SY-MSGV3 SY-MSGV4.
  ENDIF.
  CALL FUNCTION 'START_FORM'
    EXPORTING
*     form        = 'ZIR1_PDF_2'
*     FORM        = 'ZIR1_PDF_2A1'
      FORM        = 'ZIR1_PDF_2A2'
      LANGUAGE    = SY-LANGU
    EXCEPTIONS
      FORM        = 1
      FORMAT      = 2
      UNENDED     = 3
      UNOPENED    = 4
      UNUSED      = 5
      SPOOL_ERROR = 6
      CODEPAGE    = 7
      OTHERS      = 8.
  IF SY-SUBRC <> 0.
    MESSAGE ID SY-MSGID TYPE SY-MSGTY NUMBER SY-MSGNO
            WITH SY-MSGV1 SY-MSGV2 SY-MSGV3 SY-MSGV4.
  ENDIF.


  CALL FUNCTION 'WRITE_FORM'
    EXPORTING
      ELEMENT = 'IR1'
      WINDOW  = 'MAIN'.

  CALL FUNCTION 'END_FORM'
    EXCEPTIONS
      UNOPENED                 = 1
      BAD_PAGEFORMAT_FOR_PRINT = 2
      SPOOL_ERROR              = 3
      CODEPAGE                 = 4
      OTHERS                   = 5.
  IF SY-SUBRC <> 0.
    MESSAGE ID SY-MSGID TYPE SY-MSGTY NUMBER SY-MSGNO
            WITH SY-MSGV1 SY-MSGV2 SY-MSGV3 SY-MSGV4.
  ENDIF.

  CALL FUNCTION 'CLOSE_FORM'
    IMPORTING
      RESULT  = RESULT
    TABLES
      OTFDATA = L_OTF_DATA.

  CALL FUNCTION 'CONVERT_OTF'
    EXPORTING
      FORMAT       = 'PDF'
    IMPORTING
      BIN_FILESIZE = L_BIN_FILESIZE
    TABLES
      OTF          = L_OTF_DATA
      LINES        = L_ASC_DATA.

  CALL FUNCTION 'SX_TABLE_LINE_WIDTH_CHANGE'
    EXPORTING
      LINE_WIDTH_DST = '255'
    TABLES
      CONTENT_IN     = L_ASC_DATA
      CONTENT_OUT    = OBJBIN.

  WRITE ASDT TO WA_D1 DD/MM/YYYY.
*  write s_budat-high to wa_d2 dd/mm/yyyy.

  DESCRIBE TABLE OBJBIN LINES RIGHE_ATTACHMENT.
  OBJTXT = 'This eMail is meant for information only. Please DO NOT REPLY'.APPEND OBJTXT.
  OBJTXT = '                                 '.APPEND OBJTXT.
  OBJTXT = 'BLUE CROSS LABORATORIES PRIVATE LTD.'.APPEND OBJTXT.
  DESCRIBE TABLE OBJTXT LINES RIGHE_TESTO.
  DOC_CHNG-OBJ_NAME = 'URGENT'.
  DOC_CHNG-EXPIRY_DAT = SY-DATUM + 10.
  CONDENSE LTX.
  CONDENSE OBJTXT.
*      CONCATENATE 'SR9 for the period' ltx '-' INTO doc_chng-obj_descr SEPARATED BY space.
  CONCATENATE 'IR1-T FOR THE DATE  :' WA_D1  INTO DOC_CHNG-OBJ_DESCR SEPARATED BY SPACE.
  DOC_CHNG-SENSITIVTY = 'F'.
  DOC_CHNG-DOC_SIZE = RIGHE_TESTO * 255 .

  CLEAR OBJPACK-TRANSF_BIN.

  OBJPACK-HEAD_START = 1.
  OBJPACK-HEAD_NUM = 0.
  OBJPACK-BODY_START = 1.
  OBJPACK-BODY_NUM = 4.
  OBJPACK-DOC_TYPE = 'TXT'.
  APPEND OBJPACK.

  OBJPACK-TRANSF_BIN = 'X'.
  OBJPACK-HEAD_START = 1.
  OBJPACK-HEAD_NUM = 0.
  OBJPACK-BODY_START = 1.
  OBJPACK-BODY_NUM = RIGHE_ATTACHMENT.
  OBJPACK-DOC_TYPE = 'PDF'.
  OBJPACK-OBJ_NAME = 'TEST'.
  CONDENSE LTX.

  CONCATENATE 'IR1-T FOR THE DATE ' WA_D1 INTO OBJPACK-OBJ_DESCR SEPARATED BY SPACE.
  OBJPACK-DOC_SIZE = RIGHE_ATTACHMENT * 255.
  APPEND OBJPACK.
  CLEAR OBJPACK.

*  UEMAIL = 'sabu@bluecrosslabs.com'.
*  uemail =  'IR1@BLUECROSSLABS.COM'.
*  uemail =  'jyotsna@BLUECROSSLABS.COM'.
*    LOOP AT it_TAM2 INTO wa_TAM2 WHERE RM_PERNR = wa_TAm1-RM_PERNR.
  RECLIST-RECEIVER =   UEMAIL.
  RECLIST-EXPRESS = 'X'.
  RECLIST-REC_TYPE = 'U'.
  RECLIST-NOTIF_DEL = 'X'. " request delivery notification
  RECLIST-NOTIF_NDEL = 'X'. " request not delivered notification
  APPEND RECLIST.
  CLEAR RECLIST.
*    ENdloop.
  DESCRIBE TABLE RECLIST LINES MCOUNT.
  IF MCOUNT > 0.
    DATA: SENDER LIKE SOEXTRECI1-RECEIVER.
**ADDED BY SATHISH.B
    TYPES: BEGIN OF T_USR21,
             BNAME      TYPE USR21-BNAME,
             PERSNUMBER TYPE USR21-PERSNUMBER,
             ADDRNUMBER TYPE USR21-ADDRNUMBER,
           END OF T_USR21.

    TYPES: BEGIN OF T_ADR6,
             ADDRNUMBER TYPE USR21-ADDRNUMBER,
             PERSNUMBER TYPE USR21-PERSNUMBER,
             SMTP_ADDR  TYPE ADR6-SMTP_ADDR,
           END OF T_ADR6.

    DATA: IT_USR21 TYPE TABLE OF T_USR21,
          WA_USR21 TYPE T_USR21,
          IT_ADR6  TYPE TABLE OF T_ADR6,
          WA_ADR6  TYPE T_ADR6.
    SELECT  BNAME PERSNUMBER ADDRNUMBER FROM USR21 INTO TABLE IT_USR21
        WHERE BNAME = SY-UNAME.
    IF SY-SUBRC = 0.
      SELECT ADDRNUMBER PERSNUMBER SMTP_ADDR FROM ADR6 INTO TABLE IT_ADR6
        FOR ALL ENTRIES IN IT_USR21 WHERE ADDRNUMBER = IT_USR21-ADDRNUMBER
                                    AND   PERSNUMBER = IT_USR21-PERSNUMBER.
    ENDIF.
    SENDER = 'DISTRIBUTION@BLUECROSSLABS.COM'.
    CALL FUNCTION 'SO_DOCUMENT_SEND_API1'
      EXPORTING
        DOCUMENT_DATA              = DOC_CHNG
        PUT_IN_OUTBOX              = 'X'
        SENDER_ADDRESS             = SENDER
        SENDER_ADDRESS_TYPE        = 'SMTP'
      TABLES
        PACKING_LIST               = OBJPACK
        CONTENTS_BIN               = OBJBIN
        CONTENTS_TXT               = OBJTXT
        RECEIVERS                  = RECLIST
      EXCEPTIONS
        TOO_MANY_RECEIVERS         = 1
        DOCUMENT_NOT_SENT          = 2
        DOCUMENT_TYPE_NOT_EXIST    = 3
        OPERATION_NO_AUTHORIZATION = 4
        PARAMETER_ERROR            = 5
        X_ERROR                    = 6
        ENQUEUE_ERROR              = 7
        OTHERS                     = 8.
    IF SY-SUBRC <> 0.
      MESSAGE ID SY-MSGID TYPE SY-MSGTY NUMBER SY-MSGNO
              WITH SY-MSGV1 SY-MSGV2 SY-MSGV3 SY-MSGV4.
    ENDIF.

    COMMIT WORK.


    IF SY-SUBRC EQ 0.

      WRITE : / 'EMAIL SENT ON EMAIL ID: ',UEMAIL.
    ENDIF.



    CLEAR   : OBJPACK,
             OBJHEAD,
             OBJTXT,
             OBJBIN,
             RECLIST.

    REFRESH : OBJPACK,
              OBJHEAD,
              OBJTXT,
              OBJBIN,
              RECLIST.

  ENDIF.

ENDFORM.                    "EMAIL


FORM END_REPORT.

  DATA: LIST        TYPE SLIS_T_LISTHEADER,
        W_LIST      LIKE LINE OF LIST,
        W_VAL       TYPE NETWR,
        W_VALUE(15) TYPE C,
        WA_LN1      TYPE I,
        WA_LN2      TYPE I,
        WA_CNC(60)  TYPE C.

* Plant code from ZPLANT
  IF ITAB_PLNT_NAM IS NOT INITIAL.
    SELECT FROM ZPLANT AS A
      FIELDS
      A~WERKS,
      A~GSBER,
      A~ZSHORT_NM
      FOR ALL ENTRIES IN @ITAB_PLNT_NAM
      WHERE WERKS = @ITAB_PLNT_NAM-WERKS
      INTO TABLE @DATA(LT_ZPLANT).
    SORT LT_ZPLANT BY WERKS.
  ENDIF.

  DATA WA_LIST TYPE SLIS_LISTHEADER.
  W_LIST-TYP = 'A'.
  CLEAR LIST.
  DESCRIBE TABLE ITAB_PLNTSTK.
  IF SY-TFILL > 0.
    W_LIST-INFO = 'Stock Value :'.
    CLEAR W_VAL.
    LOOP AT ITAB_PLNTSTK INTO WA_PLNTSTK.
      READ TABLE ITAB_PLNT_NAM ASSIGNING <FS_PLNT_NAM> WITH KEY WERKS = WA_PLNTSTK-WERKS.
      IF SY-SUBRC = 0.

        W_VALUE = WA_PLNTSTK-NETWR.
        W_VAL = W_VAL + WA_PLNTSTK-NETWR.
* To replace kunnr with short code of plant
        <FS_PLNT_NAM>-KUNNR = VALUE #( LT_ZPLANT[ WERKS = <FS_PLNT_NAM>-WERKS ]-ZSHORT_NM OPTIONAL ).

        CLEAR: WA_LN1, WA_LN2, WA_CNC.
        IF WA_PLNTSTK-WERKS EQ '2002'.
          <FS_PLNT_NAM>-KUNNR = 'OZH-1'.
        ENDIF.
        IF WA_PLNTSTK-WERKS EQ '2027'.
          <FS_PLNT_NAM>-KUNNR = 'OZH-2'.
        ENDIF.
        CONCATENATE '   '   <FS_PLNT_NAM>-KUNNR INTO <FS_PLNT_NAM>-KUNNR .
        W_VALUE = TRUNC( W_VALUE ).
        CONDENSE W_VALUE NO-GAPS.
        CONCATENATE  '    '  <FS_PLNT_NAM>-KUNNR '=' W_VALUE  INTO
        WA_CNC SEPARATED BY SPACE.
        WA_LN1 = STRLEN( W_LIST-INFO ).
        WA_LN2 = STRLEN( WA_CNC ).
        WA_LN1 = WA_LN1 + WA_LN2 + 1.
        IF WA_LN1 > 60.
          APPEND W_LIST TO LIST.

          CLEAR W_LIST-INFO.
        ENDIF.
        CONCATENATE W_LIST-INFO WA_CNC  INTO W_LIST-INFO  SEPARATED BY
                SPACE.


      ENDIF.
    ENDLOOP.
  ENDIF.

  W_VAL  = W_VAL + TSV_TOT.
  APPEND W_LIST TO LIST.

  CLEAR W_LIST-INFO.

  W_VALUE = W_VAL.
  W_VALUE = TRUNC( W_VALUE ).
  CONDENSE W_VALUE NO-GAPS.
  CONCATENATE W_LIST-INFO 'TOTAL STOCK VALUE' '=' W_VALUE
*  ',BC%' bcper1 ' XL% '  xlper1
  INTO  W_LIST-INFO SEPARATED BY SPACE.
  APPEND W_LIST TO LIST.
  LOOP AT LIST INTO  WA_LIST.
    CONDENSE WA_LIST-INFO.
    CONCATENATE FOOT_LINE WA_LIST-INFO INTO FOOT_LINE SEPARATED BY SPACE.
  ENDLOOP.

  CLEAR LIST.
  CLEAR W_LIST-INFO.
*  LOOP AT LIST.
*  ENDLOOP.
  CONDENSE BCSALE1 NO-GAPS.
  CONDENSE XLSALE1 NO-GAPS.
  CONDENSE XLPER1 NO-GAPS.
  CONDENSE BCPER1 NO-GAPS.
  CONCATENATE W_LIST-INFO 'BC/BCL SALE' '=' BCSALE1 ', BC%' BCPER1 'XL SALE' XLSALE1 ', XL% '  XLPER1 'LS SALE' LSSALE1 ', LS% '  LSPER1
   INTO
 W_LIST-INFO SEPARATED BY SPACE.
  APPEND W_LIST TO LIST.
  CLEAR W_LIST-INFO.
  TOMLVAL2 = TRUNC( TOMLVAL2 ).
  TNSKVAL2 = TRUNC( TNSKVAL2 ).
  TGOAVAL2 = TRUNC( TGOAVAL2 ).


  CONDENSE TOMLVAL2 NO-GAPS.
  CONDENSE TNSKVAL2 NO-GAPS.
  CONDENSE TGOAVAL2 NO-GAPS.
*  W_VALUE = OMLVAL.
  CONCATENATE W_LIST-INFO 'OML= ' TOMLVAL2 ', NSK= ' TNSKVAL2 ', GOA= ' TGOAVAL2  INTO
  W_LIST-INFO SEPARATED BY SPACE.

  APPEND W_LIST TO LIST.
  TVAL = TOMLVAL2 + TNSKVAL2 + TGOAVAL2.
  CONDENSE TVAL NO-GAPS.

*  CALL FUNCTION 'REUSE_ALV_COMMENTARY_WRITE'
*    EXPORTING
*      IT_LIST_COMMENTARY = LIST.

  CONDENSE TVAL.

ENDFORM.                    "END_OF_LIST
*&---------------------------------------------------------------------*
*&      Form  EXPORTSALE
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM EXPORTSALE .

  SELECT * FROM ZIR1_EXCLUDE  INTO TABLE IT_ZIR1_EXCLUDE."ADDED ON 17.5.23
*  sdate1 = '20220801'.
  SDATE1 = SY-DATUM.
  SDATE1+6(2) = '01'.

*****  SELECT * FROM vbrk INTO TABLE eit_vbrk WHERE fkart EQ 'Z003' AND fkdat GE sdate1 AND fksto NE 'X'.
*********  commented above and added below for Export Merchant bill type
  SELECT * FROM VBRK INTO TABLE EIT_VBRK WHERE FKART IN ('Z003', 'ZSCA') AND FKDAT GE SDATE1 AND FKSTO NE 'X'.
  DELETE EIT_VBRK WHERE VBELN EQ '0130230973'.  "added all three on 28.10.22
  DELETE EIT_VBRK WHERE VBELN EQ '0130230974'.
  DELETE EIT_VBRK WHERE VBELN EQ '0130230975'.

  CLEAR : EXPVAL,EXPVAL1, EXPVAL2 .

  IF EIT_VBRK IS NOT INITIAL.
    LOOP AT EIT_VBRK INTO EWA_VBRK.
      READ TABLE IT_ZIR1_EXCLUDE INTO WA_ZIR1_EXCLUDE WITH KEY VBELN = EWA_VBRK-VBELN.
      IF SY-SUBRC EQ 0.
        DELETE  EIT_VBRK WHERE VBELN EQ WA_ZIR1_EXCLUDE-VBELN.
      ENDIF.
    ENDLOOP.
  ENDIF.

  IF EIT_VBRK IS NOT INITIAL.
    LOOP AT EIT_VBRK INTO EWA_VBRK.
      CLEAR : VAL.
      VAL = EWA_VBRK-NETWR * EWA_VBRK-KURRF.
*      write : / ewa_vbrk-vbeln,ewa_vbrk-netwr,ewa_vbrk-kurrf.
      EXPVAL1 = EXPVAL1 + VAL.
    ENDLOOP.
  ENDIF.
*  expval = expval1 / 1000.
  EXPVAL2 = EXPVAL1 / 1000.
*  expval = expval2.
********** added on 18.11.22
  CLEAR : EXPV1.
  SELECT SINGLE * FROM ZEXPESTSALE WHERE ZMONTH EQ SY-DATUM+4(2) AND ZYEAR EQ SY-DATUM+0(4).
  IF SY-SUBRC EQ 0.
    EXPV1 = ZEXPESTSALE-NETVAL / 1000.
  ENDIF.
  IF EXPV1 GT 0.
    EXPVAL = EXPV1.
  ELSE.
    EXPVAL = EXPVAL2.
  ENDIF.

  TRANSLATE EXPVAL USING ','.

  SELECT * FROM VBRK INTO TABLE TIT_VBRK WHERE FKART EQ 'Z003' AND FKDAT EQ SY-DATUM AND FKSTO NE 'X'.
  CLEAR : TEXPVAL,TEXPVAL1,TEXPVAL2.
  IF TIT_VBRK IS NOT INITIAL.

    LOOP AT TIT_VBRK INTO TWA_VBRK.
      READ TABLE IT_ZIR1_EXCLUDE INTO WA_ZIR1_EXCLUDE WITH KEY VBELN = TWA_VBRK-VBELN.
      IF SY-SUBRC EQ 0.
        DELETE  TIT_VBRK WHERE VBELN EQ WA_ZIR1_EXCLUDE-VBELN.
      ENDIF.
    ENDLOOP.

    LOOP AT TIT_VBRK INTO TWA_VBRK.
      CLEAR : VAL.
      VAL = TWA_VBRK-NETWR * TWA_VBRK-KURRF.
*      WRITE : / EWA_VBRK-VBELN,EWA_VBRK-NETWR,EWA_VBRK-KURRF.
      TEXPVAL1 = TEXPVAL1 + VAL.
    ENDLOOP.
  ENDIF.
*  texpval = texpval1 / 1000.
  TEXPVAL2 = TEXPVAL1 / 1000.
  TEXPVAL = TEXPVAL2.


  SELECT SINGLE * FROM ZIR1_AUTO WHERE DATAB LE SY-DATUM AND DATBI GE SY-DATUM.  "27.4.23
  IF SY-SUBRC EQ 0.
    TEXPVAL = TEXPVAL + ZIR1_AUTO-TSALE.
    EXPVAL = EXPVAL + ZIR1_AUTO-CSALE.
  ENDIF.

  TRANSLATE TEXPVAL USING ','.

***************************  deactivated on 27.10.22*******

*  CLEAR : expval,texpval. "30.9.22
*  expval = 75233.  "cummulative
*  texpval = 17685.
**  break-point.
*  IF sy-datum GE '20221001'.
*    expval = 0.
*    texpval = 0.
*  ENDIF.
*
*  TRANSLATE expval USING ','.
*  TRANSLATE texpval USING ','.

ENDFORM.
*&---------------------------------------------------------------------*
*& Form set_values
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*&      --> <DYN_WA>
*&      --> P_
*&      <-- TS_AHM
*&---------------------------------------------------------------------*
FORM SET_VALUES  USING    P_DYN_WA TYPE ANY
*                          PU_V01  PU_V02  PU_V03  PU_V04  PU_V05
*                          PU_V06  PU_V07  PU_V08  PU_V09  PU_V10
*                          PU_V11  PU_V12  PU_V13  PU_V14  PU_V15
*                          PU_V16  PU_V17  PU_V18  PU_V19  PU_V20
*                          PU_V21  PU_V22  PU_V23  PU_V24  PU_V25

                 CHANGING PC_AHM  PC_BHS  PC_PUN  PC_OZH  PC_DEL
                          PC_COC  PC_MAD  PC_HUB  PC_HYD  PC_VIJ
                          PC_LUC  PC_VAR  PC_MEE  PC_ROH  PC_CHA
                          PC_ZIR  PC_JAI  PC_IND  PC_RAI  PC_PAT
                          PC_RAN  PC_KLC  PC_CTK  PC_NEP  PC_TOT.

  FIELD-SYMBOLS : <LV_FIELD_VAL> TYPE ANY.
* Variables
*  TS_LUC   TS_VAR  TS_MEE  TS_ROH  TS_CHA
*  TS_ZIR   TS_JAI  TS_IND  TS_RAI  TS_PAT
*  TS_RAN   TS_KLC  TS_CTK  TS_NOS  TS_TOT.
  CONSTANTS: LC_AHM  TYPE CHAR05 VALUE '2013',
             LC_BHS  TYPE CHAR05 VALUE '2001',
             LC_MAD  TYPE CHAR05 VALUE '2003',
             LC_CTK  TYPE CHAR05 VALUE '2019',
             LC_GHA  TYPE CHAR05 VALUE '2000',
             LC_GOA  TYPE CHAR05 VALUE '1001',
             LC_GOA2 TYPE CHAR05 VALUE '2024',
             LC_GOA3 TYPE CHAR05 VALUE '1007',
             LC_HUB  TYPE CHAR05 VALUE '2004',
             LC_HYD  TYPE CHAR05 VALUE '2014',
             LC_IND  TYPE CHAR05 VALUE '2007',
             LC_JAI  TYPE CHAR05 VALUE '2011',
*             LC_KOL  TYPE CHAR05 VALUE '2020',
             LC_KLC  TYPE CHAR05 VALUE '2020',
             LC_LUC  TYPE CHAR05 VALUE '2006',
             LC_MEE  TYPE CHAR05 VALUE '2010',
             LC_NSK  TYPE CHAR05 VALUE '1000',
             LC_OZH  TYPE CHAR05 VALUE '2002',
             LC_OZH2 TYPE CHAR05 VALUE '2029',
             LC_PAT  TYPE CHAR05 VALUE '2017',
             LC_PUN  TYPE CHAR05 VALUE '2023',
             LC_PUN2 TYPE CHAR05 VALUE '2030',
             LC_RAI  TYPE CHAR05 VALUE '2016',
             LC_RAN  TYPE CHAR05 VALUE '2015',
             LC_THR  TYPE CHAR05 VALUE '2005',
             LC_VAR  TYPE CHAR05 VALUE '2021',
             LC_VIJ  TYPE CHAR05 VALUE '2026',
             LC_ZIR  TYPE CHAR05 VALUE '2028',
             LC_NEP  TYPE CHAR05 VALUE 'NEP',
             LC_TOT  TYPE CHAR05 VALUE 'TOTAL',

             LC_COC  TYPE CHAR05 VALUE 'COC',
             LC_DEL  TYPE CHAR05 VALUE 'DEL',
             LC_ROH  TYPE CHAR05 VALUE 'ROH',
             LC_CHA  TYPE CHAR05 VALUE 'CHA'.
*             LC_KLC TYPE CHAR05 VALUE 'KLC'.

  CLEAR: PC_TOT.

  ASSIGN COMPONENT LC_AHM OF STRUCTURE P_DYN_WA TO <LV_FIELD_VAL>.
  IF <LV_FIELD_VAL> IS ASSIGNED AND SY-SUBRC = 0.  PC_AHM = <LV_FIELD_VAL>. ENDIF.

  ASSIGN COMPONENT LC_BHS OF STRUCTURE P_DYN_WA TO <LV_FIELD_VAL>.
  IF <LV_FIELD_VAL> IS ASSIGNED AND SY-SUBRC = 0.  PC_BHS = <LV_FIELD_VAL>. ENDIF.

  ASSIGN COMPONENT LC_PUN OF STRUCTURE P_DYN_WA TO <LV_FIELD_VAL>.
  IF <LV_FIELD_VAL> IS ASSIGNED AND SY-SUBRC = 0.  PC_PUN = <LV_FIELD_VAL>. ENDIF.

*  ASSIGN COMPONENT LC_OZH OF STRUCTURE P_DYN_WA TO <LV_FIELD_VAL>.
  ASSIGN COMPONENT LC_NEP OF STRUCTURE P_DYN_WA TO <LV_FIELD_VAL>.
  IF <LV_FIELD_VAL> IS ASSIGNED AND SY-SUBRC = 0.  PC_OZH = <LV_FIELD_VAL>. ENDIF.

  ASSIGN COMPONENT LC_DEL OF STRUCTURE P_DYN_WA TO <LV_FIELD_VAL>.
  IF <LV_FIELD_VAL> IS ASSIGNED AND SY-SUBRC = 0.  PC_DEL = <LV_FIELD_VAL>. ENDIF.

**TS_COC(thrissure LC_THR)   TS_MAD  TS_HUB  TS_HYD  TS_VIJ
  ASSIGN COMPONENT LC_THR OF STRUCTURE P_DYN_WA TO <LV_FIELD_VAL>.
  IF <LV_FIELD_VAL> IS ASSIGNED AND SY-SUBRC = 0.  PC_COC = <LV_FIELD_VAL>. ENDIF.

  ASSIGN COMPONENT LC_MAD OF STRUCTURE P_DYN_WA TO <LV_FIELD_VAL>.
  IF <LV_FIELD_VAL> IS ASSIGNED AND SY-SUBRC = 0.  PC_MAD = <LV_FIELD_VAL>. ENDIF.

  ASSIGN COMPONENT LC_HUB OF STRUCTURE P_DYN_WA TO <LV_FIELD_VAL>.
  IF <LV_FIELD_VAL> IS ASSIGNED AND SY-SUBRC = 0.  PC_HUB = <LV_FIELD_VAL>. ENDIF.

  ASSIGN COMPONENT LC_HYD OF STRUCTURE P_DYN_WA TO <LV_FIELD_VAL>.
  IF <LV_FIELD_VAL> IS ASSIGNED AND SY-SUBRC = 0.  PC_HYD = <LV_FIELD_VAL>. ENDIF.

  ASSIGN COMPONENT LC_VIJ OF STRUCTURE P_DYN_WA TO <LV_FIELD_VAL>.
  IF <LV_FIELD_VAL> IS ASSIGNED AND SY-SUBRC = 0.  PC_VIJ = <LV_FIELD_VAL>. ENDIF.

**TS_LUC   TS_VAR  TS_MEE  TS_ROH  TS_CHA
  ASSIGN COMPONENT LC_LUC OF STRUCTURE P_DYN_WA TO <LV_FIELD_VAL>.
  IF <LV_FIELD_VAL> IS ASSIGNED AND SY-SUBRC = 0.  PC_LUC = <LV_FIELD_VAL>. ENDIF.

  ASSIGN COMPONENT LC_VAR OF STRUCTURE P_DYN_WA TO <LV_FIELD_VAL>.
  IF <LV_FIELD_VAL> IS ASSIGNED AND SY-SUBRC = 0.  PC_VAR = <LV_FIELD_VAL>. ENDIF.

  ASSIGN COMPONENT LC_MEE OF STRUCTURE P_DYN_WA TO <LV_FIELD_VAL>.
  IF <LV_FIELD_VAL> IS ASSIGNED AND SY-SUBRC = 0.  PC_MEE = <LV_FIELD_VAL>. ENDIF.

  ASSIGN COMPONENT LC_ROH OF STRUCTURE P_DYN_WA TO <LV_FIELD_VAL>.
  IF <LV_FIELD_VAL> IS ASSIGNED AND SY-SUBRC = 0.  PC_ROH = <LV_FIELD_VAL>. ENDIF.

  ASSIGN COMPONENT LC_CHA OF STRUCTURE P_DYN_WA TO <LV_FIELD_VAL>.
  IF <LV_FIELD_VAL> IS ASSIGNED AND SY-SUBRC = 0.  PC_CHA = <LV_FIELD_VAL>. ENDIF.

*  TS_ZIR   TS_JAI  TS_IND  TS_RAI  TS_PAT
  ASSIGN COMPONENT LC_ZIR OF STRUCTURE P_DYN_WA TO <LV_FIELD_VAL>.
  IF <LV_FIELD_VAL> IS ASSIGNED AND SY-SUBRC = 0.  PC_ZIR = <LV_FIELD_VAL>. ENDIF.

  ASSIGN COMPONENT LC_JAI OF STRUCTURE P_DYN_WA TO <LV_FIELD_VAL>.
  IF <LV_FIELD_VAL> IS ASSIGNED AND SY-SUBRC = 0.  PC_JAI = <LV_FIELD_VAL>. ENDIF.

  ASSIGN COMPONENT LC_IND OF STRUCTURE P_DYN_WA TO <LV_FIELD_VAL>.
  IF <LV_FIELD_VAL> IS ASSIGNED AND SY-SUBRC = 0.  PC_IND = <LV_FIELD_VAL>. ENDIF.

  ASSIGN COMPONENT LC_RAI OF STRUCTURE P_DYN_WA TO <LV_FIELD_VAL>.
  IF <LV_FIELD_VAL> IS ASSIGNED AND SY-SUBRC = 0.  PC_RAI = <LV_FIELD_VAL>. ENDIF.

  ASSIGN COMPONENT LC_PAT OF STRUCTURE P_DYN_WA TO <LV_FIELD_VAL>.
  IF <LV_FIELD_VAL> IS ASSIGNED AND SY-SUBRC = 0.  PC_PAT = <LV_FIELD_VAL>. ENDIF.

*  TS_RAN   TS_KLC  TS_CTK  TS_NOS  TS_TOT.
  ASSIGN COMPONENT LC_RAN OF STRUCTURE P_DYN_WA TO <LV_FIELD_VAL>.
  IF <LV_FIELD_VAL> IS ASSIGNED AND SY-SUBRC = 0.  PC_RAN = <LV_FIELD_VAL>. ENDIF.

  ASSIGN COMPONENT LC_KLC OF STRUCTURE P_DYN_WA TO <LV_FIELD_VAL>.
  IF <LV_FIELD_VAL> IS ASSIGNED AND SY-SUBRC = 0.  PC_KLC = <LV_FIELD_VAL>. ENDIF.

  ASSIGN COMPONENT LC_CTK OF STRUCTURE P_DYN_WA TO <LV_FIELD_VAL>.
  IF <LV_FIELD_VAL> IS ASSIGNED AND SY-SUBRC = 0.  PC_CTK = <LV_FIELD_VAL>. ENDIF.

*  ASSIGN COMPONENT lc_nep OF STRUCTURE P_DYN_WA TO <LV_FIELD_VAL>.
*  IF <LV_FIELD_VAL> IS ASSIGNED and sy-subrc = 0.  PC_nep = <LV_FIELD_VAL>. ENDIF.

  ASSIGN COMPONENT LC_TOT OF STRUCTURE P_DYN_WA TO <LV_FIELD_VAL>.
  IF <LV_FIELD_VAL> IS ASSIGNED AND SY-SUBRC = 0.  PC_TOT = <LV_FIELD_VAL>. ENDIF.

  PC_TOT = PC_AHM + PC_BHS + PC_PUN + PC_OZH + PC_DEL +
           PC_COC + PC_MAD + PC_HUB + PC_HYD + PC_VIJ +
           PC_LUC + PC_VAR + PC_MEE + PC_ROH + PC_CHA +
           PC_ZIR + PC_JAI + PC_IND + PC_RAI + PC_PAT +
           PC_RAN + PC_KLC + PC_CTK.
ENDFORM.
